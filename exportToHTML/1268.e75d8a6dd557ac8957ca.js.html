<html>
<head>
<title>1268.e75d8a6dd557ac8957ca.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #cf8e6d;}
.s5 { color: #42c3d4;}
.ln { color: #4b5059; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
1268.e75d8a6dd557ac8957ca.js</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">&quot;use strict&quot;</span><span class="s1">;(</span><span class="s2">self</span><span class="s1">[</span><span class="s0">&quot;webpackChunk_jupyterlab_application_top&quot;</span><span class="s1">]=</span><span class="s2">self</span><span class="s1">[</span><span class="s0">&quot;webpackChunk_jupyterlab_application_top&quot;</span><span class="s1">]||[]).</span><span class="s2">push</span><span class="s1">([[</span><span class="s3">1268</span><span class="s1">],{</span><span class="s3">91268</span><span class="s1">:(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,{</span><span class="s2">KO</span><span class="s1">:()=&gt;</span><span class="s2">us</span><span class="s1">});</span><span class="s4">var </span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">66575</span><span class="s1">);</span><span class="s4">var </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">n</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">var </span><span class="s2">r</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">27421</span><span class="s1">);</span><span class="s4">var </span><span class="s2">l</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">65606</span><span class="s1">);</span><span class="s4">class </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">o </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">,</span><span class="s2">u</span><span class="s1">,</span><span class="s2">h</span><span class="s1">,</span><span class="s2">f</span><span class="s1">,</span><span class="s2">c</span><span class="s1">,</span><span class="s2">p</span><span class="s1">,</span><span class="s2">d</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">topRules</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">localTokens</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">context</span><span class="s1">=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalTokens</span><span class="s1">=</span><span class="s2">l</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalSpecializers</span><span class="s1">=</span><span class="s2">a</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalPropSources</span><span class="s1">=</span><span class="s2">o</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precedences</span><span class="s1">=</span><span class="s2">u</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">mainSkip</span><span class="s1">=</span><span class="s2">h</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">scopedSkip</span><span class="s1">=</span><span class="s2">f</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dialects</span><span class="s1">=</span><span class="s2">c</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalProps</span><span class="s1">=</span><span class="s2">p</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">autoDelim</span><span class="s1">=</span><span class="s2">d</span><span class="s1">}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">values</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">u </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">params</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">=</span><span class="s2">n</span><span class="s1">}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">+(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">`&lt;</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">join</span><span class="s1">()}</span><span class="s0">&gt;`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)+</span><span class="s0">&quot; -&gt; &quot;</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">h </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">items</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">f </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">items</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">c </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">a</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">p </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precedences</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">literals</span><span class="s1">=</span><span class="s2">n</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">d </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precedences</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">m </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">literal</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">g </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">source</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">k </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">source</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">x </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">token</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">source</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">=</span><span class="s2">r</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">b </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">source</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">w </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalID</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">source</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">y </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">$ </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">(</span><span class="s4">this</span><span class="s1">)}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s2">$</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">=</span><span class="s3">10</span><span class="s1">;</span><span class="s4">class </span><span class="s2">v </span><span class="s4">extends </span><span class="s2">${constructor(e,t,s){super(e);this.id=t;this.args=s}toString</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">+(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">`&lt;</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">join</span><span class="s1">()}</span><span class="s0">&gt;`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">&amp;&amp;</span><span class="s2">G</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">args</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">)}</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">C</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">args</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">args</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">v</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))}}</span><span class="s4">class </span><span class="s2">S </span><span class="s4">extends </span><span class="s2">${constructor(e,t,s,i,n){super(e);this.type=t;this.props=s;this.token=i;this.content=n}toString</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">`@</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">}</span><span class="s0">[</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">)}</span><span class="s0">]&lt;</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">token</span><span class="s1">}</span><span class="s0">, </span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">}</span><span class="s0">&gt;`</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">&amp;&amp;</span><span class="s2">E</span><span class="s1">.</span><span class="s2">eqProps</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">)&amp;&amp;</span><span class="s2">D</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">token</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">token</span><span class="s1">)&amp;&amp;</span><span class="s2">D</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">content</span><span class="s1">)}</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">token</span><span class="s1">.</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">.</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">token</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">content</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">S</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">))}}</span><span class="s4">class </span><span class="s2">T </span><span class="s4">extends </span><span class="s2">${constructor(e,t){super(e);this.rule=t}toString</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">;</span><span class="s4">return</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">`[</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">)}</span><span class="s0">]`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">} </span><span class="s0">{ </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">} </span><span class="s0">}`</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">;</span><span class="s4">return </span><span class="s2">D</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">)&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">&amp;&amp;</span><span class="s2">E</span><span class="s1">.</span><span class="s2">eqProps</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">props</span><span class="s1">)}</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">.</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">(</span><span class="s2">s</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">T</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s4">new </span><span class="s2">u</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,[],</span><span class="s2">s</span><span class="s1">)))}}</span><span class="s4">class </span><span class="s2">O </span><span class="s4">extends </span><span class="s2">${constructor(e,t){super(e);this.exprs=t}toString</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">_</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">))).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; | &quot;</span><span class="s1">)}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">G</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">)}</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">C</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">O</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))}}</span><span class="s2">O</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s4">class </span><span class="s2">R </span><span class="s4">extends </span><span class="s2">${constructor(e,t,s,i=false){super(e);this.exprs=t;this.markers=s;this.empty=i}toString</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">?</span><span class="s0">&quot;()&quot;</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">_</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">))).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">)}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">G</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">)&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">markers</span><span class="s1">.</span><span class="s2">every</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">markers</span><span class="s1">[</span><span class="s2">s</span><span class="s1">];</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">every</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">i</span><span class="s1">[</span><span class="s2">t</span><span class="s1">])))}))}</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">C</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">R</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">markers</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">&amp;&amp;!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">))}}</span><span class="s2">R</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">=</span><span class="s3">2</span><span class="s1">;</span><span class="s4">class </span><span class="s2">P </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;ambig&quot;</span><span class="s1">?</span><span class="s0">&quot;~&quot;</span><span class="s1">:</span><span class="s0">&quot;!&quot;</span><span class="s1">)+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">j </span><span class="s4">extends </span><span class="s2">${constructor(e,t,s){super(e);this.expr=t;this.kind=s}toString</span><span class="s1">(){</span><span class="s4">return </span><span class="s2">_</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s4">this</span><span class="s1">)+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">kind</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">D</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">)&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">kind</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">kind</span><span class="s1">}</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">.</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">j</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">kind</span><span class="s1">))}}</span><span class="s2">j</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">=</span><span class="s3">3</span><span class="s1">;</span><span class="s4">class </span><span class="s2">N </span><span class="s4">extends </span><span class="s2">${constructor(e,t){super(e);this.value=t}toString</span><span class="s1">(){</span><span class="s4">return </span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">A </span><span class="s4">extends </span><span class="s2">${constructor(e,t,s){super(e);this.ranges=t;this.inverted=s}toString</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">`[</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">inverted</span><span class="s1">?</span><span class="s0">&quot;^&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((([</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">])=&gt;</span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCodePoint</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)+(</span><span class="s2">t</span><span class="s1">==</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">?</span><span class="s0">&quot;&quot;</span><span class="s1">:</span><span class="s0">&quot;-&quot;</span><span class="s1">+</span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCodePoint</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))))}</span><span class="s0">]`</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">inverted</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">inverted</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((([</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">],</span><span class="s2">i</span><span class="s1">)=&gt;{</span><span class="s4">let</span><span class="s1">[</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">]=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">return </span><span class="s2">t</span><span class="s1">==</span><span class="s2">n</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">==</span><span class="s2">r</span><span class="s1">}))}}</span><span class="s4">class </span><span class="s2">z </span><span class="s4">extends </span><span class="s2">${constructor(e){super(e)}toString</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">&quot;_&quot;</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(){</span><span class="s4">return true</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">C</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">walk</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]&amp;&amp;!</span><span class="s2">s</span><span class="s1">)</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">||</span><span class="s2">e</span><span class="s1">}</span><span class="s4">const </span><span class="s2">I</span><span class="s1">={</span><span class="s2">asciiLetter</span><span class="s1">:[[</span><span class="s3">65</span><span class="s1">,</span><span class="s3">91</span><span class="s1">],[</span><span class="s3">97</span><span class="s1">,</span><span class="s3">123</span><span class="s1">]],</span><span class="s2">asciiLowercase</span><span class="s1">:[[</span><span class="s3">97</span><span class="s1">,</span><span class="s3">123</span><span class="s1">]],</span><span class="s2">asciiUppercase</span><span class="s1">:[[</span><span class="s3">65</span><span class="s1">,</span><span class="s3">91</span><span class="s1">]],</span><span class="s2">digit</span><span class="s1">:[[</span><span class="s3">48</span><span class="s1">,</span><span class="s3">58</span><span class="s1">]],</span><span class="s2">whitespace</span><span class="s1">:[[</span><span class="s3">9</span><span class="s1">,</span><span class="s3">14</span><span class="s1">],[</span><span class="s3">32</span><span class="s1">,</span><span class="s3">33</span><span class="s1">],[</span><span class="s3">133</span><span class="s1">,</span><span class="s3">134</span><span class="s1">],[</span><span class="s3">160</span><span class="s1">,</span><span class="s3">161</span><span class="s1">],[</span><span class="s3">5760</span><span class="s1">,</span><span class="s3">5761</span><span class="s1">],[</span><span class="s3">8192</span><span class="s1">,</span><span class="s3">8203</span><span class="s1">],[</span><span class="s3">8232</span><span class="s1">,</span><span class="s3">8234</span><span class="s1">],[</span><span class="s3">8239</span><span class="s1">,</span><span class="s3">8240</span><span class="s1">],[</span><span class="s3">8287</span><span class="s1">,</span><span class="s3">8288</span><span class="s1">],[</span><span class="s3">12288</span><span class="s1">,</span><span class="s3">12289</span><span class="s1">]],</span><span class="s2">eof</span><span class="s1">:[[</span><span class="s3">65535</span><span class="s1">,</span><span class="s3">65535</span><span class="s1">]]};</span><span class="s4">class </span><span class="s2">q </span><span class="s4">extends </span><span class="s2">${constructor(e,t){super(e);this.type=t}toString</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">&quot;@&quot;</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">D</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">constructor</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">constructor</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">G</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">every</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;</span><span class="s2">D</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])))}</span><span class="s4">class </span><span class="s2">E </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">at</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">every</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s2">s</span><span class="s1">].</span><span class="s2">value</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s2">s</span><span class="s1">].</span><span class="s2">name</span><span class="s1">))}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">at</span><span class="s1">?</span><span class="s0">&quot;@&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s2">e</span><span class="s1">+=</span><span class="s0">&quot;=&quot;</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">value</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}</span><span class="s2">of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)</span><span class="s2">e</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">?</span><span class="s0">`{</span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">}</span><span class="s0">}`</span><span class="s1">:</span><span class="s5">/[^\w-]/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)?</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">s</span><span class="s1">):</span><span class="s2">s</span><span class="s1">}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s4">static </span><span class="s2">eqProps</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">every</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])))}}</span><span class="s4">class </span><span class="s2">J </span><span class="s4">extends </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">_</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">?</span><span class="s0">&quot;(&quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">toString</span><span class="s1">()+</span><span class="s0">&quot;)&quot;</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">toString</span><span class="s1">()}</span><span class="s4">class </span><span class="s2">B </span><span class="s4">extends </span><span class="s2">Error</span><span class="s1">{}</span><span class="s4">function </span><span class="s2">U</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t </span><span class="s4">in </span><span class="s2">e</span><span class="s1">)</span><span class="s4">return true</span><span class="s1">;</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">let </span><span class="s2">M</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">class </span><span class="s2">F</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">={}){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">=++</span><span class="s2">M</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">=[]}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s2">get nodeType</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">top</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">||</span><span class="s2">U</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">)||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">repeated</span><span class="s1">}</span><span class="s2">get terminal</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">1</span><span class="s1">)&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">get eof</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">4</span><span class="s1">)&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">get error</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">&quot;error&quot;</span><span class="s4">in this</span><span class="s1">.</span><span class="s2">props</span><span class="s1">}</span><span class="s2">get top</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">2</span><span class="s1">)&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">get interesting</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">}</span><span class="s2">get repeated</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">16</span><span class="s1">)&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">set preserve</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">=</span><span class="s2">e</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">|</span><span class="s3">8</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;~</span><span class="s3">8</span><span class="s1">}</span><span class="s2">get preserve</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">8</span><span class="s1">)&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">set inline</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">=</span><span class="s2">e</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">|</span><span class="s3">32</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;~</span><span class="s3">32</span><span class="s1">}</span><span class="s2">get inline</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">32</span><span class="s1">)&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">L</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">names</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tops</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">eof</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,</span><span class="s3">1</span><span class="s1">|</span><span class="s3">4</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s3">8</span><span class="s1">)}</span><span class="s2">term</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">={}){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">new </span><span class="s2">F</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">names</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}</span><span class="s2">makeTop</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">(</span><span class="s0">&quot;@top&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s3">2</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tops</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s2">makeTerminal</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">={}){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s3">1</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">makeNonTerminal</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">={}){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">makeRepeat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,</span><span class="s3">16</span><span class="s1">)}</span><span class="s2">uniqueName</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;</span><span class="s2">t</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">?</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s0">-</span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">}</span><span class="s0">`</span><span class="s1">:</span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">names</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}}</span><span class="s2">finish</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of e</span><span class="s1">)</span><span class="s2">r</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">preserve</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">t</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))));</span><span class="s4">let </span><span class="s2">t</span><span class="s1">={};</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">id</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">nodeType</span><span class="s1">&amp;&amp;!</span><span class="s2">r</span><span class="s1">.</span><span class="s2">repeated</span><span class="s1">){</span><span class="s2">r</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">i</span><span class="s1">++;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">repeated</span><span class="s1">){</span><span class="s2">r</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">i</span><span class="s1">++;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">eof</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">i</span><span class="s1">++;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">id</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">r</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">i</span><span class="s1">++;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)</span><span class="s2">t</span><span class="s1">[</span><span class="s2">r</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&gt;=</span><span class="s3">65534</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">B</span><span class="s1">(</span><span class="s0">&quot;Too many terms&quot;</span><span class="s1">);</span><span class="s4">return</span><span class="s1">{</span><span class="s2">nodeTypes</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">names</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">minRepeatTerm</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">maxTerm</span><span class="s1">:</span><span class="s2">i</span><span class="s1">-</span><span class="s3">1</span><span class="s1">}}}</span><span class="s4">function </span><span class="s2">W</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}</span><span class="s4">return </span><span class="s3">0</span><span class="s1">}</span><span class="s4">const </span><span class="s2">K</span><span class="s1">=[];</span><span class="s4">class </span><span class="s2">Y</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s2">K</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precedence</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigGroups</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cut</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}</span><span class="s2">join</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">==</span><span class="s2">Y</span><span class="s1">.</span><span class="s2">none</span><span class="s1">||</span><span class="s4">this</span><span class="s1">==</span><span class="s2">e</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s2">Y</span><span class="s1">.</span><span class="s2">none</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">;</span><span class="s4">return new </span><span class="s2">Y</span><span class="s1">(</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precedence</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">precedence</span><span class="s1">),</span><span class="s2">Z</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigGroups</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ambigGroups</span><span class="s1">),</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cut</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">cut</span><span class="s1">))}</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">precedence</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">precedence</span><span class="s1">||</span><span class="s2">W</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigGroups</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ambigGroups</span><span class="s1">,((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">))||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cut</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">cut</span><span class="s1">}}</span><span class="s2">Y</span><span class="s1">.</span><span class="s2">none</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Y</span><span class="s1">(</span><span class="s3">0</span><span class="s1">);</span><span class="s4">function </span><span class="s2">Z</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">||</span><span class="s2">e</span><span class="s1">==</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">i</span><span class="s1">))</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">return </span><span class="s2">s</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">()}</span><span class="s4">let </span><span class="s2">H</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">class </span><span class="s2">Q</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">H</span><span class="s1">++}</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s2">cmpNoName</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">reduce</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">||</span><span class="s2">s</span><span class="s1">.</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s2">i</span><span class="s1">])),</span><span class="s3">0</span><span class="s1">)||</span><span class="s2">W</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">,((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">+</span><span class="s0">&quot; -&gt; &quot;</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">)}</span><span class="s2">get isRepeatWrap</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">repeated</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">2</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s2">sameReduce</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isRepeatWrap</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">isRepeatWrap</span><span class="s1">}}</span><span class="s4">const </span><span class="s2">V</span><span class="s1">=</span><span class="s3">65535</span><span class="s1">;</span><span class="s4">class </span><span class="s2">X</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">target</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">`-&gt; </span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s0">[label=</span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s0">&quot;&quot;</span><span class="s1">:</span><span class="s2">ee</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">)+(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">+</span><span class="s3">1</span><span class="s1">?</span><span class="s0">&quot;-&quot;</span><span class="s1">+</span><span class="s2">ee</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s3">1</span><span class="s1">):</span><span class="s0">&quot;&quot;</span><span class="s1">))}</span><span class="s0">]`</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">ee</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">V</span><span class="s1">?</span><span class="s0">&quot;&quot;</span><span class="s1">:</span><span class="s2">e</span><span class="s1">==</span><span class="s3">10</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\\</span><span class="s0">n&quot;</span><span class="s1">:</span><span class="s2">e</span><span class="s1">==</span><span class="s3">13</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\\</span><span class="s0">r&quot;</span><span class="s1">:</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">32</span><span class="s1">||</span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s3">55296</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">57343</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\\</span><span class="s0">u{&quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">toString</span><span class="s1">(</span><span class="s3">16</span><span class="s1">)+</span><span class="s0">&quot;}&quot;</span><span class="s1">:</span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCharCode</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">te</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">oe</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">);</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]||(</span><span class="s2">i</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=[]);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s2">s</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">false</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">])</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">){</span><span class="s2">n</span><span class="s1">[</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">continue</span><span class="s1">}</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=[];</span><span class="s2">e</span><span class="s1">:</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of r</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">se</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">s</span><span class="s1">)){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">continue </span><span class="s2">e</span><span class="s1">}}</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">([</span><span class="s2">t</span><span class="s1">])}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">1</span><span class="s1">)</span><span class="s2">i</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of r</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">)</span><span class="s2">n</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">)</span><span class="s4">return </span><span class="s2">ie</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">se</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">from</span><span class="s1">!=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">from</span><span class="s1">||</span><span class="s2">n</span><span class="s1">.</span><span class="s2">to</span><span class="s1">!=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">||</span><span class="s2">s</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]!=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">r</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">])</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ie</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">[</span><span class="s2">e</span><span class="s1">],</span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">][</span><span class="s3">0</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s4">new </span><span class="s2">X</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">][</span><span class="s3">0</span><span class="s1">]}</span><span class="s4">let </span><span class="s2">ne</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s4">let </span><span class="s2">re</span><span class="s1">=</span><span class="s4">class </span><span class="s2">e</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">=[],</span><span class="s2">t</span><span class="s1">=</span><span class="s2">ne</span><span class="s1">++){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">=[]}</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">X</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">))}</span><span class="s2">nullEdge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(-</span><span class="s3">1</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">compile</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">n</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">closure</span><span class="s1">().</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)));</span><span class="s4">return </span><span class="s2">te</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">values</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">i</span><span class="s1">);</span><span class="s4">function </span><span class="s2">n</span><span class="s1">(</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">oe</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)]=</span><span class="s4">new </span><span class="s2">e</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">reduce</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">Z</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">)),[]),</span><span class="s2">s</span><span class="s1">++);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of i</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of e</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">l</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">fe</span><span class="s1">(</span><span class="s2">l</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of a</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">targets</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">));</span><span class="s2">r</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">t</span><span class="s1">[</span><span class="s2">oe</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)]||</span><span class="s2">n</span><span class="s1">(</span><span class="s2">s</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">r</span><span class="s1">}}</span><span class="s2">closure</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[],</span><span class="s2">t</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">function </span><span class="s2">s</span><span class="s1">(</span><span class="s2">i</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">])</span><span class="s4">return</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">))||</span><span class="s2">i</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">&amp;&amp;!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">ue</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">))))</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of i</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">s</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">)}</span><span class="s2">s</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s2">findConflicts</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[],</span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cycleTerms</span><span class="s1">();</span><span class="s4">function </span><span class="s2">i</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">){[</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">]=[</span><span class="s2">s</span><span class="s1">,</span><span class="s2">e</span><span class="s1">];</span><span class="s2">i</span><span class="s1">=-</span><span class="s2">i</span><span class="s1">}</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">a</span><span class="s1">==</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">b</span><span class="s1">==</span><span class="s2">s</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">le</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">ae</span><span class="s1">(</span><span class="s2">n</span><span class="s1">),</span><span class="s2">r</span><span class="s1">&amp;&amp;</span><span class="s2">ae</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)));</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">soft</span><span class="s1">!=</span><span class="s2">i</span><span class="s1">)</span><span class="s2">l</span><span class="s1">.</span><span class="s2">soft</span><span class="s1">=</span><span class="s3">0</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">reachable</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++)</span><span class="s2">i</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">[</span><span class="s2">e</span><span class="s1">],</span><span class="s2">t</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">reachable</span><span class="s1">(((</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">)=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">a of r</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">a</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o of t</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">!=</span><span class="s2">o</span><span class="s1">)</span><span class="s2">i</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">,</span><span class="s2">r</span><span class="s1">||</span><span class="s2">s</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">o</span><span class="s1">)||!</span><span class="s2">e</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">)?</span><span class="s3">0</span><span class="s1">:</span><span class="s3">1</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">l</span><span class="s1">))}}))}));</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">cycleTerms</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">reachable</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">target</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}</span><span class="s2">of t</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}));</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">++],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">++];</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=[]);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">r</span><span class="s1">))</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s2">r</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">i</span><span class="s1">))</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of l</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s2">l</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)}}</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of s</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of n</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s2">reachable</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[],</span><span class="s2">s</span><span class="s1">=[];(</span><span class="s4">function </span><span class="s2">i</span><span class="s1">(</span><span class="s2">n</span><span class="s1">){</span><span class="s2">e</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of n</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">)){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">i</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">()}})(</span><span class="s4">this</span><span class="s1">)}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s0">&quot;digraph {</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">reachable</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">+=</span><span class="s0">`  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">} </span><span class="s0">[label=</span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">join</span><span class="s1">())}</span><span class="s0">];</span><span class="s4">\n</span><span class="s0">`</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of t</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">)</span><span class="s2">e</span><span class="s1">+=</span><span class="s0">`  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">} </span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">}</span><span class="s0">;</span><span class="s4">\n</span><span class="s0">`</span><span class="s1">}));</span><span class="s4">return </span><span class="s2">e</span><span class="s1">+</span><span class="s0">&quot;}&quot;</span><span class="s1">}</span><span class="s2">toArray</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">reachable</span><span class="s1">((</span><span class="s2">n</span><span class="s1">=&gt;{</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">r</span><span class="s1">+</span><span class="s3">3</span><span class="s1">+</span><span class="s2">n</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">length</span><span class="s1">*</span><span class="s3">2</span><span class="s1">;</span><span class="s2">s</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">r</span><span class="s1">;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">stateMask</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">l</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of n</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]||</span><span class="s3">65535</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of n</span><span class="s1">.</span><span class="s2">edges</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">-</span><span class="s3">1</span><span class="s1">)}));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">i</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">[-</span><span class="s2">i</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]-</span><span class="s3">1</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">pow</span><span class="s1">(</span><span class="s3">2</span><span class="s1">,</span><span class="s3">16</span><span class="s1">))</span><span class="s4">throw new </span><span class="s2">B</span><span class="s1">(</span><span class="s0">&quot;Tokenizer tables too big to represent with 16-bit offsets.&quot;</span><span class="s1">);</span><span class="s4">return </span><span class="s2">Uint16Array</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s2">stateMask</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">reachable</span><span class="s1">((</span><span class="s2">s</span><span class="s1">=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of s</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">)</span><span class="s2">t</span><span class="s1">|=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]||</span><span class="s3">65535</span><span class="s1">}));</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}};</span><span class="s4">let </span><span class="s2">le</span><span class="s1">=</span><span class="s4">class </span><span class="s2">e</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">a</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">soft</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">exampleA</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">exampleB</span><span class="s1">=</span><span class="s2">n</span><span class="s1">}};</span><span class="s4">function </span><span class="s2">ae</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++)</span><span class="s2">t</span><span class="s1">+=</span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCharCode</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">].</span><span class="s2">from</span><span class="s1">);</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">oe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">t</span><span class="s1">+=</span><span class="s0">&quot;-&quot;</span><span class="s1">;</span><span class="s2">t</span><span class="s1">+=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ue</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]!=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">class </span><span class="s2">he</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">targets</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">fe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[],</span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">from</span><span class="s1">))</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">from</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">to</span><span class="s1">))</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)}</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">-</span><span class="s3">1</span><span class="s1">],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of e</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&gt;</span><span class="s2">i</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&lt;</span><span class="s2">r</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">closure</span><span class="s1">())</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s2">l</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">he</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">))}</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s3">65535</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">to</span><span class="s1">==</span><span class="s3">65535</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of i</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">closure</span><span class="s1">())</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">s</span><span class="s1">))</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">he</span><span class="s1">(</span><span class="s3">65535</span><span class="s1">,</span><span class="s3">65535</span><span class="s1">,</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">let </span><span class="s2">ce</span><span class="s1">=</span><span class="s5">/[\w_-]+/gy</span><span class="s1">;</span><span class="s4">try</span><span class="s1">{</span><span class="s2">ce</span><span class="s1">=</span><span class="s5">/[\p{Alphabetic}\d_-]+/guy</span><span class="s1">}</span><span class="s4">catch</span><span class="s1">(</span><span class="s2">ds</span><span class="s1">){}</span><span class="s4">const </span><span class="s2">pe</span><span class="s1">=[];</span><span class="s4">class </span><span class="s2">de</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fileName</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">=</span><span class="s0">&quot;sof&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">end</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s2">lineInfo</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">1</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">){++</span><span class="s2">t</span><span class="s1">;</span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">return</span><span class="s1">{</span><span class="s2">line</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">ch</span><span class="s1">:</span><span class="s2">e</span><span class="s1">-</span><span class="s2">s</span><span class="s1">}}}}</span><span class="s2">message</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fileName</span><span class="s1">||</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lineInfo</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">s</span><span class="s1">+=(</span><span class="s2">s</span><span class="s1">?</span><span class="s0">&quot; &quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">line</span><span class="s1">+</span><span class="s0">&quot;:&quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ch</span><span class="s1">}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">?</span><span class="s2">e</span><span class="s1">+</span><span class="s0">` (</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">:</span><span class="s2">e</span><span class="s1">}</span><span class="s2">raise</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">throw new </span><span class="s2">B</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">message</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))}</span><span class="s2">match</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">exec</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">e</span><span class="s1">));</span><span class="s4">return </span><span class="s2">s</span><span class="s1">?</span><span class="s2">e</span><span class="s1">+</span><span class="s2">s</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">length</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">}</span><span class="s2">next</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">match</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">end</span><span class="s1">,</span><span class="s5">/^(\s|\/\/.*|\/\*[^]*?\*\/)*/</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;eof&quot;</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s0">'&quot;'</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">match</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s5">/^(\\.|[^&quot;\\])*&quot;/</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Unterminated string literal&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;string&quot;</span><span class="s1">,</span><span class="s2">Je</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">-</span><span class="s3">1</span><span class="s1">)),</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;'&quot;</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">match</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s5">/^(\\.|[^'\\])*'/</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Unterminated string literal&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;string&quot;</span><span class="s1">,</span><span class="s2">Je</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">-</span><span class="s3">1</span><span class="s1">)),</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;@&quot;</span><span class="s1">){</span><span class="s2">ce</span><span class="s1">.</span><span class="s2">lastIndex</span><span class="s1">=</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">ce</span><span class="s1">.</span><span class="s2">exec</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;@ without a name&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">e</span><span class="s1">,</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">+</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">length</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">((</span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;$&quot;</span><span class="s1">||</span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;!&quot;</span><span class="s1">)&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">[</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">]==</span><span class="s0">&quot;[&quot;</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">match</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">2</span><span class="s1">,</span><span class="s5">/^(?:\\.|[^\]\\])*\]/</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Unterminated character set&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;set&quot;</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">2</span><span class="s1">,</span><span class="s2">t</span><span class="s1">-</span><span class="s3">1</span><span class="s1">),</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s5">/[\[\]()!~+*?{}&lt;&gt;\.,|:$=]/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">ce</span><span class="s1">.</span><span class="s2">lastIndex</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">ce</span><span class="s1">.</span><span class="s2">exec</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Unexpected character &quot;</span><span class="s1">+</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s2">s</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">e</span><span class="s1">,</span><span class="s2">e</span><span class="s1">+</span><span class="s2">s</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">length</span><span class="s1">)}}</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">end</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}</span><span class="s2">eat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s2">e</span><span class="s1">&amp;&amp;(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">null</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">===</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">return false</span><span class="s1">}}</span><span class="s2">unexpected</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Unexpected token '</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">string</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">end</span><span class="s1">)}</span><span class="s0">'`</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}</span><span class="s2">expect</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">||!(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">null</span><span class="s1">||</span><span class="s2">s</span><span class="s1">===</span><span class="s2">t</span><span class="s1">))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">unexpected</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s2">parse</span><span class="s1">(){</span><span class="s4">return </span><span class="s2">me</span><span class="s1">(</span><span class="s4">this</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">me</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">f</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">c</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">p</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">d</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">m</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">k</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">x</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">!=</span><span class="s0">&quot;eof&quot;</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;top&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">!=</span><span class="s0">&quot;id&quot;</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Top rules must have a name`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s2">m</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)));</span><span class="s2">k</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;at&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s0">&quot;tokens&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Multiple @tokens declaractions`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">else </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Ne</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;local&quot;</span><span class="s1">)){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;tokens&quot;</span><span class="s1">);</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Ae</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;context&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Multiple @context declarations`</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;from&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;string&quot;</span><span class="s1">);</span><span class="s2">h</span><span class="s1">=</span><span class="s4">new </span><span class="s2">g</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;external&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;tokens&quot;</span><span class="s1">))</span><span class="s2">f</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">qe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">));</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;prop&quot;</span><span class="s1">))</span><span class="s2">p</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Ee</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">));</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;extend&quot;</span><span class="s1">))</span><span class="s2">c</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">De</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;extend&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">));</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;specialize&quot;</span><span class="s1">))</span><span class="s2">c</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">De</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;specialize&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">));</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;propSource&quot;</span><span class="s1">))</span><span class="s2">d</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">));</span><span class="s4">else </span><span class="s2">e</span><span class="s1">.</span><span class="s2">unexpected</span><span class="s1">()}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;dialects&quot;</span><span class="s1">)){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;{&quot;</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">);</span><span class="s2">t</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">);</span><span class="s2">u</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;at&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s0">&quot;precedence&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Multiple precedence declarations`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s2">i</span><span class="s1">=</span><span class="s2">je</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;detectDelim&quot;</span><span class="s1">)){</span><span class="s2">x</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;skip&quot;</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">be</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;{&quot;</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;top&quot;</span><span class="s1">)){</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)));</span><span class="s2">k</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}}</span><span class="s2">a</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">expr</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">topRules</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">rules</span><span class="s1">:</span><span class="s2">s</span><span class="s1">})}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Multiple top-level skip declarations`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">k</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Missing @top declaration`</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">o</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">m</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">h</span><span class="s1">,</span><span class="s2">f</span><span class="s1">,</span><span class="s2">c</span><span class="s1">,</span><span class="s2">d</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">u</span><span class="s1">,</span><span class="s2">p</span><span class="s1">,</span><span class="s2">x</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">start</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">||</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">ke</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;&lt;&quot;</span><span class="s1">))</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;&gt;&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">);</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">be</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">u</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">ke</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">!=</span><span class="s0">&quot;[&quot;</span><span class="s1">)</span><span class="s4">return </span><span class="s2">pe</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;[&quot;</span><span class="s1">);</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;]&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">xe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">xe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;at&quot;</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">)&amp;&amp;!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">))</span><span class="s2">e</span><span class="s1">.</span><span class="s2">unexpected</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;=&quot;</span><span class="s1">))</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;string&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;id&quot;</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">J</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">,</span><span class="s4">null</span><span class="s1">));</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;.&quot;</span><span class="s1">)){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">J</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s0">&quot;.&quot;</span><span class="s1">,</span><span class="s4">null</span><span class="s1">))}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;{&quot;</span><span class="s1">)){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">J</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">)));</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">break</span><span class="s1">}}</span><span class="s4">return new </span><span class="s2">E</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">be</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;{&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Re</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">);</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">const </span><span class="s2">we</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">function </span><span class="s2">ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;(&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;)&quot;</span><span class="s1">))</span><span class="s4">return new </span><span class="s2">R</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">pe</span><span class="s1">,[</span><span class="s2">pe</span><span class="s1">,</span><span class="s2">pe</span><span class="s1">]);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Re</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;)&quot;</span><span class="s1">);</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;string&quot;</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return new </span><span class="s2">R</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">pe</span><span class="s1">,[</span><span class="s2">pe</span><span class="s1">,</span><span class="s2">pe</span><span class="s1">]);</span><span class="s4">return new </span><span class="s2">N</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;_&quot;</span><span class="s1">)){</span><span class="s4">return new </span><span class="s2">z</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;set&quot;</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">string</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">]==</span><span class="s0">&quot;!&quot;</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Je</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s5">/\\.|-|&quot;/g</span><span class="s1">,(</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">==</span><span class="s0">&quot;-&quot;</span><span class="s1">?</span><span class="s2">we</span><span class="s1">:</span><span class="s2">e</span><span class="s1">==</span><span class="s0">'&quot;'</span><span class="s1">?</span><span class="s0">'</span><span class="s4">\\</span><span class="s0">&quot;'</span><span class="s1">:</span><span class="s2">e</span><span class="s1">)));</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">codePointAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">t</span><span class="s1">+=</span><span class="s2">s</span><span class="s1">&gt;</span><span class="s3">65535</span><span class="s1">?</span><span class="s3">2</span><span class="s1">:</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]==</span><span class="s2">we</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">codePointAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">+</span><span class="s3">1</span><span class="s1">);</span><span class="s2">t</span><span class="s1">+=</span><span class="s2">i</span><span class="s1">&gt;</span><span class="s3">65535</span><span class="s1">?</span><span class="s3">3</span><span class="s1">:</span><span class="s3">2</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Invalid character range&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s2">ve</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">==</span><span class="s2">we</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s3">0</span><span class="s1">))</span><span class="s2">s</span><span class="s1">=</span><span class="s3">45</span><span class="s1">;</span><span class="s2">ve</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">)}}</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">return new </span><span class="s2">A</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]-</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">])),</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;at&quot;</span><span class="s1">&amp;&amp;(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s0">&quot;specialize&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s0">&quot;extend&quot;</span><span class="s1">)){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">start</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">value</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">ke</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;&lt;&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Re</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">r</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">)){</span><span class="s2">r</span><span class="s1">=</span><span class="s2">Re</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">n </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">){</span><span class="s2">r</span><span class="s1">=</span><span class="s2">n</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`@</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">} </span><span class="s0">requires two arguments when its first argument isn't a literal string`</span><span class="s1">)}</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;&gt;&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">S</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;at&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">I</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">new </span><span class="s2">q</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;[&quot;</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">new </span><span class="s2">y</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s0">&quot;_anon&quot;</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Inline rules can't have parameters`</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">T</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;[&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;{&quot;</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Inline rules can't have parameters`</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">T</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;.&quot;</span><span class="s1">)&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;std&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">I</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">q</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">return new </span><span class="s2">v</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">$e</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}}}</span><span class="s4">function </span><span class="s2">$e</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;&lt;&quot;</span><span class="s1">))</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;&gt;&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Re</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ve</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((([</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">])=&gt;</span><span class="s2">t</span><span class="s1">&lt;=</span><span class="s2">s</span><span class="s1">||</span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s2">i</span><span class="s1">)))</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Overlapping character range&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">([</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">])}</span><span class="s4">function </span><span class="s2">Se</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;*&quot;</span><span class="s1">)||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;?&quot;</span><span class="s1">)||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;+&quot;</span><span class="s1">))</span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">j</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s4">else return </span><span class="s2">s</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">Te</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;}&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;)&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;|&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;/&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;/</span><span class="s4">\\</span><span class="s0">&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;{&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;,&quot;</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;&gt;&quot;</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Oe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=[</span><span class="s2">pe</span><span class="s1">];</span><span class="s4">do</span><span class="s1">{</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;~&quot;</span><span class="s1">))</span><span class="s2">s</span><span class="s1">=</span><span class="s0">&quot;ambig&quot;</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;!&quot;</span><span class="s1">))</span><span class="s2">s</span><span class="s1">=</span><span class="s0">&quot;prec&quot;</span><span class="s1">;</span><span class="s4">else break</span><span class="s1">;</span><span class="s2">i</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">].</span><span class="s2">concat</span><span class="s1">(</span><span class="s4">new </span><span class="s2">P</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">s</span><span class="s1">))}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Te</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s4">break</span><span class="s1">;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Se</span><span class="s1">(</span><span class="s2">e</span><span class="s1">));</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">pe</span><span class="s1">)}</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">Te</span><span class="s1">(</span><span class="s2">e</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)))</span><span class="s4">return </span><span class="s2">s</span><span class="s1">[</span><span class="s3">0</span><span class="s1">];</span><span class="s4">return new </span><span class="s2">R</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Re</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">Oe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;|&quot;</span><span class="s1">))</span><span class="s4">return </span><span class="s2">s</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[</span><span class="s2">s</span><span class="s1">];</span><span class="s4">do</span><span class="s1">{</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Oe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">while</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;|&quot;</span><span class="s1">));</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">R</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Empty expression in choice operator. If this is intentional, use () to make it explicit.&quot;</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">O</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">!=</span><span class="s0">&quot;id&quot;</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">unexpected</span><span class="s1">();</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">return new </span><span class="s2">y</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">je</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;{&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">id</span><span class="s1">:</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">type</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;left&quot;</span><span class="s1">)?</span><span class="s0">&quot;left&quot;</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;right&quot;</span><span class="s1">)?</span><span class="s0">&quot;right&quot;</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;cut&quot;</span><span class="s1">)?</span><span class="s0">&quot;cut&quot;</span><span class="s1">:</span><span class="s4">null</span><span class="s1">})}</span><span class="s4">return new </span><span class="s2">h</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Ne</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;{&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;at&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s0">&quot;precedence&quot;</span><span class="s1">){</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ze</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;at&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s0">&quot;conflict&quot;</span><span class="s1">){</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Ce</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;string&quot;</span><span class="s1">){</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">m</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;string&quot;</span><span class="s1">),</span><span class="s2">ke</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)))}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}}</span><span class="s4">return new </span><span class="s2">p</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Ae</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;{&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;at&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s0">&quot;precedence&quot;</span><span class="s1">){</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ze</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;at&quot;</span><span class="s1">,</span><span class="s0">&quot;else&quot;</span><span class="s1">)&amp;&amp;!</span><span class="s2">n</span><span class="s1">){</span><span class="s2">n</span><span class="s1">={</span><span class="s2">id</span><span class="s1">:</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">props</span><span class="s1">:</span><span class="s2">ke</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}}</span><span class="s4">return new </span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">ze</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;{&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">||</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">else </span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Invalid expression in token precedences`</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}</span><span class="s4">return new </span><span class="s2">f</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Ce</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;{&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!(</span><span class="s2">s </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">||</span><span class="s2">s </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">))</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Invalid expression in token conflict`</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!(</span><span class="s2">i </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">||</span><span class="s2">i </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">))</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Invalid expression in token conflict`</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">c</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Ie</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;{&quot;</span><span class="s1">);</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">ke</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">id</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">props</span><span class="s1">:</span><span class="s2">i</span><span class="s1">})}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">qe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;from&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;string&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">k</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">Ie</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">function </span><span class="s2">De</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">be</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;from&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;string&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">x</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">Ie</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">function </span><span class="s2">Ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;from&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">b</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;string&quot;</span><span class="s1">))}</span><span class="s4">function </span><span class="s2">Ee</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eat</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;as&quot;</span><span class="s1">)?</span><span class="s2">Pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">):</span><span class="s2">s</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,</span><span class="s0">&quot;from&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expect</span><span class="s1">(</span><span class="s0">&quot;string&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Je</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s5">/\\(?:u\{([\da-f]+)\}|u([\da-f]{4})|x([\da-f]{2})|([ntbrf0])|(.))|[^]/giy</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s2">i</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">exec</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s4">let</span><span class="s1">[</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">a</span><span class="s1">]=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">||</span><span class="s2">n</span><span class="s1">||</span><span class="s2">r</span><span class="s1">)</span><span class="s2">s</span><span class="s1">+=</span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCodePoint</span><span class="s1">(</span><span class="s2">parseInt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">||</span><span class="s2">n</span><span class="s1">||</span><span class="s2">r</span><span class="s1">,</span><span class="s3">16</span><span class="s1">));</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)</span><span class="s2">s</span><span class="s1">+=</span><span class="s2">l</span><span class="s1">==</span><span class="s0">&quot;n&quot;</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">:</span><span class="s2">l</span><span class="s1">==</span><span class="s0">&quot;t&quot;</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\t</span><span class="s0">&quot;</span><span class="s1">:</span><span class="s2">l</span><span class="s1">==</span><span class="s0">&quot;0&quot;</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\0</span><span class="s0">&quot;</span><span class="s1">:</span><span class="s2">l</span><span class="s1">==</span><span class="s0">&quot;r&quot;</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\r</span><span class="s0">&quot;</span><span class="s1">:</span><span class="s2">l</span><span class="s1">==</span><span class="s0">&quot;f&quot;</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\f</span><span class="s0">&quot;</span><span class="s1">:</span><span class="s0">&quot;</span><span class="s4">\b</span><span class="s0">&quot;</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">)</span><span class="s2">s</span><span class="s1">+=</span><span class="s2">a</span><span class="s1">;</span><span class="s4">else </span><span class="s2">s</span><span class="s1">+=</span><span class="s2">e</span><span class="s1">}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">function </span><span class="s2">_e</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&lt;&lt;</span><span class="s3">5</span><span class="s1">)+</span><span class="s2">e</span><span class="s1">+</span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Be</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++)</span><span class="s2">e</span><span class="s1">=</span><span class="s2">_e</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">));</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s4">const </span><span class="s2">Ue</span><span class="s1">=</span><span class="s4">typeof </span><span class="s2">l</span><span class="s1">!=</span><span class="s0">&quot;undefined&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">env</span><span class="s1">.</span><span class="s2">LOG</span><span class="s1">||</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">const </span><span class="s2">Me</span><span class="s1">=</span><span class="s5">/\btime\b/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">Ue</span><span class="s1">);</span><span class="s4">const </span><span class="s2">Fe</span><span class="s1">=</span><span class="s2">Me</span><span class="s1">?(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;{</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">();</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">();</span><span class="s2">console</span><span class="s1">.</span><span class="s2">log</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">} </span><span class="s0">(</span><span class="s2">$</span><span class="s1">{((</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">()-</span><span class="s2">s</span><span class="s1">)/</span><span class="s3">1e3</span><span class="s1">).</span><span class="s2">toFixed</span><span class="s1">(</span><span class="s3">2</span><span class="s1">)}</span><span class="s0">s)`</span><span class="s1">);</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}:(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">();</span><span class="s4">class </span><span class="s2">Le</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">via</span><span class="s1">=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">=</span><span class="s3">0</span><span class="s1">}</span><span class="s2">finish</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">_e</span><span class="s1">(</span><span class="s2">_e</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">),</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s2">_e</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s2">Be</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">get next</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">]:</span><span class="s4">null</span><span class="s1">}</span><span class="s2">advance</span><span class="s1">(){</span><span class="s4">return new </span><span class="s2">Le</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">via</span><span class="s1">).</span><span class="s2">finish</span><span class="s1">()}</span><span class="s2">get skip</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">}</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">)||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">||</span><span class="s2">W</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">,((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))||</span><span class="s2">W</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">,</span><span class="s2">Ye</span><span class="s1">)}</span><span class="s2">eqSimple</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">));</span><span class="s2">e</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s0">&quot;&quot;</span><span class="s1">);</span><span class="s4">return</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">-&gt; </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">==</span><span class="s2">e</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">&amp;&amp;</span><span class="s2">Qe</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">)&amp;&amp;</span><span class="s2">Qe</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">)}</span><span class="s2">trail</span><span class="s1">(</span><span class="s2">e</span><span class="s1">=</span><span class="s3">60</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">;</span><span class="s2">i</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">via</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">--)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s2">e</span><span class="s1">])}</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">reverse</span><span class="s1">().</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">e</span><span class="s1">)</span><span class="s2">s</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">e</span><span class="s1">).</span><span class="s2">replace</span><span class="s1">(</span><span class="s5">/.*? /</span><span class="s1">,</span><span class="s0">&quot; &quot;</span><span class="s1">);</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s2">conflicts</span><span class="s1">(</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Y</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">));</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">static </span><span class="s2">addOrigins</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">next</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">&amp;&amp;!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">i</span><span class="s1">))</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">We</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Y</span><span class="s1">.</span><span class="s2">none</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">());</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Ke</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">repeated</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">isRepeatWrap</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s3">2</span><span class="s1">)</span><span class="s4">return </span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">isRepeatWrap</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s3">2</span><span class="s1">)</span><span class="s4">return</span><span class="s1">-</span><span class="s3">1</span><span class="s1">}}</span><span class="s4">return </span><span class="s3">0</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Ze</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">s</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">){</span><span class="s2">nt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">else for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of i</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s4">null</span><span class="s1">)</span><span class="s2">s</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">else </span><span class="s2">nt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of s</span><span class="s1">)</span><span class="s2">nt</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}</span><span class="s4">function </span><span class="s2">He</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">].</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]))</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Qe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]!=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">class </span><span class="s2">Ve</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">target</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Ve</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Xe</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s2">matches</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Ve</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]==</span><span class="s2">t</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">&quot;s&quot;</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s2">map</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]];</span><span class="s4">return </span><span class="s2">s</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">target</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">Ve</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">Xe</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Xe</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">sameReduce</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">)}</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Ve</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">id</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">id</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s2">matches</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Xe</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">sameReduce</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">)}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">(</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">}</span><span class="s2">map</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">et</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">5381</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s2">_e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">);</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">class </span><span class="s2">tt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">first</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">=[]}}</span><span class="s4">class </span><span class="s2">st</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">et</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">r</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startRule</span><span class="s1">=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actionPositions</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_actionsByTerm</span><span class="s1">=</span><span class="s4">null</span><span class="s1">}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">+</span><span class="s0">&quot;=&quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">)+(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">&quot; | &quot;</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">+</span><span class="s0">&quot;=&quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">):</span><span class="s0">&quot;&quot;</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">+</span><span class="s0">&quot;: &quot;</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">()+(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">?</span><span class="s0">`</span><span class="s4">\n  </span><span class="s0">always </span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">(</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\n  </span><span class="s0">&quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)}</span><span class="s2">addActionInner</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s2">e</span><span class="s1">:</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">[</span><span class="s2">s</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Le</span><span class="s1">.</span><span class="s2">addOrigins</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">),</span><span class="s2">r</span><span class="s1">=</span><span class="s2">Le</span><span class="s1">.</span><span class="s2">addOrigins</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actionPositions</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">We</span><span class="s1">(</span><span class="s2">n</span><span class="s1">),</span><span class="s2">a</span><span class="s1">=</span><span class="s2">We</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">Ke</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)||</span><span class="s2">l</span><span class="s1">.</span><span class="s2">precedence</span><span class="s1">-</span><span class="s2">a</span><span class="s1">.</span><span class="s2">precedence</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s3">1</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actionPositions</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s3">1</span><span class="s1">);</span><span class="s2">s</span><span class="s1">--;</span><span class="s4">continue </span><span class="s2">e</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">return null</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ambigGroups</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">ambigGroups</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)))){</span><span class="s4">continue </span><span class="s2">e</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}}}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actionPositions</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return null</span><span class="s1">}</span><span class="s2">addAction</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">addActionInner</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actionPositions</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)][</span><span class="s3">0</span><span class="s1">];</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=[</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))))))</span><span class="s4">return</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i </span><span class="s4">instanceof </span><span class="s2">Ve</span><span class="s1">)</span><span class="s2">l</span><span class="s1">=</span><span class="s0">`shift/reduce conflict between</span><span class="s4">\n  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">n</span><span class="s1">}</span><span class="s4">\n</span><span class="s0">and</span><span class="s4">\n  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">rule</span><span class="s1">}</span><span class="s0">`</span><span class="s1">;</span><span class="s4">else </span><span class="s2">l</span><span class="s1">=</span><span class="s0">`reduce/reduce conflict between</span><span class="s4">\n  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">n</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">}</span><span class="s4">\n</span><span class="s0">and</span><span class="s4">\n  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">rule</span><span class="s1">}</span><span class="s0">`</span><span class="s1">;</span><span class="s2">l</span><span class="s1">+=</span><span class="s0">`</span><span class="s4">\n</span><span class="s0">With input:</span><span class="s4">\n  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">trail</span><span class="s1">(</span><span class="s3">70</span><span class="s1">)} </span><span class="s0"> </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">} </span><span class="s0">`</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i </span><span class="s4">instanceof </span><span class="s2">Ve</span><span class="s1">)</span><span class="s2">l</span><span class="s1">+=</span><span class="s2">ut</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">i</span><span class="s1">.</span><span class="s2">term</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">first</span><span class="s1">);</span><span class="s2">l</span><span class="s1">+=</span><span class="s2">ot</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">at</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">r</span><span class="s1">))}}</span><span class="s2">getGoto</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">e</span><span class="s1">))}</span><span class="s2">hasSet</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">He</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">actionsByTerm</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_actionsByTerm</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_actionsByTerm</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]||(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s2">finish</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">[</span><span class="s3">0</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Xe</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Xe</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">sameReduce</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">||</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sameReduce</span><span class="s1">(</span><span class="s2">s</span><span class="s1">):</span><span class="s4">false</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">&amp;&amp;</span><span class="s2">He</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">)&amp;&amp;</span><span class="s2">He</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">it</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">function </span><span class="s2">n</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">a</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o of t</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">==</span><span class="s2">o</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">==</span><span class="s2">o</span><span class="s1">));</span><span class="s2">t</span><span class="s1">=</span><span class="s2">i</span><span class="s1">?</span><span class="s4">new </span><span class="s2">Le</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(),</span><span class="s2">i</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">via</span><span class="s1">):</span><span class="s4">new </span><span class="s2">Le</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,[],</span><span class="s2">xt</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">a</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">!=</span><span class="s2">l</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">B</span><span class="s1">(</span><span class="s0">&quot;Inconsistent skip sets after &quot;</span><span class="s1">+</span><span class="s2">a</span><span class="s1">.</span><span class="s2">trail</span><span class="s1">());</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">=</span><span class="s2">Z</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of n</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">terminal</span><span class="s1">)</span><span class="s2">nt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}}}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l of e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">next</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&amp;&amp;!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">)</span><span class="s2">n</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Ze</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">,</span><span class="s2">t</span><span class="s1">),</span><span class="s2">l</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">+</span><span class="s3">1</span><span class="s1">).</span><span class="s2">ambigGroups</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s2">l</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">?</span><span class="s2">l</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">:</span><span class="s2">l</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">,</span><span class="s2">l</span><span class="s1">)}</span><span class="s4">while</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span><span class="s2">n</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">Ze</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">,</span><span class="s2">t</span><span class="s1">),</span><span class="s2">Z</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">[</span><span class="s3">1</span><span class="s1">].</span><span class="s2">ambigGroups</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ambigAhead</span><span class="s1">:</span><span class="s2">xt</span><span class="s1">),</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">skipAhead</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l of s</span><span class="s1">){</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">));</span><span class="s2">l</span><span class="s1">.</span><span class="s2">finish</span><span class="s1">();</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">==</span><span class="s2">l</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">r</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=</span><span class="s2">l</span><span class="s1">;</span><span class="s4">else </span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))}</span><span class="s4">function </span><span class="s2">nt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">rt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">)</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=[];</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of e</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of i</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">name</span><span class="s1">];</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">false</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">){</span><span class="s2">r</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">){</span><span class="s2">nt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s4">null</span><span class="s1">)</span><span class="s2">r</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">else </span><span class="s2">nt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)</span><span class="s4">break</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">)</span><span class="s2">nt</span><span class="s1">(</span><span class="s4">null</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">l</span><span class="s1">)</span><span class="s2">s</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">lt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">state</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">at</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">error</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">ot</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eqSimple</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))</span><span class="s4">return</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">function </span><span class="s2">s</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">via</span><span class="s1">;!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">eqSimple</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">i</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">via</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">unshift</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return </span><span class="s2">s</span><span class="s1">.</span><span class="s2">reverse</span><span class="s1">().</span><span class="s2">map</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">+</span><span class="s0">&quot;  &quot;</span><span class="s1">.</span><span class="s2">repeat</span><span class="s1">(</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">)+(</span><span class="s2">e</span><span class="s1">==</span><span class="s2">t</span><span class="s1">?</span><span class="s0">&quot;&quot;</span><span class="s1">:</span><span class="s0">&quot;via &quot;</span><span class="s1">)+</span><span class="s2">e</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">)}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s2">i</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">via</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s2">n</span><span class="s1">;</span><span class="s2">n</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">via</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">eqSimple</span><span class="s1">(</span><span class="s2">n</span><span class="s1">))</span><span class="s4">return</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">Shared origin: &quot;</span><span class="s1">+</span><span class="s2">i</span><span class="s1">+</span><span class="s2">s</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)+</span><span class="s2">s</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">return</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ut</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">--)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">via</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">via</span><span class="s1">}</span><span class="s2">n</span><span class="s1">.</span><span class="s2">reverse</span><span class="s1">();</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Set</span><span class="s1">;</span><span class="s4">function </span><span class="s2">l</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">==</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">&amp;&amp;!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">next</span><span class="s1">)</span><span class="s4">return</span><span class="s0">`</span><span class="s4">\n</span><span class="s0">The reduction of </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">is allowed before </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">} </span><span class="s0">because of this rule:</span><span class="s4">\n  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">o</span><span class="s1">}</span><span class="s0">`</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">;</span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">next</span><span class="s1">;){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&lt;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">==</span><span class="s2">n</span><span class="s1">[</span><span class="s2">a</span><span class="s1">]){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">l</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">advance</span><span class="s1">(),</span><span class="s2">a</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">o</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">+</span><span class="s3">1</span><span class="s1">],</span><span class="s2">h</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">+</span><span class="s3">1</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">o</span><span class="s1">:</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">u</span><span class="s1">&amp;&amp;(</span><span class="s2">u</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">?</span><span class="s2">u</span><span class="s1">==</span><span class="s2">t</span><span class="s1">:</span><span class="s2">s</span><span class="s1">[</span><span class="s2">u</span><span class="s1">.</span><span class="s2">name</span><span class="s1">].</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))</span><span class="s2">h</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">advance</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of e</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">&lt;&lt;</span><span class="s3">5</span><span class="s1">)+</span><span class="s2">a</span><span class="s1">+(</span><span class="s2">h</span><span class="s1">?</span><span class="s3">555</span><span class="s1">:</span><span class="s3">0</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)){</span><span class="s2">r</span><span class="s1">.</span><span class="s2">add</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">l</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Le</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,[],[],</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">),</span><span class="s2">a</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">].</span><span class="s2">includes</span><span class="s1">(</span><span class="s4">null</span><span class="s1">))</span><span class="s2">i</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">advance</span><span class="s1">();</span><span class="s4">else break</span><span class="s1">}</span><span class="s4">return</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s4">return </span><span class="s2">l</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s4">null</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">ht</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[],</span><span class="s2">n</span><span class="s1">={};</span><span class="s4">let </span><span class="s2">r</span><span class="s1">={};</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">();</span><span class="s4">function </span><span class="s2">a</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">et</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">o</span><span class="s1">=</span><span class="s2">r</span><span class="s1">[</span><span class="s2">a</span><span class="s1">];</span><span class="s4">let </span><span class="s2">u</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">u</span><span class="s1">)</span><span class="s2">u</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">u</span><span class="s1">!=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">B</span><span class="s1">(</span><span class="s0">&quot;Inconsistent skip sets after &quot;</span><span class="s1">+</span><span class="s2">s</span><span class="s1">.</span><span class="s2">trail</span><span class="s1">())}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of o</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">He</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">set</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">!=</span><span class="s2">u</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">B</span><span class="s1">(</span><span class="s0">&quot;Inconsistent skip sets after &quot;</span><span class="s1">+</span><span class="s2">s</span><span class="s1">.</span><span class="s2">set</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">trail</span><span class="s1">());</span><span class="s4">return </span><span class="s2">s</span><span class="s1">.</span><span class="s2">state</span><span class="s1">}</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">it</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">let </span><span class="s2">f</span><span class="s1">=</span><span class="s2">et</span><span class="s1">(</span><span class="s2">h</span><span class="s1">),</span><span class="s2">c</span><span class="s1">=</span><span class="s2">n</span><span class="s1">[</span><span class="s2">f</span><span class="s1">]||(</span><span class="s2">n</span><span class="s1">[</span><span class="s2">f</span><span class="s1">]=[]);</span><span class="s4">let </span><span class="s2">p</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of c</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">hasSet</span><span class="s1">(</span><span class="s2">h</span><span class="s1">))</span><span class="s2">p</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">p</span><span class="s1">){</span><span class="s2">p</span><span class="s1">=</span><span class="s4">new </span><span class="s2">st</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">h</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">u</span><span class="s1">,</span><span class="s2">f</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s2">c</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">p</span><span class="s1">);</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">p</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Me</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">%</span><span class="s3">500</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s2">console</span><span class="s1">.</span><span class="s2">log</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">} </span><span class="s0">states after </span><span class="s2">$</span><span class="s1">{((</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">()-</span><span class="s2">l</span><span class="s1">)/</span><span class="s3">1e3</span><span class="s1">).</span><span class="s2">toFixed</span><span class="s1">(</span><span class="s3">2</span><span class="s1">)}</span><span class="s0">s`</span><span class="s1">)}(</span><span class="s2">r</span><span class="s1">[</span><span class="s2">a</span><span class="s1">]||(</span><span class="s2">r</span><span class="s1">[</span><span class="s2">a</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">lt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">p</span><span class="s1">));</span><span class="s4">return </span><span class="s2">p</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">u of t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">u</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">u</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">skip</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">names</span><span class="s1">[</span><span class="s0">&quot;%noskip&quot;</span><span class="s1">];</span><span class="s2">a</span><span class="s1">(</span><span class="s2">u</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">s</span><span class="s1">=&gt;</span><span class="s4">new </span><span class="s2">Le</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eof</span><span class="s1">],</span><span class="s2">xt</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s4">null</span><span class="s1">).</span><span class="s2">finish</span><span class="s1">())),</span><span class="s2">u</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s4">new </span><span class="s2">tt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">u</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">u</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">u</span><span class="s1">];</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[],</span><span class="s2">n</span><span class="s1">=[],</span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">.</span><span class="s2">set</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">top</span><span class="s1">)</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s2">s</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">];</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">([</span><span class="s2">s</span><span class="s1">])}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">n</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}}}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">n</span><span class="s1">[</span><span class="s2">s</span><span class="s1">].</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">advance</span><span class="s1">()));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">ft</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">a</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">addAction</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Ve</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">),</span><span class="s2">n</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">o</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">a</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Ve</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))}}</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of r</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of s</span><span class="s1">.</span><span class="s2">ahead</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">addAction</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Xe</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">),[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">o</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">i</span><span class="s1">)</span><span class="s2">l</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">term</span><span class="s1">.</span><span class="s2">name</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Ve</span><span class="s1">)))))</span><span class="s2">e</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(</span><span class="s2">i</span><span class="s1">--,</span><span class="s3">1</span><span class="s1">)}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">B</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">error</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;</span><span class="s4">\n\n</span><span class="s0">&quot;</span><span class="s1">));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">u of i</span><span class="s1">)</span><span class="s2">u</span><span class="s1">.</span><span class="s2">finish</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Me</span><span class="s1">)</span><span class="s2">console</span><span class="s1">.</span><span class="s2">log</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">} </span><span class="s0">states total.`</span><span class="s1">);</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ft</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">null</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">-</span><span class="s3">1</span><span class="s1">].</span><span class="s2">cut</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">||</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">s</span><span class="s1">){</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s2">t</span><span class="s1">=[]}</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">||</span><span class="s2">e</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ct</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of e</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]!=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">])</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">actionsByTerm</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)))){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actionsByTerm</span><span class="s1">()[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">||</span><span class="s2">i</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">))))))</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">function </span><span class="s2">pt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]){</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s4">new </span><span class="s2">st</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">set</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">startRule</span><span class="s1">);</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">].</span><span class="s2">tokenGroup</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">;</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">].</span><span class="s2">defaultReduce</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">}}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">],</span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s2">n</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">|=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">[</span><span class="s2">r</span><span class="s1">].</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)))){</span><span class="s2">n</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">actionPositions</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">actionPositions</span><span class="s1">[</span><span class="s2">r</span><span class="s1">])}}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of i</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))))</span><span class="s2">n</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">class </span><span class="s2">dt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">origin</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">members</span><span class="s1">=[</span><span class="s2">t</span><span class="s1">]}}</span><span class="s4">function </span><span class="s2">mt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">].</span><span class="s2">eqSimple</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]))</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">function </span><span class="s2">gt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[],</span><span class="s2">s</span><span class="s1">=[];</span><span class="s2">e</span><span class="s1">:</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">startRule</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">a</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">l</span><span class="s1">.</span><span class="s2">members</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">==</span><span class="s2">a</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">==</span><span class="s2">a</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">&amp;&amp;!</span><span class="s2">a</span><span class="s1">.</span><span class="s2">startRule</span><span class="s1">&amp;&amp;</span><span class="s2">mt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">set</span><span class="s1">,</span><span class="s2">a</span><span class="s1">.</span><span class="s2">set</span><span class="s1">)){</span><span class="s2">l</span><span class="s1">.</span><span class="s2">members</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">continue </span><span class="s2">e</span><span class="s1">}}</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">dt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">n</span><span class="s1">))}</span><span class="s4">function </span><span class="s2">i</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">r</span><span class="s1">.</span><span class="s2">members</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]];</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">members</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">!=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">members</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">r</span><span class="s1">.</span><span class="s2">members</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">o</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">o</span><span class="s1">++){</span><span class="s2">t</span><span class="s1">[</span><span class="s2">l</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">o</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">[</span><span class="s2">o</span><span class="s1">].</span><span class="s2">origin</span><span class="s1">==</span><span class="s2">r</span><span class="s1">.</span><span class="s2">origin</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">[</span><span class="s2">o</span><span class="s1">].</span><span class="s2">members</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">s</span><span class="s1">=&gt;</span><span class="s2">ct</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">t</span><span class="s1">)))){</span><span class="s2">s</span><span class="s1">[</span><span class="s2">o</span><span class="s1">].</span><span class="s2">members</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">id</span><span class="s1">);</span><span class="s4">return</span><span class="s1">}}</span><span class="s2">t</span><span class="s1">[</span><span class="s2">l</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">dt</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">origin</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">id</span><span class="s1">))}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;;</span><span class="s2">n</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">false</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">a</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">a</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">members</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">a</span><span class="s1">&lt;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">members</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">a</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">members</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">u</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">members</span><span class="s1">[</span><span class="s2">a</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">ct</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">o</span><span class="s1">],</span><span class="s2">e</span><span class="s1">[</span><span class="s2">u</span><span class="s1">],</span><span class="s2">t</span><span class="s1">)){</span><span class="s2">r</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s2">i</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">a</span><span class="s1">--)}}}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Me</span><span class="s1">)</span><span class="s2">console</span><span class="s1">.</span><span class="s2">log</span><span class="s1">(</span><span class="s0">`Collapse pass </span><span class="s2">$</span><span class="s1">{</span><span class="s2">n</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">r</span><span class="s1">?</span><span class="s0">``</span><span class="s1">:</span><span class="s0">`, done`</span><span class="s1">} </span><span class="s0">(</span><span class="s2">$</span><span class="s1">{((</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">()-</span><span class="s2">l</span><span class="s1">)/</span><span class="s3">1e3</span><span class="s1">).</span><span class="s2">toFixed</span><span class="s1">(</span><span class="s3">2</span><span class="s1">)}</span><span class="s0">s)`</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">)</span><span class="s4">return </span><span class="s2">pt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">kt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;;</span><span class="s2">t</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=</span><span class="s4">false</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">();</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">t</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">];</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=</span><span class="s2">l</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">r</span><span class="s1">[</span><span class="s2">l</span><span class="s1">],</span><span class="s2">a</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of n</span><span class="s1">.</span><span class="s2">set</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">set</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eqSimple</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))))(</span><span class="s2">a</span><span class="s1">||(</span><span class="s2">a</span><span class="s1">=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">set</span><span class="s1">=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">set</span><span class="s1">).</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">cmp</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Me</span><span class="s1">)</span><span class="s2">console</span><span class="s1">.</span><span class="s2">log</span><span class="s1">(</span><span class="s0">`Merge identical pass </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">?</span><span class="s0">&quot;&quot;</span><span class="s1">:</span><span class="s0">&quot;, done&quot;</span><span class="s1">} </span><span class="s0">(</span><span class="s2">$</span><span class="s1">{((</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">()-</span><span class="s2">n</span><span class="s1">)/</span><span class="s3">1e3</span><span class="s1">).</span><span class="s2">toFixed</span><span class="s1">(</span><span class="s3">2</span><span class="s1">)}</span><span class="s0">s)`</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of r</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)));</span><span class="s2">e</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)))}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++)</span><span class="s2">r</span><span class="s1">[</span><span class="s2">e</span><span class="s1">].</span><span class="s2">id</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s2">e</span><span class="s1">=</span><span class="s2">r</span><span class="s1">}}</span><span class="s4">const </span><span class="s2">xt</span><span class="s1">=[];</span><span class="s4">function </span><span class="s2">bt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">kt</span><span class="s1">(</span><span class="s2">gt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">function </span><span class="s2">wt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">+</span><span class="s3">32</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s3">34</span><span class="s1">)</span><span class="s2">t</span><span class="s1">++;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s3">92</span><span class="s1">)</span><span class="s2">t</span><span class="s1">++;</span><span class="s4">return </span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCharCode</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">yt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s3">65535</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Trying to encode a number that's too big: &quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s3">65535</span><span class="s1">)</span><span class="s4">return </span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCharCode</span><span class="s1">(</span><span class="s3">126</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">46</span><span class="s1">;;</span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">%</span><span class="s3">46</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">;</span><span class="s2">s</span><span class="s1">=</span><span class="s2">wt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">+</span><span class="s2">i</span><span class="s1">)+</span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s2">e</span><span class="s1">=</span><span class="s2">n</span><span class="s1">/</span><span class="s3">46</span><span class="s1">}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">function </span><span class="s2">$t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s3">65535</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s0">'&quot;'</span><span class="s1">+</span><span class="s2">yt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s3">4294967295</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++)</span><span class="s2">s</span><span class="s1">+=</span><span class="s2">yt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">t</span><span class="s1">);</span><span class="s2">s</span><span class="s1">+=</span><span class="s0">'&quot;'</span><span class="s1">;</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">const </span><span class="s2">vt</span><span class="s1">=[];</span><span class="s4">class </span><span class="s2">St</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">==</span><span class="s2">St</span><span class="s1">.</span><span class="s2">none</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s2">St</span><span class="s1">.</span><span class="s2">none</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">){</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">():</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ensureConflicts</span><span class="s1">();</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ensureConflicts</span><span class="s1">();</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">].</span><span class="s2">join</span><span class="s1">(</span><span class="s2">s</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">])}</span><span class="s4">return new </span><span class="s2">St</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">),</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">withConflicts</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s2">Y</span><span class="s1">.</span><span class="s2">none</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">():</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ensureConflicts</span><span class="s1">();</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">].</span><span class="s2">join</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">St</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">ensureConflicts</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">&lt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">t</span><span class="s1">++)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">Y</span><span class="s1">.</span><span class="s2">none</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}}</span><span class="s2">St</span><span class="s1">.</span><span class="s2">none</span><span class="s1">=</span><span class="s4">new </span><span class="s2">St</span><span class="s1">(</span><span class="s2">vt</span><span class="s1">,</span><span class="s4">null</span><span class="s1">);</span><span class="s4">function </span><span class="s2">Tt</span><span class="s1">(</span><span class="s2">...e</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">St</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">null</span><span class="s1">)}</span><span class="s4">class </span><span class="s2">Ot</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">args</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}</span><span class="s2">matches</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">&amp;&amp;</span><span class="s2">G</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">args</span><span class="s1">)}</span><span class="s2">matchesRepeat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">==</span><span class="s0">&quot;+&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">D</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">args</span><span class="s1">[</span><span class="s3">0</span><span class="s1">])}}</span><span class="s4">class </span><span class="s2">Rt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">=</span><span class="s4">new </span><span class="s2">L</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">specialized</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokenOrigins</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ruleNames</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">namespaces</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">knownProps</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dynamicRulePrecedences</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">definedGroups</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">astRules</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">=[];</span><span class="s2">Fe</span><span class="s1">(</span><span class="s0">&quot;Parse&quot;</span><span class="s1">,(()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">input</span><span class="s1">=</span><span class="s4">new </span><span class="s2">de</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">fileName</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">input</span><span class="s1">.</span><span class="s2">parse</span><span class="s1">()}));</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">NodeProp</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n </span><span class="s4">in </span><span class="s2">s</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]</span><span class="s4">instanceof </span><span class="s2">i</span><span class="s1">.</span><span class="s2">NodeProp</span><span class="s1">&amp;&amp;!</span><span class="s2">s</span><span class="s1">[</span><span class="s2">n</span><span class="s1">].</span><span class="s2">perNode</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">knownProps</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]={</span><span class="s2">prop</span><span class="s1">:</span><span class="s2">s</span><span class="s1">[</span><span class="s2">n</span><span class="s1">],</span><span class="s2">source</span><span class="s1">:{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">from</span><span class="s1">:</span><span class="s4">null</span><span class="s1">}}}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">externalProps</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">knownProps</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]={</span><span class="s2">prop</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">externalProp</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">externalProp</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">):</span><span class="s4">new </span><span class="s2">i</span><span class="s1">.</span><span class="s2">NodeProp</span><span class="s1">,</span><span class="s2">source</span><span class="s1">:{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">externalID</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">from</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">source</span><span class="s1">}}}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dialects</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">dialects</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Mt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">localTokens</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">localTokens</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s4">new </span><span class="s2">Ft</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalTokens</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">externalTokens</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s4">new </span><span class="s2">ns</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalSpecializers</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">externalSpecializers</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s4">new </span><span class="s2">rs</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)));</span><span class="s2">Fe</span><span class="s1">(</span><span class="s0">&quot;Build rules&quot;</span><span class="s1">,(()=&gt;{</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">newName</span><span class="s1">(</span><span class="s0">&quot;%noskip&quot;</span><span class="s1">,</span><span class="s4">true</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defineRule</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,[]);</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">mainSkip</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">newName</span><span class="s1">(</span><span class="s0">&quot;%mainskip&quot;</span><span class="s1">,</span><span class="s4">true</span><span class="s1">):</span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">astRules</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">skip</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">n</span><span class="s1">});</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">topRules</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">skip</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">n</span><span class="s1">});</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">scopedSkip</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">scopedSkip</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">D</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">)));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">r</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">l</span><span class="s1">];</span><span class="s4">else if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">mainSkip</span><span class="s1">&amp;&amp;</span><span class="s2">D</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">mainSkip</span><span class="s1">))</span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(!</span><span class="s2">es</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">))</span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">newName</span><span class="s1">(</span><span class="s0">&quot;%skip&quot;</span><span class="s1">,</span><span class="s4">true</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of n</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">astRules</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">skip</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">e</span><span class="s1">});</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of n</span><span class="s1">.</span><span class="s2">topRules</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">skip</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">e</span><span class="s1">})}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">n</span><span class="s1">}</span><span class="s2">of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">astRules</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">unique</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipRules</span><span class="s1">=</span><span class="s2">t</span><span class="s1">==</span><span class="s2">e</span><span class="s1">?[</span><span class="s2">t</span><span class="s1">]:[</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defineRule</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">mainSkip</span><span class="s1">));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">scopedSkip</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipRules</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipRules</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defineRule</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">scopedSkip</span><span class="s1">[</span><span class="s2">n</span><span class="s1">].</span><span class="s2">expr</span><span class="s1">))}}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">skip</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}</span><span class="s2">of i</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">start</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">start</span><span class="s1">))){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">unique</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">used</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">let</span><span class="s1">{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">props</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodeInfo</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s0">&quot;a&quot;</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">vt</span><span class="s1">,</span><span class="s2">vt</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">makeTop</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defineRule</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">()}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalSpecializers</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">finish</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">skip</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}</span><span class="s2">of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">astRules</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ruleNames</span><span class="s1">[</span><span class="s2">r</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]&amp;&amp;</span><span class="s2">ps</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)&amp;&amp;!</span><span class="s2">r</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buildRule</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,[],</span><span class="s2">n</span><span class="s1">,</span><span class="s4">false</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">expr </span><span class="s4">instanceof </span><span class="s2">R</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">used</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)}}}));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i </span><span class="s4">in this</span><span class="s1">.</span><span class="s2">ruleNames</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ruleNames</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">`Unused rule '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">'`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">takePrecedences</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">takeConflicts</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">localTokens</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">takePrecedences</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">group</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}</span><span class="s2">of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">definedGroups</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defineGroup</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">checkGroups</span><span class="s1">()}</span><span class="s2">unique</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name </span><span class="s4">in this</span><span class="s1">.</span><span class="s2">ruleNames</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Duplicate definition of rule '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">'`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ruleNames</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=</span><span class="s2">e</span><span class="s1">}</span><span class="s2">used</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ruleNames</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s4">null</span><span class="s1">}</span><span class="s2">newName</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s4">null</span><span class="s1">,</span><span class="s2">s</span><span class="s1">={}){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s3">1</span><span class="s1">;;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">?</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s0">-</span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">}</span><span class="s0">`</span><span class="s1">:</span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">names</span><span class="s1">[</span><span class="s2">n</span><span class="s1">])</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">makeNonTerminal</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">t</span><span class="s1">===</span><span class="s4">true</span><span class="s1">?</span><span class="s4">null</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}}</span><span class="s2">prepareParser</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">Fe</span><span class="s1">(</span><span class="s0">&quot;Simplify rules&quot;</span><span class="s1">,(()=&gt;</span><span class="s2">os</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">,[</span><span class="s2">...</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipRules</span><span class="s1">,</span><span class="s2">...</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">tops</span><span class="s1">])));</span><span class="s4">let</span><span class="s1">{</span><span class="s2">nodeTypes</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">names</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">minRepeatTerm</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">maxTerm</span><span class="s1">:</span><span class="s2">n</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">finish</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">R </span><span class="s4">in this</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">[</span><span class="s2">R</span><span class="s1">]=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">[</span><span class="s2">R</span><span class="s1">].</span><span class="s2">id</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s5">/\bgrammar\b/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">Ue</span><span class="s1">))</span><span class="s2">console</span><span class="s1">.</span><span class="s2">log</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">));</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">tops</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">rt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">);</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipRules</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;{</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=[],</span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of e</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s3">0</span><span class="s1">];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of e</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">?[</span><span class="s2">e</span><span class="s1">]:</span><span class="s2">l</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]||[])</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&amp;&amp;!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">terminal</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">&amp;&amp;!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">!=</span><span class="s2">r</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]==</span><span class="s2">e</span><span class="s1">)))</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">else </span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)}</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return</span><span class="s1">{</span><span class="s2">skip</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s4">null</span><span class="s1">,</span><span class="s2">startTokens</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">id</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}}));</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">Fe</span><span class="s1">(</span><span class="s0">&quot;Build full automaton&quot;</span><span class="s1">,(()=&gt;</span><span class="s2">ht</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">)));</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">localTokens</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">buildLocalGroup</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)));</span><span class="s4">let</span><span class="s1">{</span><span class="s2">tokenGroups</span><span class="s1">:</span><span class="s2">h</span><span class="s1">,</span><span class="s2">tokenPrec</span><span class="s1">:</span><span class="s2">f</span><span class="s1">,</span><span class="s2">tokenData</span><span class="s1">:</span><span class="s2">c</span><span class="s1">}=</span><span class="s2">Fe</span><span class="s1">(</span><span class="s0">&quot;Build token groups&quot;</span><span class="s1">,(()=&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">buildTokenGroups</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">u</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)));</span><span class="s4">let </span><span class="s2">p</span><span class="s1">=</span><span class="s2">Fe</span><span class="s1">(</span><span class="s0">&quot;Finish automaton&quot;</span><span class="s1">,(()=&gt;</span><span class="s2">bt</span><span class="s1">(</span><span class="s2">o</span><span class="s1">)));</span><span class="s4">let </span><span class="s2">d</span><span class="s1">=</span><span class="s2">It</span><span class="s1">(</span><span class="s2">p</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">tops</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s5">/\blr\b/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">Ue</span><span class="s1">))</span><span class="s2">console</span><span class="s1">.</span><span class="s2">log</span><span class="s1">(</span><span class="s2">p</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">));</span><span class="s4">let </span><span class="s2">m</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">R of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalSpecializers</span><span class="s1">)</span><span class="s2">m</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">R</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">R </span><span class="s4">in this</span><span class="s1">.</span><span class="s2">specialized</span><span class="s1">)</span><span class="s2">m</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">token</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">names</span><span class="s1">[</span><span class="s2">R</span><span class="s1">],</span><span class="s2">table</span><span class="s1">:</span><span class="s2">At</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">specialized</span><span class="s1">[</span><span class="s2">R</span><span class="s1">])});</span><span class="s4">let </span><span class="s2">g</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">ns</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">start</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">start</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">};</span><span class="s4">let </span><span class="s2">k</span><span class="s1">=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalTokens</span><span class="s1">).</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">g</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)-</span><span class="s2">g</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))).</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">u</span><span class="s1">);</span><span class="s4">let </span><span class="s2">x</span><span class="s1">=</span><span class="s4">new </span><span class="s2">qt</span><span class="s1">;</span><span class="s4">let </span><span class="s2">b</span><span class="s1">=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s3">262144</span><span class="s1">&gt;&gt;</span><span class="s3">16</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">p</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">startRule</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of s</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s3">131072</span><span class="s1">&gt;&gt;</span><span class="s3">16</span><span class="s1">)}</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">65535</span><span class="s1">,</span><span class="s3">0</span><span class="s1">);</span><span class="s4">return </span><span class="s2">x</span><span class="s1">.</span><span class="s2">storeArray</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}));</span><span class="s4">let </span><span class="s2">w</span><span class="s1">=</span><span class="s2">Fe</span><span class="s1">(</span><span class="s0">&quot;Finish states&quot;</span><span class="s1">,(()=&gt;{</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Uint32Array</span><span class="s1">(</span><span class="s2">p</span><span class="s1">.</span><span class="s2">length</span><span class="s1">*</span><span class="s3">6</span><span class="s1">);</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">computeForceReductions</span><span class="s1">(</span><span class="s2">p</span><span class="s1">,</span><span class="s2">a</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">jt</span><span class="s1">(</span><span class="s2">k</span><span class="s1">,</span><span class="s2">x</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">b</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">p</span><span class="s1">,</span><span class="s4">this</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of p</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">finish</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">d</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">),</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}));</span><span class="s4">let </span><span class="s2">y</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">R</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">R</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dialects</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">R</span><span class="s1">++)</span><span class="s2">y</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dialects</span><span class="s1">[</span><span class="s2">R</span><span class="s1">]]=</span><span class="s2">x</span><span class="s1">.</span><span class="s2">storeArray</span><span class="s1">((</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">[</span><span class="s2">R</span><span class="s1">]||</span><span class="s2">vt</span><span class="s1">).</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)).</span><span class="s2">concat</span><span class="s1">(</span><span class="s3">65535</span><span class="s1">));</span><span class="s4">let </span><span class="s2">$</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dynamicRulePrecedences</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s2">$</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">prec</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}</span><span class="s2">of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">dynamicRulePrecedences</span><span class="s1">)</span><span class="s2">$</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">let </span><span class="s2">v</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">R of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">tops</span><span class="s1">)</span><span class="s2">v</span><span class="s1">[</span><span class="s2">R</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">]=[</span><span class="s2">p</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">startRule</span><span class="s1">==</span><span class="s2">R</span><span class="s1">)).</span><span class="s2">id</span><span class="s1">,</span><span class="s2">R</span><span class="s1">.</span><span class="s2">id</span><span class="s1">];</span><span class="s4">let </span><span class="s2">S</span><span class="s1">=</span><span class="s2">x</span><span class="s1">.</span><span class="s2">storeArray</span><span class="s1">(</span><span class="s2">f</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s3">65535</span><span class="s1">));</span><span class="s4">let</span><span class="s1">{</span><span class="s2">nodeProps</span><span class="s1">:</span><span class="s2">T</span><span class="s1">,</span><span class="s2">skippedTypes</span><span class="s1">:</span><span class="s2">O</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">gatherNodeProps</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return</span><span class="s1">{</span><span class="s2">states</span><span class="s1">:</span><span class="s2">w</span><span class="s1">,</span><span class="s2">stateData</span><span class="s1">:</span><span class="s2">x</span><span class="s1">.</span><span class="s2">finish</span><span class="s1">(),</span><span class="s2">goto</span><span class="s1">:</span><span class="s2">Dt</span><span class="s1">(</span><span class="s2">p</span><span class="s1">),</span><span class="s2">nodeNames</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">)).</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">),</span><span class="s2">nodeProps</span><span class="s1">:</span><span class="s2">T</span><span class="s1">,</span><span class="s2">skippedTypes</span><span class="s1">:</span><span class="s2">O</span><span class="s1">,</span><span class="s2">maxTerm</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">repeatNodeCount</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">i</span><span class="s1">,</span><span class="s2">tokenizers</span><span class="s1">:</span><span class="s2">k</span><span class="s1">,</span><span class="s2">tokenData</span><span class="s1">:</span><span class="s2">c</span><span class="s1">,</span><span class="s2">topRules</span><span class="s1">:</span><span class="s2">v</span><span class="s1">,</span><span class="s2">dialects</span><span class="s1">:</span><span class="s2">y</span><span class="s1">,</span><span class="s2">dynamicPrecedences</span><span class="s1">:</span><span class="s2">$</span><span class="s1">,</span><span class="s2">specialized</span><span class="s1">:</span><span class="s2">m</span><span class="s1">,</span><span class="s2">tokenPrec</span><span class="s1">:</span><span class="s2">S</span><span class="s1">,</span><span class="s2">termNames</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}}</span><span class="s2">getParser</span><span class="s1">(){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">states</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">stateData</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">goto</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">nodeNames</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">nodeProps</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">skippedTypes</span><span class="s1">:</span><span class="s2">l</span><span class="s1">,</span><span class="s2">maxTerm</span><span class="s1">:</span><span class="s2">a</span><span class="s1">,</span><span class="s2">repeatNodeCount</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">tokenizers</span><span class="s1">:</span><span class="s2">u</span><span class="s1">,</span><span class="s2">tokenData</span><span class="s1">:</span><span class="s2">h</span><span class="s1">,</span><span class="s2">topRules</span><span class="s1">:</span><span class="s2">f</span><span class="s1">,</span><span class="s2">dialects</span><span class="s1">:</span><span class="s2">c</span><span class="s1">,</span><span class="s2">dynamicPrecedences</span><span class="s1">:</span><span class="s2">p</span><span class="s1">,</span><span class="s2">specialized</span><span class="s1">:</span><span class="s2">d</span><span class="s1">,</span><span class="s2">tokenPrec</span><span class="s1">:</span><span class="s2">m</span><span class="s1">,</span><span class="s2">termNames</span><span class="s1">:</span><span class="s2">g</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">prepareParser</span><span class="s1">();</span><span class="s4">let </span><span class="s2">k</span><span class="s1">=</span><span class="s2">d</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">rs</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">externalSpecializer</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">);</span><span class="s4">return</span><span class="s1">{</span><span class="s2">term</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">get</span><span class="s1">:(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)&lt;&lt;</span><span class="s3">1</span><span class="s1">|(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;extend&quot;</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">),</span><span class="s2">external</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">extend</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;extend&quot;</span><span class="s1">}}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">return</span><span class="s1">{</span><span class="s2">term</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">token</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">get</span><span class="s1">:</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">table</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]||-</span><span class="s3">1</span><span class="s1">}}}));</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">U1</span><span class="s1">.</span><span class="s2">deserialize</span><span class="s1">({</span><span class="s2">version</span><span class="s1">:</span><span class="s3">14</span><span class="s1">,</span><span class="s2">states</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">stateData</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">goto</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">nodeNames</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">maxTerm</span><span class="s1">:</span><span class="s2">a</span><span class="s1">,</span><span class="s2">repeatNodeCount</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">nodeProps</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((({</span><span class="s2">prop</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">terms</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">knownProps</span><span class="s1">[</span><span class="s2">e</span><span class="s1">].</span><span class="s2">prop</span><span class="s1">,</span><span class="s2">...t</span><span class="s1">])),</span><span class="s2">propSources</span><span class="s1">:!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">externalPropSource</span><span class="s1">?</span><span class="s2">undefined</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">externalPropSources</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">externalPropSource</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">))),</span><span class="s2">skippedNodes</span><span class="s1">:</span><span class="s2">l</span><span class="s1">,</span><span class="s2">tokenData</span><span class="s1">:</span><span class="s2">h</span><span class="s1">,</span><span class="s2">tokenizers</span><span class="s1">:</span><span class="s2">u</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">create</span><span class="s1">())),</span><span class="s2">context</span><span class="s1">:!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">context</span><span class="s1">?</span><span class="s2">undefined</span><span class="s1">:</span><span class="s4">typeof this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">contextTracker</span><span class="s1">==</span><span class="s0">&quot;function&quot;</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">contextTracker</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">):</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">contextTracker</span><span class="s1">,</span><span class="s2">topRules</span><span class="s1">:</span><span class="s2">f</span><span class="s1">,</span><span class="s2">dialects</span><span class="s1">:</span><span class="s2">c</span><span class="s1">,</span><span class="s2">dynamicPrecedences</span><span class="s1">:</span><span class="s2">p</span><span class="s1">,</span><span class="s2">specialized</span><span class="s1">:</span><span class="s2">k</span><span class="s1">,</span><span class="s2">tokenPrec</span><span class="s1">:</span><span class="s2">m</span><span class="s1">,</span><span class="s2">termNames</span><span class="s1">:</span><span class="s2">g</span><span class="s1">})}</span><span class="s2">getParserFile</span><span class="s1">(){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">states</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">stateData</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">goto</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">nodeNames</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">nodeProps</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">skippedTypes</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">maxTerm</span><span class="s1">:</span><span class="s2">l</span><span class="s1">,</span><span class="s2">repeatNodeCount</span><span class="s1">:</span><span class="s2">a</span><span class="s1">,</span><span class="s2">tokenizers</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">tokenData</span><span class="s1">:</span><span class="s2">u</span><span class="s1">,</span><span class="s2">topRules</span><span class="s1">:</span><span class="s2">h</span><span class="s1">,</span><span class="s2">dialects</span><span class="s1">:</span><span class="s2">f</span><span class="s1">,</span><span class="s2">dynamicPrecedences</span><span class="s1">:</span><span class="s2">c</span><span class="s1">,</span><span class="s2">specialized</span><span class="s1">:</span><span class="s2">p</span><span class="s1">,</span><span class="s2">tokenPrec</span><span class="s1">:</span><span class="s2">d</span><span class="s1">,</span><span class="s2">termNames</span><span class="s1">:</span><span class="s2">m</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">prepareParser</span><span class="s1">();</span><span class="s4">let </span><span class="s2">g</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">moduleStyle</span><span class="s1">||</span><span class="s0">&quot;es&quot;</span><span class="s1">;</span><span class="s4">let </span><span class="s2">k</span><span class="s1">=</span><span class="s0">&quot;// This file was generated by lezer-generator. You probably shouldn't edit it.</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">,</span><span class="s2">x</span><span class="s1">=</span><span class="s2">k</span><span class="s1">;</span><span class="s4">let </span><span class="s2">b</span><span class="s1">={},</span><span class="s2">w</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">let </span><span class="s2">y</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">G of hs</span><span class="s1">)</span><span class="s2">y</span><span class="s1">[</span><span class="s2">G</span><span class="s1">]=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">let </span><span class="s2">$</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">exportName</span><span class="s1">||</span><span class="s0">&quot;parser&quot;</span><span class="s1">;</span><span class="s2">y</span><span class="s1">[</span><span class="s2">$</span><span class="s1">]=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">let </span><span class="s2">v</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;</span><span class="s2">t</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">+(</span><span class="s2">t</span><span class="s1">?</span><span class="s0">&quot;_&quot;</span><span class="s1">+</span><span class="s2">t</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">y</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}};</span><span class="s4">let </span><span class="s2">S</span><span class="s1">=(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">+</span><span class="s0">&quot; from &quot;</span><span class="s1">+</span><span class="s2">t</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">w</span><span class="s1">[</span><span class="s2">i</span><span class="s1">])</span><span class="s4">return </span><span class="s2">w</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">in </span><span class="s2">y</span><span class="s1">){</span><span class="s2">r</span><span class="s1">=</span><span class="s2">v</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s2">e</span><span class="s1">+=</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">g</span><span class="s1">==</span><span class="s0">&quot;cjs&quot;</span><span class="s1">?</span><span class="s0">&quot;:&quot;</span><span class="s1">:</span><span class="s0">&quot; as&quot;</span><span class="s1">} </span><span class="s2">$</span><span class="s1">{</span><span class="s2">r</span><span class="s1">}</span><span class="s0">`</span><span class="s1">}</span><span class="s2">y</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=</span><span class="s4">true</span><span class="s1">;(</span><span class="s2">b</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]||(</span><span class="s2">b</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">w</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]=</span><span class="s2">r</span><span class="s1">};</span><span class="s4">let </span><span class="s2">T</span><span class="s1">=</span><span class="s2">S</span><span class="s1">(</span><span class="s0">&quot;LRParser&quot;</span><span class="s1">,</span><span class="s0">&quot;@lezer/lr&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">O</span><span class="s1">=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">createSource</span><span class="s1">(</span><span class="s2">S</span><span class="s1">)));</span><span class="s4">let </span><span class="s2">R</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">context</span><span class="s1">?</span><span class="s2">S</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">context</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">context</span><span class="s1">.</span><span class="s2">source</span><span class="s1">):</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">P</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((({</span><span class="s2">prop</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">terms</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">let</span><span class="s1">{</span><span class="s2">source</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">knownProps</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">?</span><span class="s2">S</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">):</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">name</span><span class="s1">);</span><span class="s4">return</span><span class="s0">`[</span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">}</span><span class="s0">, </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">C</span><span class="s1">).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">)}</span><span class="s0">]`</span><span class="s1">}));</span><span class="s4">function </span><span class="s2">j</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return</span><span class="s0">&quot;{__proto__:null,&quot;</span><span class="s1">+</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">e</span><span class="s1">).</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s5">/^(\d+|[a-zA-Z_]\w*)$/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)?</span><span class="s2">t</span><span class="s1">:</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s0">:</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]}</span><span class="s0">`</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;, &quot;</span><span class="s1">)+</span><span class="s0">&quot;}&quot;</span><span class="s1">}</span><span class="s4">let </span><span class="s2">N</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">let </span><span class="s2">A</span><span class="s1">=</span><span class="s2">p</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">rs</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">S</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">source</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">typeScript</span><span class="s1">?</span><span class="s0">&quot;: any&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">return</span><span class="s0">`{term: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s0">, get: (value</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">}</span><span class="s0">, stack</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">}</span><span class="s0">) =&gt; (</span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">}</span><span class="s0">(value, stack) &lt;&lt; 1)</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;extend&quot;</span><span class="s1">?</span><span class="s0">` | </span><span class="s2">$</span><span class="s1">{</span><span class="s3">1</span><span class="s1">}</span><span class="s0">`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s0">, external: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;extend&quot;</span><span class="s1">?</span><span class="s0">&quot;, extend: true&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s0">}`</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">v</span><span class="s1">(</span><span class="s0">&quot;spec_&quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">token</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s5">/\W/g</span><span class="s1">,</span><span class="s0">&quot;&quot;</span><span class="s1">));</span><span class="s2">y</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=</span><span class="s4">true</span><span class="s1">;</span><span class="s2">N</span><span class="s1">+=</span><span class="s0">`const </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">j</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">table</span><span class="s1">)}</span><span class="s4">\n</span><span class="s0">`</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">typeScript</span><span class="s1">?</span><span class="s0">`: keyof typeof </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">}</span><span class="s0">`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">return</span><span class="s0">`{term: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">token</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s0">, get: (value</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">}</span><span class="s0">) =&gt; </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">}</span><span class="s0">[value] || -1}`</span><span class="s1">}}));</span><span class="s4">let </span><span class="s2">z</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">externalPropSources</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">S</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">source</span><span class="s1">)));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">G </span><span class="s4">in </span><span class="s2">b</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">g</span><span class="s1">==</span><span class="s0">&quot;cjs&quot;</span><span class="s1">)</span><span class="s2">x</span><span class="s1">+=</span><span class="s0">`const {</span><span class="s2">$</span><span class="s1">{</span><span class="s2">b</span><span class="s1">[</span><span class="s2">G</span><span class="s1">].</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;, &quot;</span><span class="s1">)}</span><span class="s0">} = require(</span><span class="s2">$</span><span class="s1">{</span><span class="s2">G</span><span class="s1">}</span><span class="s0">)</span><span class="s4">\n</span><span class="s0">`</span><span class="s1">;</span><span class="s4">else </span><span class="s2">x</span><span class="s1">+=</span><span class="s0">`import {</span><span class="s2">$</span><span class="s1">{</span><span class="s2">b</span><span class="s1">[</span><span class="s2">G</span><span class="s1">].</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;, &quot;</span><span class="s1">)}</span><span class="s0">} from </span><span class="s2">$</span><span class="s1">{</span><span class="s2">G</span><span class="s1">}</span><span class="s4">\n</span><span class="s0">`</span><span class="s1">}</span><span class="s2">x</span><span class="s1">+=</span><span class="s2">N</span><span class="s1">;</span><span class="s4">function </span><span class="s2">C</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return typeof </span><span class="s2">e</span><span class="s1">!=</span><span class="s0">&quot;string&quot;</span><span class="s1">||</span><span class="s5">/^(true|false|\d+(\.\d+)?|\.\d+)$/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)?</span><span class="s2">e</span><span class="s1">:</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">I</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">f</span><span class="s1">).</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s0">: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">f</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]}</span><span class="s0">`</span><span class="s1">));</span><span class="s4">let </span><span class="s2">q</span><span class="s1">=</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">T</span><span class="s1">}</span><span class="s0">.deserialize({</span><span class="s4">\n  </span><span class="s0">version: </span><span class="s2">$</span><span class="s1">{</span><span class="s3">14</span><span class="s1">}</span><span class="s0">,</span><span class="s4">\n  </span><span class="s0">states: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">$t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s3">4294967295</span><span class="s1">)}</span><span class="s0">,</span><span class="s4">\n  </span><span class="s0">stateData: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">$t</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s0">,</span><span class="s4">\n  </span><span class="s0">goto: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">$t</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s0">,</span><span class="s4">\n  </span><span class="s0">nodeNames: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s0">,</span><span class="s4">\n  </span><span class="s0">maxTerm: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">l</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">R</span><span class="s1">?</span><span class="s0">`,</span><span class="s4">\n  </span><span class="s0">context: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">R</span><span class="s1">}</span><span class="s0">`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">P</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">`,</span><span class="s4">\n  </span><span class="s0">nodeProps: [</span><span class="s4">\n    </span><span class="s2">$</span><span class="s1">{</span><span class="s2">P</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,</span><span class="s4">\n    </span><span class="s0">&quot;</span><span class="s1">)}</span><span class="s4">\n  </span><span class="s0">]`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">z</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">`,</span><span class="s4">\n  </span><span class="s0">propSources: [</span><span class="s2">$</span><span class="s1">{</span><span class="s2">z</span><span class="s1">.</span><span class="s2">join</span><span class="s1">()}</span><span class="s0">]`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">`,</span><span class="s4">\n  </span><span class="s0">skippedNodes: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s0">,</span><span class="s4">\n  </span><span class="s0">repeatNodeCount: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">a</span><span class="s1">}</span><span class="s0">,</span><span class="s4">\n  </span><span class="s0">tokenData: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">$t</span><span class="s1">(</span><span class="s2">u</span><span class="s1">)}</span><span class="s0">,</span><span class="s4">\n  </span><span class="s0">tokenizers: [</span><span class="s2">$</span><span class="s1">{</span><span class="s2">O</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;, &quot;</span><span class="s1">)}</span><span class="s0">],</span><span class="s4">\n  </span><span class="s0">topRules: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">h</span><span class="s1">)}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">I</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">`,</span><span class="s4">\n  </span><span class="s0">dialects: {</span><span class="s2">$</span><span class="s1">{</span><span class="s2">I</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;, &quot;</span><span class="s1">)}</span><span class="s0">}`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">c</span><span class="s1">?</span><span class="s0">`,</span><span class="s4">\n  </span><span class="s0">dynamicPrecedences: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">c</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">A</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">`,</span><span class="s4">\n  </span><span class="s0">specialized: [</span><span class="s2">$</span><span class="s1">{</span><span class="s2">A</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">)}</span><span class="s0">]`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s0">,</span><span class="s4">\n  </span><span class="s0">tokenPrec: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">d</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">includeNames</span><span class="s1">?</span><span class="s0">`,</span><span class="s4">\n  </span><span class="s0">termNames: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">m</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s4">\n</span><span class="s0">})`</span><span class="s1">;</span><span class="s4">let </span><span class="s2">D</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">G </span><span class="s4">in this</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">G</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">hs</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;;</span><span class="s2">t</span><span class="s1">++){</span><span class="s2">e</span><span class="s1">=</span><span class="s0">&quot;_&quot;</span><span class="s1">.</span><span class="s2">repeat</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)+</span><span class="s2">G</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!(</span><span class="s2">e </span><span class="s4">in this</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">))</span><span class="s4">break</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(!</span><span class="s5">/^[\w$]+$/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">G</span><span class="s1">)){</span><span class="s4">continue</span><span class="s1">}</span><span class="s2">D</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">g</span><span class="s1">==</span><span class="s0">&quot;cjs&quot;</span><span class="s1">?</span><span class="s0">&quot;:&quot;</span><span class="s1">:</span><span class="s0">&quot; =&quot;</span><span class="s1">} </span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">[</span><span class="s2">G</span><span class="s1">]}</span><span class="s0">`</span><span class="s1">)}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">G</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">G</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dialects</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">G</span><span class="s1">++)</span><span class="s2">D</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s0">`Dialect_</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dialects</span><span class="s1">[</span><span class="s2">G</span><span class="s1">]}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">g</span><span class="s1">==</span><span class="s0">&quot;cjs&quot;</span><span class="s1">?</span><span class="s0">&quot;:&quot;</span><span class="s1">:</span><span class="s0">&quot; =&quot;</span><span class="s1">} </span><span class="s2">$</span><span class="s1">{</span><span class="s2">G</span><span class="s1">}</span><span class="s0">`</span><span class="s1">);</span><span class="s4">return</span><span class="s1">{</span><span class="s2">parser</span><span class="s1">:</span><span class="s2">x</span><span class="s1">+(</span><span class="s2">g</span><span class="s1">==</span><span class="s0">&quot;cjs&quot;</span><span class="s1">?</span><span class="s0">`exports.</span><span class="s2">$</span><span class="s1">{</span><span class="s2">$</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">q</span><span class="s1">}</span><span class="s4">\n</span><span class="s0">`</span><span class="s1">:</span><span class="s0">`export const </span><span class="s2">$</span><span class="s1">{</span><span class="s2">$</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">q</span><span class="s1">}</span><span class="s4">\n</span><span class="s0">`</span><span class="s1">),</span><span class="s2">terms</span><span class="s1">:</span><span class="s2">g</span><span class="s1">==</span><span class="s0">&quot;cjs&quot;</span><span class="s1">?</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">k</span><span class="s1">}</span><span class="s0">module.exports = {</span><span class="s4">\n  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">D</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,</span><span class="s4">\n  </span><span class="s0">&quot;</span><span class="s1">)}</span><span class="s4">\n</span><span class="s0">}`</span><span class="s1">:</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">k</span><span class="s1">}</span><span class="s0">export const</span><span class="s4">\n  </span><span class="s2">$</span><span class="s1">{</span><span class="s2">D</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,</span><span class="s4">\n  </span><span class="s0">&quot;</span><span class="s1">)}</span><span class="s4">\n</span><span class="s0">`</span><span class="s1">}}</span><span class="s2">gatherNonSkippedNodes</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">s</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]){</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s4">true</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">tops</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">rules</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">)</span><span class="s2">s</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s2">gatherNodeProps</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">gatherNonSkippedNodes</span><span class="s1">(),</span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]&amp;&amp;!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">error</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e </span><span class="s4">in </span><span class="s2">n</span><span class="s1">.</span><span class="s2">props</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">knownProps</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">B</span><span class="s1">(</span><span class="s0">&quot;No known prop type for &quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">source</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s4">null</span><span class="s1">&amp;&amp;(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">source</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;repeated&quot;</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">source</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;error&quot;</span><span class="s1">))</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">prop</span><span class="s1">==</span><span class="s2">e</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">={</span><span class="s2">prop</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">values</span><span class="s1">:{}});(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">props</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]]||(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">props</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)}}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">nodeProps</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((({</span><span class="s2">prop</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">values</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i </span><span class="s4">in </span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of e</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">prop</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">terms</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}})),</span><span class="s2">skippedTypes</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}}</span><span class="s2">makeTerminal</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">makeTerminal</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">uniqueName</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">computeForceReductions</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">a of e</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">0</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of a</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">n</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]||(</span><span class="s2">n</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=[]);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">parents</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">id</span><span class="s1">);</span><span class="s4">else </span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">parents</span><span class="s1">:[</span><span class="s2">a</span><span class="s1">.</span><span class="s2">id</span><span class="s1">],</span><span class="s2">target</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">})}</span><span class="s2">i</span><span class="s1">[</span><span class="s2">a</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">set</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">&amp;&amp;!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">top</span><span class="s1">)).</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">))}</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">function </span><span class="s2">l</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">n</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">return </span><span class="s2">i</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">?</span><span class="s2">s</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parents</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))):</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parents</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">==</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return true</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">r</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">];</span><span class="s4">return </span><span class="s2">n</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}))}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">a of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">&amp;&amp;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">s</span><span class="s1">[</span><span class="s2">a</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">zt</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">)</span><span class="s2">r</span><span class="s1">[</span><span class="s2">a</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;;</span><span class="s2">a</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">o</span><span class="s1">.</span><span class="s2">id</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">a</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">a</span><span class="s1">)</span><span class="s2">n</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">continue</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">!=</span><span class="s3">1</span><span class="s1">||!</span><span class="s2">l</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">o</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)){</span><span class="s2">s</span><span class="s1">[</span><span class="s2">o</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">zt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s3">1</span><span class="s1">)</span><span class="s2">r</span><span class="s1">[</span><span class="s2">o</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">id</span><span class="s1">;</span><span class="s4">break</span><span class="s1">}}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s4">break</span><span class="s1">}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s2">substituteArgs</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">;</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">walk</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">&amp;&amp;(</span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)))&gt;-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">&amp;&amp;!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return new </span><span class="s2">v</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Passing arguments to a parameter that already has arguments`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">T</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">substituteArgsInProps</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">return </span><span class="s2">n</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">props</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s4">new </span><span class="s2">T</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s4">new </span><span class="s2">u</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">params</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">))}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">S</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">substituteArgsInProps</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">return </span><span class="s2">i</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s4">new </span><span class="s2">S</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">token</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">content</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}))}</span><span class="s2">substituteArgsInProps</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">r</span><span class="s1">.</span><span class="s2">name</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s2">e</span><span class="s1">)</span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">l</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">&amp;&amp;!</span><span class="s2">a</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">i</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=</span><span class="s4">new </span><span class="s2">J</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">a</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s4">null</span><span class="s1">);</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">a </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">)</span><span class="s2">i</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=</span><span class="s4">new </span><span class="s2">J</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">a</span><span class="s1">.</span><span class="s2">value</span><span class="s1">,</span><span class="s4">null</span><span class="s1">);</span><span class="s4">else this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Trying to interpolate expression '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">a</span><span class="s1">}</span><span class="s0">' into a prop`</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">};</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">value</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">value</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">==</span><span class="s2">e</span><span class="s1">)</span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s2">n</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=</span><span class="s4">new </span><span class="s2">E</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">start</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">at</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}}</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}</span><span class="s2">conflictsFor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Y</span><span class="s1">.</span><span class="s2">none</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">Y</span><span class="s1">.</span><span class="s2">none</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;ambig&quot;</span><span class="s1">){</span><span class="s2">t</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Y</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]))}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">precedences</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">items</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)):-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Reference to unknown precedence: '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">'`</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">items</span><span class="s1">[</span><span class="s2">n</span><span class="s1">],</span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">items</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">n</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;cut&quot;</span><span class="s1">){</span><span class="s2">t</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Y</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">vt</span><span class="s1">,</span><span class="s2">l</span><span class="s1">))}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">t</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Y</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&lt;&lt;</span><span class="s3">2</span><span class="s1">));</span><span class="s2">s</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Y</span><span class="s1">((</span><span class="s2">l</span><span class="s1">&lt;&lt;</span><span class="s3">2</span><span class="s1">)+(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;left&quot;</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s0">&quot;right&quot;</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">)))}}}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">here</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">atEnd</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}}</span><span class="s2">raise</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s3">1</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">input</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">warn</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">input</span><span class="s1">.</span><span class="s2">message</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">else </span><span class="s2">console</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">defineRule</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Q</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">ensureConflicts</span><span class="s1">(),</span><span class="s2">s</span><span class="s1">))}</span><span class="s2">resolve</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s4">return</span><span class="s1">[</span><span class="s2">Tt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">term</span><span class="s1">)];</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return</span><span class="s1">[</span><span class="s2">Tt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">localTokens</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return</span><span class="s1">[</span><span class="s2">Tt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)]}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalTokens</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return</span><span class="s1">[</span><span class="s2">Tt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)]}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">externalSpecializers</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return</span><span class="s1">[</span><span class="s2">Tt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)]}</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">astRules</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Reference to undefined rule '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">'`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Wrong number or arguments for '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">'`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">used</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">);</span><span class="s4">return</span><span class="s1">[</span><span class="s2">Tt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buildRule</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">))]}</span><span class="s2">normalizeRepeat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">matchesRepeat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return </span><span class="s2">Tt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">term</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">?</span><span class="s0">`(</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">}</span><span class="s0">)+`</span><span class="s1">:</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">}</span><span class="s0">+`</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">makeRepeat</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">uniqueName</span><span class="s1">(</span><span class="s2">s</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Ot</span><span class="s1">(</span><span class="s0">&quot;+&quot;</span><span class="s1">,[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">],</span><span class="s2">i</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defineRule</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">).</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">Tt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)));</span><span class="s4">return </span><span class="s2">Tt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s2">normalizeSequence</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)));</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">;</span><span class="s4">function </span><span class="s2">i</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">here</span><span class="s1">:</span><span class="s2">a</span><span class="s1">,</span><span class="s2">atEnd</span><span class="s1">:</span><span class="s2">o</span><span class="s1">}=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">conflictsFor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">markers</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">withConflicts</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">a</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s2">l</span><span class="s1">))];</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of i</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">).</span><span class="s2">withConflicts</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">a</span><span class="s1">),</span><span class="s2">r</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s2">o</span><span class="s1">)))</span><span class="s2">u</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">u</span><span class="s1">}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">(</span><span class="s2">St</span><span class="s1">.</span><span class="s2">none</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">Y</span><span class="s1">.</span><span class="s2">none</span><span class="s1">)}</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">j</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">kind</span><span class="s1">==</span><span class="s0">&quot;?&quot;</span><span class="s1">){</span><span class="s4">return</span><span class="s1">[</span><span class="s2">St</span><span class="s1">.</span><span class="s2">none</span><span class="s1">,</span><span class="s2">...</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">)]}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">j</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeRepeat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">kind</span><span class="s1">==</span><span class="s0">&quot;+&quot;</span><span class="s1">?[</span><span class="s2">t</span><span class="s1">]:[</span><span class="s2">St</span><span class="s1">.</span><span class="s2">none</span><span class="s1">,</span><span class="s2">t</span><span class="s1">]}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">O</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">reduce</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))),[])}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">R</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">normalizeSequence</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">){</span><span class="s4">return</span><span class="s1">[</span><span class="s2">Tt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">getLiteral</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))]}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">resolve</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">S</span><span class="s1">){</span><span class="s4">return</span><span class="s1">[</span><span class="s2">Tt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">resolveSpecialization</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))]}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">T</span><span class="s1">){</span><span class="s4">return</span><span class="s1">[</span><span class="s2">Tt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buildRule</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s2">vt</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">],</span><span class="s4">true</span><span class="s1">))]}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`This type of expression ('</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s0">') may not occur in non-token rules`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}}</span><span class="s2">buildRule</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">substituteArgs</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">params</span><span class="s1">);</span><span class="s4">let</span><span class="s1">{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">props</span><span class="s1">:</span><span class="s2">l</span><span class="s1">,</span><span class="s2">dynamicPrec</span><span class="s1">:</span><span class="s2">a</span><span class="s1">,</span><span class="s2">inline</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">group</span><span class="s1">:</span><span class="s2">u</span><span class="s1">,</span><span class="s2">exported</span><span class="s1">:</span><span class="s2">h</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodeInfo</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">||</span><span class="s2">vt</span><span class="s1">,</span><span class="s2">i</span><span class="s1">?</span><span class="s0">&quot;pg&quot;</span><span class="s1">:</span><span class="s0">&quot;pgi&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">params</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">`Can't export parameterized rules`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">`Can't export inline rule`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">let </span><span class="s2">f</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">newName</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">+(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s0">&quot;&lt;&quot;</span><span class="s1">+</span><span class="s2">t</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">)+</span><span class="s0">&quot;&gt;&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">),</span><span class="s2">r</span><span class="s1">||</span><span class="s4">true</span><span class="s1">,</span><span class="s2">l</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">)</span><span class="s2">f</span><span class="s1">.</span><span class="s2">inline</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">registerDynamicPrec</span><span class="s1">(</span><span class="s2">f</span><span class="s1">,</span><span class="s2">a</span><span class="s1">);</span><span class="s4">if</span><span class="s1">((</span><span class="s2">f</span><span class="s1">.</span><span class="s2">nodeType</span><span class="s1">||</span><span class="s2">h</span><span class="s1">)&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">)</span><span class="s2">f</span><span class="s1">.</span><span class="s2">preserve</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">[</span><span class="s2">h</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=</span><span class="s2">f</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Ot</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">f</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">let </span><span class="s2">c</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">c</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">100</span><span class="s1">*(</span><span class="s2">n </span><span class="s4">instanceof </span><span class="s2">O</span><span class="s1">?</span><span class="s2">n</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">:</span><span class="s3">1</span><span class="s1">))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">`Rule </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">is generating a lot (</span><span class="s2">$</span><span class="s1">{</span><span class="s2">c</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s0">) of choices.</span><span class="s4">\n  </span><span class="s0">Consider splitting it up or reducing the amount of ? or | operator uses.`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s5">/\brulesize\b/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">Ue</span><span class="s1">)&amp;&amp;</span><span class="s2">c</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">10</span><span class="s1">)</span><span class="s2">console</span><span class="s1">.</span><span class="s2">log</span><span class="s1">(</span><span class="s0">`Rule </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">c</span><span class="s1">.</span><span class="s2">length</span><span class="s1">} </span><span class="s0">variants`</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">defineRule</span><span class="s1">(</span><span class="s2">f</span><span class="s1">,</span><span class="s2">c</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">currentSkip</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">u</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">definedGroups</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">name</span><span class="s1">:</span><span class="s2">f</span><span class="s1">,</span><span class="s2">group</span><span class="s1">:</span><span class="s2">u</span><span class="s1">,</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">e</span><span class="s1">});</span><span class="s4">return </span><span class="s2">f</span><span class="s1">}</span><span class="s2">nodeInfo</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s2">vt</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">vt</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">){</span><span class="s4">let </span><span class="s2">a</span><span class="s1">={};</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">s</span><span class="s1">&amp;&amp;(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s0">&quot;a&quot;</span><span class="s1">)&gt;-</span><span class="s3">1</span><span class="s1">||!</span><span class="s2">cs</span><span class="s1">(</span><span class="s2">s</span><span class="s1">))&amp;&amp;!</span><span class="s5">/ /</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)?</span><span class="s2">s</span><span class="s1">:</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=</span><span class="s4">null</span><span class="s1">,</span><span class="s2">h</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">f</span><span class="s1">=</span><span class="s4">false</span><span class="s1">,</span><span class="s2">c</span><span class="s1">=</span><span class="s4">null</span><span class="s1">,</span><span class="s2">p</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">d of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">d</span><span class="s1">.</span><span class="s2">at</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">knownProps</span><span class="s1">[</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[</span><span class="s0">&quot;name&quot;</span><span class="s1">,</span><span class="s0">&quot;dialect&quot;</span><span class="s1">,</span><span class="s0">&quot;dynamicPrecedence&quot;</span><span class="s1">,</span><span class="s0">&quot;export&quot;</span><span class="s1">,</span><span class="s0">&quot;isGroup&quot;</span><span class="s1">].</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)?</span><span class="s0">` (did you mean '@</span><span class="s2">$</span><span class="s1">{</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">'?)`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Unknown prop name '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">'</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s0">`</span><span class="s1">,</span><span class="s2">d</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}</span><span class="s2">a</span><span class="s1">[</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">finishProp</span><span class="s1">(</span><span class="s2">d</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;name&quot;</span><span class="s1">){</span><span class="s2">o</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">finishProp</span><span class="s1">(</span><span class="s2">d</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s5">/ /</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">o</span><span class="s1">))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Node names cannot have spaces ('</span><span class="s2">$</span><span class="s1">{</span><span class="s2">o</span><span class="s1">}</span><span class="s0">')`</span><span class="s1">,</span><span class="s2">d</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;dialect&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s0">&quot;d&quot;</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Can't specify a dialect on non-token rules&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s3">1</span><span class="s1">&amp;&amp;!</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">value</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;The '@dialect' rule prop must hold a plain string value&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dialects</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">value</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Unknown dialect '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">value</span><span class="s1">}</span><span class="s0">'`</span><span class="s1">,</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">start</span><span class="s1">);</span><span class="s2">u</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;dynamicPrecedence&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s0">&quot;p&quot;</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Dynamic precedence can only be specified on nonterminals&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s3">1</span><span class="s1">||!</span><span class="s5">/^-?(?:10|\d)$/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">value</span><span class="s1">))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;The '@dynamicPrecedence' rule prop must hold an integer between -10 and 10&quot;</span><span class="s1">);</span><span class="s2">h</span><span class="s1">=+</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">value</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;inline&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;'@inline' doesn't take a value&quot;</span><span class="s1">,</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s0">&quot;i&quot;</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Inline can only be specified on nonterminals&quot;</span><span class="s1">);</span><span class="s2">f</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;isGroup&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s0">&quot;g&quot;</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;'@isGroup' can only be specified on nonterminals&quot;</span><span class="s1">);</span><span class="s2">c</span><span class="s1">=</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">finishProp</span><span class="s1">(</span><span class="s2">d</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">):</span><span class="s2">s</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;export&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">p</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">finishProp</span><span class="s1">(</span><span class="s2">d</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">else </span><span class="s2">p</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Unknown built-in prop name '@</span><span class="s2">$</span><span class="s1">{</span><span class="s2">d</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">'`</span><span class="s1">,</span><span class="s2">d</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">autoDelim</span><span class="s1">&amp;&amp;(</span><span class="s2">o</span><span class="s1">||</span><span class="s2">U</span><span class="s1">(</span><span class="s2">a</span><span class="s1">))){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">findDelimiters</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s2">Nt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s0">&quot;closedBy&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">[</span><span class="s3">1</span><span class="s1">].</span><span class="s2">nodeName</span><span class="s1">);</span><span class="s2">Nt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s3">1</span><span class="s1">],</span><span class="s0">&quot;openedBy&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">nodeName</span><span class="s1">)}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&amp;&amp;</span><span class="s2">U</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e </span><span class="s4">in </span><span class="s2">l</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(!(</span><span class="s2">e </span><span class="s4">in </span><span class="s2">a</span><span class="s1">))</span><span class="s2">a</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">l</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">U</span><span class="s1">(</span><span class="s2">a</span><span class="s1">)&amp;&amp;!</span><span class="s2">o</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Node has properties but no name`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">start</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">f</span><span class="s1">&amp;&amp;(</span><span class="s2">U</span><span class="s1">(</span><span class="s2">a</span><span class="s1">)||</span><span class="s2">u</span><span class="s1">||</span><span class="s2">h</span><span class="s1">))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Inline nodes can't have props, dynamic precedence, or a dialect`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">f</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">)</span><span class="s2">o</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">return</span><span class="s1">{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">props</span><span class="s1">:</span><span class="s2">a</span><span class="s1">,</span><span class="s2">dialect</span><span class="s1">:</span><span class="s2">u</span><span class="s1">,</span><span class="s2">dynamicPrec</span><span class="s1">:</span><span class="s2">h</span><span class="s1">,</span><span class="s2">inline</span><span class="s1">:</span><span class="s2">f</span><span class="s1">,</span><span class="s2">group</span><span class="s1">:</span><span class="s2">c</span><span class="s1">,</span><span class="s2">exported</span><span class="s1">:</span><span class="s2">p</span><span class="s1">}}</span><span class="s2">finishProp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Property refers to '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">', but no parameter by that name is in scope`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">&amp;&amp;!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return </span><span class="s2">n</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">)</span><span class="s4">return </span><span class="s2">n</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Expression '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">n</span><span class="s1">}</span><span class="s0">' can not be used as part of a property value`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)})).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">)}</span><span class="s2">resolveSpecialization</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">;</span><span class="s4">let</span><span class="s1">{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">props</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">dialect</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">exported</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodeInfo</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s0">&quot;d&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">token</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s3">1</span><span class="s1">||</span><span class="s2">l</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s3">1</span><span class="s1">||!</span><span class="s2">l</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">terms</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">terminal</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`The first argument to '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">}</span><span class="s0">' must resolve to a token`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">token</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">let </span><span class="s2">a</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">content </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">)</span><span class="s2">a</span><span class="s1">=[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">content</span><span class="s1">.</span><span class="s2">value</span><span class="s1">];</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">content </span><span class="s4">instanceof </span><span class="s2">O</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">content</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">)))</span><span class="s2">a</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">content</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">));</span><span class="s4">else return this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`The second argument to '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">}</span><span class="s0">' must be a literal or choice of literals`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">content</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">l</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">terms</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">u</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">specialized</span><span class="s1">[</span><span class="s2">o</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]||(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">specialized</span><span class="s1">[</span><span class="s2">o</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=[]);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">f of a</span><span class="s1">){</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">==</span><span class="s2">f</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">==</span><span class="s4">null</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">u</span><span class="s1">){</span><span class="s2">u</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">makeTerminal</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">name</span><span class="s1">+</span><span class="s0">&quot;/&quot;</span><span class="s1">+</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">f</span><span class="s1">),</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">)(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]||(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">u</span><span class="s1">)}</span><span class="s2">h</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">value</span><span class="s1">:</span><span class="s2">f</span><span class="s1">,</span><span class="s2">term</span><span class="s1">:</span><span class="s2">u</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">dialect</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">name</span><span class="s1">:</span><span class="s2">s</span><span class="s1">});</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokenOrigins</span><span class="s1">[</span><span class="s2">u</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]={</span><span class="s2">spec</span><span class="s1">:</span><span class="s2">o</span><span class="s1">};</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">||</span><span class="s2">r</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s2">u</span><span class="s1">.</span><span class="s2">preserve</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">[</span><span class="s2">r</span><span class="s1">||</span><span class="s2">s</span><span class="s1">]=</span><span class="s2">u</span><span class="s1">}}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">type</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Conflicting specialization types for </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">f</span><span class="s1">)} </span><span class="s0">of </span><span class="s2">$</span><span class="s1">{</span><span class="s2">o</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">(</span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">} </span><span class="s0">vs </span><span class="s2">$</span><span class="s1">{</span><span class="s2">l</span><span class="s1">.</span><span class="s2">type</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">dialect</span><span class="s1">!=</span><span class="s2">n</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Conflicting dialects for specialization </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">f</span><span class="s1">)} </span><span class="s0">of </span><span class="s2">$</span><span class="s1">{</span><span class="s2">o</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">name</span><span class="s1">!=</span><span class="s2">s</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Conflicting names for specialization </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">f</span><span class="s1">)} </span><span class="s0">of </span><span class="s2">$</span><span class="s1">{</span><span class="s2">o</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">u</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">term</span><span class="s1">!=</span><span class="s2">u</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Conflicting specialization tokens for </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">f</span><span class="s1">)} </span><span class="s0">of </span><span class="s2">$</span><span class="s1">{</span><span class="s2">o</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s2">u</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">term</span><span class="s1">}}</span><span class="s4">return </span><span class="s2">u</span><span class="s1">}</span><span class="s2">findDelimiters</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">R</span><span class="s1">)||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s3">2</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">)</span><span class="s4">return</span><span class="s1">{</span><span class="s2">term</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">getLiteral</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">str</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">};</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">expr </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">)</span><span class="s4">return</span><span class="s1">{</span><span class="s2">term</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">str</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">.</span><span class="s2">value</span><span class="s1">}}</span><span class="s4">return null</span><span class="s1">};</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">||!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=[</span><span class="s0">&quot;()&quot;</span><span class="s1">,</span><span class="s0">&quot;[]&quot;</span><span class="s1">,</span><span class="s0">&quot;{}&quot;</span><span class="s1">,</span><span class="s0">&quot;&lt;&gt;&quot;</span><span class="s1">];</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">str</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s3">1</span><span class="s1">])&gt;-</span><span class="s3">1</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">str</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">])&lt;</span><span class="s3">0</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">||!</span><span class="s2">r</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">||</span><span class="s2">r</span><span class="s1">.</span><span class="s2">str</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">n</span><span class="s1">[</span><span class="s3">0</span><span class="s1">])&lt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">r</span><span class="s1">.</span><span class="s2">str</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">n</span><span class="s1">[</span><span class="s3">1</span><span class="s1">])&gt;-</span><span class="s3">1</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">return</span><span class="s1">[</span><span class="s2">r</span><span class="s1">.</span><span class="s2">term</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">term</span><span class="s1">]}</span><span class="s2">registerDynamicPrec</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dynamicRulePrecedences</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">rule</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">prec</span><span class="s1">:</span><span class="s2">t</span><span class="s1">});</span><span class="s2">e</span><span class="s1">.</span><span class="s2">preserve</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}</span><span class="s2">defineGroup</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">var </span><span class="s2">i</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">)</span><span class="s4">return</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Rule '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">' cannot define a group because it contains a non-named recursive rule ('</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">')`</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">r</span><span class="s1">).</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">1</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Rule '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">' cannot define a group because some choices produce multiple named nodes`</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">])</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">n</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span><span class="s4">return </span><span class="s2">t</span><span class="s1">};</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l of r</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s2">l</span><span class="s1">.</span><span class="s2">props</span><span class="s1">[</span><span class="s0">&quot;group&quot;</span><span class="s1">]=(((</span><span class="s2">i</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">props</span><span class="s1">[</span><span class="s0">&quot;group&quot;</span><span class="s1">])===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">i</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">))||[]).</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">t</span><span class="s1">).</span><span class="s2">sort</span><span class="s1">().</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">)}</span><span class="s2">checkGroups</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">),</span><span class="s2">t</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">terms</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">){</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">nodeName</span><span class="s1">]=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">props</span><span class="s1">[</span><span class="s0">&quot;group&quot;</span><span class="s1">])</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of i</span><span class="s1">.</span><span class="s2">props</span><span class="s1">[</span><span class="s0">&quot;group&quot;</span><span class="s1">].</span><span class="s2">split</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">)){(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]||(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}}</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">])</span><span class="s4">this</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">`Group name '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">n</span><span class="s1">}</span><span class="s0">' conflicts with a node of the same name`</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">t</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)))&amp;&amp;(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">i</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;!</span><span class="s2">r</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))):</span><span class="s2">r</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)))))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">`Groups '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">n</span><span class="s1">}</span><span class="s0">' and '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]}</span><span class="s0">' overlap without one being a superset of the other`</span><span class="s1">)}}}}</span><span class="s4">const </span><span class="s2">Pt</span><span class="s1">=</span><span class="s3">5</span><span class="s1">;</span><span class="s4">class </span><span class="s2">jt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokenizers</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">data</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">stateArray</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipData</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipInfo</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">builder</span><span class="s1">=</span><span class="s2">l</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sharedActions</span><span class="s1">=[]}</span><span class="s2">findSharedActions</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s2">Pt</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">sharedActions</span><span class="s1">){</span><span class="s4">if</span><span class="s1">((!</span><span class="s2">t</span><span class="s1">||</span><span class="s2">r</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))))))</span><span class="s2">t</span><span class="s1">=</span><span class="s2">r</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s2">Pt</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s2">i</span><span class="s1">[</span><span class="s2">n</span><span class="s1">++]=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">&gt;=</span><span class="s2">Pt</span><span class="s1">&amp;&amp;(!</span><span class="s2">s</span><span class="s1">||</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s2">n</span><span class="s1">)){</span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=[]}}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">={</span><span class="s2">actions</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">addr</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">storeActions</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">,</span><span class="s4">null</span><span class="s1">)};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sharedActions</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}</span><span class="s2">storeActions</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return </span><span class="s2">s</span><span class="s1">.</span><span class="s2">addr</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">n</span><span class="s1">))))</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n </span><span class="s4">instanceof </span><span class="s2">Ve</span><span class="s1">){</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s3">0</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">zt</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipInfo</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">e</span><span class="s1">&amp;</span><span class="s3">65535</span><span class="s1">,</span><span class="s2">e</span><span class="s1">&gt;&gt;</span><span class="s3">16</span><span class="s1">)}}</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">65535</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">2</span><span class="s1">,</span><span class="s2">t</span><span class="s1">&amp;</span><span class="s3">65535</span><span class="s1">,</span><span class="s2">t</span><span class="s1">&gt;&gt;</span><span class="s3">16</span><span class="s1">);</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">1</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">addr</span><span class="s1">&amp;</span><span class="s3">65535</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">addr</span><span class="s1">&gt;&gt;</span><span class="s3">16</span><span class="s1">);</span><span class="s4">else </span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">0</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">data</span><span class="s1">.</span><span class="s2">storeArray</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s2">finish</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">builder</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">skipRules</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipData</span><span class="s1">[</span><span class="s2">n</span><span class="s1">],</span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipInfo</span><span class="s1">[</span><span class="s2">n</span><span class="s1">].</span><span class="s2">startTokens</span><span class="s1">;</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">?</span><span class="s2">zt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipInfo</span><span class="s1">):</span><span class="s3">0</span><span class="s1">;</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">;</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">h</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">t of e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">Xe</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">eof</span><span class="s1">)</span><span class="s2">u</span><span class="s1">=</span><span class="s2">zt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skipInfo</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">u</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">h</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">findSharedActions</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">set</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">top</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)))</span><span class="s2">o</span><span class="s1">|=</span><span class="s3">2</span><span class="s1">;</span><span class="s4">let </span><span class="s2">f</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">d</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">d</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">d</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">d</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">[</span><span class="s2">d</span><span class="s1">].</span><span class="s2">term</span><span class="s1">:</span><span class="s2">l</span><span class="s1">[</span><span class="s2">d</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">];</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">tokenOrigins</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">){</span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">;</span><span class="s4">continue</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">external </span><span class="s4">instanceof </span><span class="s2">ns</span><span class="s1">)</span><span class="s2">Et</span><span class="s1">(</span><span class="s2">f</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">external</span><span class="s1">);</span><span class="s4">break</span><span class="s1">}}</span><span class="s4">let </span><span class="s2">c</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">d</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">d</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokenizers</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">d</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokenizers</span><span class="s1">[</span><span class="s2">d</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">f</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">groupID</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">)</span><span class="s2">c</span><span class="s1">|=</span><span class="s3">1</span><span class="s1">&lt;&lt;</span><span class="s2">d</span><span class="s1">}</span><span class="s4">let </span><span class="s2">p</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">*</span><span class="s3">6</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">stateArray</span><span class="s1">[</span><span class="s2">p</span><span class="s1">+</span><span class="s3">0</span><span class="s1">]=</span><span class="s2">o</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">stateArray</span><span class="s1">[</span><span class="s2">p</span><span class="s1">+</span><span class="s3">1</span><span class="s1">]=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">storeActions</span><span class="s1">(</span><span class="s2">a</span><span class="s1">?</span><span class="s2">vt</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">,</span><span class="s2">u</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">stateArray</span><span class="s1">[</span><span class="s2">p</span><span class="s1">+</span><span class="s3">2</span><span class="s1">]=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">stateArray</span><span class="s1">[</span><span class="s2">p</span><span class="s1">+</span><span class="s3">3</span><span class="s1">]=</span><span class="s2">c</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">stateArray</span><span class="s1">[</span><span class="s2">p</span><span class="s1">+</span><span class="s3">4</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">stateArray</span><span class="s1">[</span><span class="s2">p</span><span class="s1">+</span><span class="s3">5</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">Nt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">[</span><span class="s2">t</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">||</span><span class="s2">i</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">).</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=</span><span class="s2">i</span><span class="s1">?</span><span class="s2">i</span><span class="s1">+</span><span class="s0">&quot; &quot;</span><span class="s1">+</span><span class="s2">s</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}</span><span class="s4">function </span><span class="s2">At</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">value</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">term</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s2">n</span><span class="s1">}</span><span class="s2">of e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">n</span><span class="s1">==</span><span class="s0">&quot;specialize&quot;</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s3">1</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">|</span><span class="s2">e</span><span class="s1">}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">zt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">id</span><span class="s1">|</span><span class="s3">65536</span><span class="s1">|(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">isRepeatWrap</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s3">131072</span><span class="s1">:</span><span class="s3">0</span><span class="s1">)|(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rule</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">))?</span><span class="s3">262144</span><span class="s1">:</span><span class="s3">0</span><span class="s1">)|</span><span class="s2">s</span><span class="s1">&lt;&lt;</span><span class="s3">19</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Ct</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s2">e</span><span class="s1">:</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">||</span><span class="s2">i</span><span class="s1">+</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]!=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">+</span><span class="s2">n</span><span class="s1">]){</span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">continue </span><span class="s2">e</span><span class="s1">}}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s4">return</span><span class="s1">-</span><span class="s3">1</span><span class="s1">}</span><span class="s4">function </span><span class="s2">It</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]){</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s4">true</span><span class="s1">;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}};</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of e</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">startRule</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">startRule</span><span class="s1">))</span><span class="s2">n</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of i</span><span class="s1">[</span><span class="s2">r</span><span class="s1">].</span><span class="s2">actions</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Ve</span><span class="s1">)</span><span class="s2">n</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of i</span><span class="s1">[</span><span class="s2">r</span><span class="s1">].</span><span class="s2">goto</span><span class="s1">)</span><span class="s2">n</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">=&gt;!</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]}</span><span class="s4">class </span><span class="s2">qt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">data</span><span class="s1">=[]}</span><span class="s2">storeArray</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Ct</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">data</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">data</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of e</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">data</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s2">finish</span><span class="s1">(){</span><span class="s4">return </span><span class="s2">Uint16Array</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">data</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">Dt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">={};</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l of e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of l</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">){</span><span class="s2">s</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]||(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]={});(</span><span class="s2">i</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]||(</span><span class="s2">i</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)}}</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">new </span><span class="s2">qt</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">s</span><span class="s1">+</span><span class="s3">2</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">l</span><span class="s1">&lt;=</span><span class="s2">s</span><span class="s1">;</span><span class="s2">l</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">l</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">){</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">1</span><span class="s1">);</span><span class="s4">continue</span><span class="s1">}</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of a</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">];</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">((</span><span class="s2">t</span><span class="s1">==</span><span class="s2">a</span><span class="s1">[</span><span class="s2">a</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">)+(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">));</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(+</span><span class="s2">t</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of i</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">storeArray</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)+</span><span class="s2">r</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">65535</span><span class="s1">)))</span><span class="s4">throw new </span><span class="s2">B</span><span class="s1">(</span><span class="s0">&quot;Goto table too large&quot;</span><span class="s1">);</span><span class="s4">return </span><span class="s2">Uint16Array</span><span class="s1">.</span><span class="s2">from</span><span class="s1">([</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">...n</span><span class="s1">,</span><span class="s2">...i</span><span class="s1">.</span><span class="s2">data</span><span class="s1">])}</span><span class="s4">class </span><span class="s2">Gt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">groupID</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s2">create</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">groupID</span><span class="s1">}</span><span class="s2">createSource</span><span class="s1">(){</span><span class="s4">return </span><span class="s2">String</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">groupID</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">Et</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Jt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">1</span><span class="s1">&lt;&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">groupID</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of s</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">){</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]||</span><span class="s3">0</span><span class="s1">)|</span><span class="s2">e</span><span class="s1">}}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">class </span><span class="s2">_t</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">scope</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">Bt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">name</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">start</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">args</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">Ut</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">=</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">building</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precedenceRelations</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">=</span><span class="s2">t</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">:</span><span class="s2">vt</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">unique</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)}</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s4">return </span><span class="s2">o</span><span class="s1">.</span><span class="s2">term</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">t</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">let</span><span class="s1">{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">props</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">dialect</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">exported</span><span class="s1">:</span><span class="s2">l</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">nodeInfo</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s0">&quot;d&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">vt</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">params</span><span class="s1">);</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">makeTerminal</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">toString</span><span class="s1">(),</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">)(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]||(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">a</span><span class="s1">);</span><span class="s4">if</span><span class="s1">((</span><span class="s2">a</span><span class="s1">.</span><span class="s2">nodeType</span><span class="s1">||</span><span class="s2">l</span><span class="s1">)&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">a</span><span class="s1">.</span><span class="s2">nodeType</span><span class="s1">)</span><span class="s2">a</span><span class="s1">.</span><span class="s2">preserve</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">[</span><span class="s2">l</span><span class="s1">||</span><span class="s2">t</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buildRule</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">,</span><span class="s4">new </span><span class="s2">re</span><span class="s1">([</span><span class="s2">a</span><span class="s1">]));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Ot</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">,</span><span class="s2">a</span><span class="s1">));</span><span class="s4">return </span><span class="s2">a</span><span class="s1">}</span><span class="s2">buildRule</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">vt</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">params</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Incorrect number of arguments for token '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">r</span><span class="s1">}</span><span class="s0">'`</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">building</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">r</span><span class="s1">&amp;&amp;</span><span class="s2">G</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">args</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">)));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">to</span><span class="s1">==</span><span class="s2">i</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">nullEdge</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">return</span><span class="s1">}</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">building</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">building</span><span class="s1">[</span><span class="s2">e</span><span class="s1">].</span><span class="s2">name</span><span class="s1">!=</span><span class="s2">r</span><span class="s1">)</span><span class="s2">e</span><span class="s1">--;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Invalid (non-tail) recursion in token rules: </span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">building</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">e</span><span class="s1">).</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; -&gt; &quot;</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">used</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">);</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">nullEdge</span><span class="s1">(</span><span class="s2">a</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">building</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Bt</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">args</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">build</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">substituteArgs</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">args</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">params</span><span class="s1">),</span><span class="s2">a</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;</span><span class="s4">new </span><span class="s2">_t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">params</span><span class="s1">[</span><span class="s2">s</span><span class="s1">].</span><span class="s2">name</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">))));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">building</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">()}</span><span class="s2">build</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">n</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">build</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">scope</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">localTokens</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">:</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s2">l</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">n</span><span class="s1">))}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Reference to token rule '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">', which isn't found`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buildRule</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">q</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">[</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">]</span><span class="s2">of I</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">])</span><span class="s2">t</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">O</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">build</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">es</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nullEdge</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">R</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">markers</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;Conflict marker in token expression&quot;</span><span class="s1">,</span><span class="s2">n</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">start</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">r</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">build</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s2">t</span><span class="s1">=</span><span class="s2">n</span><span class="s1">}}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">j</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">kind</span><span class="s1">==</span><span class="s0">&quot;*&quot;</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nullEdge</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">build</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">nullEdge</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">kind</span><span class="s1">==</span><span class="s0">&quot;+&quot;</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">build</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">build</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">nullEdge</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nullEdge</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">build</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">expr</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">A</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">[</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">]</span><span class="s2">of e</span><span class="s1">.</span><span class="s2">inverted</span><span class="s1">?</span><span class="s2">Wt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">):</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">)</span><span class="s2">Xt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">N</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">n</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s2">t</span><span class="s1">=</span><span class="s2">r</span><span class="s1">}}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">z</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s3">56320</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s3">56320</span><span class="s1">,</span><span class="s2">V</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s3">55296</span><span class="s1">,</span><span class="s3">56320</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s3">56320</span><span class="s1">,</span><span class="s3">57344</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Unrecognized expression type in token`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">)}}</span><span class="s2">takePrecedences</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precedenceRelations</span><span class="s1">=[];</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">precedences</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t</span><span class="s1">.</span><span class="s2">items</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">(</span><span class="s2">i</span><span class="s1">):</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">==</span><span class="s2">e</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">term</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">`Precedence specified for unknown token </span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">}</span><span class="s0">`</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t</span><span class="s1">)</span><span class="s2">is</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">s</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}}}</span><span class="s2">precededBy</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precedenceRelations</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">e</span><span class="s1">));</span><span class="s4">return </span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">after</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">buildPrecTable</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[],</span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precedenceRelations</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">a</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">b</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">soft</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}</span><span class="s2">of e</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">i</span><span class="s1">))||!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">n</span><span class="s1">)))</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)[</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">]=[</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">];</span><span class="s2">is</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,[</span><span class="s2">i</span><span class="s1">]);</span><span class="s2">is</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,[])}</span><span class="s2">e</span><span class="s1">:</span><span class="s4">while</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">after</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)))){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">term</span><span class="s1">.</span><span class="s2">id</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">)</span><span class="s4">break </span><span class="s2">e</span><span class="s1">;</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span><span class="s4">continue </span><span class="s2">e</span><span class="s1">}}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Cyclic token precedence relation between </span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;, &quot;</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">Mt </span><span class="s4">extends </span><span class="s2">Ut</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">...arguments</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">explicitConflicts</span><span class="s1">=[]}</span><span class="s2">getLiteral</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">id</span><span class="s1">==</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return </span><span class="s2">o</span><span class="s1">.</span><span class="s2">term</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">,</span><span class="s2">i</span><span class="s1">={},</span><span class="s2">n</span><span class="s1">=</span><span class="s4">null</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">literals</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">literal</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)):</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)({</span><span class="s2">name</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">props</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">dialect</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">exported</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">nodeInfo</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s0">&quot;da&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">));</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">makeTerminal</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">)(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]||(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">a</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">build</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">,</span><span class="s4">new </span><span class="s2">re</span><span class="s1">([</span><span class="s2">a</span><span class="s1">]),</span><span class="s2">vt</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Ot</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">vt</span><span class="s1">,</span><span class="s2">a</span><span class="s1">));</span><span class="s4">return </span><span class="s2">a</span><span class="s1">}</span><span class="s2">takeConflicts</span><span class="s1">(){</span><span class="s4">var </span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">v</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">term</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">built</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">==</span><span class="s2">t</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return </span><span class="s2">s</span><span class="s1">.</span><span class="s2">term</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">warn</span><span class="s1">(</span><span class="s0">`Precedence specified for unknown token </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s0">`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">return null</span><span class="s1">};</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">e</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">)||[]){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">a</span><span class="s1">),</span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">b</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)[</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">]=[</span><span class="s2">i</span><span class="s1">,</span><span class="s2">e</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">explicitConflicts</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">a</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">b</span><span class="s1">:</span><span class="s2">i</span><span class="s1">})}}}</span><span class="s2">buildTokenGroups</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">.</span><span class="s2">compile</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Grammar contains zero-length tokens (in '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">name</span><span class="s1">}</span><span class="s0">')`</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">name</span><span class="s1">)).</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s5">/\btokens\b/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">Ue</span><span class="s1">))</span><span class="s2">console</span><span class="s1">.</span><span class="s2">log</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">toString</span><span class="s1">());</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">findConflicts</span><span class="s1">(</span><span class="s2">Lt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)).</span><span class="s2">filter</span><span class="s1">((({</span><span class="s2">a</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">b</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precededBy</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)&amp;&amp;!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precededBy</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">a</span><span class="s1">:</span><span class="s2">h</span><span class="s1">,</span><span class="s2">b</span><span class="s1">:</span><span class="s2">f</span><span class="s1">}</span><span class="s2">of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">explicitConflicts</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">a</span><span class="s1">==</span><span class="s2">h</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">b</span><span class="s1">==</span><span class="s2">f</span><span class="s1">)))</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">le</span><span class="s1">(</span><span class="s2">h</span><span class="s1">,</span><span class="s2">f</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s0">&quot;&quot;</span><span class="s1">))}</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">soft</span><span class="s1">)),</span><span class="s2">l</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">soft</span><span class="s1">));</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">h of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">||</span><span class="s2">h</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">skipRules</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">)].</span><span class="s2">startTokens</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of n</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">t</span><span class="s1">)))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Use of token </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">conflicts with skip rule`</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+(</span><span class="s2">n</span><span class="s1">?</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">:</span><span class="s3">0</span><span class="s1">);</span><span class="s2">t</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">h</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">[</span><span class="s2">t</span><span class="s1">].</span><span class="s2">term</span><span class="s1">:</span><span class="s2">n</span><span class="s1">[</span><span class="s2">t</span><span class="s1">-</span><span class="s2">h</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">length</span><span class="s1">];</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">tokenOrigins</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">external</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s2">Et</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of r</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of l</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">a</span><span class="s1">==</span><span class="s2">t</span><span class="s1">?</span><span class="s2">s</span><span class="s1">.</span><span class="s2">b</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">b</span><span class="s1">==</span><span class="s2">t</span><span class="s1">?</span><span class="s2">s</span><span class="s1">.</span><span class="s2">a</span><span class="s1">:</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)&amp;&amp;!</span><span class="s2">a</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">conflict</span><span class="s1">==</span><span class="s2">s</span><span class="s1">))){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">exampleA</span><span class="s1">?</span><span class="s0">` (example: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">exampleA</span><span class="s1">)}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">exampleB</span><span class="s1">?</span><span class="s0">` vs </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">exampleB</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">error</span><span class="s1">:</span><span class="s0">`Overlapping tokens </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">and </span><span class="s2">$</span><span class="s1">{</span><span class="s2">n</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">used in same context</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s4">\n</span><span class="s0">`</span><span class="s1">+</span><span class="s0">`After: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">h</span><span class="s1">.</span><span class="s2">set</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">trail</span><span class="s1">()}</span><span class="s0">`</span><span class="s1">,</span><span class="s2">conflict</span><span class="s1">:</span><span class="s2">s</span><span class="s1">})}</span><span class="s2">Et</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s2">Et</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}}</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of o</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))))</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">)</span><span class="s2">Et</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">u</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">break</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">u</span><span class="s1">){</span><span class="s2">u</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Gt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s2">s</span><span class="s1">);</span><span class="s2">o</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">u</span><span class="s1">)}</span><span class="s2">h</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">=</span><span class="s2">u</span><span class="s1">.</span><span class="s2">groupID</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">error</span><span class="s1">)).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;</span><span class="s4">\n\n</span><span class="s0">&quot;</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s2">s</span><span class="s1">&gt;</span><span class="s3">16</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Too many different token groups (</span><span class="s2">$</span><span class="s1">{</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s0">) to represent them as a 16-bit bitfield`</span><span class="s1">);</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buildPrecTable</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">return</span><span class="s1">{</span><span class="s2">tokenGroups</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">tokenPrec</span><span class="s1">:</span><span class="s2">u</span><span class="s1">,</span><span class="s2">tokenData</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">toArray</span><span class="s1">(</span><span class="s2">Jt</span><span class="s1">(</span><span class="s2">o</span><span class="s1">),</span><span class="s2">u</span><span class="s1">)}}}</span><span class="s4">class </span><span class="s2">Ft </span><span class="s4">extends </span><span class="s2">Ut</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">unique</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)}</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Incorrect number of arguments for </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">`</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">props</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">exported</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">nodeInfo</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">vt</span><span class="s1">,</span><span class="s2">vt</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">makeTerminal</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">nodeType</span><span class="s1">||</span><span class="s2">i</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">nodeType</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">preserve</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">[</span><span class="s2">i</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=</span><span class="s2">n</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">used</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)}</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">t</span><span class="s1">=</span><span class="s4">super</span><span class="s1">.</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&amp;&amp;!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">tokenOrigins</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">])</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">tokenOrigins</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]={</span><span class="s2">group</span><span class="s1">:</span><span class="s4">this</span><span class="s1">};</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">buildLocalGroup</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">.</span><span class="s2">compile</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Grammar contains zero-length tokens (in '</span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">name</span><span class="s1">}</span><span class="s0">')`</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rules</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">accepting</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">name</span><span class="s1">)).</span><span class="s2">start</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">a</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">b</span><span class="s1">:</span><span class="s2">u</span><span class="s1">,</span><span class="s2">exampleA</span><span class="s1">:</span><span class="s2">h</span><span class="s1">}</span><span class="s2">of i</span><span class="s1">.</span><span class="s2">findConflicts</span><span class="s1">((()=&gt;</span><span class="s4">true</span><span class="s1">))){</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precededBy</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">u</span><span class="s1">)&amp;&amp;!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">precededBy</span><span class="s1">(</span><span class="s2">u</span><span class="s1">,</span><span class="s2">r</span><span class="s1">))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Overlapping tokens </span><span class="s2">$</span><span class="s1">{</span><span class="s2">r</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">and </span><span class="s2">$</span><span class="s1">{</span><span class="s2">u</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">in local token group</span><span class="s2">$</span><span class="s1">{</span><span class="s2">h</span><span class="s1">?</span><span class="s0">` (example: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">h</span><span class="s1">)}</span><span class="s0">)`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s0">`</span><span class="s1">)}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">defaultReduce</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">skipRules</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">)].</span><span class="s2">startTokens</span><span class="s1">[</span><span class="s3">0</span><span class="s1">];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">{</span><span class="s2">term</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}</span><span class="s2">of r</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">tokenOrigins</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">name</span><span class="s1">];</span><span class="s4">if</span><span class="s1">((</span><span class="s2">s</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">s</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">group</span><span class="s1">)==</span><span class="s4">this</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">else </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`Tokens from a local token group used together with other tokens (</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">} </span><span class="s0">with </span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">.</span><span class="s2">name</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">);</span><span class="s2">r</span><span class="s1">.</span><span class="s2">tokenGroup</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}}</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buildPrecTable</span><span class="s1">(</span><span class="s2">vt</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">toArray</span><span class="s1">({[</span><span class="s2">s</span><span class="s1">]:</span><span class="s3">65535</span><span class="s1">},</span><span class="s2">n</span><span class="s1">);</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Uint16Array</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">);</span><span class="s2">o</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s3">0</span><span class="s1">);</span><span class="s2">o</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">a</span><span class="s1">);</span><span class="s2">o</span><span class="s1">[</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]=</span><span class="s3">65535</span><span class="s1">;</span><span class="s4">return</span><span class="s1">{</span><span class="s2">groupID</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">create</span><span class="s1">:()=&gt;</span><span class="s4">new </span><span class="s2">r</span><span class="s1">.</span><span class="s2">uC</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">.</span><span class="s2">id</span><span class="s1">:</span><span class="s2">undefined</span><span class="s1">),</span><span class="s2">createSource</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s0">`new </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">(</span><span class="s0">&quot;LocalTokenGroup&quot;</span><span class="s1">,</span><span class="s0">&quot;@lezer/lr&quot;</span><span class="s1">)}</span><span class="s0">(</span><span class="s2">$</span><span class="s1">{</span><span class="s2">$t</span><span class="s1">(</span><span class="s2">o</span><span class="s1">)}</span><span class="s0">, </span><span class="s2">$</span><span class="s1">{</span><span class="s2">a</span><span class="s1">}</span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">?</span><span class="s0">`, </span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fallback</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s0">`</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">}}}</span><span class="s4">function </span><span class="s2">Lt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">function </span><span class="s2">n</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">actions</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">i</span><span class="s1">))||</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">skipRules</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">)].</span><span class="s2">startTokens</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">return</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">]=[</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">];</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">|</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">&lt;&lt;</span><span class="s3">16</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">r</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">)</span><span class="s4">return </span><span class="s2">l</span><span class="s1">;</span><span class="s4">return </span><span class="s2">i</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">n</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)&amp;&amp;</span><span class="s2">n</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)))}}</span><span class="s4">function </span><span class="s2">Wt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let</span><span class="s1">[</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">]</span><span class="s2">of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">([</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">]);</span><span class="s2">t</span><span class="s1">=</span><span class="s2">n</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;=</span><span class="s2">Ht</span><span class="s1">)</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">([</span><span class="s2">t</span><span class="s1">,</span><span class="s2">Ht</span><span class="s1">+</span><span class="s3">1</span><span class="s1">]);</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">const </span><span class="s2">Kt</span><span class="s1">=</span><span class="s3">65536</span><span class="s1">,</span><span class="s2">Yt</span><span class="s1">=</span><span class="s3">55296</span><span class="s1">,</span><span class="s2">Zt</span><span class="s1">=</span><span class="s3">57344</span><span class="s1">,</span><span class="s2">Ht</span><span class="s1">=</span><span class="s3">1114111</span><span class="s1">;</span><span class="s4">const </span><span class="s2">Qt</span><span class="s1">=</span><span class="s3">56320</span><span class="s1">,</span><span class="s2">Vt</span><span class="s1">=</span><span class="s3">57343</span><span class="s1">;</span><span class="s4">function </span><span class="s2">Xt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">Kt</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">Yt</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">Yt</span><span class="s1">),</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&gt;</span><span class="s2">Zt</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">Zt</span><span class="s1">),</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">V</span><span class="s1">+</span><span class="s3">1</span><span class="s1">),</span><span class="s2">t</span><span class="s1">);</span><span class="s2">s</span><span class="s1">=</span><span class="s2">Kt</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;=</span><span class="s2">Kt</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCodePoint</span><span class="s1">(</span><span class="s2">s</span><span class="s1">),</span><span class="s2">r</span><span class="s1">=</span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCodePoint</span><span class="s1">(</span><span class="s2">i</span><span class="s1">-</span><span class="s3">1</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s3">0</span><span class="s1">),</span><span class="s2">a</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s3">1</span><span class="s1">);</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s3">0</span><span class="s1">),</span><span class="s2">u</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s3">1</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">==</span><span class="s2">o</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">l</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">u</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">l</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s2">o</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&gt;</span><span class="s2">Qt</span><span class="s1">){</span><span class="s2">s</span><span class="s1">++;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">l</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s2">i</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">Vt</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">u</span><span class="s1">&lt;</span><span class="s2">Vt</span><span class="s1">){</span><span class="s2">i</span><span class="s1">--;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s2">o</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">Qt</span><span class="s1">,</span><span class="s2">u</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&lt;=</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">new </span><span class="s2">re</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">edge</span><span class="s1">(</span><span class="s2">Qt</span><span class="s1">,</span><span class="s2">Vt</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}}}</span><span class="s4">function </span><span class="s2">es</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">R</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">exprs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ts</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">unique</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">);</span><span class="s4">let</span><span class="s1">{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">props</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">dialect</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">nodeInfo</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">props</span><span class="s1">,</span><span class="s0">&quot;d&quot;</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">makeTerminal</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]||(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">byDialect</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">l</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">namedTerms</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=</span><span class="s2">l</span><span class="s1">}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ss</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">args</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">&quot;External tokens cannot take arguments&quot;</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">args</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">start</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">used</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">);</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s4">function </span><span class="s2">is</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">term</span><span class="s1">==</span><span class="s2">t</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">term</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">after</span><span class="s1">:</span><span class="s2">s</span><span class="s1">});</span><span class="s4">else </span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]={</span><span class="s2">term</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">after</span><span class="s1">:</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">after</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">ns</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">=</span><span class="s2">ts</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s </span><span class="s4">in this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">tokenOrigins</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">s</span><span class="s1">].</span><span class="s2">name</span><span class="s1">]={</span><span class="s2">external</span><span class="s1">:</span><span class="s4">this</span><span class="s1">}}</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">ss</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">create</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">options</span><span class="s1">.</span><span class="s2">externalTokenizer</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">id</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">)}</span><span class="s2">createSource</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">source</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">id</span><span class="s1">:{</span><span class="s2">name</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">;</span><span class="s4">return </span><span class="s2">e</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">rs</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">=</span><span class="s2">ts</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">)}</span><span class="s2">finish</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">normalizeExpr</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">token</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s3">1</span><span class="s1">||</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">terms</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s3">1</span><span class="s1">||!</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">terms</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">terminal</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">raise</span><span class="s1">(</span><span class="s0">`The token expression to '@external </span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">type</span><span class="s1">}</span><span class="s0">' must resolve to a token`</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ast</span><span class="s1">.</span><span class="s2">token</span><span class="s1">.</span><span class="s2">start</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">terms</span><span class="s1">[</span><span class="s3">0</span><span class="s1">];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t </span><span class="s4">in this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">.</span><span class="s2">tokenOrigins</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">t</span><span class="s1">].</span><span class="s2">name</span><span class="s1">]={</span><span class="s2">spec</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">term</span><span class="s1">,</span><span class="s2">external</span><span class="s1">:</span><span class="s4">this</span><span class="s1">}}</span><span class="s2">getToken</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">ss</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">b</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">ls</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">),</span><span class="s2">n</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">inline</span><span class="s1">&amp;&amp;!</span><span class="s2">i</span><span class="s1">[</span><span class="s2">l</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]){</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">l</span><span class="s1">.</span><span class="s2">name</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">name</span><span class="s1">))))</span><span class="s4">continue</span><span class="s1">;</span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">l</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">}}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">o</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">o</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">o</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">u</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">interesting</span><span class="s1">&amp;&amp;!</span><span class="s2">u</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">u</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)&amp;&amp;</span><span class="s2">u</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s3">3</span><span class="s1">&amp;&amp;!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">u</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)&amp;&amp;(</span><span class="s2">u</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">==</span><span class="s2">u</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">||!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">u</span><span class="s1">.</span><span class="s2">name</span><span class="s1">))))&amp;&amp;!</span><span class="s2">u</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;!!</span><span class="s2">i</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]))&amp;&amp;!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">some</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">!=</span><span class="s2">o</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s2">u</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)))</span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">u</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=[</span><span class="s2">u</span><span class="s1">]}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">h of e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">[</span><span class="s2">h</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">name</span><span class="s1">])</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">h</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;!!</span><span class="s2">i</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]))){</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">h</span><span class="s1">);</span><span class="s4">continue</span><span class="s1">}</span><span class="s4">function </span><span class="s2">f</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s2">h</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Q</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">h</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">));</span><span class="s4">return</span><span class="s1">}</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">[</span><span class="s2">e</span><span class="s1">],</span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">name</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">){</span><span class="s2">f</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">[</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">]),</span><span class="s2">s</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">n</span><span class="s1">));</span><span class="s4">return</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of l</span><span class="s1">)</span><span class="s2">f</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">).</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">].</span><span class="s2">join</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">[</span><span class="s3">0</span><span class="s1">])).</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">1</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">)).</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">[</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">].</span><span class="s2">join</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">])),</span><span class="s2">s</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">))}</span><span class="s2">f</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,[</span><span class="s2">h</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]],[])}</span><span class="s2">e</span><span class="s1">=</span><span class="s2">r</span><span class="s1">}}</span><span class="s4">function </span><span class="s1">as(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">),</span><span class="s2">s</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">++].</span><span class="s2">name</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">].</span><span class="s2">name</span><span class="s1">==</span><span class="s2">r</span><span class="s1">)</span><span class="s2">n</span><span class="s1">++;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">n</span><span class="s1">-</span><span class="s2">i</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">interesting</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s2">a</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">a</span><span class="s1">++].</span><span class="s2">name</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">[</span><span class="s2">a</span><span class="s1">].</span><span class="s2">name</span><span class="s1">==</span><span class="s2">o</span><span class="s1">)</span><span class="s2">a</span><span class="s1">++;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">-</span><span class="s2">n</span><span class="s1">!=</span><span class="s2">l</span><span class="s1">||</span><span class="s2">o</span><span class="s1">.</span><span class="s2">interesting</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">l</span><span class="s1">&amp;&amp;</span><span class="s2">u</span><span class="s1">;</span><span class="s2">t</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">+</span><span class="s2">t</span><span class="s1">],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">+</span><span class="s2">t</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">cmpNoName</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)!=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">u</span><span class="s1">=</span><span class="s4">false</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">u</span><span class="s1">)</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">r</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]=</span><span class="s2">o</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of e</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">name</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]){</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;!</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]))?</span><span class="s2">n</span><span class="s1">:</span><span class="s4">new </span><span class="s2">Q</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">name</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">parts</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">]||</span><span class="s2">e</span><span class="s1">)),</span><span class="s2">n</span><span class="s1">.</span><span class="s2">conflicts</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s4">function </span><span class="s2">os</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s1">as(</span><span class="s2">ls</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))}</span><span class="s4">function </span><span class="s2">us</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">={}){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Rt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">),</span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">getParser</span><span class="s1">();</span><span class="s2">i</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">termTable</span><span class="s1">;</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s4">const </span><span class="s2">hs</span><span class="s1">=[</span><span class="s0">&quot;await&quot;</span><span class="s1">,</span><span class="s0">&quot;break&quot;</span><span class="s1">,</span><span class="s0">&quot;case&quot;</span><span class="s1">,</span><span class="s0">&quot;catch&quot;</span><span class="s1">,</span><span class="s0">&quot;continue&quot;</span><span class="s1">,</span><span class="s0">&quot;debugger&quot;</span><span class="s1">,</span><span class="s0">&quot;default&quot;</span><span class="s1">,</span><span class="s0">&quot;do&quot;</span><span class="s1">,</span><span class="s0">&quot;else&quot;</span><span class="s1">,</span><span class="s0">&quot;finally&quot;</span><span class="s1">,</span><span class="s0">&quot;for&quot;</span><span class="s1">,</span><span class="s0">&quot;function&quot;</span><span class="s1">,</span><span class="s0">&quot;if&quot;</span><span class="s1">,</span><span class="s0">&quot;return&quot;</span><span class="s1">,</span><span class="s0">&quot;switch&quot;</span><span class="s1">,</span><span class="s0">&quot;throw&quot;</span><span class="s1">,</span><span class="s0">&quot;try&quot;</span><span class="s1">,</span><span class="s0">&quot;var&quot;</span><span class="s1">,</span><span class="s0">&quot;while&quot;</span><span class="s1">,</span><span class="s0">&quot;with&quot;</span><span class="s1">,</span><span class="s0">&quot;null&quot;</span><span class="s1">,</span><span class="s0">&quot;true&quot;</span><span class="s1">,</span><span class="s0">&quot;false&quot;</span><span class="s1">,</span><span class="s0">&quot;instanceof&quot;</span><span class="s1">,</span><span class="s0">&quot;typeof&quot;</span><span class="s1">,</span><span class="s0">&quot;void&quot;</span><span class="s1">,</span><span class="s0">&quot;delete&quot;</span><span class="s1">,</span><span class="s0">&quot;new&quot;</span><span class="s1">,</span><span class="s0">&quot;in&quot;</span><span class="s1">,</span><span class="s0">&quot;this&quot;</span><span class="s1">,</span><span class="s0">&quot;const&quot;</span><span class="s1">,</span><span class="s0">&quot;class&quot;</span><span class="s1">,</span><span class="s0">&quot;extends&quot;</span><span class="s1">,</span><span class="s0">&quot;export&quot;</span><span class="s1">,</span><span class="s0">&quot;import&quot;</span><span class="s1">,</span><span class="s0">&quot;super&quot;</span><span class="s1">,</span><span class="s0">&quot;enum&quot;</span><span class="s1">,</span><span class="s0">&quot;implements&quot;</span><span class="s1">,</span><span class="s0">&quot;interface&quot;</span><span class="s1">,</span><span class="s0">&quot;let&quot;</span><span class="s1">,</span><span class="s0">&quot;package&quot;</span><span class="s1">,</span><span class="s0">&quot;private&quot;</span><span class="s1">,</span><span class="s0">&quot;protected&quot;</span><span class="s1">,</span><span class="s0">&quot;public&quot;</span><span class="s1">,</span><span class="s0">&quot;static&quot;</span><span class="s1">,</span><span class="s0">&quot;yield&quot;</span><span class="s1">,</span><span class="s0">&quot;require&quot;</span><span class="s1">];</span><span class="s4">function </span><span class="s2">fs</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">={}){</span><span class="s4">return new </span><span class="s2">Rt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">).</span><span class="s2">getParserFile</span><span class="s1">()}</span><span class="s4">function </span><span class="s2">cs</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">];</span><span class="s4">return </span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;_&quot;</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">toUpperCase</span><span class="s1">()!=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ps</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">props</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">at</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">name</span><span class="s1">==</span><span class="s0">&quot;export&quot;</span><span class="s1">))}}}]);</span></pre>
</body>
</html>