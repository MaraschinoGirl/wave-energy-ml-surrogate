<html>
<head>
<title>6003.0e631d8bc60aebfa5484.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #cf8e6d;}
.s5 { color: #42c3d4;}
.ln { color: #4b5059; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
6003.0e631d8bc60aebfa5484.js</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">&quot;use strict&quot;</span><span class="s1">;(</span><span class="s2">self</span><span class="s1">[</span><span class="s0">&quot;webpackChunk_jupyterlab_application_top&quot;</span><span class="s1">]=</span><span class="s2">self</span><span class="s1">[</span><span class="s0">&quot;webpackChunk_jupyterlab_application_top&quot;</span><span class="s1">]||[]).</span><span class="s2">push</span><span class="s1">([[</span><span class="s3">6003</span><span class="s1">],{</span><span class="s3">56003</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)=&gt;{</span><span class="s2">n</span><span class="s1">.</span><span class="s2">r</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">Annotation</span><span class="s1">:()=&gt;</span><span class="s2">xt</span><span class="s1">,</span><span class="s2">AnnotationType</span><span class="s1">:()=&gt;</span><span class="s2">vt</span><span class="s1">,</span><span class="s2">ChangeDesc</span><span class="s1">:()=&gt;</span><span class="s2">N</span><span class="s1">,</span><span class="s2">ChangeSet</span><span class="s1">:()=&gt;</span><span class="s2">D</span><span class="s1">,</span><span class="s2">CharCategory</span><span class="s1">:()=&gt;</span><span class="s2">Ot</span><span class="s1">,</span><span class="s2">Compartment</span><span class="s1">:()=&gt;</span><span class="s2">rt</span><span class="s1">,</span><span class="s2">EditorSelection</span><span class="s1">:()=&gt;</span><span class="s2">V</span><span class="s1">,</span><span class="s2">EditorState</span><span class="s1">:()=&gt;</span><span class="s2">Dt</span><span class="s1">,</span><span class="s2">Facet</span><span class="s1">:()=&gt;</span><span class="s2">G</span><span class="s1">,</span><span class="s2">Line</span><span class="s1">:()=&gt;</span><span class="s2">P</span><span class="s1">,</span><span class="s2">MapMode</span><span class="s1">:()=&gt;</span><span class="s2">B</span><span class="s1">,</span><span class="s2">Prec</span><span class="s1">:()=&gt;</span><span class="s2">it</span><span class="s1">,</span><span class="s2">Range</span><span class="s1">:()=&gt;</span><span class="s2">jt</span><span class="s1">,</span><span class="s2">RangeSet</span><span class="s1">:()=&gt;</span><span class="s2">_t</span><span class="s1">,</span><span class="s2">RangeSetBuilder</span><span class="s1">:()=&gt;</span><span class="s2">Vt</span><span class="s1">,</span><span class="s2">RangeValue</span><span class="s1">:()=&gt;</span><span class="s2">Lt</span><span class="s1">,</span><span class="s2">SelectionRange</span><span class="s1">:()=&gt;</span><span class="s2">z</span><span class="s1">,</span><span class="s2">StateEffect</span><span class="s1">:()=&gt;</span><span class="s2">yt</span><span class="s1">,</span><span class="s2">StateEffectType</span><span class="s1">:()=&gt;</span><span class="s2">kt</span><span class="s1">,</span><span class="s2">StateField</span><span class="s1">:()=&gt;</span><span class="s2">tt</span><span class="s1">,</span><span class="s2">Text</span><span class="s1">:()=&gt;</span><span class="s2">m</span><span class="s1">,</span><span class="s2">Transaction</span><span class="s1">:()=&gt;</span><span class="s2">St</span><span class="s1">,</span><span class="s2">codePointAt</span><span class="s1">:()=&gt;</span><span class="s2">R</span><span class="s1">,</span><span class="s2">codePointSize</span><span class="s1">:()=&gt;</span><span class="s2">T</span><span class="s1">,</span><span class="s2">combineConfig</span><span class="s1">:()=&gt;</span><span class="s2">Jt</span><span class="s1">,</span><span class="s2">countColumn</span><span class="s1">:()=&gt;</span><span class="s2">ee</span><span class="s1">,</span><span class="s2">findClusterBreak</span><span class="s1">:()=&gt;</span><span class="s2">M</span><span class="s1">,</span><span class="s2">findColumn</span><span class="s1">:()=&gt;</span><span class="s2">ne</span><span class="s1">,</span><span class="s2">fromCodePoint</span><span class="s1">:()=&gt;</span><span class="s2">O</span><span class="s1">});</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[],</span><span class="s2">s</span><span class="s1">=[];(()=&gt;{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s0">&quot;lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o&quot;</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s0">&quot;,&quot;</span><span class="s1">).</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">?</span><span class="s2">parseInt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s3">36</span><span class="s1">):</span><span class="s3">1</span><span class="s1">));</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++)(</span><span class="s2">e</span><span class="s1">%</span><span class="s3">2</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s2">i</span><span class="s1">).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">=</span><span class="s2">n</span><span class="s1">+</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">])})();</span><span class="s4">function </span><span class="s2">r</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">768</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;;){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">+</span><span class="s2">n</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">[</span><span class="s2">r</span><span class="s1">])</span><span class="s2">n</span><span class="s1">=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">r</span><span class="s1">])</span><span class="s2">e</span><span class="s1">=</span><span class="s2">r</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">else return true</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s2">n</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">l</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s3">127462</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">&lt;=</span><span class="s3">127487</span><span class="s1">}</span><span class="s4">function </span><span class="s2">h</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]&gt;</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return </span><span class="s2">i</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]&lt;=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=</span><span class="s3">8205</span><span class="s1">;</span><span class="s4">function </span><span class="s2">a</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s4">true</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s4">true</span><span class="s1">){</span><span class="s4">return</span><span class="s1">(</span><span class="s2">n</span><span class="s1">?</span><span class="s2">f</span><span class="s1">:</span><span class="s2">c</span><span class="s1">)(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">f</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))&amp;&amp;</span><span class="s2">g</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">-</span><span class="s3">1</span><span class="s1">)))</span><span class="s2">e</span><span class="s1">--;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">u</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s2">e</span><span class="s1">+=</span><span class="s2">p</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">while</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">u</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s2">o</span><span class="s1">||</span><span class="s2">s</span><span class="s1">==</span><span class="s2">o</span><span class="s1">||</span><span class="s2">n</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)){</span><span class="s2">e</span><span class="s1">+=</span><span class="s2">p</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">-</span><span class="s3">2</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">(</span><span class="s2">u</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">))){</span><span class="s2">n</span><span class="s1">++;</span><span class="s2">i</span><span class="s1">-=</span><span class="s3">2</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">%</span><span class="s3">2</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s4">else </span><span class="s2">e</span><span class="s1">+=</span><span class="s3">2</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">break</span><span class="s1">}}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s4">function </span><span class="s2">c</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">while</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">f</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s3">2</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">)</span><span class="s4">return </span><span class="s2">i</span><span class="s1">;</span><span class="s2">e</span><span class="s1">--}</span><span class="s4">return </span><span class="s3">0</span><span class="s1">}</span><span class="s4">function </span><span class="s2">u</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">g</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)||</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return </span><span class="s2">n</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">d</span><span class="s1">(</span><span class="s2">i</span><span class="s1">))</span><span class="s4">return </span><span class="s2">n</span><span class="s1">;</span><span class="s4">return</span><span class="s1">(</span><span class="s2">n</span><span class="s1">-</span><span class="s3">55296</span><span class="s1">&lt;&lt;</span><span class="s3">10</span><span class="s1">)+(</span><span class="s2">i</span><span class="s1">-</span><span class="s3">56320</span><span class="s1">)+</span><span class="s3">65536</span><span class="s1">}</span><span class="s4">function </span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s3">56320</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">57344</span><span class="s1">}</span><span class="s4">function </span><span class="s2">g</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s3">55296</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">56320</span><span class="s1">}</span><span class="s4">function </span><span class="s2">p</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">65536</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">2</span><span class="s1">}</span><span class="s4">class </span><span class="s2">m</span><span class="s1">{</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">t</span><span class="s1">&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">`Invalid position </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">} </span><span class="s0">in document of length </span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s0">`</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">lineInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">false</span><span class="s1">,</span><span class="s3">1</span><span class="s1">,</span><span class="s3">0</span><span class="s1">)}</span><span class="s2">line</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">1</span><span class="s1">||</span><span class="s2">t</span><span class="s1">&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">`Invalid line number </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">} </span><span class="s0">in </span><span class="s2">$</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">}</span><span class="s0">-line document`</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">lineInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">true</span><span class="s1">,</span><span class="s3">1</span><span class="s1">,</span><span class="s3">0</span><span class="s1">)}</span><span class="s2">replace</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">E</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">decompose</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s3">2</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">decompose</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s3">1</span><span class="s1">|</span><span class="s3">2</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">decompose</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s3">1</span><span class="s1">);</span><span class="s4">return </span><span class="s2">x</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-(</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">)+</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)}</span><span class="s2">append</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">E</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">decompose</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s3">0</span><span class="s1">);</span><span class="s4">return </span><span class="s2">x</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">)</span><span class="s4">return true</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">!=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">scanIdentical</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s3">1</span><span class="s1">),</span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">scanIdentical</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">new </span><span class="s2">S</span><span class="s1">(</span><span class="s4">this</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">S</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;;){</span><span class="s2">i</span><span class="s1">.</span><span class="s2">next</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">next</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">lineBreak</span><span class="s1">!=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">lineBreak</span><span class="s1">||</span><span class="s2">i</span><span class="s1">.</span><span class="s2">done</span><span class="s1">!=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">done</span><span class="s1">||</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">!=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s2">l</span><span class="s1">+=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">done</span><span class="s1">||</span><span class="s2">l</span><span class="s1">&gt;=</span><span class="s2">n</span><span class="s1">)</span><span class="s4">return true</span><span class="s1">}}</span><span class="s2">iter</span><span class="s1">(</span><span class="s2">t</span><span class="s1">=</span><span class="s3">1</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">S</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">iterRange</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">b</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">iterLines</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">null</span><span class="s1">){</span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">()}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s4">null</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">line</span><span class="s1">(</span><span class="s2">t</span><span class="s1">).</span><span class="s2">from</span><span class="s1">;</span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iterRange</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">e</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">+</span><span class="s3">1</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">:</span><span class="s2">e</span><span class="s1">&lt;=</span><span class="s3">1</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">line</span><span class="s1">(</span><span class="s2">e</span><span class="s1">-</span><span class="s3">1</span><span class="s1">).</span><span class="s2">to</span><span class="s1">))}</span><span class="s4">return new </span><span class="s2">I</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">sliceString</span><span class="s1">(</span><span class="s3">0</span><span class="s1">)}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flatten</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">constructor</span><span class="s1">(){}</span><span class="s4">static </span><span class="s2">of</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;A document must have at least one line&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">&amp;&amp;!</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">])</span><span class="s4">return </span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">;</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;=</span><span class="s3">32</span><span class="s1">?</span><span class="s4">new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">t</span><span class="s1">):</span><span class="s2">x</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">w</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,[]))}}</span><span class="s4">class </span><span class="s2">w </span><span class="s4">extends </span><span class="s2">m</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s2">v</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">super</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}</span><span class="s2">get lines</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s2">get children</span><span class="s1">(){</span><span class="s4">return null</span><span class="s1">}</span><span class="s2">lineInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">((</span><span class="s2">e</span><span class="s1">?</span><span class="s2">n</span><span class="s1">:</span><span class="s2">l</span><span class="s1">)&gt;=</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return new </span><span class="s2">P</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s2">i</span><span class="s1">=</span><span class="s2">l</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++}}</span><span class="s2">decompose</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">&lt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">y</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">),</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)-</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&amp;</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">k</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">text</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(),</span><span class="s3">0</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;=</span><span class="s3">32</span><span class="s1">){</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">))}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)),</span><span class="s4">new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))}}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}}</span><span class="s2">replace</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!(</span><span class="s2">n </span><span class="s4">instanceof </span><span class="s2">w</span><span class="s1">))</span><span class="s4">return super</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">E</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">k</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">,</span><span class="s2">k</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">text</span><span class="s1">,</span><span class="s2">y</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)),</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-(</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;=</span><span class="s3">32</span><span class="s1">)</span><span class="s4">return new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">return </span><span class="s2">x</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">w</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,[]),</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">sliceString</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">){[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">E</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;=</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">h</span><span class="s1">=</span><span class="s2">s</span><span class="s1">+</span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">)</span><span class="s2">i</span><span class="s1">+=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">h</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">s</span><span class="s1">)</span><span class="s2">i</span><span class="s1">+=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">-</span><span class="s2">s</span><span class="s1">),</span><span class="s2">e</span><span class="s1">-</span><span class="s2">s</span><span class="s1">);</span><span class="s2">s</span><span class="s1">=</span><span class="s2">h</span><span class="s1">+</span><span class="s3">1</span><span class="s1">}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s2">flatten</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">scanIdentical</span><span class="s1">(){</span><span class="s4">return </span><span class="s3">0</span><span class="s1">}</span><span class="s4">static </span><span class="s2">split</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of t</span><span class="s1">){</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s2">i</span><span class="s1">+=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">32</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">));</span><span class="s2">n</span><span class="s1">=[];</span><span class="s2">i</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">));</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">x </span><span class="s4">extends </span><span class="s2">m</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">super</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of t</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">+=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">}</span><span class="s2">lineInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">h</span><span class="s1">=</span><span class="s2">n</span><span class="s1">+</span><span class="s2">r</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">((</span><span class="s2">e</span><span class="s1">?</span><span class="s2">h</span><span class="s1">:</span><span class="s2">l</span><span class="s1">)&gt;=</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">lineInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s2">i</span><span class="s1">=</span><span class="s2">l</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">=</span><span class="s2">h</span><span class="s1">+</span><span class="s3">1</span><span class="s1">}}</span><span class="s2">decompose</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;=</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">h</span><span class="s1">=</span><span class="s2">r</span><span class="s1">+</span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;=</span><span class="s2">h</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s2">r</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">&amp;((</span><span class="s2">r</span><span class="s1">&lt;=</span><span class="s2">t</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">)|(</span><span class="s2">h</span><span class="s1">&gt;=</span><span class="s2">e</span><span class="s1">?</span><span class="s3">2</span><span class="s1">:</span><span class="s3">0</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&gt;=</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">&lt;=</span><span class="s2">e</span><span class="s1">&amp;&amp;!</span><span class="s2">s</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">l</span><span class="s1">);</span><span class="s4">else </span><span class="s2">l</span><span class="s1">.</span><span class="s2">decompose</span><span class="s1">(</span><span class="s2">t</span><span class="s1">-</span><span class="s2">r</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">r</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">r</span><span class="s1">=</span><span class="s2">h</span><span class="s1">+</span><span class="s3">1</span><span class="s1">}}</span><span class="s2">replace</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">E</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">l</span><span class="s1">=</span><span class="s2">s</span><span class="s1">+</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">&lt;=</span><span class="s2">l</span><span class="s1">){</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s2">t</span><span class="s1">-</span><span class="s2">s</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">-</span><span class="s2">r</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">+</span><span class="s2">h</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">&lt;</span><span class="s2">o</span><span class="s1">&gt;&gt;</span><span class="s3">5</span><span class="s1">-</span><span class="s3">1</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">&gt;</span><span class="s2">o</span><span class="s1">&gt;&gt;</span><span class="s3">5</span><span class="s1">+</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s2">s</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]=</span><span class="s2">h</span><span class="s1">;</span><span class="s4">return new </span><span class="s2">x</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-(</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">)+</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)}</span><span class="s4">return super</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">h</span><span class="s1">)}</span><span class="s2">s</span><span class="s1">=</span><span class="s2">l</span><span class="s1">+</span><span class="s3">1</span><span class="s1">}</span><span class="s4">return super</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">sliceString</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">){[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">E</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">&lt;=</span><span class="s2">e</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">h</span><span class="s1">=</span><span class="s2">r</span><span class="s1">+</span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">)</span><span class="s2">i</span><span class="s1">+=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">h</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">r</span><span class="s1">)</span><span class="s2">i</span><span class="s1">+=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">sliceString</span><span class="s1">(</span><span class="s2">t</span><span class="s1">-</span><span class="s2">r</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">r</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s2">r</span><span class="s1">=</span><span class="s2">h</span><span class="s1">+</span><span class="s3">1</span><span class="s1">}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s2">flatten</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">flatten</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">scanIdentical</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">x</span><span class="s1">))</span><span class="s4">return </span><span class="s3">0</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">let</span><span class="s1">[</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">]=</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">?[</span><span class="s3">0</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">]:[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">];</span><span class="s4">for</span><span class="s1">(;;</span><span class="s2">i</span><span class="s1">+=</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">+=</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s2">r</span><span class="s1">||</span><span class="s2">s</span><span class="s1">==</span><span class="s2">l</span><span class="s1">)</span><span class="s4">return </span><span class="s2">n</span><span class="s1">;</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">children</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">children</span><span class="s1">[</span><span class="s2">s</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">!=</span><span class="s2">o</span><span class="s1">)</span><span class="s4">return </span><span class="s2">n</span><span class="s1">+</span><span class="s2">h</span><span class="s1">.</span><span class="s2">scanIdentical</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s2">n</span><span class="s1">+=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">}}</span><span class="s4">static </span><span class="s2">from</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">reduce</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">),-</span><span class="s3">1</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">u of t</span><span class="s1">)</span><span class="s2">n</span><span class="s1">+=</span><span class="s2">u</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s3">32</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">flatten</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">32</span><span class="s1">,</span><span class="s2">n</span><span class="s1">&gt;&gt;</span><span class="s3">5</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=[],</span><span class="s2">h</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">o</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">a</span><span class="s1">=[];</span><span class="s4">function </span><span class="s2">f</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">&gt;</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">x</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">.</span><span class="s2">children</span><span class="s1">)</span><span class="s2">f</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">&gt;</span><span class="s2">r</span><span class="s1">&amp;&amp;(</span><span class="s2">h</span><span class="s1">&gt;</span><span class="s2">r</span><span class="s1">||!</span><span class="s2">h</span><span class="s1">)){</span><span class="s2">c</span><span class="s1">();</span><span class="s2">l</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">w</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">&amp;&amp;(</span><span class="s2">e</span><span class="s1">=</span><span class="s2">a</span><span class="s1">[</span><span class="s2">a</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">])</span><span class="s4">instanceof </span><span class="s2">w</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">&lt;=</span><span class="s3">32</span><span class="s1">){</span><span class="s2">h</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">;</span><span class="s2">o</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">a</span><span class="s1">[</span><span class="s2">a</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]=</span><span class="s4">new </span><span class="s2">w</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">text</span><span class="s1">),</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">+</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">+</span><span class="s2">t</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">&gt;</span><span class="s2">i</span><span class="s1">)</span><span class="s2">c</span><span class="s1">();</span><span class="s2">h</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">;</span><span class="s2">o</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">c</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">?</span><span class="s2">a</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]:</span><span class="s2">x</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">));</span><span class="s2">o</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">h</span><span class="s1">=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">length</span><span class="s1">=</span><span class="s3">0</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">u of t</span><span class="s1">)</span><span class="s2">f</span><span class="s1">(</span><span class="s2">u</span><span class="s1">);</span><span class="s2">c</span><span class="s1">();</span><span class="s4">return </span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">?</span><span class="s2">l</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]:</span><span class="s4">new </span><span class="s2">x</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}}</span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">=</span><span class="s4">new </span><span class="s2">w</span><span class="s1">([</span><span class="s0">&quot;&quot;</span><span class="s1">],</span><span class="s3">0</span><span class="s1">);</span><span class="s4">function </span><span class="s2">v</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of t</span><span class="s1">)</span><span class="s2">e</span><span class="s1">+=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s4">function </span><span class="s2">k</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s3">1e9</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">&lt;=</span><span class="s2">i</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">o</span><span class="s1">=</span><span class="s2">s</span><span class="s1">+</span><span class="s2">h</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&gt;=</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&gt;</span><span class="s2">i</span><span class="s1">)</span><span class="s2">h</span><span class="s1">=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">-</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">n</span><span class="s1">)</span><span class="s2">h</span><span class="s1">=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">n</span><span class="s1">-</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">){</span><span class="s2">e</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]+=</span><span class="s2">h</span><span class="s1">;</span><span class="s2">l</span><span class="s1">=</span><span class="s4">false</span><span class="s1">}</span><span class="s4">else </span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">h</span><span class="s1">)}</span><span class="s2">s</span><span class="s1">=</span><span class="s2">o</span><span class="s1">+</span><span class="s3">1</span><span class="s1">}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s4">function </span><span class="s2">y</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">return </span><span class="s2">k</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,[</span><span class="s0">&quot;&quot;</span><span class="s1">],</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">class </span><span class="s2">S</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s3">1</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dir</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lineBreak</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodes</span><span class="s1">=[</span><span class="s2">t</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">offsets</span><span class="s1">=[</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">w</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">length</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)&lt;&lt;</span><span class="s3">1</span><span class="s1">]}</span><span class="s2">nextInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lineBreak</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodes</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodes</span><span class="s1">[</span><span class="s2">n</span><span class="s1">],</span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">offsets</span><span class="s1">[</span><span class="s2">n</span><span class="s1">],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">s</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">i </span><span class="s4">instanceof </span><span class="s2">w</span><span class="s1">?</span><span class="s2">i</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">length</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">==(</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">?</span><span class="s2">l</span><span class="s1">:</span><span class="s3">0</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">offsets</span><span class="s1">[</span><span class="s2">n</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]++;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodes</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">offsets</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">()}</span><span class="s4">else if</span><span class="s1">((</span><span class="s2">s</span><span class="s1">&amp;</span><span class="s3">1</span><span class="s1">)==(</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s3">1</span><span class="s1">)){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">offsets</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]+=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lineBreak</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">t</span><span class="s1">--}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">i </span><span class="s4">instanceof </span><span class="s2">w</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">text</span><span class="s1">[</span><span class="s2">r</span><span class="s1">+(</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">)];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">offsets</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]+=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">t</span><span class="s1">==</span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">t</span><span class="s1">):</span><span class="s2">s</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">t</span><span class="s1">-=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">children</span><span class="s1">[</span><span class="s2">r</span><span class="s1">+(</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">)];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s2">t</span><span class="s1">-=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">offsets</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]+=</span><span class="s2">e</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">offsets</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]--;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nodes</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">offsets</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:(</span><span class="s2">s </span><span class="s4">instanceof </span><span class="s2">w</span><span class="s1">?</span><span class="s2">s</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">length</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">children</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)&lt;&lt;</span><span class="s3">1</span><span class="s1">)}}}}</span><span class="s2">next</span><span class="s1">(</span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextInner</span><span class="s1">(-</span><span class="s2">t</span><span class="s1">,-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dir</span><span class="s1">);</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">nextInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dir</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">b</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">=</span><span class="s4">new </span><span class="s2">S</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">n</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">1</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">=</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">n</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">:</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">nextInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">&lt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">&gt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">t</span><span class="s1">+=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;</span><span class="s2">n</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s2">n</span><span class="s1">-=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">let</span><span class="s1">{</span><span class="s2">value</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">next</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">+=(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s2">t</span><span class="s1">)*</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;=</span><span class="s2">n</span><span class="s1">?</span><span class="s2">i</span><span class="s1">:</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s2">i</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">n</span><span class="s1">):</span><span class="s2">i</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">next</span><span class="s1">(</span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">);</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pos</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">nextInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">dir</span><span class="s1">)}</span><span class="s2">get lineBreak</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">lineBreak</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">!=</span><span class="s0">&quot;&quot;</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">I</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">inner</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">afterBreak</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">false</span><span class="s1">}</span><span class="s2">next</span><span class="s1">(</span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">done</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">lineBreak</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">value</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">inner</span><span class="s1">.</span><span class="s2">next</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">afterBreak</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">afterBreak</span><span class="s1">=</span><span class="s4">false</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">afterBreak</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">afterBreak</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">afterBreak</span><span class="s1">=</span><span class="s4">false</span><span class="s1">}</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">get lineBreak</span><span class="s1">(){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">Symbol</span><span class="s1">!=</span><span class="s0">&quot;undefined&quot;</span><span class="s1">){</span><span class="s2">m</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">[</span><span class="s2">Symbol</span><span class="s1">.</span><span class="s2">iterator</span><span class="s1">]=</span><span class="s4">function</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">()};</span><span class="s2">S</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">[</span><span class="s2">Symbol</span><span class="s1">.</span><span class="s2">iterator</span><span class="s1">]=</span><span class="s2">b</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">[</span><span class="s2">Symbol</span><span class="s1">.</span><span class="s2">iterator</span><span class="s1">]=</span><span class="s2">I</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">[</span><span class="s2">Symbol</span><span class="s1">.</span><span class="s2">iterator</span><span class="s1">]=</span><span class="s4">function</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">P</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">number</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}</span><span class="s2">get length</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">E</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s2">e</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">e</span><span class="s1">));</span><span class="s4">return</span><span class="s1">[</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">n</span><span class="s1">))]}</span><span class="s4">function </span><span class="s2">M</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s4">true</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s4">true</span><span class="s1">){</span><span class="s4">return </span><span class="s2">a</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">A</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s3">56320</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">57344</span><span class="s1">}</span><span class="s4">function </span><span class="s2">C</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s3">55296</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">56320</span><span class="s1">}</span><span class="s4">function </span><span class="s2">R</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">C</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)||</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return </span><span class="s2">n</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">A</span><span class="s1">(</span><span class="s2">i</span><span class="s1">))</span><span class="s4">return </span><span class="s2">n</span><span class="s1">;</span><span class="s4">return</span><span class="s1">(</span><span class="s2">n</span><span class="s1">-</span><span class="s3">55296</span><span class="s1">&lt;&lt;</span><span class="s3">10</span><span class="s1">)+(</span><span class="s2">i</span><span class="s1">-</span><span class="s3">56320</span><span class="s1">)+</span><span class="s3">65536</span><span class="s1">}</span><span class="s4">function </span><span class="s2">O</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;=</span><span class="s3">65535</span><span class="s1">)</span><span class="s4">return </span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCharCode</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">t</span><span class="s1">-=</span><span class="s3">65536</span><span class="s1">;</span><span class="s4">return </span><span class="s2">String</span><span class="s1">.</span><span class="s2">fromCharCode</span><span class="s1">((</span><span class="s2">t</span><span class="s1">&gt;&gt;</span><span class="s3">10</span><span class="s1">)+</span><span class="s3">55296</span><span class="s1">,(</span><span class="s2">t</span><span class="s1">&amp;</span><span class="s3">1023</span><span class="s1">)+</span><span class="s3">56320</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">T</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">65536</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">2</span><span class="s1">}</span><span class="s4">const </span><span class="s2">F</span><span class="s1">=</span><span class="s5">/\r\n?|\n/</span><span class="s1">;</span><span class="s4">var </span><span class="s2">B</span><span class="s1">=</span><span class="s4">function</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">[</span><span class="s0">&quot;Simple&quot;</span><span class="s1">]=</span><span class="s3">0</span><span class="s1">]=</span><span class="s0">&quot;Simple&quot;</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">[</span><span class="s0">&quot;TrackDel&quot;</span><span class="s1">]=</span><span class="s3">1</span><span class="s1">]=</span><span class="s0">&quot;TrackDel&quot;</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">[</span><span class="s0">&quot;TrackBefore&quot;</span><span class="s1">]=</span><span class="s3">2</span><span class="s1">]=</span><span class="s0">&quot;TrackBefore&quot;</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">[</span><span class="s0">&quot;TrackAfter&quot;</span><span class="s1">]=</span><span class="s3">3</span><span class="s1">]=</span><span class="s0">&quot;TrackAfter&quot;</span><span class="s1">;</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}(</span><span class="s2">B</span><span class="s1">||(</span><span class="s2">B</span><span class="s1">={}));</span><span class="s4">class </span><span class="s2">N</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s2">get length</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">+=</span><span class="s3">2</span><span class="s1">)</span><span class="s2">t</span><span class="s1">+=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">get newLength</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">+=</span><span class="s3">2</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">];</span><span class="s2">t</span><span class="s1">+=</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]:</span><span class="s2">n</span><span class="s1">}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">get empty</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">2</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s3">1</span><span class="s1">]&lt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">iterGaps</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">++],</span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">++];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">t</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">i</span><span class="s1">+=</span><span class="s2">s</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">i</span><span class="s1">+=</span><span class="s2">r</span><span class="s1">}</span><span class="s2">n</span><span class="s1">+=</span><span class="s2">s</span><span class="s1">}}</span><span class="s2">iterChangedRanges</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s2">j</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">get invertedDesc</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">++],</span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">++];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s4">else </span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">return new </span><span class="s2">N</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">composeDesc</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">?</span><span class="s2">t</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s2">$</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">mapDesc</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s2">q</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">B</span><span class="s1">.</span><span class="s2">Simple</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">r</span><span class="s1">++],</span><span class="s2">h</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">r</span><span class="s1">++],</span><span class="s2">o</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s2">l</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return </span><span class="s2">s</span><span class="s1">+(</span><span class="s2">t</span><span class="s1">-</span><span class="s2">i</span><span class="s1">);</span><span class="s2">s</span><span class="s1">+=</span><span class="s2">l</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">!=</span><span class="s2">B</span><span class="s1">.</span><span class="s2">Simple</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">&gt;=</span><span class="s2">t</span><span class="s1">&amp;&amp;(</span><span class="s2">n</span><span class="s1">==</span><span class="s2">B</span><span class="s1">.</span><span class="s2">TrackDel</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">||</span><span class="s2">n</span><span class="s1">==</span><span class="s2">B</span><span class="s1">.</span><span class="s2">TrackBefore</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">||</span><span class="s2">n</span><span class="s1">==</span><span class="s2">B</span><span class="s1">.</span><span class="s2">TrackAfter</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">))</span><span class="s4">return null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">||</span><span class="s2">o</span><span class="s1">==</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">&amp;&amp;!</span><span class="s2">l</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">==</span><span class="s2">i</span><span class="s1">||</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s2">s</span><span class="s1">+</span><span class="s2">h</span><span class="s1">;</span><span class="s2">s</span><span class="s1">+=</span><span class="s2">h</span><span class="s1">}</span><span class="s2">i</span><span class="s1">=</span><span class="s2">o</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;</span><span class="s2">i</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">`Position </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">} </span><span class="s0">is out of range for changeset of length </span><span class="s2">$</span><span class="s1">{</span><span class="s2">i</span><span class="s1">}</span><span class="s0">`</span><span class="s1">);</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s2">touchesRange</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">&lt;=</span><span class="s2">e</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">n</span><span class="s1">++],</span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">n</span><span class="s1">++],</span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">&lt;=</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">&gt;=</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return </span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">&gt;</span><span class="s2">e</span><span class="s1">?</span><span class="s0">&quot;cover&quot;</span><span class="s1">:</span><span class="s4">true</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=</span><span class="s2">l</span><span class="s1">}</span><span class="s4">return false</span><span class="s1">}</span><span class="s2">toString</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">++],</span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">++];</span><span class="s2">t</span><span class="s1">+=(</span><span class="s2">t</span><span class="s1">?</span><span class="s0">&quot; &quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)+</span><span class="s2">n</span><span class="s1">+(</span><span class="s2">i</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">?</span><span class="s0">&quot;:&quot;</span><span class="s1">+</span><span class="s2">i</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">}</span><span class="s4">static </span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">%</span><span class="s3">2</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">!=</span><span class="s0">&quot;number&quot;</span><span class="s1">)))</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Invalid JSON representation of ChangeDesc&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">N</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">N</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">D </span><span class="s4">extends </span><span class="s2">N</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">inserted</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}</span><span class="s2">apply</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Applying change set to a document with the wrong length&quot;</span><span class="s1">);</span><span class="s2">j</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">i</span><span class="s1">+(</span><span class="s2">n</span><span class="s1">-</span><span class="s2">e</span><span class="s1">),</span><span class="s2">r</span><span class="s1">)),</span><span class="s4">false</span><span class="s1">);</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">mapDesc</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">return </span><span class="s2">q</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s4">true</span><span class="s1">)}</span><span class="s2">invert</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(),</span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">+=</span><span class="s3">2</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">){</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]=</span><span class="s2">l</span><span class="s1">;</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">]=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">i</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s2">h</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">s</span><span class="s1">+</span><span class="s2">r</span><span class="s1">):</span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">)}</span><span class="s2">s</span><span class="s1">+=</span><span class="s2">r</span><span class="s1">}</span><span class="s4">return new </span><span class="s2">D</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">compose</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">?</span><span class="s2">t</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s2">$</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s4">true</span><span class="s1">)}</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s2">q</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s4">true</span><span class="s1">)}</span><span class="s2">iterChanges</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s2">j</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">get desc</span><span class="s1">(){</span><span class="s4">return </span><span class="s2">N</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">)}</span><span class="s2">filter</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[],</span><span class="s2">n</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">_</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s2">t</span><span class="s1">:</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;){</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">r</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s3">1e9</span><span class="s1">:</span><span class="s2">t</span><span class="s1">[</span><span class="s2">r</span><span class="s1">++];</span><span class="s4">while</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s2">h</span><span class="s1">||</span><span class="s2">l</span><span class="s1">==</span><span class="s2">h</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">len</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">done</span><span class="s1">)</span><span class="s4">break </span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">len</span><span class="s1">,</span><span class="s2">h</span><span class="s1">-</span><span class="s2">l</span><span class="s1">);</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">off</span><span class="s1">==</span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">:</span><span class="s3">0</span><span class="s1">;</span><span class="s2">J</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">L</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">text</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">l</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">r</span><span class="s1">++];</span><span class="s4">while</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s2">o</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">done</span><span class="s1">)</span><span class="s4">break </span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">len</span><span class="s1">,</span><span class="s2">o</span><span class="s1">-</span><span class="s2">l</span><span class="s1">);</span><span class="s2">J</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">);</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">off</span><span class="s1">==</span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">:</span><span class="s3">0</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">l</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">}}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">changes</span><span class="s1">:</span><span class="s4">new </span><span class="s2">D</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">),</span><span class="s2">filtered</span><span class="s1">:</span><span class="s2">N</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">+=</span><span class="s3">2</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">],</span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">([</span><span class="s2">n</span><span class="s1">]);</span><span class="s4">else </span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">([</span><span class="s2">n</span><span class="s1">].</span><span class="s2">concat</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">inserted</span><span class="s1">[</span><span class="s2">e</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">].</span><span class="s2">toJSON</span><span class="s1">()))}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">static </span><span class="s2">of</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[],</span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">function </span><span class="s2">h</span><span class="s1">(</span><span class="s2">t</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">&amp;&amp;!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">)</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">r</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">new </span><span class="s2">D</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">l</span><span class="s1">=</span><span class="s2">l</span><span class="s1">?</span><span class="s2">l</span><span class="s1">.</span><span class="s2">compose</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)):</span><span class="s2">n</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=[];</span><span class="s2">s</span><span class="s1">=[];</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">}</span><span class="s4">function </span><span class="s2">o</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">)</span><span class="s2">o</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">D</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">`Mismatched change set length (got </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s0">, expected </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">);</span><span class="s2">h</span><span class="s1">();</span><span class="s2">l</span><span class="s1">=</span><span class="s2">l</span><span class="s1">?</span><span class="s2">l</span><span class="s1">.</span><span class="s2">compose</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)):</span><span class="s2">t</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let</span><span class="s1">{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">l</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">o</span><span class="s1">=</span><span class="s2">l</span><span class="s1">,</span><span class="s2">insert</span><span class="s1">:</span><span class="s2">a</span><span class="s1">}=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&gt;</span><span class="s2">o</span><span class="s1">||</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">o</span><span class="s1">&gt;</span><span class="s2">e</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">`Invalid change range </span><span class="s2">$</span><span class="s1">{</span><span class="s2">l</span><span class="s1">} </span><span class="s0">to </span><span class="s2">$</span><span class="s1">{</span><span class="s2">o</span><span class="s1">} </span><span class="s0">(in doc of length </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">);</span><span class="s4">let </span><span class="s2">f</span><span class="s1">=!</span><span class="s2">a</span><span class="s1">?</span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">:</span><span class="s4">typeof </span><span class="s2">a</span><span class="s1">==</span><span class="s0">&quot;string&quot;</span><span class="s1">?</span><span class="s2">m</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s2">n</span><span class="s1">||</span><span class="s2">F</span><span class="s1">)):</span><span class="s2">a</span><span class="s1">;</span><span class="s4">let </span><span class="s2">c</span><span class="s1">=</span><span class="s2">f</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">==</span><span class="s2">o</span><span class="s1">&amp;&amp;</span><span class="s2">c</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s2">r</span><span class="s1">)</span><span class="s2">h</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&gt;</span><span class="s2">r</span><span class="s1">)</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">-</span><span class="s2">r</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">);</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">o</span><span class="s1">-</span><span class="s2">l</span><span class="s1">,</span><span class="s2">c</span><span class="s1">);</span><span class="s2">L</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">f</span><span class="s1">);</span><span class="s2">r</span><span class="s1">=</span><span class="s2">o</span><span class="s1">}}</span><span class="s2">o</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">h</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">);</span><span class="s4">return </span><span class="s2">l</span><span class="s1">}</span><span class="s4">static </span><span class="s2">empty</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">D</span><span class="s1">(</span><span class="s2">t</span><span class="s1">?[</span><span class="s2">t</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">]:[],[])}</span><span class="s4">static </span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Invalid JSON representation of ChangeSet&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[],</span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">s</span><span class="s1">==</span><span class="s0">&quot;number&quot;</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(!</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)||</span><span class="s4">typeof </span><span class="s2">s</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]!=</span><span class="s0">&quot;number&quot;</span><span class="s1">||</span><span class="s2">s</span><span class="s1">.</span><span class="s2">some</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">!=</span><span class="s0">&quot;string&quot;</span><span class="s1">))){</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Invalid JSON representation of ChangeSet&quot;</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s3">0</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">while</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">);</span><span class="s2">n</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]=</span><span class="s2">m</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">1</span><span class="s1">));</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">n</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">length</span><span class="s1">)}}</span><span class="s4">return new </span><span class="s2">D</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">createSet</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">D</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">J</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">&lt;=</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">2</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">&lt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">==</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">])</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]+=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">==</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]==</span><span class="s3">0</span><span class="s1">)</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">]+=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">){</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]+=</span><span class="s2">e</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">]+=</span><span class="s2">n</span><span class="s1">}</span><span class="s4">else </span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">L</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">2</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">].</span><span class="s2">append</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">while</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">j</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">inserted</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;){</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">l</span><span class="s1">++],</span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">l</span><span class="s1">++];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">s</span><span class="s1">+=</span><span class="s2">h</span><span class="s1">;</span><span class="s2">r</span><span class="s1">+=</span><span class="s2">h</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">s</span><span class="s1">,</span><span class="s2">f</span><span class="s1">=</span><span class="s2">r</span><span class="s1">,</span><span class="s2">c</span><span class="s1">=</span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s2">a</span><span class="s1">+=</span><span class="s2">h</span><span class="s1">;</span><span class="s2">f</span><span class="s1">+=</span><span class="s2">o</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">)</span><span class="s2">c</span><span class="s1">=</span><span class="s2">c</span><span class="s1">.</span><span class="s2">append</span><span class="s1">(</span><span class="s2">i</span><span class="s1">[</span><span class="s2">l</span><span class="s1">-</span><span class="s3">2</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">]);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">||</span><span class="s2">l</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">.</span><span class="s2">length</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">l</span><span class="s1">+</span><span class="s3">1</span><span class="s1">]&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s2">h</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">l</span><span class="s1">++];</span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sections</span><span class="s1">[</span><span class="s2">l</span><span class="s1">++]}</span><span class="s2">e</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">f</span><span class="s1">,</span><span class="s2">c</span><span class="s1">);</span><span class="s2">s</span><span class="s1">=</span><span class="s2">a</span><span class="s1">;</span><span class="s2">r</span><span class="s1">=</span><span class="s2">f</span><span class="s1">}}}</span><span class="s4">function </span><span class="s2">q</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">?[]:</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">new </span><span class="s2">_</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">h</span><span class="s1">=</span><span class="s4">new </span><span class="s2">_</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;;){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">done</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">len</span><span class="s1">||</span><span class="s2">h</span><span class="s1">.</span><span class="s2">done</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">){</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Mismatched change set lengths&quot;</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">,</span><span class="s2">h</span><span class="s1">.</span><span class="s2">len</span><span class="s1">);</span><span class="s2">J</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">);</span><span class="s2">l</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">h</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">o</span><span class="s1">==</span><span class="s2">l</span><span class="s1">.</span><span class="s2">i</span><span class="s1">||</span><span class="s2">l</span><span class="s1">.</span><span class="s2">off</span><span class="s1">==</span><span class="s3">0</span><span class="s1">&amp;&amp;(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">len</span><span class="s1">&lt;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">||</span><span class="s2">h</span><span class="s1">.</span><span class="s2">len</span><span class="s1">==</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">&amp;&amp;!</span><span class="s2">n</span><span class="s1">))){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">len</span><span class="s1">;</span><span class="s2">J</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">h</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">);</span><span class="s4">while</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">&lt;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">i</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">&lt;=</span><span class="s2">e</span><span class="s1">){</span><span class="s2">J</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)</span><span class="s2">L</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">text</span><span class="s1">);</span><span class="s2">o</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">i</span><span class="s1">}</span><span class="s2">l</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">t</span><span class="s1">-=</span><span class="s2">e</span><span class="s1">}</span><span class="s2">h</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">h</span><span class="s1">.</span><span class="s2">len</span><span class="s1">);</span><span class="s2">t</span><span class="s1">+=</span><span class="s2">n</span><span class="s1">;</span><span class="s2">e</span><span class="s1">-=</span><span class="s2">n</span><span class="s1">;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">len</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">){</span><span class="s2">e</span><span class="s1">-=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">len</span><span class="s1">;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">break</span><span class="s1">}}</span><span class="s2">J</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">o</span><span class="s1">&lt;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">i</span><span class="s1">?</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">:</span><span class="s3">0</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">&lt;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">i</span><span class="s1">)</span><span class="s2">L</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">text</span><span class="s1">);</span><span class="s2">o</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">i</span><span class="s1">;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">-</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">done</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">done</span><span class="s1">){</span><span class="s4">return </span><span class="s2">r</span><span class="s1">?</span><span class="s2">D</span><span class="s1">.</span><span class="s2">createSet</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">):</span><span class="s2">N</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Mismatched change set lengths&quot;</span><span class="s1">)}}}</span><span class="s4">function </span><span class="s2">$</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">?[]:</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">new </span><span class="s2">_</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">l</span><span class="s1">=</span><span class="s4">new </span><span class="s2">_</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;;){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">done</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">done</span><span class="s1">){</span><span class="s4">return </span><span class="s2">s</span><span class="s1">?</span><span class="s2">D</span><span class="s1">.</span><span class="s2">createSet</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">):</span><span class="s2">N</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">len</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s2">r</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">==</span><span class="s3">0</span><span class="s1">&amp;&amp;!</span><span class="s2">l</span><span class="s1">.</span><span class="s2">done</span><span class="s1">){</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)</span><span class="s2">L</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">text</span><span class="s1">);</span><span class="s2">l</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">done</span><span class="s1">||</span><span class="s2">l</span><span class="s1">.</span><span class="s2">done</span><span class="s1">){</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Mismatched change set lengths&quot;</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">len2</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">),</span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s2">l</span><span class="s1">.</span><span class="s2">off</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">;</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">)</span><span class="s2">L</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">text</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">){</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">off</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">len</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)</span><span class="s2">L</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">textBit</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">J</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">off</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">len</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">off</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&amp;&amp;!</span><span class="s2">l</span><span class="s1">.</span><span class="s2">off</span><span class="s1">)</span><span class="s2">L</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">text</span><span class="s1">)}</span><span class="s2">h</span><span class="s1">=(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">||</span><span class="s2">l</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">len</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">)&amp;&amp;(</span><span class="s2">h</span><span class="s1">||</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">e</span><span class="s1">);</span><span class="s2">r</span><span class="s1">.</span><span class="s2">forward2</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">l</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}}}</span><span class="s4">class </span><span class="s2">_</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s2">next</span><span class="s1">(){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">sections</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">len</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">i</span><span class="s1">++];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">i</span><span class="s1">++]}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">len</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">=-</span><span class="s3">2</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">off</span><span class="s1">=</span><span class="s3">0</span><span class="s1">}</span><span class="s2">get done</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">2</span><span class="s1">}</span><span class="s2">get len2</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">len</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">}</span><span class="s2">get text</span><span class="s1">(){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">inserted</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">i</span><span class="s1">-</span><span class="s3">2</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">return </span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">:</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]}</span><span class="s2">textBit</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">inserted</span><span class="s1">:</span><span class="s2">e</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">set</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">i</span><span class="s1">-</span><span class="s3">2</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">return </span><span class="s2">n</span><span class="s1">&gt;=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;!</span><span class="s2">t</span><span class="s1">?</span><span class="s2">m</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">:</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">].</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">off</span><span class="s1">,</span><span class="s2">t</span><span class="s1">==</span><span class="s4">null</span><span class="s1">?</span><span class="s2">undefined</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">off</span><span class="s1">+</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">len</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">len</span><span class="s1">-=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">off</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">}}</span><span class="s2">forward2</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">==-</span><span class="s3">1</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ins</span><span class="s1">-=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">off</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">}}}</span><span class="s4">class </span><span class="s2">z</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">=</span><span class="s2">n</span><span class="s1">}</span><span class="s2">get anchor</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">32</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">}</span><span class="s2">get head</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">32</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">}</span><span class="s2">get empty</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">}</span><span class="s2">get assoc</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">8</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">16</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">}</span><span class="s2">get bidiLevel</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&amp;</span><span class="s3">7</span><span class="s1">;</span><span class="s4">return </span><span class="s2">t</span><span class="s1">==</span><span class="s3">7</span><span class="s1">?</span><span class="s4">null</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}</span><span class="s2">get goalColumn</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">&gt;&gt;</span><span class="s3">6</span><span class="s1">;</span><span class="s4">return </span><span class="s2">t</span><span class="s1">==</span><span class="s3">16777215</span><span class="s1">?</span><span class="s2">undefined</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">){</span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s3">1</span><span class="s1">);</span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">n</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">z</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flags</span><span class="s1">)}</span><span class="s2">extend</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">)</span><span class="s4">return </span><span class="s2">V</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">abs</span><span class="s1">(</span><span class="s2">t</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">)&gt;</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">abs</span><span class="s1">(</span><span class="s2">e</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">)?</span><span class="s2">t</span><span class="s1">:</span><span class="s2">e</span><span class="s1">;</span><span class="s4">return </span><span class="s2">V</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">head</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">head</span><span class="s1">&amp;&amp;(!</span><span class="s2">e</span><span class="s1">||!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">assoc</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">assoc</span><span class="s1">)}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">{</span><span class="s2">anchor</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">,</span><span class="s2">head</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">head</span><span class="s1">}}</span><span class="s4">static </span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">||</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">!=</span><span class="s0">&quot;number&quot;</span><span class="s1">||</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">.</span><span class="s2">head</span><span class="s1">!=</span><span class="s0">&quot;number&quot;</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Invalid JSON representation for SelectionRange&quot;</span><span class="s1">);</span><span class="s4">return </span><span class="s2">V</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">head</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">z</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">V</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">;</span><span class="s4">return </span><span class="s2">V</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">n</span><span class="s1">=&gt;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">))),</span><span class="s4">this</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">)}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">[</span><span class="s2">n</span><span class="s1">].</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">[</span><span class="s2">n</span><span class="s1">],</span><span class="s2">e</span><span class="s1">))</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">return true</span><span class="s1">}</span><span class="s2">get main</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">]}</span><span class="s2">asSingle</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">V</span><span class="s1">([</span><span class="s4">this</span><span class="s1">.</span><span class="s2">main</span><span class="s1">],</span><span class="s3">0</span><span class="s1">)}</span><span class="s2">addRange</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">true</span><span class="s1">){</span><span class="s4">return </span><span class="s2">V</span><span class="s1">.</span><span class="s2">create</span><span class="s1">([</span><span class="s2">t</span><span class="s1">].</span><span class="s2">concat</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">),</span><span class="s2">e</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">+</span><span class="s3">1</span><span class="s1">)}</span><span class="s2">replaceRange</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s2">n</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">return </span><span class="s2">V</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">)}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">{</span><span class="s2">ranges</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">())),</span><span class="s2">main</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">}}</span><span class="s4">static </span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">||!</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">)||</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">.</span><span class="s2">main</span><span class="s1">!=</span><span class="s0">&quot;number&quot;</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">main</span><span class="s1">&gt;=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Invalid JSON representation for EditorSelection&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">V</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">z</span><span class="s1">.</span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))),</span><span class="s2">t</span><span class="s1">.</span><span class="s2">main</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">single</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">V</span><span class="s1">([</span><span class="s2">V</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)],</span><span class="s3">0</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;A selection needs at least one range&quot;</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">?</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&lt;=</span><span class="s2">n</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&lt;</span><span class="s2">n</span><span class="s1">)</span><span class="s4">return </span><span class="s2">V</span><span class="s1">.</span><span class="s2">normalized</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(),</span><span class="s2">e</span><span class="s1">);</span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">}</span><span class="s4">return new </span><span class="s2">V</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">cursor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">return </span><span class="s2">z</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,(</span><span class="s2">e</span><span class="s1">==</span><span class="s3">0</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s3">8</span><span class="s1">:</span><span class="s3">16</span><span class="s1">)|(</span><span class="s2">n</span><span class="s1">==</span><span class="s4">null</span><span class="s1">?</span><span class="s3">7</span><span class="s1">:</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s3">6</span><span class="s1">,</span><span class="s2">n</span><span class="s1">))|(</span><span class="s2">i</span><span class="s1">!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">i</span><span class="s1">:</span><span class="s3">16777215</span><span class="s1">)&lt;&lt;</span><span class="s3">6</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">range</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=(</span><span class="s2">n</span><span class="s1">!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">n</span><span class="s1">:</span><span class="s3">16777215</span><span class="s1">)&lt;&lt;</span><span class="s3">6</span><span class="s1">|(</span><span class="s2">i</span><span class="s1">==</span><span class="s4">null</span><span class="s1">?</span><span class="s3">7</span><span class="s1">:</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s3">6</span><span class="s1">,</span><span class="s2">i</span><span class="s1">));</span><span class="s4">return </span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">?</span><span class="s2">z</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s3">32</span><span class="s1">|</span><span class="s3">16</span><span class="s1">|</span><span class="s2">s</span><span class="s1">):</span><span class="s2">z</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,(</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">?</span><span class="s3">8</span><span class="s1">:</span><span class="s3">0</span><span class="s1">)|</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">normalized</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sort</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">));</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">-</span><span class="s3">1</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">?</span><span class="s2">n</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&lt;=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;=</span><span class="s2">e</span><span class="s1">)</span><span class="s2">e</span><span class="s1">--;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(--</span><span class="s2">i</span><span class="s1">,</span><span class="s3">2</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">&gt;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">head</span><span class="s1">?</span><span class="s2">V</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">r</span><span class="s1">):</span><span class="s2">V</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">))}}</span><span class="s4">return new </span><span class="s2">V</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">W</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of t</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&gt;</span><span class="s2">e</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Selection points outside of document&quot;</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">U</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">class </span><span class="s2">G</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">combine</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">compareInput</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">compare</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isStatic</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">U</span><span class="s1">++;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">default</span><span class="s1">=</span><span class="s2">t</span><span class="s1">([]);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">extensions</span><span class="s1">=</span><span class="s4">typeof </span><span class="s2">s</span><span class="s1">==</span><span class="s0">&quot;function&quot;</span><span class="s1">?</span><span class="s2">s</span><span class="s1">(</span><span class="s4">this</span><span class="s1">):</span><span class="s2">s</span><span class="s1">}</span><span class="s2">get reader</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">}</span><span class="s4">static </span><span class="s2">define</span><span class="s1">(</span><span class="s2">t</span><span class="s1">={}){</span><span class="s4">return new </span><span class="s2">G</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">combine</span><span class="s1">||(</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">),</span><span class="s2">t</span><span class="s1">.</span><span class="s2">compareInput</span><span class="s1">||((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">===</span><span class="s2">e</span><span class="s1">),</span><span class="s2">t</span><span class="s1">.</span><span class="s2">compare</span><span class="s1">||(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">combine</span><span class="s1">?</span><span class="s2">H</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">===</span><span class="s2">e</span><span class="s1">),!!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">static</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">enables</span><span class="s1">)}</span><span class="s2">of</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">K</span><span class="s1">([],</span><span class="s4">this</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">compute</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isStatic</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Can't compute a static facet&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">K</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">,</span><span class="s3">1</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">computeN</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isStatic</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Can't compute a static facet&quot;</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">K</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">,</span><span class="s3">2</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">from</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">compute</span><span class="s1">([</span><span class="s2">t</span><span class="s1">],(</span><span class="s2">n</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))))}}</span><span class="s4">function </span><span class="s2">H</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">==</span><span class="s2">e</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">every</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">===</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]))}</span><span class="s4">class </span><span class="s2">K</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dependencies</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">U</span><span class="s1">++}</span><span class="s2">dynamicSlot</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">var </span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">.</span><span class="s2">compareInput</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]&gt;&gt;</span><span class="s3">1</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s3">2</span><span class="s1">;</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s4">false</span><span class="s1">,</span><span class="s2">o</span><span class="s1">=</span><span class="s4">false</span><span class="s1">,</span><span class="s2">a</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">f of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">dependencies</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">f</span><span class="s1">==</span><span class="s0">&quot;doc&quot;</span><span class="s1">)</span><span class="s2">h</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">f</span><span class="s1">==</span><span class="s0">&quot;selection&quot;</span><span class="s1">)</span><span class="s2">o</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">((((</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">f</span><span class="s1">.</span><span class="s2">id</span><span class="s1">])!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s3">1</span><span class="s1">)&amp;</span><span class="s3">1</span><span class="s1">)==</span><span class="s3">0</span><span class="s1">)</span><span class="s2">a</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">f</span><span class="s1">.</span><span class="s2">id</span><span class="s1">])}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=</span><span class="s2">n</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return </span><span class="s3">1</span><span class="s1">},</span><span class="s2">update</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">docChanged</span><span class="s1">||</span><span class="s2">o</span><span class="s1">&amp;&amp;(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">docChanged</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">)||</span><span class="s2">X</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">a</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">n</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">?!</span><span class="s2">Q</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">i</span><span class="s1">):!</span><span class="s2">i</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">r</span><span class="s1">])){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">return </span><span class="s3">1</span><span class="s1">}}</span><span class="s4">return </span><span class="s3">0</span><span class="s1">},</span><span class="s2">reconfigure</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">let </span><span class="s2">h</span><span class="s1">,</span><span class="s2">o</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">address</span><span class="s1">[</span><span class="s2">s</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">ft</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">o</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dependencies</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">n</span><span class="s1">=&gt;</span><span class="s2">n </span><span class="s4">instanceof </span><span class="s2">G</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)===</span><span class="s2">t</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">n</span><span class="s1">):</span><span class="s2">n </span><span class="s4">instanceof </span><span class="s2">tt</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s4">false</span><span class="s1">)==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s4">false</span><span class="s1">):</span><span class="s4">true</span><span class="s1">))||(</span><span class="s2">l</span><span class="s1">?</span><span class="s2">Q</span><span class="s1">(</span><span class="s2">h</span><span class="s1">=</span><span class="s2">n</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">):</span><span class="s2">i</span><span class="s1">(</span><span class="s2">h</span><span class="s1">=</span><span class="s2">n</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">s</span><span class="s1">))){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">return </span><span class="s3">0</span><span class="s1">}}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">h</span><span class="s1">=</span><span class="s2">n</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=</span><span class="s2">h</span><span class="s1">;</span><span class="s4">return </span><span class="s3">1</span><span class="s1">}}}}</span><span class="s4">function </span><span class="s2">Q</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]))</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">function </span><span class="s2">X</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of e</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">at</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)&amp;</span><span class="s3">1</span><span class="s1">)</span><span class="s2">n</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Y</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]));</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">type</span><span class="s1">));</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;!(</span><span class="s2">t</span><span class="s1">&amp;</span><span class="s3">1</span><span class="s1">)));</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">function </span><span class="s2">h</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">ft</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]==</span><span class="s3">2</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of r</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">else </span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">combine</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of i</span><span class="s1">)</span><span class="s2">at</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">l</span><span class="s1">]=</span><span class="s2">h</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return </span><span class="s3">1</span><span class="s1">},</span><span class="s2">update</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">X</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">))</span><span class="s4">return </span><span class="s3">0</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">h</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">compare</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">l</span><span class="s1">]))</span><span class="s4">return </span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">l</span><span class="s1">]=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">return </span><span class="s3">1</span><span class="s1">},</span><span class="s2">reconfigure</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">X</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">facets</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">],</span><span class="s2">a</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&amp;&amp;!</span><span class="s2">r</span><span class="s1">&amp;&amp;</span><span class="s2">H</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">o</span><span class="s1">)){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">l</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">;</span><span class="s4">return </span><span class="s3">0</span><span class="s1">}</span><span class="s4">let </span><span class="s2">f</span><span class="s1">=</span><span class="s2">h</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">compare</span><span class="s1">(</span><span class="s2">f</span><span class="s1">,</span><span class="s2">a</span><span class="s1">)){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">l</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">;</span><span class="s4">return </span><span class="s3">0</span><span class="s1">}</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">l</span><span class="s1">]=</span><span class="s2">f</span><span class="s1">;</span><span class="s4">return </span><span class="s3">1</span><span class="s1">}}}</span><span class="s4">const </span><span class="s2">Z</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s4">static</span><span class="s1">:</span><span class="s4">true</span><span class="s1">});</span><span class="s4">class </span><span class="s2">tt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">createF</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">updateF</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">compareF</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">provides</span><span class="s1">=</span><span class="s2">undefined</span><span class="s1">}</span><span class="s4">static </span><span class="s2">define</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">tt</span><span class="s1">(</span><span class="s2">U</span><span class="s1">++,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">create</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">update</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">compare</span><span class="s1">||((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">===</span><span class="s2">e</span><span class="s1">),</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">provide</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">provides</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">provide</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">Z</span><span class="s1">).</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">field</span><span class="s1">==</span><span class="s4">this</span><span class="s1">));</span><span class="s4">return</span><span class="s1">((</span><span class="s2">e</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">e</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">create</span><span class="s1">)||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">createF</span><span class="s1">)(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">slot</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">return</span><span class="s1">{</span><span class="s2">create</span><span class="s1">:</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return </span><span class="s3">1</span><span class="s1">},</span><span class="s2">update</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)=&gt;{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">updateF</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">compareF</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">))</span><span class="s4">return </span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">return </span><span class="s3">1</span><span class="s1">},</span><span class="s2">reconfigure</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">address</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">return </span><span class="s3">0</span><span class="s1">}</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return </span><span class="s3">1</span><span class="s1">}}}</span><span class="s2">init</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return</span><span class="s1">[</span><span class="s4">this</span><span class="s1">,</span><span class="s2">Z</span><span class="s1">.</span><span class="s2">of</span><span class="s1">({</span><span class="s2">field</span><span class="s1">:</span><span class="s4">this</span><span class="s1">,</span><span class="s2">create</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})]}</span><span class="s2">get extension</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">}}</span><span class="s4">const </span><span class="s2">et</span><span class="s1">={</span><span class="s2">lowest</span><span class="s1">:</span><span class="s3">4</span><span class="s1">,</span><span class="s2">low</span><span class="s1">:</span><span class="s3">3</span><span class="s1">,</span><span class="s4">default</span><span class="s1">:</span><span class="s3">2</span><span class="s1">,</span><span class="s2">high</span><span class="s1">:</span><span class="s3">1</span><span class="s1">,</span><span class="s2">highest</span><span class="s1">:</span><span class="s3">0</span><span class="s1">};</span><span class="s4">function </span><span class="s2">nt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s4">new </span><span class="s2">st</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">const </span><span class="s2">it</span><span class="s1">={</span><span class="s2">highest</span><span class="s1">:</span><span class="s2">nt</span><span class="s1">(</span><span class="s2">et</span><span class="s1">.</span><span class="s2">highest</span><span class="s1">),</span><span class="s2">high</span><span class="s1">:</span><span class="s2">nt</span><span class="s1">(</span><span class="s2">et</span><span class="s1">.</span><span class="s2">high</span><span class="s1">),</span><span class="s4">default</span><span class="s1">:</span><span class="s2">nt</span><span class="s1">(</span><span class="s2">et</span><span class="s1">.</span><span class="s2">default</span><span class="s1">),</span><span class="s2">low</span><span class="s1">:</span><span class="s2">nt</span><span class="s1">(</span><span class="s2">et</span><span class="s1">.</span><span class="s2">low</span><span class="s1">),</span><span class="s2">lowest</span><span class="s1">:</span><span class="s2">nt</span><span class="s1">(</span><span class="s2">et</span><span class="s1">.</span><span class="s2">lowest</span><span class="s1">)};</span><span class="s4">class </span><span class="s2">st</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">inner</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">rt</span><span class="s1">{</span><span class="s2">of</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">lt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">reconfigure</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">rt</span><span class="s1">.</span><span class="s2">reconfigure</span><span class="s1">.</span><span class="s2">of</span><span class="s1">({</span><span class="s2">compartment</span><span class="s1">:</span><span class="s4">this</span><span class="s1">,</span><span class="s2">extension</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})}</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">compartments</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s4">this</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">lt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">compartment</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">inner</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">ht</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">base</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">compartments</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dynamicSlots</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">address</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">staticValues</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">facets</span><span class="s1">=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">statusTemplate</span><span class="s1">=[];</span><span class="s4">while</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">statusTemplate</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">statusTemplate</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">0</span><span class="s1">)}</span><span class="s2">staticFacet</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">address</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">];</span><span class="s4">return </span><span class="s2">e</span><span class="s1">==</span><span class="s4">null</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">default</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">staticValues</span><span class="s1">[</span><span class="s2">e</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">]}</span><span class="s4">static </span><span class="s2">resolve</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">c of ot</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">c </span><span class="s4">instanceof </span><span class="s2">tt</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">c</span><span class="s1">);</span><span class="s4">else</span><span class="s1">(</span><span class="s2">s</span><span class="s1">[</span><span class="s2">c</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]||(</span><span class="s2">s</span><span class="s1">[</span><span class="s2">c</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=[])).</span><span class="s2">push</span><span class="s1">(</span><span class="s2">c</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">c of i</span><span class="s1">){</span><span class="s2">l</span><span class="s1">[</span><span class="s2">c</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">;</span><span class="s2">o</span><span class="s1">.</span><span class="s2">push</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">c</span><span class="s1">.</span><span class="s2">slot</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))}</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">n</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">n</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">facets</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">c </span><span class="s4">in </span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">c</span><span class="s1">],</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">facet</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">a</span><span class="s1">&amp;&amp;</span><span class="s2">a</span><span class="s1">[</span><span class="s2">c</span><span class="s1">]||[];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s3">0</span><span class="s1">))){</span><span class="s2">l</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">|</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">H</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)){</span><span class="s2">h</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">combine</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)));</span><span class="s2">h</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">compare</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))?</span><span class="s2">n</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">e</span><span class="s1">):</span><span class="s2">i</span><span class="s1">)}}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s2">l</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">|</span><span class="s3">1</span><span class="s1">;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">l</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">;</span><span class="s2">o</span><span class="s1">.</span><span class="s2">push</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dynamicSlot</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)))}}</span><span class="s2">l</span><span class="s1">[</span><span class="s2">e</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">;</span><span class="s2">o</span><span class="s1">.</span><span class="s2">push</span><span class="s1">((</span><span class="s2">n</span><span class="s1">=&gt;</span><span class="s2">Y</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)))}}</span><span class="s4">let </span><span class="s2">f</span><span class="s1">=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)));</span><span class="s4">return new </span><span class="s2">ht</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">f</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">h</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">ot</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[[],[],[],[],[]];</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s4">function </span><span class="s2">r</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">l</span><span class="s1">){</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">&lt;=</span><span class="s2">l</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">h</span><span class="s1">].</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">)</span><span class="s2">i</span><span class="s1">[</span><span class="s2">h</span><span class="s1">].</span><span class="s2">splice</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s3">1</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">lt</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">compartment</span><span class="s1">)}</span><span class="s2">s</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">l</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">)</span><span class="s2">r</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">l</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">lt</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">compartment</span><span class="s1">))</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">`Duplicate use of compartment in extensions`</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">compartment</span><span class="s1">)||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">inner</span><span class="s1">;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">compartment</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s2">r</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">st</span><span class="s1">){</span><span class="s2">r</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">inner</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">prec</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">tt</span><span class="s1">){</span><span class="s2">i</span><span class="s1">[</span><span class="s2">l</span><span class="s1">].</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">provides</span><span class="s1">)</span><span class="s2">r</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">provides</span><span class="s1">,</span><span class="s2">l</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">K</span><span class="s1">){</span><span class="s2">i</span><span class="s1">[</span><span class="s2">l</span><span class="s1">].</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">.</span><span class="s2">extensions</span><span class="s1">)</span><span class="s2">r</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">.</span><span class="s2">extensions</span><span class="s1">,</span><span class="s2">et</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">extension</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`Unrecognized extension value in extension set (</span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">}</span><span class="s0">). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`</span><span class="s1">);</span><span class="s2">r</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">l</span><span class="s1">)}}</span><span class="s2">r</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">et</span><span class="s1">.</span><span class="s2">default</span><span class="s1">);</span><span class="s4">return </span><span class="s2">i</span><span class="s1">.</span><span class="s2">reduce</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)))}</span><span class="s4">function </span><span class="s2">at</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&amp;</span><span class="s3">1</span><span class="s1">)</span><span class="s4">return </span><span class="s3">2</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">status</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s3">4</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Cyclic dependency between fields and/or facets&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&amp;</span><span class="s3">2</span><span class="s1">)</span><span class="s4">return </span><span class="s2">i</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">status</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=</span><span class="s3">4</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">computeSlot</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">dynamicSlots</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]);</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">status</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=</span><span class="s3">2</span><span class="s1">|</span><span class="s2">s</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ft</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">&amp;</span><span class="s3">1</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">staticValues</span><span class="s1">[</span><span class="s2">e</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">]:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">[</span><span class="s2">e</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">]}</span><span class="s4">const </span><span class="s2">ct</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">const </span><span class="s2">ut</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s2">combine</span><span class="s1">:</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">)),</span><span class="s4">static</span><span class="s1">:</span><span class="s4">true</span><span class="s1">});</span><span class="s4">const </span><span class="s2">dt</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s2">combine</span><span class="s1">:</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]:</span><span class="s2">undefined</span><span class="s1">,</span><span class="s4">static</span><span class="s1">:</span><span class="s4">true</span><span class="s1">});</span><span class="s4">const </span><span class="s2">gt</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">const </span><span class="s2">pt</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">const </span><span class="s2">mt</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">const </span><span class="s2">wt</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s2">combine</span><span class="s1">:</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]:</span><span class="s4">false</span><span class="s1">});</span><span class="s4">class </span><span class="s2">xt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}</span><span class="s4">static </span><span class="s2">define</span><span class="s1">(){</span><span class="s4">return new </span><span class="s2">vt</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">vt</span><span class="s1">{</span><span class="s2">of</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">xt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">kt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">map</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s2">of</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">yt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">yt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">?</span><span class="s2">undefined</span><span class="s1">:</span><span class="s2">e</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s4">new </span><span class="s2">yt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">is</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s2">t</span><span class="s1">}</span><span class="s4">static </span><span class="s2">define</span><span class="s1">(</span><span class="s2">t</span><span class="s1">={}){</span><span class="s4">return new </span><span class="s2">kt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">map</span><span class="s1">||(</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">))}</span><span class="s4">static </span><span class="s2">mapEffects</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}}</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">reconfigure</span><span class="s1">=</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">appendConfig</span><span class="s1">=</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">class </span><span class="s2">St</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_doc</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_state</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s2">W</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">newLength</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s2">St</span><span class="s1">.</span><span class="s2">time</span><span class="s1">)))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">St</span><span class="s1">.</span><span class="s2">time</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">()))}</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">St</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)}</span><span class="s2">get newDoc</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_doc</span><span class="s1">||(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_doc</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">apply</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">))}</span><span class="s2">get newSelection</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">)}</span><span class="s2">get state</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_state</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">.</span><span class="s2">applyTransaction</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_state</span><span class="s1">}</span><span class="s2">annotation</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">type</span><span class="s1">==</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">return </span><span class="s2">undefined</span><span class="s1">}</span><span class="s2">get docChanged</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">}</span><span class="s2">get reconfigured</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">.</span><span class="s2">config</span><span class="s1">!=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">config</span><span class="s1">}</span><span class="s2">isUserEvent</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">annotation</span><span class="s1">(</span><span class="s2">St</span><span class="s1">.</span><span class="s2">userEvent</span><span class="s1">);</span><span class="s4">return</span><span class="s1">!!(</span><span class="s2">e</span><span class="s1">&amp;&amp;(</span><span class="s2">e</span><span class="s1">==</span><span class="s2">t</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)==</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">]==</span><span class="s0">&quot;.&quot;</span><span class="s1">))}}</span><span class="s2">St</span><span class="s1">.</span><span class="s2">time</span><span class="s1">=</span><span class="s2">xt</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s2">St</span><span class="s1">.</span><span class="s2">userEvent</span><span class="s1">=</span><span class="s2">xt</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s2">St</span><span class="s1">.</span><span class="s2">addToHistory</span><span class="s1">=</span><span class="s2">xt</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s2">St</span><span class="s1">.</span><span class="s2">remote</span><span class="s1">=</span><span class="s2">xt</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">function </span><span class="s2">bt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;(</span><span class="s2">s</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">||</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]&gt;=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">])){</span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">++];</span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">++]}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">++];</span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">++]}</span><span class="s4">else return </span><span class="s2">n</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">||</span><span class="s2">n</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]&lt;</span><span class="s2">r</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">);</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]&lt;</span><span class="s2">l</span><span class="s1">)</span><span class="s2">n</span><span class="s1">[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]=</span><span class="s2">l</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">It</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">var </span><span class="s2">i</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">){</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">;</span><span class="s2">r</span><span class="s1">=</span><span class="s2">D</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">compose</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">);</span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">mapDesc</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">,</span><span class="s4">true</span><span class="s1">);</span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">compose</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">changes</span><span class="s1">:</span><span class="s2">l</span><span class="s1">,</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">r</span><span class="s1">):(</span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">i</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">s</span><span class="s1">),</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">mapEffects</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">,</span><span class="s2">s</span><span class="s1">).</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">mapEffects</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)),</span><span class="s2">annotations</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">):</span><span class="s2">e</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">,</span><span class="s2">scrollIntoView</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">Pt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">Rt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">userEvent</span><span class="s1">)</span><span class="s2">s</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">St</span><span class="s1">.</span><span class="s2">userEvent</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">userEvent</span><span class="s1">));</span><span class="s4">return</span><span class="s1">{</span><span class="s2">changes</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes </span><span class="s4">instanceof </span><span class="s2">D</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">:</span><span class="s2">D</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">||[],</span><span class="s2">n</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">dt</span><span class="s1">)),</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">i</span><span class="s1">&amp;&amp;(</span><span class="s2">i </span><span class="s4">instanceof </span><span class="s2">V</span><span class="s1">?</span><span class="s2">i</span><span class="s1">:</span><span class="s2">V</span><span class="s1">.</span><span class="s2">single</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">head</span><span class="s1">)),</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">Rt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">),</span><span class="s2">annotations</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">scrollIntoView</span><span class="s1">:!!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">Et</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">Pt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]:{},</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">filter</span><span class="s1">===</span><span class="s4">false</span><span class="s1">)</span><span class="s2">n</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">r</span><span class="s1">].</span><span class="s2">filter</span><span class="s1">===</span><span class="s4">false</span><span class="s1">)</span><span class="s2">n</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=!!</span><span class="s2">e</span><span class="s1">[</span><span class="s2">r</span><span class="s1">].</span><span class="s2">sequential</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=</span><span class="s2">It</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">Pt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">s</span><span class="s1">?</span><span class="s2">i</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">newLength</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">),</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">St</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">);</span><span class="s4">return </span><span class="s2">At</span><span class="s1">(</span><span class="s2">n</span><span class="s1">?</span><span class="s2">Mt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">):</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Mt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of e</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">gt</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">===</span><span class="s4">false</span><span class="s1">){</span><span class="s2">n</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">break</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s2">n</span><span class="s1">=</span><span class="s2">n</span><span class="s1">===</span><span class="s4">true</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s2">bt</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">!==</span><span class="s4">true</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">===</span><span class="s4">false</span><span class="s1">){</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">invertedDesc</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=</span><span class="s2">D</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">;</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">filtered</span><span class="s1">.</span><span class="s2">mapDesc</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">).</span><span class="s2">invertedDesc</span><span class="s1">}</span><span class="s2">t</span><span class="s1">=</span><span class="s2">St</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">s</span><span class="s1">),</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">mapEffects</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">,</span><span class="s2">s</span><span class="s1">),</span><span class="s2">t</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">)}</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">pt</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">--){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">s</span><span class="s1">](</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n </span><span class="s4">instanceof </span><span class="s2">St</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)&amp;&amp;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]</span><span class="s4">instanceof </span><span class="s2">St</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s2">n</span><span class="s1">[</span><span class="s3">0</span><span class="s1">];</span><span class="s4">else </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Et</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Rt</span><span class="s1">(</span><span class="s2">n</span><span class="s1">),</span><span class="s4">false</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">At</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">mt</span><span class="s1">),</span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">--){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">n</span><span class="s1">[</span><span class="s2">s</span><span class="s1">](</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&amp;&amp;</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">r</span><span class="s1">).</span><span class="s2">length</span><span class="s1">)</span><span class="s2">i</span><span class="s1">=</span><span class="s2">It</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">Pt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">newLength</span><span class="s1">),</span><span class="s4">true</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">==</span><span class="s2">t</span><span class="s1">?</span><span class="s2">t</span><span class="s1">:</span><span class="s2">St</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">annotations</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">)}</span><span class="s4">const </span><span class="s2">Ct</span><span class="s1">=[];</span><span class="s4">function </span><span class="s2">Rt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">==</span><span class="s4">null</span><span class="s1">?</span><span class="s2">Ct</span><span class="s1">:</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)?</span><span class="s2">t</span><span class="s1">:[</span><span class="s2">t</span><span class="s1">]}</span><span class="s4">var </span><span class="s2">Ot</span><span class="s1">=</span><span class="s4">function</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">[</span><span class="s0">&quot;Word&quot;</span><span class="s1">]=</span><span class="s3">0</span><span class="s1">]=</span><span class="s0">&quot;Word&quot;</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">[</span><span class="s0">&quot;Space&quot;</span><span class="s1">]=</span><span class="s3">1</span><span class="s1">]=</span><span class="s0">&quot;Space&quot;</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">[</span><span class="s0">&quot;Other&quot;</span><span class="s1">]=</span><span class="s3">2</span><span class="s1">]=</span><span class="s0">&quot;Other&quot;</span><span class="s1">;</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}(</span><span class="s2">Ot</span><span class="s1">||(</span><span class="s2">Ot</span><span class="s1">={}));</span><span class="s4">const </span><span class="s2">Tt</span><span class="s1">=</span><span class="s5">/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/</span><span class="s1">;</span><span class="s4">let </span><span class="s2">Ft</span><span class="s1">;</span><span class="s4">try</span><span class="s1">{</span><span class="s2">Ft</span><span class="s1">=</span><span class="s4">new </span><span class="s2">RegExp</span><span class="s1">(</span><span class="s0">&quot;[</span><span class="s4">\\</span><span class="s0">p{Alphabetic}</span><span class="s4">\\</span><span class="s0">p{Number}_]&quot;</span><span class="s1">,</span><span class="s0">&quot;u&quot;</span><span class="s1">)}</span><span class="s4">catch</span><span class="s1">(</span><span class="s2">ie</span><span class="s1">){}</span><span class="s4">function </span><span class="s2">Bt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Ft</span><span class="s1">)</span><span class="s4">return </span><span class="s2">Ft</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s5">/\w/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)||</span><span class="s2">n</span><span class="s1">&gt;</span><span class="s0">&quot;&quot;</span><span class="s1">&amp;&amp;(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">toUpperCase</span><span class="s1">()!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">toLowerCase</span><span class="s1">()||</span><span class="s2">Tt</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)))</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Nt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(!</span><span class="s5">/\S/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s4">return </span><span class="s2">Ot</span><span class="s1">.</span><span class="s2">Space</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Bt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">))</span><span class="s4">return </span><span class="s2">Ot</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">])&gt;-</span><span class="s3">1</span><span class="s1">)</span><span class="s4">return </span><span class="s2">Ot</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">;</span><span class="s4">return </span><span class="s2">Ot</span><span class="s1">.</span><span class="s2">Other</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">Dt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">config</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">values</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">status</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">statusTemplate</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">computeSlot</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)</span><span class="s2">r</span><span class="s1">.</span><span class="s2">_state</span><span class="s1">=</span><span class="s4">this</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">dynamicSlots</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">l</span><span class="s1">++)</span><span class="s2">at</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">l</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">computeSlot</span><span class="s1">=</span><span class="s4">null</span><span class="s1">}</span><span class="s2">field</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">true</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">address</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">==</span><span class="s4">null</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Field is not present in this state&quot;</span><span class="s1">);</span><span class="s4">return </span><span class="s2">undefined</span><span class="s1">}</span><span class="s2">at</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">return </span><span class="s2">ft</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">update</span><span class="s1">(</span><span class="s2">...t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">Et</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s4">true</span><span class="s1">)}</span><span class="s2">applyTransaction</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">config</span><span class="s1">,{</span><span class="s2">base</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">compartments</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l of t</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">is</span><span class="s1">(</span><span class="s2">rt</span><span class="s1">.</span><span class="s2">reconfigure</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s2">i</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">compartments</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)));</span><span class="s2">e</span><span class="s1">=</span><span class="s4">null</span><span class="s1">}</span><span class="s2">i</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">compartment</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">extension</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">is</span><span class="s1">(</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">reconfigure</span><span class="s1">)){</span><span class="s2">e</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s2">n</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">is</span><span class="s1">(</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">appendConfig</span><span class="s1">)){</span><span class="s2">e</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s2">n</span><span class="s1">=</span><span class="s2">Rt</span><span class="s1">(</span><span class="s2">n</span><span class="s1">).</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)}}</span><span class="s4">let </span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">){</span><span class="s2">e</span><span class="s1">=</span><span class="s2">ht</span><span class="s1">.</span><span class="s2">resolve</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s4">this</span><span class="s1">);</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Dt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dynamicSlots</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((()=&gt;</span><span class="s4">null</span><span class="s1">)),((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">reconfigure</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">)),</span><span class="s4">null</span><span class="s1">);</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">.</span><span class="s2">values</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">()}</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">ut</span><span class="s1">)?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">newSelection</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">newSelection</span><span class="s1">.</span><span class="s2">asSingle</span><span class="s1">();</span><span class="s4">new </span><span class="s2">Dt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">newDoc</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)=&gt;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">update</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)),</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">replaceSelection</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;string&quot;</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">toText</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">changeByRange</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;({</span><span class="s2">changes</span><span class="s1">:{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">insert</span><span class="s1">:</span><span class="s2">t</span><span class="s1">},</span><span class="s2">range</span><span class="s1">:</span><span class="s2">V</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">+</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)})))}</span><span class="s2">changeByRange</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=[</span><span class="s2">n</span><span class="s1">.</span><span class="s2">range</span><span class="s1">];</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">Rt</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">l</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">[</span><span class="s2">l</span><span class="s1">]);</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">),</span><span class="s2">o</span><span class="s1">=</span><span class="s2">h</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">l</span><span class="s1">;</span><span class="s2">t</span><span class="s1">++)</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">].</span><span class="s2">map</span><span class="s1">(</span><span class="s2">o</span><span class="s1">);</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">mapDesc</span><span class="s1">(</span><span class="s2">h</span><span class="s1">,</span><span class="s4">true</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">range</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">a</span><span class="s1">));</span><span class="s2">i</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">compose</span><span class="s1">(</span><span class="s2">o</span><span class="s1">);</span><span class="s2">r</span><span class="s1">=</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">mapEffects</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">o</span><span class="s1">).</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">mapEffects</span><span class="s1">(</span><span class="s2">Rt</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">),</span><span class="s2">a</span><span class="s1">))}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">changes</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">V</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">),</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}}</span><span class="s2">changes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">=[]){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">D</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">;</span><span class="s4">return </span><span class="s2">D</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">lineSeparator</span><span class="s1">))}</span><span class="s2">toText</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">m</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">lineSeparator</span><span class="s1">)||</span><span class="s2">F</span><span class="s1">))}</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">sliceString</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lineBreak</span><span class="s1">)}</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">address</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">==</span><span class="s4">null</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">default</span><span class="s1">;</span><span class="s2">at</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">ft</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">toJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">={</span><span class="s2">doc</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(),</span><span class="s2">selection</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">()};</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n </span><span class="s4">in </span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i </span><span class="s4">instanceof </span><span class="s2">tt</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">config</span><span class="s1">.</span><span class="s2">address</span><span class="s1">[</span><span class="s2">i</span><span class="s1">.</span><span class="s2">id</span><span class="s1">]!=</span><span class="s4">null</span><span class="s1">)</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]),</span><span class="s4">this</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s4">static </span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">={},</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">||</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">!=</span><span class="s0">&quot;string&quot;</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Invalid JSON representation for EditorState&quot;</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s </span><span class="s4">in </span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">n</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">];</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">init</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))))}}</span><span class="s4">return </span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">create</span><span class="s1">({</span><span class="s2">doc</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">,</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">V</span><span class="s1">.</span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">),</span><span class="s2">extensions</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">extensions</span><span class="s1">?</span><span class="s2">i</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">([</span><span class="s2">e</span><span class="s1">.</span><span class="s2">extensions</span><span class="s1">]):</span><span class="s2">i</span><span class="s1">})}</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">={}){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">ht</span><span class="s1">.</span><span class="s2">resolve</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">extensions</span><span class="s1">||[],</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc </span><span class="s4">instanceof </span><span class="s2">m</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">:</span><span class="s2">m</span><span class="s1">.</span><span class="s2">of</span><span class="s1">((</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">||</span><span class="s0">&quot;&quot;</span><span class="s1">).</span><span class="s2">split</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">staticFacet</span><span class="s1">(</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">lineSeparator</span><span class="s1">)||</span><span class="s2">F</span><span class="s1">));</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">?</span><span class="s2">V</span><span class="s1">.</span><span class="s2">single</span><span class="s1">(</span><span class="s3">0</span><span class="s1">):</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection </span><span class="s4">instanceof </span><span class="s2">V</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">V</span><span class="s1">.</span><span class="s2">single</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">anchor</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">head</span><span class="s1">);</span><span class="s2">W</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">staticFacet</span><span class="s1">(</span><span class="s2">ut</span><span class="s1">))</span><span class="s2">i</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">asSingle</span><span class="s1">();</span><span class="s4">return new </span><span class="s2">Dt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dynamicSlots</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((()=&gt;</span><span class="s4">null</span><span class="s1">)),((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)),</span><span class="s4">null</span><span class="s1">)}</span><span class="s2">get tabSize</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">tabSize</span><span class="s1">)}</span><span class="s2">get lineBreak</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">lineSeparator</span><span class="s1">)||</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">}</span><span class="s2">get readOnly</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">wt</span><span class="s1">)}</span><span class="s2">phrase</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">...e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">phrases</span><span class="s1">))</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)){</span><span class="s2">t</span><span class="s1">=</span><span class="s2">n</span><span class="s1">[</span><span class="s2">t</span><span class="s1">];</span><span class="s4">break</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s2">t</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s5">/\$(\$|\d*)/g</span><span class="s1">,((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">==</span><span class="s0">&quot;$&quot;</span><span class="s1">)</span><span class="s4">return</span><span class="s0">&quot;$&quot;</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=+(</span><span class="s2">n</span><span class="s1">||</span><span class="s3">1</span><span class="s1">);</span><span class="s4">return</span><span class="s1">!</span><span class="s2">i</span><span class="s1">||</span><span class="s2">i</span><span class="s1">&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">t</span><span class="s1">:</span><span class="s2">e</span><span class="s1">[</span><span class="s2">i</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]}));</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">languageDataAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">ct</span><span class="s1">)){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of s</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">[</span><span class="s2">t</span><span class="s1">])}}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s2">charCategorizer</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">Nt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">languageDataAt</span><span class="s1">(</span><span class="s0">&quot;wordChars&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">))}</span><span class="s2">wordAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">text</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">from</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">length</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">charCategorizer</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">-</span><span class="s2">n</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">-</span><span class="s2">n</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">M</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s4">false</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">))!=</span><span class="s2">Ot</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">while</span><span class="s1">(</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">M</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">l</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))!=</span><span class="s2">Ot</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">return </span><span class="s2">r</span><span class="s1">==</span><span class="s2">l</span><span class="s1">?</span><span class="s4">null</span><span class="s1">:</span><span class="s2">V</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">r</span><span class="s1">+</span><span class="s2">n</span><span class="s1">,</span><span class="s2">l</span><span class="s1">+</span><span class="s2">n</span><span class="s1">)}}</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">allowMultipleSelections</span><span class="s1">=</span><span class="s2">ut</span><span class="s1">;</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">tabSize</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s2">combine</span><span class="s1">:</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]:</span><span class="s3">4</span><span class="s1">});</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">lineSeparator</span><span class="s1">=</span><span class="s2">dt</span><span class="s1">;</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">readOnly</span><span class="s1">=</span><span class="s2">wt</span><span class="s1">;</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">phrases</span><span class="s1">=</span><span class="s2">G</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s2">compare</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">i</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">every</span><span class="s1">((</span><span class="s2">n</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]==</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]))}});</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">languageData</span><span class="s1">=</span><span class="s2">ct</span><span class="s1">;</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">changeFilter</span><span class="s1">=</span><span class="s2">gt</span><span class="s1">;</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">transactionFilter</span><span class="s1">=</span><span class="s2">pt</span><span class="s1">;</span><span class="s2">Dt</span><span class="s1">.</span><span class="s2">transactionExtender</span><span class="s1">=</span><span class="s2">mt</span><span class="s1">;</span><span class="s2">rt</span><span class="s1">.</span><span class="s2">reconfigure</span><span class="s1">=</span><span class="s2">yt</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">function </span><span class="s2">Jt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">={}){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">={};</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s of t</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">t</span><span class="s1">],</span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">t</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">)</span><span class="s2">i</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">===</span><span class="s2">e</span><span class="s1">||</span><span class="s2">e</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">);</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))</span><span class="s2">i</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=</span><span class="s2">n</span><span class="s1">[</span><span class="s2">t</span><span class="s1">](</span><span class="s2">r</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">else throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Config merge conflict for field &quot;</span><span class="s1">+</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s </span><span class="s4">in </span><span class="s2">e</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]===</span><span class="s2">undefined</span><span class="s1">)</span><span class="s2">i</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">];</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s4">class </span><span class="s2">Lt</span><span class="s1">{</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">==</span><span class="s2">t</span><span class="s1">}</span><span class="s2">range</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">jt</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">)}}</span><span class="s2">Lt</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">=</span><span class="s2">Lt</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">Lt</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">point</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s2">Lt</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">mapMode</span><span class="s1">=</span><span class="s2">B</span><span class="s1">.</span><span class="s2">TrackDel</span><span class="s1">;</span><span class="s4">class </span><span class="s2">jt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">n</span><span class="s1">}</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">jt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">qt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">-</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">}</span><span class="s4">class </span><span class="s2">$t</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}</span><span class="s2">get length</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">]}</span><span class="s2">findIndex</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;;){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">==</span><span class="s2">l</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">r</span><span class="s1">+</span><span class="s2">l</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">s</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]-</span><span class="s2">t</span><span class="s1">||(</span><span class="s2">n</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">endSide</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">startSide</span><span class="s1">)-</span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s2">r</span><span class="s1">)</span><span class="s4">return </span><span class="s2">h</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">?</span><span class="s2">r</span><span class="s1">:</span><span class="s2">l</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">else </span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">}}</span><span class="s2">between</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,-</span><span class="s3">1e9</span><span class="s1">,</span><span class="s4">true</span><span class="s1">),</span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">findIndex</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s3">1e9</span><span class="s1">,</span><span class="s4">false</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">r</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]+</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]+</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])===</span><span class="s4">false</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">}</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=[],</span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">r</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">h</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">h</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s2">h</span><span class="s1">],</span><span class="s2">a</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">[</span><span class="s2">h</span><span class="s1">]+</span><span class="s2">t</span><span class="s1">,</span><span class="s2">f</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">[</span><span class="s2">h</span><span class="s1">]+</span><span class="s2">t</span><span class="s1">,</span><span class="s2">c</span><span class="s1">,</span><span class="s2">u</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">==</span><span class="s2">f</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">,</span><span class="s2">o</span><span class="s1">.</span><span class="s2">mapMode</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">null</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s2">c</span><span class="s1">=</span><span class="s2">u</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">!=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">){</span><span class="s2">u</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">u</span><span class="s1">&lt;</span><span class="s2">c</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">}}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">c</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">);</span><span class="s2">u</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s2">f</span><span class="s1">,</span><span class="s2">o</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">c</span><span class="s1">&gt;</span><span class="s2">u</span><span class="s1">||</span><span class="s2">c</span><span class="s1">==</span><span class="s2">u</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">&lt;=</span><span class="s3">0</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">}</span><span class="s4">if</span><span class="s1">((</span><span class="s2">u</span><span class="s1">-</span><span class="s2">c</span><span class="s1">||</span><span class="s2">o</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">-</span><span class="s2">o</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">r</span><span class="s1">=</span><span class="s2">c</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">point</span><span class="s1">)</span><span class="s2">l</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">u</span><span class="s1">-</span><span class="s2">c</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">o</span><span class="s1">);</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">c</span><span class="s1">-</span><span class="s2">r</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">u</span><span class="s1">-</span><span class="s2">r</span><span class="s1">)}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">mapped</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s4">new </span><span class="s2">$t</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">l</span><span class="s1">):</span><span class="s4">null</span><span class="s1">,</span><span class="s2">pos</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}}}</span><span class="s4">class </span><span class="s2">_t</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">_t</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s2">get length</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkEnd</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)}</span><span class="s2">get size</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">)</span><span class="s4">return </span><span class="s3">0</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">.</span><span class="s2">size</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">)</span><span class="s2">t</span><span class="s1">+=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">chunkEnd</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s2">t</span><span class="s1">].</span><span class="s2">length</span><span class="s1">}</span><span class="s2">update</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">add</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=[],</span><span class="s2">sort</span><span class="s1">:</span><span class="s2">n</span><span class="s1">=</span><span class="s4">false</span><span class="s1">,</span><span class="s2">filterFrom</span><span class="s1">:</span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">filterTo</span><span class="s1">:</span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">&amp;&amp;!</span><span class="s2">r</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">().</span><span class="s2">sort</span><span class="s1">(</span><span class="s2">qt</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">)</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">_t</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">e</span><span class="s1">):</span><span class="s4">this</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Ut</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">).</span><span class="s2">goto</span><span class="s1">(</span><span class="s3">0</span><span class="s1">),</span><span class="s2">h</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">o</span><span class="s1">=[];</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Vt</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">||</span><span class="s2">h</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">from</span><span class="s1">-</span><span class="s2">e</span><span class="s1">[</span><span class="s2">h</span><span class="s1">].</span><span class="s2">from</span><span class="s1">||</span><span class="s2">l</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">-</span><span class="s2">e</span><span class="s1">[</span><span class="s2">h</span><span class="s1">].</span><span class="s2">value</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">)&gt;=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">h</span><span class="s1">++];</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">a</span><span class="s1">.</span><span class="s2">addInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">value</span><span class="s1">))</span><span class="s2">o</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">==</span><span class="s3">1</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;(</span><span class="s2">h</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkEnd</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">)&lt;</span><span class="s2">e</span><span class="s1">[</span><span class="s2">h</span><span class="s1">].</span><span class="s2">from</span><span class="s1">)&amp;&amp;(!</span><span class="s2">r</span><span class="s1">||</span><span class="s2">i</span><span class="s1">&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkEnd</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">)||</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">[</span><span class="s2">l</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">])&amp;&amp;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">addChunk</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">[</span><span class="s2">l</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">],</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s2">l</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">])){</span><span class="s2">l</span><span class="s1">.</span><span class="s2">nextChunk</span><span class="s1">()}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">||</span><span class="s2">i</span><span class="s1">&gt;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">to</span><span class="s1">||</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">from</span><span class="s1">||</span><span class="s2">r</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">a</span><span class="s1">.</span><span class="s2">addInner</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">))</span><span class="s2">o</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">jt</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">))}</span><span class="s2">l</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}}</span><span class="s4">return </span><span class="s2">a</span><span class="s1">.</span><span class="s2">finishInner</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">&amp;&amp;!</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">_t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">.</span><span class="s2">update</span><span class="s1">({</span><span class="s2">add</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">filter</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">filterFrom</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">filterTo</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}))}</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[],</span><span class="s2">n</span><span class="s1">=[],</span><span class="s2">i</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">[</span><span class="s2">r</span><span class="s1">],</span><span class="s2">l</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s2">r</span><span class="s1">];</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">touchesRange</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">s</span><span class="s1">+</span><span class="s2">l</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">===</span><span class="s4">false</span><span class="s1">){</span><span class="s2">i</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">l</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s2">s</span><span class="s1">))}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">===</span><span class="s4">true</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">mapped</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">pos</span><span class="s1">:</span><span class="s2">h</span><span class="s1">}=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">){</span><span class="s2">i</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">h</span><span class="s1">)}}}</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s4">new </span><span class="s2">_t</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">||</span><span class="s2">_t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s2">between</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">&lt;=</span><span class="s2">s</span><span class="s1">+</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">between</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">-</span><span class="s2">s</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)===</span><span class="s4">false</span><span class="s1">)</span><span class="s4">return</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">.</span><span class="s2">between</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">iter</span><span class="s1">(</span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">return </span><span class="s2">Gt</span><span class="s1">.</span><span class="s2">from</span><span class="s1">([</span><span class="s4">this</span><span class="s1">]).</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">get isEmpty</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">==</span><span class="s4">this</span><span class="s1">}</span><span class="s4">static </span><span class="s2">iter</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">return </span><span class="s2">Gt</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">t</span><span class="s1">).</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">compare</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">&gt;=</span><span class="s2">s</span><span class="s1">));</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">&gt;=</span><span class="s2">s</span><span class="s1">));</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">Wt</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Kt</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">h</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Kt</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">h</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">iterGaps</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)=&gt;</span><span class="s2">Qt</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s2">Qt</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">eq</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s4">null</span><span class="s1">)</span><span class="s2">i</span><span class="s1">=</span><span class="s3">1e9</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">));</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">filter</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return true</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">Wt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Kt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s3">0</span><span class="s1">).</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">n</span><span class="s1">),</span><span class="s2">o</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Kt</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,</span><span class="s3">0</span><span class="s1">).</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">to</span><span class="s1">!=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">to</span><span class="s1">||!</span><span class="s2">Xt</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">active</span><span class="s1">,</span><span class="s2">o</span><span class="s1">.</span><span class="s2">active</span><span class="s1">)||</span><span class="s2">h</span><span class="s1">.</span><span class="s2">point</span><span class="s1">&amp;&amp;(!</span><span class="s2">o</span><span class="s1">.</span><span class="s2">point</span><span class="s1">||!</span><span class="s2">h</span><span class="s1">.</span><span class="s2">point</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">point</span><span class="s1">)))</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&gt;</span><span class="s2">i</span><span class="s1">)</span><span class="s4">return true</span><span class="s1">;</span><span class="s2">h</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s2">o</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}}</span><span class="s4">static </span><span class="s2">spans</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Kt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,</span><span class="s2">s</span><span class="s1">).</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">openStart</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">point</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">activeForPoint</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">pointFrom</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">?</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">point</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">:</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s2">i</span><span class="s1">.</span><span class="s2">point</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">point</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">pointRank</span><span class="s1">);</span><span class="s2">h</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">openEnd</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;</span><span class="s2">l</span><span class="s1">){</span><span class="s2">i</span><span class="s1">.</span><span class="s2">span</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">active</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s2">h</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">openEnd</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&gt;</span><span class="s2">n</span><span class="s1">)</span><span class="s4">return </span><span class="s2">h</span><span class="s1">+(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">point</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&gt;</span><span class="s2">n</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">);</span><span class="s2">l</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}}</span><span class="s4">static </span><span class="s2">of</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">false</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Vt</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t </span><span class="s4">instanceof </span><span class="s2">jt</span><span class="s1">?[</span><span class="s2">t</span><span class="s1">]:</span><span class="s2">e</span><span class="s1">?</span><span class="s2">zt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">):</span><span class="s2">t</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">add</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">);</span><span class="s4">return </span><span class="s2">n</span><span class="s1">.</span><span class="s2">finish</span><span class="s1">()}</span><span class="s4">static </span><span class="s2">join</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return </span><span class="s2">_t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">2</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">--){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s2">i</span><span class="s1">!=</span><span class="s2">_t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">_t</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}}</span><span class="s2">_t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">=</span><span class="s4">new </span><span class="s2">_t</span><span class="s1">([],[],</span><span class="s4">null</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">);</span><span class="s4">function </span><span class="s2">zt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">1</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">],</span><span class="s2">n</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">qt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)&gt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">().</span><span class="s2">sort</span><span class="s1">(</span><span class="s2">qt</span><span class="s1">);</span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s2">_t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">=</span><span class="s2">_t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">;</span><span class="s4">class </span><span class="s2">Vt</span><span class="s1">{</span><span class="s2">finishChunk</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunks</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">$t</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkStart</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkStart</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMaxPoint</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMaxPoint</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=[]}}</span><span class="s2">constructor</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunks</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkStart</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">last</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lastFrom</span><span class="s1">=-</span><span class="s3">1e9</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lastTo</span><span class="s1">=-</span><span class="s3">1e9</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMaxPoint</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">=</span><span class="s4">null</span><span class="s1">}</span><span class="s2">add</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">addInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">))(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">||(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Vt</span><span class="s1">)).</span><span class="s2">add</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">addInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lastTo</span><span class="s1">||</span><span class="s2">n</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">last</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;(</span><span class="s2">t</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lastFrom</span><span class="s1">||</span><span class="s2">n</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">last</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Ranges must be added sorted by `from` position and `startSide`&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">250</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">finishChunk</span><span class="s1">(</span><span class="s4">true</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkStart</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkStart</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkStart</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkStart</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">last</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lastFrom</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lastTo</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">point</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return true</span><span class="s1">}</span><span class="s2">addChunk</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">((</span><span class="s2">t</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lastTo</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">startSide</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">last</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">finishChunk</span><span class="s1">(</span><span class="s4">true</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMaxPoint</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMaxPoint</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunks</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">last</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s2">n</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lastFrom</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]+</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">lastTo</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">to</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]+</span><span class="s2">t</span><span class="s1">;</span><span class="s4">return true</span><span class="s1">}</span><span class="s2">finish</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">finishInner</span><span class="s1">(</span><span class="s2">_t</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">)}</span><span class="s2">finishInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">finishChunk</span><span class="s1">(</span><span class="s4">false</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunks</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">_t</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunks</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">.</span><span class="s2">finishInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">):</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMaxPoint</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">Wt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of t</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">t</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s2">t</span><span class="s1">].</span><span class="s2">maxPoint</span><span class="s1">&lt;=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s2">t</span><span class="s1">],</span><span class="s2">r</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Set</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r of e</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">t</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">&amp;&amp;(</span><span class="s2">n</span><span class="s1">?</span><span class="s2">n</span><span class="s1">.</span><span class="s2">mapPos</span><span class="s1">(</span><span class="s2">e</span><span class="s1">):</span><span class="s2">e</span><span class="s1">)==</span><span class="s2">r</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]&amp;&amp;!(</span><span class="s2">n</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">n</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">touchesRange</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">e</span><span class="s1">+</span><span class="s2">r</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s2">t</span><span class="s1">].</span><span class="s2">length</span><span class="s1">)))</span><span class="s2">s</span><span class="s1">.</span><span class="s2">add</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s2">t</span><span class="s1">])}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s4">class </span><span class="s2">Ut</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minPoint</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rank</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}</span><span class="s2">get startSide</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">:</span><span class="s3">0</span><span class="s1">}</span><span class="s2">get endSide</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">:</span><span class="s3">0</span><span class="s1">}</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=-</span><span class="s3">1e9</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">gotoInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s4">false</span><span class="s1">);</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">gotoInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">while</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(!(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunkEnd</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">)&lt;</span><span class="s2">t</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minPoint</span><span class="s1">))</span><span class="s4">break</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">++;</span><span class="s2">n</span><span class="s1">=</span><span class="s4">false</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">].</span><span class="s2">findIndex</span><span class="s1">(</span><span class="s2">t</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">],</span><span class="s2">e</span><span class="s1">,</span><span class="s4">true</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setRangeIndex</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">((</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s2">t</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">-</span><span class="s2">e</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">gotoInner</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s4">true</span><span class="s1">)}</span><span class="s2">next</span><span class="s1">(){</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s3">1e9</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">break</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunkPos</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">],</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">];</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">t</span><span class="s1">+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">to</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setRangeIndex</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">+</span><span class="s3">1</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minPoint</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">point</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&gt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minPoint</span><span class="s1">)</span><span class="s4">break</span><span class="s1">}}}</span><span class="s2">setRangeIndex</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">].</span><span class="s2">value</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">++;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">){</span><span class="s4">while</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">skip</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">layer</span><span class="s1">.</span><span class="s2">chunk</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">]))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">++}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">=</span><span class="s3">0</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}}</span><span class="s2">nextChunk</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkIndex</span><span class="s1">++;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rangeIndex</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s2">compare</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rank</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rank</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">-</span><span class="s2">t</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">Gt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">static </span><span class="s2">from</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">null</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">];!</span><span class="s2">r</span><span class="s1">.</span><span class="s2">isEmpty</span><span class="s1">;</span><span class="s2">r</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">nextLayer</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">maxPoint</span><span class="s1">&gt;=</span><span class="s2">n</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">new </span><span class="s2">Ut</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">))}}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">?</span><span class="s2">i</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]:</span><span class="s4">new </span><span class="s2">Gt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)}</span><span class="s2">get startSide</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">:</span><span class="s3">0</span><span class="s1">}</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=-</span><span class="s3">1e9</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">--)</span><span class="s2">Ht</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n of </span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;&gt;</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">--)</span><span class="s2">Ht</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">if</span><span class="s1">((</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s2">t</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">-</span><span class="s2">e</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s2">next</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s3">1e9</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rank</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">[</span><span class="s3">0</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">rank</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">rank</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s2">Ht</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">heap</span><span class="s1">,</span><span class="s3">0</span><span class="s1">)}}}</span><span class="s4">function </span><span class="s2">Ht</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">];;){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=(</span><span class="s2">e</span><span class="s1">&lt;&lt;</span><span class="s3">1</span><span class="s1">)+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&gt;=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">compare</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">])&gt;=</span><span class="s3">0</span><span class="s1">){</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">];</span><span class="s2">i</span><span class="s1">++}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">compare</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]=</span><span class="s2">n</span><span class="s1">;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">s</span><span class="s1">;</span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">Kt</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minPoint</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeRank</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minActive</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">point</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pointFrom</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pointRank</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=-</span><span class="s3">1e9</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">openStart</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">=</span><span class="s2">Gt</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=-</span><span class="s3">1e9</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">.</span><span class="s2">length</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">.</span><span class="s2">length</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeRank</span><span class="s1">.</span><span class="s2">length</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minActive</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">openStart</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">while</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minActive</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">&amp;&amp;(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minActive</span><span class="s1">]-</span><span class="s2">t</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minActive</span><span class="s1">].</span><span class="s2">endSide</span><span class="s1">-</span><span class="s2">e</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">removeActive</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minActive</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">removeActive</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s2">Yt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s2">Yt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s2">Yt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeRank</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minActive</span><span class="s1">=</span><span class="s2">te</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">)}</span><span class="s2">addActive</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,{</span><span class="s2">value</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">rank</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeRank</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;(</span><span class="s2">s</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeRank</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]||</span><span class="s2">i</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">[</span><span class="s2">e</span><span class="s1">])&gt;</span><span class="s3">0</span><span class="s1">)</span><span class="s2">e</span><span class="s1">++;</span><span class="s2">Zt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s2">Zt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s2">Zt</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeRank</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s2">Zt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">from</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minActive</span><span class="s1">=</span><span class="s2">te</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">)}</span><span class="s2">next</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">point</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">point</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">openStart</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?[]:</span><span class="s4">null</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">minActive</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&gt;-</span><span class="s3">1</span><span class="s1">&amp;&amp;(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">from</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">endSide</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]&gt;</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">[</span><span class="s2">i</span><span class="s1">].</span><span class="s2">endSide</span><span class="s1">;</span><span class="s4">break</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">removeActive</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)</span><span class="s2">Yt</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">value</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">=</span><span class="s3">1e9</span><span class="s1">;</span><span class="s4">break</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">from</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">startSide</span><span class="s1">;</span><span class="s4">break</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">point</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">addActive</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">to</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">to</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">point</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pointFrom</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">from</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pointRank</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">rank</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">to</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">forward</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">);</span><span class="s4">break</span><span class="s1">}}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">openStart</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]&lt;</span><span class="s2">t</span><span class="s1">;</span><span class="s2">e</span><span class="s1">--)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">openStart</span><span class="s1">++}}</span><span class="s2">activeForPoint</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">--){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeRank</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">pointRank</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]&gt;</span><span class="s2">t</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]==</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">[</span><span class="s2">n</span><span class="s1">].</span><span class="s2">endSide</span><span class="s1">&gt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">point</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">active</span><span class="s1">[</span><span class="s2">n</span><span class="s1">])}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">reverse</span><span class="s1">()}</span><span class="s2">openEnd</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">activeTo</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]&gt;</span><span class="s2">t</span><span class="s1">;</span><span class="s2">n</span><span class="s1">--)</span><span class="s2">e</span><span class="s1">++;</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">Qt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">goto</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s2">s</span><span class="s1">;</span><span class="s4">let </span><span class="s2">h</span><span class="s1">=</span><span class="s2">i</span><span class="s1">,</span><span class="s2">o</span><span class="s1">=</span><span class="s2">i</span><span class="s1">-</span><span class="s2">e</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">+</span><span class="s2">o</span><span class="s1">-</span><span class="s2">n</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">-</span><span class="s2">n</span><span class="s1">.</span><span class="s2">endSide</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">+</span><span class="s2">o</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">a</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">l</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">point</span><span class="s1">||</span><span class="s2">n</span><span class="s1">.</span><span class="s2">point</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">point</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">point</span><span class="s1">&amp;&amp;(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">point</span><span class="s1">==</span><span class="s2">n</span><span class="s1">.</span><span class="s2">point</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">point</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">point</span><span class="s1">))&amp;&amp;</span><span class="s2">Xt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">activeForPoint</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">),</span><span class="s2">n</span><span class="s1">.</span><span class="s2">activeForPoint</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">to</span><span class="s1">))))</span><span class="s2">r</span><span class="s1">.</span><span class="s2">comparePoint</span><span class="s1">(</span><span class="s2">h</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">point</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">point</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&gt;</span><span class="s2">h</span><span class="s1">&amp;&amp;!</span><span class="s2">Xt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">active</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">active</span><span class="s1">))</span><span class="s2">r</span><span class="s1">.</span><span class="s2">compareRange</span><span class="s1">(</span><span class="s2">h</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">active</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">active</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&gt;</span><span class="s2">l</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s4">if</span><span class="s1">((</span><span class="s2">e</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">openEnd</span><span class="s1">!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">openEnd</span><span class="s1">)&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">boundChange</span><span class="s1">)</span><span class="s2">r</span><span class="s1">.</span><span class="s2">boundChange</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s2">h</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&lt;=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">)</span><span class="s2">n</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}}</span><span class="s4">function </span><span class="s2">Xt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]!=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]&amp;&amp;!</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">].</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]))</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">function </span><span class="s2">Yt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">;</span><span class="s2">n</span><span class="s1">++)</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">+</span><span class="s3">1</span><span class="s1">];</span><span class="s2">t</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">()}</span><span class="s4">function </span><span class="s2">Zt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&gt;=</span><span class="s2">e</span><span class="s1">;</span><span class="s2">i</span><span class="s1">--)</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">]=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span><span class="s2">t</span><span class="s1">[</span><span class="s2">e</span><span class="s1">]=</span><span class="s2">n</span><span class="s1">}</span><span class="s4">function </span><span class="s2">te</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s3">1e9</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">((</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]-</span><span class="s2">i</span><span class="s1">||</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">].</span><span class="s2">endSide</span><span class="s1">-</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">].</span><span class="s2">endSide</span><span class="s1">)&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]}</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ee</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">n</span><span class="s1">;){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)==</span><span class="s3">9</span><span class="s1">){</span><span class="s2">i</span><span class="s1">+=</span><span class="s2">e</span><span class="s1">-</span><span class="s2">i</span><span class="s1">%</span><span class="s2">e</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">i</span><span class="s1">++;</span><span class="s2">s</span><span class="s1">=</span><span class="s2">M</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">}</span><span class="s4">function </span><span class="s2">ne</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;;){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&gt;=</span><span class="s2">e</span><span class="s1">)</span><span class="s4">return </span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">break</span><span class="s1">;</span><span class="s2">r</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)==</span><span class="s3">9</span><span class="s1">?</span><span class="s2">n</span><span class="s1">-</span><span class="s2">r</span><span class="s1">%</span><span class="s2">n</span><span class="s1">:</span><span class="s3">1</span><span class="s1">;</span><span class="s2">s</span><span class="s1">=</span><span class="s2">M</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">i</span><span class="s1">===</span><span class="s4">true</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}}}]);</span></pre>
</body>
</html>