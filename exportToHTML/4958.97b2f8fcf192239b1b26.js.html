<html>
<head>
<title>4958.97b2f8fcf192239b1b26.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #cf8e6d;}
.s5 { color: #42c3d4;}
.ln { color: #4b5059; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
4958.97b2f8fcf192239b1b26.js</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">&quot;use strict&quot;</span><span class="s1">;(</span><span class="s2">self</span><span class="s1">[</span><span class="s0">&quot;webpackChunk_jupyterlab_application_top&quot;</span><span class="s1">]=</span><span class="s2">self</span><span class="s1">[</span><span class="s0">&quot;webpackChunk_jupyterlab_application_top&quot;</span><span class="s1">]||[]).</span><span class="s2">push</span><span class="s1">([[</span><span class="s3">4958</span><span class="s1">],{</span><span class="s3">44958</span><span class="s1">:(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)=&gt;{</span><span class="s2">i</span><span class="s1">.</span><span class="s2">r</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">i</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,{</span><span class="s2">RegExpCursor</span><span class="s1">:()=&gt;</span><span class="s2">u</span><span class="s1">,</span><span class="s2">SearchCursor</span><span class="s1">:()=&gt;</span><span class="s2">a</span><span class="s1">,</span><span class="s2">SearchQuery</span><span class="s1">:()=&gt;</span><span class="s2">I</span><span class="s1">,</span><span class="s2">closeSearchPanel</span><span class="s1">:()=&gt;</span><span class="s2">de</span><span class="s1">,</span><span class="s2">findNext</span><span class="s1">:()=&gt;</span><span class="s2">ie</span><span class="s1">,</span><span class="s2">findPrevious</span><span class="s1">:()=&gt;</span><span class="s2">re</span><span class="s1">,</span><span class="s2">getSearchQuery</span><span class="s1">:()=&gt;</span><span class="s2">U</span><span class="s1">,</span><span class="s2">gotoLine</span><span class="s1">:()=&gt;</span><span class="s2">w</span><span class="s1">,</span><span class="s2">highlightSelectionMatches</span><span class="s1">:()=&gt;</span><span class="s2">M</span><span class="s1">,</span><span class="s2">openSearchPanel</span><span class="s1">:()=&gt;</span><span class="s2">fe</span><span class="s1">,</span><span class="s2">replaceAll</span><span class="s1">:()=&gt;</span><span class="s2">le</span><span class="s1">,</span><span class="s2">replaceNext</span><span class="s1">:()=&gt;</span><span class="s2">oe</span><span class="s1">,</span><span class="s2">search</span><span class="s1">:()=&gt;</span><span class="s2">V</span><span class="s1">,</span><span class="s2">searchKeymap</span><span class="s1">:()=&gt;</span><span class="s2">me</span><span class="s1">,</span><span class="s2">searchPanelOpen</span><span class="s1">:()=&gt;</span><span class="s2">J</span><span class="s1">,</span><span class="s2">selectMatches</span><span class="s1">:()=&gt;</span><span class="s2">ne</span><span class="s1">,</span><span class="s2">selectNextOccurrence</span><span class="s1">:()=&gt;</span><span class="s2">F</span><span class="s1">,</span><span class="s2">selectSelectionMatches</span><span class="s1">:()=&gt;</span><span class="s2">se</span><span class="s1">,</span><span class="s2">setSearchQuery</span><span class="s1">:()=&gt;</span><span class="s2">K</span><span class="s1">});</span><span class="s4">var </span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">(</span><span class="s3">22819</span><span class="s1">);</span><span class="s4">var </span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">(</span><span class="s3">71674</span><span class="s1">);</span><span class="s4">function </span><span class="s2">s</span><span class="s1">(){</span><span class="s4">var </span><span class="s2">e</span><span class="s1">=</span><span class="s2">arguments</span><span class="s1">[</span><span class="s3">0</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">e</span><span class="s1">==</span><span class="s0">&quot;string&quot;</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s2">document</span><span class="s1">.</span><span class="s2">createElement</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">var </span><span class="s2">t</span><span class="s1">=</span><span class="s3">1</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s2">arguments</span><span class="s1">[</span><span class="s3">1</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&amp;&amp;</span><span class="s4">typeof </span><span class="s2">i</span><span class="s1">==</span><span class="s0">&quot;object&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">nodeType</span><span class="s1">==</span><span class="s4">null</span><span class="s1">&amp;&amp;!</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">var </span><span class="s2">r </span><span class="s4">in </span><span class="s2">i</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)){</span><span class="s4">var </span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">[</span><span class="s2">r</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">n</span><span class="s1">==</span><span class="s0">&quot;string&quot;</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">setAttribute</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">)</span><span class="s2">e</span><span class="s1">[</span><span class="s2">r</span><span class="s1">]=</span><span class="s2">n</span><span class="s1">}</span><span class="s2">t</span><span class="s1">++}</span><span class="s4">for</span><span class="s1">(;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">arguments</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">t</span><span class="s1">++)</span><span class="s2">o</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">arguments</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s4">function </span><span class="s2">o</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;string&quot;</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">appendChild</span><span class="s1">(</span><span class="s2">document</span><span class="s1">.</span><span class="s2">createTextNode</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">null</span><span class="s1">){}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nodeType</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">appendChild</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">var </span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">i</span><span class="s1">++)</span><span class="s2">o</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">[</span><span class="s2">i</span><span class="s1">])}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">throw new </span><span class="s2">RangeError</span><span class="s1">(</span><span class="s0">&quot;Unsupported child node: &quot;</span><span class="s1">+</span><span class="s2">t</span><span class="s1">)}}</span><span class="s4">const </span><span class="s2">l</span><span class="s1">=</span><span class="s4">typeof </span><span class="s2">String</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">normalize</span><span class="s1">==</span><span class="s0">&quot;function&quot;</span><span class="s1">?</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">normalize</span><span class="s1">(</span><span class="s0">&quot;NFKD&quot;</span><span class="s1">):</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">;</span><span class="s4">class </span><span class="s2">a</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">test</span><span class="s1">=</span><span class="s2">s</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">={</span><span class="s2">from</span><span class="s1">:</span><span class="s3">0</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s3">0</span><span class="s1">};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buffer</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferPos</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">iterRange</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferStart</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalize</span><span class="s1">=</span><span class="s2">n</span><span class="s1">?</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">n</span><span class="s1">(</span><span class="s2">l</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)):</span><span class="s2">l</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalize</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">peek</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferPos</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buffer</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferStart</span><span class="s1">+=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buffer</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">.</span><span class="s2">done</span><span class="s1">)</span><span class="s4">return</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferPos</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buffer</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">.</span><span class="s2">value</span><span class="s1">}</span><span class="s4">return</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">codePointAt</span><span class="s1">)(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buffer</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferPos</span><span class="s1">)}</span><span class="s2">next</span><span class="s1">(){</span><span class="s4">while</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">.</span><span class="s2">pop</span><span class="s1">();</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">nextOverlapping</span><span class="s1">()}</span><span class="s2">nextOverlapping</span><span class="s1">(){</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">peek</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">}</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">fromCodePoint</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferStart</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferPos</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferPos</span><span class="s1">+=(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">codePointSize</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">normalize</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;;</span><span class="s2">n</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">match</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferPos</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferStart</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">==</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">o</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">}</span><span class="s4">break</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">==</span><span class="s2">i</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)==</span><span class="s2">e</span><span class="s1">)</span><span class="s2">s</span><span class="s1">++}}}</span><span class="s2">match</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">n</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">n</span><span class="s1">+=</span><span class="s3">2</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">[</span><span class="s2">n</span><span class="s1">],</span><span class="s2">s</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)==</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">){</span><span class="s2">r</span><span class="s1">={</span><span class="s2">from</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">[</span><span class="s2">n</span><span class="s1">+</span><span class="s3">1</span><span class="s1">],</span><span class="s2">to</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">[</span><span class="s2">n</span><span class="s1">]++;</span><span class="s2">s</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s3">2</span><span class="s1">);</span><span class="s2">n</span><span class="s1">-=</span><span class="s3">2</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s3">0</span><span class="s1">)==</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">1</span><span class="s1">)</span><span class="s2">r</span><span class="s1">={</span><span class="s2">from</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">i</span><span class="s1">};</span><span class="s4">else this</span><span class="s1">.</span><span class="s2">matches</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">1</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">test</span><span class="s1">&amp;&amp;!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">buffer</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">bufferStart</span><span class="s1">))</span><span class="s2">r</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">return </span><span class="s2">r</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">Symbol</span><span class="s1">!=</span><span class="s0">&quot;undefined&quot;</span><span class="s1">)</span><span class="s2">a</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">[</span><span class="s2">Symbol</span><span class="s1">.</span><span class="s2">iterator</span><span class="s1">]=</span><span class="s4">function</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">};</span><span class="s4">const </span><span class="s2">c</span><span class="s1">={</span><span class="s2">from</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">match</span><span class="s1">:</span><span class="s5">/.*/</span><span class="s1">.</span><span class="s2">exec</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">)};</span><span class="s4">const </span><span class="s2">h</span><span class="s1">=</span><span class="s0">&quot;gm&quot;</span><span class="s1">+(</span><span class="s5">/x/</span><span class="s1">.</span><span class="s2">unicode</span><span class="s1">==</span><span class="s4">null</span><span class="s1">?</span><span class="s0">&quot;&quot;</span><span class="s1">:</span><span class="s0">&quot;u&quot;</span><span class="s1">);</span><span class="s4">class </span><span class="s2">u</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">c</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s5">/\\[sWDnr]|\n|\r|\[\^/</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))</span><span class="s4">return new </span><span class="s2">m</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">re</span><span class="s1">=</span><span class="s4">new </span><span class="s2">RegExp</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">h</span><span class="s1">+((</span><span class="s2">i</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">i</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">ignoreCase</span><span class="s1">)?</span><span class="s0">&quot;i&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">test</span><span class="s1">=</span><span class="s2">i</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">i</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">test</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">();</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">r</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matchPos</span><span class="s1">=</span><span class="s2">g</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getLine</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">)}</span><span class="s2">getLine</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">.</span><span class="s2">next</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">.</span><span class="s2">lineBreak</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">iter</span><span class="s1">.</span><span class="s2">next</span><span class="s1">()}}</span><span class="s2">nextLine</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">.</span><span class="s2">length</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">else this</span><span class="s1">.</span><span class="s2">getLine</span><span class="s1">(</span><span class="s3">0</span><span class="s1">)}</span><span class="s2">next</span><span class="s1">(){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matchPos</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">;;){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">re</span><span class="s1">.</span><span class="s2">lastIndex</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matchPos</span><span class="s1">&lt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">re</span><span class="s1">.</span><span class="s2">exec</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">+</span><span class="s2">t</span><span class="s1">.</span><span class="s2">index</span><span class="s1">,</span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">+</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">length</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matchPos</span><span class="s1">=</span><span class="s2">g</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">,</span><span class="s2">r</span><span class="s1">+(</span><span class="s2">i</span><span class="s1">==</span><span class="s2">r</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLine</span><span class="s1">();</span><span class="s4">if</span><span class="s1">((</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">r</span><span class="s1">||</span><span class="s2">i</span><span class="s1">&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)&amp;&amp;(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">test</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">={</span><span class="s2">from</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">match</span><span class="s1">:</span><span class="s2">t</span><span class="s1">};</span><span class="s4">return this</span><span class="s1">}</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matchPos</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLineStart</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">curLine</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nextLine</span><span class="s1">();</span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">}}}}</span><span class="s4">const </span><span class="s2">f</span><span class="s1">=</span><span class="s4">new </span><span class="s2">WeakMap</span><span class="s1">;</span><span class="s4">class </span><span class="s2">d</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s2">get to</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">from</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s4">static </span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">f</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">||</span><span class="s2">r</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&gt;=</span><span class="s2">i</span><span class="s1">||</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&lt;=</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">new </span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sliceString</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">));</span><span class="s2">f</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s4">return </span><span class="s2">r</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">==</span><span class="s2">i</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">;</span><span class="s4">let</span><span class="s1">{</span><span class="s2">text</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">from</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}=</span><span class="s2">r</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">){</span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sliceString</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)+</span><span class="s2">n</span><span class="s1">;</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">)</span><span class="s2">n</span><span class="s1">+=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sliceString</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s2">f</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">new </span><span class="s2">d</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">));</span><span class="s4">return new </span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">t</span><span class="s1">-</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">-</span><span class="s2">s</span><span class="s1">))}}</span><span class="s4">class </span><span class="s2">m</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">n</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">c</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matchPos</span><span class="s1">=</span><span class="s2">g</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">re</span><span class="s1">=</span><span class="s4">new </span><span class="s2">RegExp</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">h</span><span class="s1">+((</span><span class="s2">i</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">i</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">ignoreCase</span><span class="s1">)?</span><span class="s0">&quot;i&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">test</span><span class="s1">=</span><span class="s2">i</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">i</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">test</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">=</span><span class="s2">d</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkEnd</span><span class="s1">(</span><span class="s2">r</span><span class="s1">+</span><span class="s3">5e3</span><span class="s1">))}</span><span class="s2">chunkEnd</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">&gt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">).</span><span class="s2">to</span><span class="s1">}</span><span class="s2">next</span><span class="s1">(){</span><span class="s4">for</span><span class="s1">(;;){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">re</span><span class="s1">.</span><span class="s2">lastIndex</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matchPos</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">from</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">re</span><span class="s1">.</span><span class="s2">exec</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">text</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&amp;&amp;!</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">index</span><span class="s1">==</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">re</span><span class="s1">.</span><span class="s2">lastIndex</span><span class="s1">=</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">re</span><span class="s1">.</span><span class="s2">exec</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">text</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">from</span><span class="s1">+</span><span class="s2">t</span><span class="s1">.</span><span class="s2">index</span><span class="s1">,</span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">+</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">length</span><span class="s1">;</span><span class="s4">if</span><span class="s1">((</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&gt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">index</span><span class="s1">+</span><span class="s2">t</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">length</span><span class="s1">&lt;=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">10</span><span class="s1">)&amp;&amp;(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">test</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">value</span><span class="s1">={</span><span class="s2">from</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">match</span><span class="s1">:</span><span class="s2">t</span><span class="s1">};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">matchPos</span><span class="s1">=</span><span class="s2">g</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">,</span><span class="s2">i</span><span class="s1">+(</span><span class="s2">e</span><span class="s1">==</span><span class="s2">i</span><span class="s1">?</span><span class="s3">1</span><span class="s1">:</span><span class="s3">0</span><span class="s1">));</span><span class="s4">return this</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">to</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">to</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">done</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">=</span><span class="s2">d</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">text</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">chunkEnd</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">from</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">flat</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">length</span><span class="s1">*</span><span class="s3">2</span><span class="s1">))}}}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">Symbol</span><span class="s1">!=</span><span class="s0">&quot;undefined&quot;</span><span class="s1">){</span><span class="s2">u</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">[</span><span class="s2">Symbol</span><span class="s1">.</span><span class="s2">iterator</span><span class="s1">]=</span><span class="s2">m</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">[</span><span class="s2">Symbol</span><span class="s1">.</span><span class="s2">iterator</span><span class="s1">]=</span><span class="s4">function</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">p</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">try</span><span class="s1">{</span><span class="s4">new </span><span class="s2">RegExp</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">h</span><span class="s1">);</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">catch</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">g</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">r</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&amp;&amp;(</span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">text</span><span class="s1">.</span><span class="s2">charCodeAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">-</span><span class="s2">i</span><span class="s1">.</span><span class="s2">from</span><span class="s1">))&gt;=</span><span class="s3">56320</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s3">57344</span><span class="s1">)</span><span class="s2">t</span><span class="s1">++;</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">function </span><span class="s2">v</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">String</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">main</span><span class="s1">.</span><span class="s2">head</span><span class="s1">).</span><span class="s2">number</span><span class="s1">);</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;input&quot;</span><span class="s1">,{</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-textfield&quot;</span><span class="s1">,</span><span class="s2">name</span><span class="s1">:</span><span class="s0">&quot;line&quot;</span><span class="s1">,</span><span class="s2">value</span><span class="s1">:</span><span class="s2">t</span><span class="s1">});</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;form&quot;</span><span class="s1">,{</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-gotoLine&quot;</span><span class="s1">,</span><span class="s2">onkeydown</span><span class="s1">:</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">keyCode</span><span class="s1">==</span><span class="s3">27</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">preventDefault</span><span class="s1">();</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">x</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s4">false</span><span class="s1">)});</span><span class="s2">e</span><span class="s1">.</span><span class="s2">focus</span><span class="s1">()}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">keyCode</span><span class="s1">==</span><span class="s3">13</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">preventDefault</span><span class="s1">();</span><span class="s2">l</span><span class="s1">()}},</span><span class="s2">onsubmit</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">preventDefault</span><span class="s1">();</span><span class="s2">l</span><span class="s1">()}},</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;label&quot;</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">phrase</span><span class="s1">(</span><span class="s0">&quot;Go to line&quot;</span><span class="s1">),</span><span class="s0">&quot;: &quot;</span><span class="s1">,</span><span class="s2">i</span><span class="s1">),</span><span class="s0">&quot; &quot;</span><span class="s1">,</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;button&quot;</span><span class="s1">,{</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-button&quot;</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;submit&quot;</span><span class="s1">},</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">phrase</span><span class="s1">(</span><span class="s0">&quot;go&quot;</span><span class="s1">)));</span><span class="s4">function </span><span class="s2">l</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s5">/^([+-])?(\d+)?(:\d+)?(%)?$/</span><span class="s1">.</span><span class="s2">exec</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">let</span><span class="s1">{</span><span class="s2">state</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">,</span><span class="s2">o</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">main</span><span class="s1">.</span><span class="s2">head</span><span class="s1">);</span><span class="s4">let</span><span class="s1">[,</span><span class="s2">l</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">c</span><span class="s1">,</span><span class="s2">h</span><span class="s1">]=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">u</span><span class="s1">=</span><span class="s2">c</span><span class="s1">?+</span><span class="s2">c</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">1</span><span class="s1">):</span><span class="s3">0</span><span class="s1">;</span><span class="s4">let </span><span class="s2">f</span><span class="s1">=</span><span class="s2">a</span><span class="s1">?+</span><span class="s2">a</span><span class="s1">:</span><span class="s2">o</span><span class="s1">.</span><span class="s2">number</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">f</span><span class="s1">/</span><span class="s3">100</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">)</span><span class="s2">e</span><span class="s1">=</span><span class="s2">e</span><span class="s1">*(</span><span class="s2">l</span><span class="s1">==</span><span class="s0">&quot;-&quot;</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">1</span><span class="s1">)+</span><span class="s2">o</span><span class="s1">.</span><span class="s2">number</span><span class="s1">/</span><span class="s2">s</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">;</span><span class="s2">f</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">round</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">*</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">){</span><span class="s2">f</span><span class="s1">=</span><span class="s2">f</span><span class="s1">*(</span><span class="s2">l</span><span class="s1">==</span><span class="s0">&quot;-&quot;</span><span class="s1">?-</span><span class="s3">1</span><span class="s1">:</span><span class="s3">1</span><span class="s1">)+</span><span class="s2">o</span><span class="s1">.</span><span class="s2">number</span><span class="s1">}</span><span class="s4">let </span><span class="s2">d</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">line</span><span class="s1">(</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">1</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">lines</span><span class="s1">,</span><span class="s2">f</span><span class="s1">)));</span><span class="s4">let </span><span class="s2">m</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">(</span><span class="s2">d</span><span class="s1">.</span><span class="s2">from</span><span class="s1">+</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">u</span><span class="s1">,</span><span class="s2">d</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)));</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">effects</span><span class="s1">:[</span><span class="s2">x</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s4">false</span><span class="s1">),</span><span class="s2">r</span><span class="s1">.</span><span class="s2">EditorView</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">(</span><span class="s2">m</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,{</span><span class="s2">y</span><span class="s1">:</span><span class="s0">&quot;center&quot;</span><span class="s1">})],</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">m</span><span class="s1">});</span><span class="s2">e</span><span class="s1">.</span><span class="s2">focus</span><span class="s1">()}</span><span class="s4">return</span><span class="s1">{</span><span class="s2">dom</span><span class="s1">:</span><span class="s2">o</span><span class="s1">}}</span><span class="s4">const </span><span class="s2">x</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">StateEffect</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">const </span><span class="s2">y</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">StateField</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s2">create</span><span class="s1">(){</span><span class="s4">return true</span><span class="s1">},</span><span class="s2">update</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">)</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">is</span><span class="s1">(</span><span class="s2">x</span><span class="s1">))</span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">return </span><span class="s2">e</span><span class="s1">},</span><span class="s2">provide</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">showPanel</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,(</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">?</span><span class="s2">v</span><span class="s1">:</span><span class="s4">null</span><span class="s1">))});</span><span class="s4">const </span><span class="s2">w</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">getPanel</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">v</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=[</span><span class="s2">x</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s4">true</span><span class="s1">)];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">y</span><span class="s1">,</span><span class="s4">false</span><span class="s1">)==</span><span class="s4">null</span><span class="s1">)</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">StateEffect</span><span class="s1">.</span><span class="s2">appendConfig</span><span class="s1">.</span><span class="s2">of</span><span class="s1">([</span><span class="s2">y</span><span class="s1">,</span><span class="s2">b</span><span class="s1">]));</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">i</span><span class="s1">});</span><span class="s2">t</span><span class="s1">=(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">getPanel</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">v</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">dom</span><span class="s1">.</span><span class="s2">querySelector</span><span class="s1">(</span><span class="s0">&quot;input&quot;</span><span class="s1">).</span><span class="s2">select</span><span class="s1">();</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">const </span><span class="s2">b</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">EditorView</span><span class="s1">.</span><span class="s2">baseTheme</span><span class="s1">({</span><span class="s0">&quot;.cm-panel.cm-gotoLine&quot;</span><span class="s1">:{</span><span class="s2">padding</span><span class="s1">:</span><span class="s0">&quot;2px 6px 4px&quot;</span><span class="s1">,</span><span class="s0">&quot;&amp; label&quot;</span><span class="s1">:{</span><span class="s2">fontSize</span><span class="s1">:</span><span class="s0">&quot;80%&quot;</span><span class="s1">}}});</span><span class="s4">const </span><span class="s2">S</span><span class="s1">={</span><span class="s2">highlightWordAroundCursor</span><span class="s1">:</span><span class="s4">false</span><span class="s1">,</span><span class="s2">minSelectionLength</span><span class="s1">:</span><span class="s3">1</span><span class="s1">,</span><span class="s2">maxMatches</span><span class="s1">:</span><span class="s3">100</span><span class="s1">,</span><span class="s2">wholeWords</span><span class="s1">:</span><span class="s4">false</span><span class="s1">};</span><span class="s4">const </span><span class="s2">C</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">Facet</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s2">combine</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">combineConfig</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">S</span><span class="s1">,{</span><span class="s2">highlightWordAroundCursor</span><span class="s1">:(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">||</span><span class="s2">t</span><span class="s1">,</span><span class="s2">minSelectionLength</span><span class="s1">:</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">,</span><span class="s2">maxMatches</span><span class="s1">:</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">})}});</span><span class="s4">function </span><span class="s2">M</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=[</span><span class="s2">P</span><span class="s1">,</span><span class="s2">L</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">C</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">e</span><span class="s1">));</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}</span><span class="s4">const </span><span class="s2">k</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">mark</span><span class="s1">({</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-selectionMatch&quot;</span><span class="s1">});</span><span class="s4">const </span><span class="s2">E</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">mark</span><span class="s1">({</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-selectionMatch cm-selectionMatch-main&quot;</span><span class="s1">});</span><span class="s4">function </span><span class="s2">q</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">return</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s3">0</span><span class="s1">||</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">i</span><span class="s1">-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">i</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">)&amp;&amp;(</span><span class="s2">r</span><span class="s1">==</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">||</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">r</span><span class="s1">+</span><span class="s3">1</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">D</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">i</span><span class="s1">+</span><span class="s3">1</span><span class="s1">))==</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">r</span><span class="s1">-</span><span class="s3">1</span><span class="s1">,</span><span class="s2">r</span><span class="s1">))==</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">}</span><span class="s4">const </span><span class="s2">L</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">ViewPlugin</span><span class="s1">.</span><span class="s2">fromClass</span><span class="s1">(</span><span class="s4">class</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">decorations</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getDeco</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">update</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selectionSet</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">docChanged</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">viewportChanged</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">decorations</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getDeco</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">view</span><span class="s1">)}</span><span class="s2">getDeco</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">C</span><span class="s1">);</span><span class="s4">let</span><span class="s1">{</span><span class="s2">state</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">1</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">none</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">main</span><span class="s1">,</span><span class="s2">o</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">highlightWordAroundCursor</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">none</span><span class="s1">;</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">wordAt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">head</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">none</span><span class="s1">;</span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">charCategorizer</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">head</span><span class="s1">);</span><span class="s2">o</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">minSelectionLength</span><span class="s1">||</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">200</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">none</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">wholeWords</span><span class="s1">){</span><span class="s2">o</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">);</span><span class="s2">l</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">charCategorizer</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">head</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!(</span><span class="s2">q</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)&amp;&amp;</span><span class="s2">D</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)))</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">none</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">o</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">o</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">none</span><span class="s1">}}</span><span class="s4">let </span><span class="s2">c</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">h of e</span><span class="s1">.</span><span class="s2">visibleRanges</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">a</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">,</span><span class="s2">o</span><span class="s1">,</span><span class="s2">h</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">h</span><span class="s1">.</span><span class="s2">to</span><span class="s1">);</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">next</span><span class="s1">().</span><span class="s2">done</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">o</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">||</span><span class="s2">q</span><span class="s1">(</span><span class="s2">l</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">o</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">&lt;=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">&gt;=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)</span><span class="s2">c</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">E</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">o</span><span class="s1">));</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">&gt;=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">||</span><span class="s2">o</span><span class="s1">&lt;=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">)</span><span class="s2">c</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">k</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">o</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">c</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">maxMatches</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">none</span><span class="s1">}}}</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">c</span><span class="s1">)}},{</span><span class="s2">decorations</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">decorations</span><span class="s1">});</span><span class="s4">const </span><span class="s2">P</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">EditorView</span><span class="s1">.</span><span class="s2">baseTheme</span><span class="s1">({</span><span class="s0">&quot;.cm-selectionMatch&quot;</span><span class="s1">:{</span><span class="s2">backgroundColor</span><span class="s1">:</span><span class="s0">&quot;#99ff7780&quot;</span><span class="s1">},</span><span class="s0">&quot;.cm-searchMatch .cm-selectionMatch&quot;</span><span class="s1">:{</span><span class="s2">backgroundColor</span><span class="s1">:</span><span class="s0">&quot;transparent&quot;</span><span class="s1">}});</span><span class="s4">const </span><span class="s2">A</span><span class="s1">=({</span><span class="s2">state</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">dispatch</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">let</span><span class="s1">{</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">wordAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">head</span><span class="s1">)||</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">cursor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">head</span><span class="s1">))),</span><span class="s2">i</span><span class="s1">.</span><span class="s2">mainIndex</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">i</span><span class="s1">))</span><span class="s4">return false</span><span class="s1">;</span><span class="s2">t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">update</span><span class="s1">({</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}));</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">function </span><span class="s2">W</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">main</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">ranges</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">wordAt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">head</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">to</span><span class="s1">==</span><span class="s2">i</span><span class="s1">.</span><span class="s2">to</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s4">false</span><span class="s1">,</span><span class="s2">l</span><span class="s1">=</span><span class="s4">new </span><span class="s2">a</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">[</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">].</span><span class="s2">to</span><span class="s1">);;){</span><span class="s2">l</span><span class="s1">.</span><span class="s2">next</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">done</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s2">l</span><span class="s1">=</span><span class="s4">new </span><span class="s2">a</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">[</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">].</span><span class="s2">from</span><span class="s1">-</span><span class="s3">1</span><span class="s1">));</span><span class="s2">o</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">from</span><span class="s1">)))</span><span class="s4">continue</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">wordAt</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">from</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">!=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">from</span><span class="s1">||</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">!=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)</span><span class="s4">continue</span><span class="s1">}</span><span class="s4">return </span><span class="s2">l</span><span class="s1">.</span><span class="s2">value</span><span class="s1">}}}</span><span class="s4">const </span><span class="s2">F</span><span class="s1">=({</span><span class="s2">state</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">dispatch</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">let</span><span class="s1">{</span><span class="s2">ranges</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">===</span><span class="s2">e</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)))</span><span class="s4">return </span><span class="s2">A</span><span class="s1">({</span><span class="s2">state</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">dispatch</span><span class="s1">:</span><span class="s2">t</span><span class="s1">});</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">i</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">from</span><span class="s1">,</span><span class="s2">i</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">to</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)!=</span><span class="s2">s</span><span class="s1">)))</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">W</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">o</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s2">t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">update</span><span class="s1">({</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">addRange</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">o</span><span class="s1">.</span><span class="s2">to</span><span class="s1">),</span><span class="s4">false</span><span class="s1">),</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">EditorView</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)}));</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">const </span><span class="s2">R</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">Facet</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s2">combine</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">combineConfig</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">top</span><span class="s1">:</span><span class="s4">false</span><span class="s1">,</span><span class="s2">caseSensitive</span><span class="s1">:</span><span class="s4">false</span><span class="s1">,</span><span class="s2">literal</span><span class="s1">:</span><span class="s4">false</span><span class="s1">,</span><span class="s2">regexp</span><span class="s1">:</span><span class="s4">false</span><span class="s1">,</span><span class="s2">wholeWord</span><span class="s1">:</span><span class="s4">false</span><span class="s1">,</span><span class="s2">createPanel</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s4">new </span><span class="s2">pe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">scrollToMatch</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">EditorView</span><span class="s1">.</span><span class="s2">scrollIntoView</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)})}});</span><span class="s4">function </span><span class="s2">V</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">?[</span><span class="s2">R</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">be</span><span class="s1">]:</span><span class="s2">be</span><span class="s1">}</span><span class="s4">class </span><span class="s2">I</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">search</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">search</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">=!!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">literal</span><span class="s1">=!!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">literal</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">=!!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">||</span><span class="s0">&quot;&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">valid</span><span class="s1">=!!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">search</span><span class="s1">&amp;&amp;(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">||</span><span class="s2">p</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">search</span><span class="s1">));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">unquoted</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">unquote</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">search</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">=!!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">}</span><span class="s2">unquote</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">literal</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s5">/\\([nrt\\])/g</span><span class="s1">,((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;n&quot;</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\n</span><span class="s0">&quot;</span><span class="s1">:</span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;r&quot;</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\r</span><span class="s0">&quot;</span><span class="s1">:</span><span class="s2">t</span><span class="s1">==</span><span class="s0">&quot;t&quot;</span><span class="s1">?</span><span class="s0">&quot;</span><span class="s4">\t</span><span class="s0">&quot;</span><span class="s1">:</span><span class="s0">&quot;</span><span class="s4">\\</span><span class="s0">&quot;</span><span class="s1">))}</span><span class="s2">eq</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">search</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">search</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">}</span><span class="s2">create</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">?</span><span class="s4">new </span><span class="s2">B</span><span class="s1">(</span><span class="s4">this</span><span class="s1">):</span><span class="s4">new </span><span class="s2">$</span><span class="s1">(</span><span class="s4">this</span><span class="s1">)}</span><span class="s2">getCursor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorState</span><span class="s1">.</span><span class="s2">create</span><span class="s1">({</span><span class="s2">doc</span><span class="s1">:</span><span class="s2">e</span><span class="s1">});</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s4">null</span><span class="s1">)</span><span class="s2">i</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">?</span><span class="s2">_</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">):</span><span class="s2">O</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">z</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">O</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">a</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">unquoted</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">?</span><span class="s2">undefined</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">toLowerCase</span><span class="s1">(),</span><span class="s2">e</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">?</span><span class="s2">T</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCategorizer</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">main</span><span class="s1">.</span><span class="s2">head</span><span class="s1">)):</span><span class="s2">undefined</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">T</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">o</span><span class="s1">)=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&gt;</span><span class="s2">i</span><span class="s1">||</span><span class="s2">o</span><span class="s1">+</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&lt;</span><span class="s2">r</span><span class="s1">){</span><span class="s2">o</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">-</span><span class="s3">2</span><span class="s1">);</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sliceString</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">r</span><span class="s1">+</span><span class="s3">2</span><span class="s1">))}</span><span class="s4">return</span><span class="s1">(</span><span class="s2">t</span><span class="s1">(</span><span class="s2">N</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">-</span><span class="s2">o</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">||</span><span class="s2">t</span><span class="s1">(</span><span class="s2">Q</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">-</span><span class="s2">o</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">)&amp;&amp;(</span><span class="s2">t</span><span class="s1">(</span><span class="s2">Q</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">-</span><span class="s2">o</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">||</span><span class="s2">t</span><span class="s1">(</span><span class="s2">N</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">r</span><span class="s1">-</span><span class="s2">o</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">$ </span><span class="s4">extends </span><span class="s2">z</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">nextMatch</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">O</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">).</span><span class="s2">nextOverlapping</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">done</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">t</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">unquoted</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s2">r</span><span class="s1">=</span><span class="s2">O</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">).</span><span class="s2">nextOverlapping</span><span class="s1">()}</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">done</span><span class="s1">||</span><span class="s2">r</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">to</span><span class="s1">==</span><span class="s2">i</span><span class="s1">?</span><span class="s4">null</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">value</span><span class="s1">}</span><span class="s2">prevMatchInRange</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">;;){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">-</span><span class="s3">1e4</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">unquoted</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">O</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">nextOverlapping</span><span class="s1">().</span><span class="s2">done</span><span class="s1">)</span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return </span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">==</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s2">r</span><span class="s1">-=</span><span class="s3">1e4</span><span class="s1">}}</span><span class="s2">prevMatch</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">prevMatchInRange</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">)</span><span class="s2">r</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">prevMatchInRange</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">i</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">unquoted</span><span class="s1">.</span><span class="s2">length</span><span class="s1">),</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s4">return </span><span class="s2">r</span><span class="s1">&amp;&amp;(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">from</span><span class="s1">!=</span><span class="s2">t</span><span class="s1">||</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">!=</span><span class="s2">i</span><span class="s1">)?</span><span class="s2">r</span><span class="s1">:</span><span class="s4">null</span><span class="s1">}</span><span class="s2">getReplacement</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">unquote</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">)}</span><span class="s2">matchAll</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">O</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">),</span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">next</span><span class="s1">().</span><span class="s2">done</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;=</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">r</span><span class="s1">}</span><span class="s2">highlight</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">O</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">unquoted</span><span class="s1">.</span><span class="s2">length</span><span class="s1">),</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">i</span><span class="s1">+</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">unquoted</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">));</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">next</span><span class="s1">().</span><span class="s2">done</span><span class="s1">)</span><span class="s2">r</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)}}</span><span class="s4">function </span><span class="s2">_</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">u</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">search</span><span class="s1">,{</span><span class="s2">ignoreCase</span><span class="s1">:!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">,</span><span class="s2">test</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">?</span><span class="s2">j</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">charCategorizer</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">main</span><span class="s1">.</span><span class="s2">head</span><span class="s1">)):</span><span class="s2">undefined</span><span class="s1">},</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">N</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">((</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">findClusterBreak</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s4">false</span><span class="s1">),</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">Q</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">findClusterBreak</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">))}</span><span class="s4">function </span><span class="s2">j</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">)=&gt;!</span><span class="s2">r</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">length</span><span class="s1">||(</span><span class="s2">e</span><span class="s1">(</span><span class="s2">N</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">input</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">index</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">||</span><span class="s2">e</span><span class="s1">(</span><span class="s2">Q</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">input</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">index</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">)&amp;&amp;(</span><span class="s2">e</span><span class="s1">(</span><span class="s2">Q</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">input</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">index</span><span class="s1">+</span><span class="s2">r</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">length</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">||</span><span class="s2">e</span><span class="s1">(</span><span class="s2">N</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">input</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">index</span><span class="s1">+</span><span class="s2">r</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">length</span><span class="s1">))!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">CharCategory</span><span class="s1">.</span><span class="s2">Word</span><span class="s1">)}</span><span class="s4">class </span><span class="s2">B </span><span class="s4">extends </span><span class="s2">z</span><span class="s1">{</span><span class="s2">nextMatch</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">_</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">).</span><span class="s2">next</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">done</span><span class="s1">)</span><span class="s2">r</span><span class="s1">=</span><span class="s2">_</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">).</span><span class="s2">next</span><span class="s1">();</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">done</span><span class="s1">?</span><span class="s4">null</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">value</span><span class="s1">}</span><span class="s2">prevMatchInRange</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">1</span><span class="s1">;;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">-</span><span class="s2">r</span><span class="s1">*</span><span class="s3">1e4</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">_</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">i</span><span class="s1">),</span><span class="s2">o</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">next</span><span class="s1">().</span><span class="s2">done</span><span class="s1">)</span><span class="s2">o</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">value</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">&amp;&amp;(</span><span class="s2">n</span><span class="s1">==</span><span class="s2">t</span><span class="s1">||</span><span class="s2">o</span><span class="s1">.</span><span class="s2">from</span><span class="s1">&gt;</span><span class="s2">n</span><span class="s1">+</span><span class="s3">10</span><span class="s1">))</span><span class="s4">return </span><span class="s2">o</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">==</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">}}</span><span class="s2">prevMatch</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">prevMatchInRange</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">prevMatchInRange</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)}</span><span class="s2">getReplacement</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">unquote</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">).</span><span class="s2">replace</span><span class="s1">(</span><span class="s5">/\$([$&amp;\d+])/g</span><span class="s1">,((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">)=&gt;</span><span class="s2">i</span><span class="s1">==</span><span class="s0">&quot;$&quot;</span><span class="s1">?</span><span class="s0">&quot;$&quot;</span><span class="s1">:</span><span class="s2">i</span><span class="s1">==</span><span class="s0">&quot;&amp;&quot;</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">match</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]:</span><span class="s2">i</span><span class="s1">!=</span><span class="s0">&quot;0&quot;</span><span class="s1">&amp;&amp;+</span><span class="s2">i</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">match</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">match</span><span class="s1">[</span><span class="s2">i</span><span class="s1">]:</span><span class="s2">t</span><span class="s1">))}</span><span class="s2">matchAll</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">_</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">),</span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">next</span><span class="s1">().</span><span class="s2">done</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;=</span><span class="s2">t</span><span class="s1">)</span><span class="s4">return null</span><span class="s1">;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">r</span><span class="s1">}</span><span class="s2">highlight</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">_</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">-</span><span class="s3">250</span><span class="s1">),</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">i</span><span class="s1">+</span><span class="s3">250</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">length</span><span class="s1">));</span><span class="s4">while</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">next</span><span class="s1">().</span><span class="s2">done</span><span class="s1">)</span><span class="s2">r</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)}}</span><span class="s4">const </span><span class="s2">K</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">StateEffect</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">const </span><span class="s2">G</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">StateEffect</span><span class="s1">.</span><span class="s2">define</span><span class="s1">();</span><span class="s4">const </span><span class="s2">H</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">StateField</span><span class="s1">.</span><span class="s2">define</span><span class="s1">({</span><span class="s2">create</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return new </span><span class="s2">X</span><span class="s1">(</span><span class="s2">ce</span><span class="s1">(</span><span class="s2">e</span><span class="s1">).</span><span class="s2">create</span><span class="s1">(),</span><span class="s4">null</span><span class="s1">)},</span><span class="s2">update</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">i of t</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">is</span><span class="s1">(</span><span class="s2">K</span><span class="s1">))</span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">X</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(),</span><span class="s2">e</span><span class="s1">.</span><span class="s2">panel</span><span class="s1">);</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">is</span><span class="s1">(</span><span class="s2">G</span><span class="s1">))</span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">X</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">query</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">value</span><span class="s1">?</span><span class="s2">ae</span><span class="s1">:</span><span class="s4">null</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">},</span><span class="s2">provide</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">r</span><span class="s1">.</span><span class="s2">showPanel</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,(</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">panel</span><span class="s1">))});</span><span class="s4">function </span><span class="s2">U</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">H</span><span class="s1">,</span><span class="s4">false</span><span class="s1">);</span><span class="s4">return </span><span class="s2">t</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">query</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">:</span><span class="s2">ce</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">J</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">var </span><span class="s2">t</span><span class="s1">;</span><span class="s4">return</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">H</span><span class="s1">,</span><span class="s4">false</span><span class="s1">))===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">panel</span><span class="s1">)!=</span><span class="s4">null</span><span class="s1">}</span><span class="s4">class </span><span class="s2">X</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">panel</span><span class="s1">=</span><span class="s2">t</span><span class="s1">}}</span><span class="s4">const </span><span class="s2">Y</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">mark</span><span class="s1">({</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-searchMatch&quot;</span><span class="s1">}),</span><span class="s2">Z</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">mark</span><span class="s1">({</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-searchMatch cm-searchMatch-selected&quot;</span><span class="s1">});</span><span class="s4">const </span><span class="s2">ee</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">ViewPlugin</span><span class="s1">.</span><span class="s2">fromClass</span><span class="s1">(</span><span class="s4">class</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">view</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">decorations</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">highlight</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">H</span><span class="s1">))}</span><span class="s2">update</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">H</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">startState</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">H</span><span class="s1">)||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">docChanged</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selectionSet</span><span class="s1">||</span><span class="s2">e</span><span class="s1">.</span><span class="s2">viewportChanged</span><span class="s1">)</span><span class="s4">this</span><span class="s1">.</span><span class="s2">decorations</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">highlight</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">highlight</span><span class="s1">({</span><span class="s2">query</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">panel</span><span class="s1">:</span><span class="s2">t</span><span class="s1">}){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">||!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">valid</span><span class="s1">)</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">Decoration</span><span class="s1">.</span><span class="s2">none</span><span class="s1">;</span><span class="s4">let</span><span class="s1">{</span><span class="s2">view</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s4">this</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">n</span><span class="s1">.</span><span class="s2">RangeSetBuilder</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s3">0</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">visibleRanges</span><span class="s1">,</span><span class="s2">o</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">o</span><span class="s1">;</span><span class="s2">r</span><span class="s1">++){</span><span class="s4">let</span><span class="s1">{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">l</span><span class="s1">}=</span><span class="s2">n</span><span class="s1">[</span><span class="s2">r</span><span class="s1">];</span><span class="s4">while</span><span class="s1">(</span><span class="s2">r</span><span class="s1">&lt;</span><span class="s2">o</span><span class="s1">-</span><span class="s3">1</span><span class="s1">&amp;&amp;</span><span class="s2">l</span><span class="s1">&gt;</span><span class="s2">n</span><span class="s1">[</span><span class="s2">r</span><span class="s1">+</span><span class="s3">1</span><span class="s1">].</span><span class="s2">from</span><span class="s1">-</span><span class="s3">2</span><span class="s1">*</span><span class="s3">250</span><span class="s1">)</span><span class="s2">l</span><span class="s1">=</span><span class="s2">n</span><span class="s1">[++</span><span class="s2">r</span><span class="s1">].</span><span class="s2">to</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">highlight</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">state</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">l</span><span class="s1">,((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)=&gt;{</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">some</span><span class="s1">((</span><span class="s2">i</span><span class="s1">=&gt;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s2">e</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">to</span><span class="s1">==</span><span class="s2">t</span><span class="s1">));</span><span class="s2">s</span><span class="s1">.</span><span class="s2">add</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">r</span><span class="s1">?</span><span class="s2">Z</span><span class="s1">:</span><span class="s2">Y</span><span class="s1">)}))}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">.</span><span class="s2">finish</span><span class="s1">()}},{</span><span class="s2">decorations</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">decorations</span><span class="s1">});</span><span class="s4">function </span><span class="s2">te</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">H</span><span class="s1">,</span><span class="s4">false</span><span class="s1">);</span><span class="s4">return </span><span class="s2">i</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">query</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">.</span><span class="s2">valid</span><span class="s1">?</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">):</span><span class="s2">fe</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}}</span><span class="s4">const </span><span class="s2">ie</span><span class="s1">=</span><span class="s2">te</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">query</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">let</span><span class="s1">{</span><span class="s2">to</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">main</span><span class="s1">;</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nextMatch</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">r</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">single</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">to</span><span class="s1">);</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">R</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">effects</span><span class="s1">:[</span><span class="s2">ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">r</span><span class="s1">),</span><span class="s2">o</span><span class="s1">.</span><span class="s2">scrollToMatch</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">main</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)],</span><span class="s2">userEvent</span><span class="s1">:</span><span class="s0">&quot;select.search&quot;</span><span class="s1">});</span><span class="s2">ue</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return true</span><span class="s1">}));</span><span class="s4">const </span><span class="s2">re</span><span class="s1">=</span><span class="s2">te</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">query</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">let</span><span class="s1">{</span><span class="s2">state</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">main</span><span class="s1">;</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">prevMatch</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">single</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">to</span><span class="s1">);</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">R</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">effects</span><span class="s1">:[</span><span class="s2">ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">),</span><span class="s2">l</span><span class="s1">.</span><span class="s2">scrollToMatch</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">main</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)],</span><span class="s2">userEvent</span><span class="s1">:</span><span class="s0">&quot;select.search&quot;</span><span class="s1">});</span><span class="s2">ue</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return true</span><span class="s1">}));</span><span class="s4">const </span><span class="s2">ne</span><span class="s1">=</span><span class="s2">te</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">query</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">matchAll</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">,</span><span class="s3">1e3</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">||!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">to</span><span class="s1">)))),</span><span class="s2">userEvent</span><span class="s1">:</span><span class="s0">&quot;select.search.matches&quot;</span><span class="s1">});</span><span class="s4">return true</span><span class="s1">}));</span><span class="s4">const </span><span class="s2">se</span><span class="s1">=({</span><span class="s2">state</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">dispatch</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">ranges</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">1</span><span class="s1">||</span><span class="s2">i</span><span class="s1">.</span><span class="s2">main</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let</span><span class="s1">{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">s</span><span class="s1">}=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">main</span><span class="s1">;</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=[],</span><span class="s2">l</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">c</span><span class="s1">=</span><span class="s4">new </span><span class="s2">a</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">r</span><span class="s1">,</span><span class="s2">s</span><span class="s1">));!</span><span class="s2">c</span><span class="s1">.</span><span class="s2">next</span><span class="s1">().</span><span class="s2">done</span><span class="s1">;){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">1e3</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">c</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s2">r</span><span class="s1">)</span><span class="s2">l</span><span class="s1">=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">o</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">range</span><span class="s1">(</span><span class="s2">c</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">c</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">to</span><span class="s1">))}</span><span class="s2">t</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">update</span><span class="s1">({</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s2">l</span><span class="s1">),</span><span class="s2">userEvent</span><span class="s1">:</span><span class="s0">&quot;select.search.matches&quot;</span><span class="s1">}));</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">const </span><span class="s2">oe</span><span class="s1">=</span><span class="s2">te</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">query</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">let</span><span class="s1">{</span><span class="s2">state</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">o</span><span class="s1">}=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">main</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">readOnly</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nextMatch</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">l</span><span class="s1">;</span><span class="s4">let </span><span class="s2">c</span><span class="s1">=[],</span><span class="s2">h</span><span class="s1">,</span><span class="s2">u</span><span class="s1">;</span><span class="s4">let </span><span class="s2">f</span><span class="s1">=[];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">from</span><span class="s1">==</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">to</span><span class="s1">==</span><span class="s2">o</span><span class="s1">){</span><span class="s2">u</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">toText</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">getReplacement</span><span class="s1">(</span><span class="s2">a</span><span class="s1">));</span><span class="s2">c</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">from</span><span class="s1">:</span><span class="s2">a</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">a</span><span class="s1">.</span><span class="s2">to</span><span class="s1">,</span><span class="s2">insert</span><span class="s1">:</span><span class="s2">u</span><span class="s1">});</span><span class="s2">a</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nextMatch</span><span class="s1">(</span><span class="s2">i</span><span class="s1">,</span><span class="s2">a</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">a</span><span class="s1">.</span><span class="s2">to</span><span class="s1">);</span><span class="s2">f</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">EditorView</span><span class="s1">.</span><span class="s2">announce</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">phrase</span><span class="s1">(</span><span class="s0">&quot;replaced match on line $&quot;</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">s</span><span class="s1">).</span><span class="s2">number</span><span class="s1">)+</span><span class="s0">&quot;.&quot;</span><span class="s1">))}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">c</span><span class="s1">.</span><span class="s2">length</span><span class="s1">==</span><span class="s3">0</span><span class="s1">||</span><span class="s2">c</span><span class="s1">[</span><span class="s3">0</span><span class="s1">].</span><span class="s2">from</span><span class="s1">&gt;=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">to</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s2">l</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s2">l</span><span class="s1">.</span><span class="s2">from</span><span class="s1">-</span><span class="s2">u</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">h</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">EditorSelection</span><span class="s1">.</span><span class="s2">single</span><span class="s1">(</span><span class="s2">a</span><span class="s1">.</span><span class="s2">from</span><span class="s1">-</span><span class="s2">t</span><span class="s1">,</span><span class="s2">a</span><span class="s1">.</span><span class="s2">to</span><span class="s1">-</span><span class="s2">t</span><span class="s1">);</span><span class="s2">f</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">a</span><span class="s1">));</span><span class="s2">f</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">i</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">R</span><span class="s1">).</span><span class="s2">scrollToMatch</span><span class="s1">(</span><span class="s2">h</span><span class="s1">.</span><span class="s2">main</span><span class="s1">,</span><span class="s2">e</span><span class="s1">))}</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">changes</span><span class="s1">:</span><span class="s2">c</span><span class="s1">,</span><span class="s2">selection</span><span class="s1">:</span><span class="s2">h</span><span class="s1">,</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">f</span><span class="s1">,</span><span class="s2">userEvent</span><span class="s1">:</span><span class="s0">&quot;input.replace&quot;</span><span class="s1">});</span><span class="s4">return true</span><span class="s1">}));</span><span class="s4">const </span><span class="s2">le</span><span class="s1">=</span><span class="s2">te</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">query</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">readOnly</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">matchAll</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">,</span><span class="s3">1e9</span><span class="s1">).</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">let</span><span class="s1">{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">r</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">return</span><span class="s1">{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">insert</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">getReplacement</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}}));</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">phrase</span><span class="s1">(</span><span class="s0">&quot;replaced $ matches&quot;</span><span class="s1">,</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)+</span><span class="s0">&quot;.&quot;</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">changes</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">EditorView</span><span class="s1">.</span><span class="s2">announce</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">n</span><span class="s1">),</span><span class="s2">userEvent</span><span class="s1">:</span><span class="s0">&quot;input.replace.all&quot;</span><span class="s1">});</span><span class="s4">return true</span><span class="s1">}));</span><span class="s4">function </span><span class="s2">ae</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">R</span><span class="s1">).</span><span class="s2">createPanel</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">ce</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">var </span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">o</span><span class="s1">;</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">selection</span><span class="s1">.</span><span class="s2">main</span><span class="s1">;</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">l</span><span class="s1">.</span><span class="s2">empty</span><span class="s1">||</span><span class="s2">l</span><span class="s1">.</span><span class="s2">to</span><span class="s1">&gt;</span><span class="s2">l</span><span class="s1">.</span><span class="s2">from</span><span class="s1">+</span><span class="s3">100</span><span class="s1">?</span><span class="s0">&quot;&quot;</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">l</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">l</span><span class="s1">.</span><span class="s2">to</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&amp;&amp;!</span><span class="s2">a</span><span class="s1">)</span><span class="s4">return </span><span class="s2">t</span><span class="s1">;</span><span class="s4">let </span><span class="s2">c</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">R</span><span class="s1">);</span><span class="s4">return new </span><span class="s2">I</span><span class="s1">({</span><span class="s2">search</span><span class="s1">:((</span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">literal</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">i</span><span class="s1">:</span><span class="s2">c</span><span class="s1">.</span><span class="s2">literal</span><span class="s1">)?</span><span class="s2">a</span><span class="s1">:</span><span class="s2">a</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">(</span><span class="s5">/\n/g</span><span class="s1">,</span><span class="s0">&quot;</span><span class="s4">\\</span><span class="s0">n&quot;</span><span class="s1">),</span><span class="s2">caseSensitive</span><span class="s1">:(</span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">r</span><span class="s1">:</span><span class="s2">c</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">,</span><span class="s2">literal</span><span class="s1">:(</span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">literal</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">n</span><span class="s1">:</span><span class="s2">c</span><span class="s1">.</span><span class="s2">literal</span><span class="s1">,</span><span class="s2">regexp</span><span class="s1">:(</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s2">c</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">,</span><span class="s2">wholeWord</span><span class="s1">:(</span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">o</span><span class="s1">:</span><span class="s2">c</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">})}</span><span class="s4">function </span><span class="s2">he</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">getPanel</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">ae</span><span class="s1">);</span><span class="s4">return </span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">dom</span><span class="s1">.</span><span class="s2">querySelector</span><span class="s1">(</span><span class="s0">&quot;[main-field]&quot;</span><span class="s1">)}</span><span class="s4">function </span><span class="s2">ue</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">he</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">root</span><span class="s1">.</span><span class="s2">activeElement</span><span class="s1">)</span><span class="s2">t</span><span class="s1">.</span><span class="s2">select</span><span class="s1">()}</span><span class="s4">const </span><span class="s2">fe</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">H</span><span class="s1">,</span><span class="s4">false</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">panel</span><span class="s1">){</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s2">he</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">!=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">root</span><span class="s1">.</span><span class="s2">activeElement</span><span class="s1">){</span><span class="s4">let </span><span class="s2">r</span><span class="s1">=</span><span class="s2">ce</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">query</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">r</span><span class="s1">.</span><span class="s2">valid</span><span class="s1">)</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">K</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">r</span><span class="s1">)});</span><span class="s2">i</span><span class="s1">.</span><span class="s2">focus</span><span class="s1">();</span><span class="s2">i</span><span class="s1">.</span><span class="s2">select</span><span class="s1">()}}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">effects</span><span class="s1">:[</span><span class="s2">G</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s4">true</span><span class="s1">),</span><span class="s2">t</span><span class="s1">?</span><span class="s2">K</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">ce</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">query</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">)):</span><span class="s2">n</span><span class="s1">.</span><span class="s2">StateEffect</span><span class="s1">.</span><span class="s2">appendConfig</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">be</span><span class="s1">)]})}</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">const </span><span class="s2">de</span><span class="s1">=</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">H</span><span class="s1">,</span><span class="s4">false</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">t</span><span class="s1">||!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">panel</span><span class="s1">)</span><span class="s4">return false</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">getPanel</span><span class="s1">)(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">ae</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">i</span><span class="s1">&amp;&amp;</span><span class="s2">i</span><span class="s1">.</span><span class="s2">dom</span><span class="s1">.</span><span class="s2">contains</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">root</span><span class="s1">.</span><span class="s2">activeElement</span><span class="s1">))</span><span class="s2">e</span><span class="s1">.</span><span class="s2">focus</span><span class="s1">();</span><span class="s2">e</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">G</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s4">false</span><span class="s1">)});</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">const </span><span class="s2">me</span><span class="s1">=[{</span><span class="s2">key</span><span class="s1">:</span><span class="s0">&quot;Mod-f&quot;</span><span class="s1">,</span><span class="s2">run</span><span class="s1">:</span><span class="s2">fe</span><span class="s1">,</span><span class="s2">scope</span><span class="s1">:</span><span class="s0">&quot;editor search-panel&quot;</span><span class="s1">},{</span><span class="s2">key</span><span class="s1">:</span><span class="s0">&quot;F3&quot;</span><span class="s1">,</span><span class="s2">run</span><span class="s1">:</span><span class="s2">ie</span><span class="s1">,</span><span class="s2">shift</span><span class="s1">:</span><span class="s2">re</span><span class="s1">,</span><span class="s2">scope</span><span class="s1">:</span><span class="s0">&quot;editor search-panel&quot;</span><span class="s1">,</span><span class="s2">preventDefault</span><span class="s1">:</span><span class="s4">true</span><span class="s1">},{</span><span class="s2">key</span><span class="s1">:</span><span class="s0">&quot;Mod-g&quot;</span><span class="s1">,</span><span class="s2">run</span><span class="s1">:</span><span class="s2">ie</span><span class="s1">,</span><span class="s2">shift</span><span class="s1">:</span><span class="s2">re</span><span class="s1">,</span><span class="s2">scope</span><span class="s1">:</span><span class="s0">&quot;editor search-panel&quot;</span><span class="s1">,</span><span class="s2">preventDefault</span><span class="s1">:</span><span class="s4">true</span><span class="s1">},{</span><span class="s2">key</span><span class="s1">:</span><span class="s0">&quot;Escape&quot;</span><span class="s1">,</span><span class="s2">run</span><span class="s1">:</span><span class="s2">de</span><span class="s1">,</span><span class="s2">scope</span><span class="s1">:</span><span class="s0">&quot;editor search-panel&quot;</span><span class="s1">},{</span><span class="s2">key</span><span class="s1">:</span><span class="s0">&quot;Mod-Shift-l&quot;</span><span class="s1">,</span><span class="s2">run</span><span class="s1">:</span><span class="s2">se</span><span class="s1">},{</span><span class="s2">key</span><span class="s1">:</span><span class="s0">&quot;Mod-Alt-g&quot;</span><span class="s1">,</span><span class="s2">run</span><span class="s1">:</span><span class="s2">w</span><span class="s1">},{</span><span class="s2">key</span><span class="s1">:</span><span class="s0">&quot;Mod-d&quot;</span><span class="s1">,</span><span class="s2">run</span><span class="s1">:</span><span class="s2">F</span><span class="s1">,</span><span class="s2">preventDefault</span><span class="s1">:</span><span class="s4">true</span><span class="s1">}];</span><span class="s4">class </span><span class="s2">pe</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">view</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">field</span><span class="s1">(</span><span class="s2">H</span><span class="s1">).</span><span class="s2">query</span><span class="s1">.</span><span class="s2">spec</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">commit</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">commit</span><span class="s1">.</span><span class="s2">bind</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">searchField</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;input&quot;</span><span class="s1">,{</span><span class="s2">value</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">search</span><span class="s1">,</span><span class="s2">placeholder</span><span class="s1">:</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;Find&quot;</span><span class="s1">),</span><span class="s0">&quot;aria-label&quot;</span><span class="s1">:</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;Find&quot;</span><span class="s1">),</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-textfield&quot;</span><span class="s1">,</span><span class="s2">name</span><span class="s1">:</span><span class="s0">&quot;search&quot;</span><span class="s1">,</span><span class="s2">form</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s0">&quot;main-field&quot;</span><span class="s1">:</span><span class="s0">&quot;true&quot;</span><span class="s1">,</span><span class="s2">onchange</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">commit</span><span class="s1">,</span><span class="s2">onkeyup</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">commit</span><span class="s1">});</span><span class="s4">this</span><span class="s1">.</span><span class="s2">replaceField</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;input&quot;</span><span class="s1">,{</span><span class="s2">value</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">,</span><span class="s2">placeholder</span><span class="s1">:</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;Replace&quot;</span><span class="s1">),</span><span class="s0">&quot;aria-label&quot;</span><span class="s1">:</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;Replace&quot;</span><span class="s1">),</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-textfield&quot;</span><span class="s1">,</span><span class="s2">name</span><span class="s1">:</span><span class="s0">&quot;replace&quot;</span><span class="s1">,</span><span class="s2">form</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s2">onchange</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">commit</span><span class="s1">,</span><span class="s2">onkeyup</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">commit</span><span class="s1">});</span><span class="s4">this</span><span class="s1">.</span><span class="s2">caseField</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;input&quot;</span><span class="s1">,{</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;checkbox&quot;</span><span class="s1">,</span><span class="s2">name</span><span class="s1">:</span><span class="s0">&quot;case&quot;</span><span class="s1">,</span><span class="s2">form</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s2">checked</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">,</span><span class="s2">onchange</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">commit</span><span class="s1">});</span><span class="s4">this</span><span class="s1">.</span><span class="s2">reField</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;input&quot;</span><span class="s1">,{</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;checkbox&quot;</span><span class="s1">,</span><span class="s2">name</span><span class="s1">:</span><span class="s0">&quot;re&quot;</span><span class="s1">,</span><span class="s2">form</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s2">checked</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">,</span><span class="s2">onchange</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">commit</span><span class="s1">});</span><span class="s4">this</span><span class="s1">.</span><span class="s2">wordField</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;input&quot;</span><span class="s1">,{</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;checkbox&quot;</span><span class="s1">,</span><span class="s2">name</span><span class="s1">:</span><span class="s0">&quot;word&quot;</span><span class="s1">,</span><span class="s2">form</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">,</span><span class="s2">checked</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">,</span><span class="s2">onchange</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">commit</span><span class="s1">});</span><span class="s4">function </span><span class="s2">i</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">i</span><span class="s1">){</span><span class="s4">return </span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;button&quot;</span><span class="s1">,{</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-button&quot;</span><span class="s1">,</span><span class="s2">name</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">onclick</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;button&quot;</span><span class="s1">},</span><span class="s2">i</span><span class="s1">)}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">dom</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;div&quot;</span><span class="s1">,{</span><span class="s2">onkeydown</span><span class="s1">:</span><span class="s2">e</span><span class="s1">=&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">keydown</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s4">class</span><span class="s1">:</span><span class="s0">&quot;cm-search&quot;</span><span class="s1">},[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">searchField</span><span class="s1">,</span><span class="s2">i</span><span class="s1">(</span><span class="s0">&quot;next&quot;</span><span class="s1">,(()=&gt;</span><span class="s2">ie</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)),[</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;next&quot;</span><span class="s1">)]),</span><span class="s2">i</span><span class="s1">(</span><span class="s0">&quot;prev&quot;</span><span class="s1">,(()=&gt;</span><span class="s2">re</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)),[</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;previous&quot;</span><span class="s1">)]),</span><span class="s2">i</span><span class="s1">(</span><span class="s0">&quot;select&quot;</span><span class="s1">,(()=&gt;</span><span class="s2">ne</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)),[</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;all&quot;</span><span class="s1">)]),</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;label&quot;</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">caseField</span><span class="s1">,</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;match case&quot;</span><span class="s1">)]),</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;label&quot;</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">reField</span><span class="s1">,</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;regexp&quot;</span><span class="s1">)]),</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;label&quot;</span><span class="s1">,</span><span class="s4">null</span><span class="s1">,[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">wordField</span><span class="s1">,</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;by word&quot;</span><span class="s1">)]),</span><span class="s2">...e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">readOnly</span><span class="s1">?[]:[</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;br&quot;</span><span class="s1">),</span><span class="s4">this</span><span class="s1">.</span><span class="s2">replaceField</span><span class="s1">,</span><span class="s2">i</span><span class="s1">(</span><span class="s0">&quot;replace&quot;</span><span class="s1">,(()=&gt;</span><span class="s2">oe</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)),[</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;replace&quot;</span><span class="s1">)]),</span><span class="s2">i</span><span class="s1">(</span><span class="s0">&quot;replaceAll&quot;</span><span class="s1">,(()=&gt;</span><span class="s2">le</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)),[</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;replace all&quot;</span><span class="s1">)])],</span><span class="s2">s</span><span class="s1">(</span><span class="s0">&quot;button&quot;</span><span class="s1">,{</span><span class="s2">name</span><span class="s1">:</span><span class="s0">&quot;close&quot;</span><span class="s1">,</span><span class="s2">onclick</span><span class="s1">:()=&gt;</span><span class="s2">de</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s0">&quot;aria-label&quot;</span><span class="s1">:</span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;close&quot;</span><span class="s1">),</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;button&quot;</span><span class="s1">},[</span><span class="s0">&quot;×&quot;</span><span class="s1">])])}</span><span class="s2">commit</span><span class="s1">(){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">I</span><span class="s1">({</span><span class="s2">search</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">searchField</span><span class="s1">.</span><span class="s2">value</span><span class="s1">,</span><span class="s2">caseSensitive</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">caseField</span><span class="s1">.</span><span class="s2">checked</span><span class="s1">,</span><span class="s2">regexp</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">reField</span><span class="s1">.</span><span class="s2">checked</span><span class="s1">,</span><span class="s2">wholeWord</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">wordField</span><span class="s1">.</span><span class="s2">checked</span><span class="s1">,</span><span class="s2">replace</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">replaceField</span><span class="s1">.</span><span class="s2">value</span><span class="s1">});</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">)){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">view</span><span class="s1">.</span><span class="s2">dispatch</span><span class="s1">({</span><span class="s2">effects</span><span class="s1">:</span><span class="s2">K</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)})}}</span><span class="s2">keydown</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">((</span><span class="s3">0</span><span class="s1">,</span><span class="s2">r</span><span class="s1">.</span><span class="s2">runScopeHandlers</span><span class="s1">)(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">view</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;search-panel&quot;</span><span class="s1">)){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">preventDefault</span><span class="s1">()}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">keyCode</span><span class="s1">==</span><span class="s3">13</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">searchField</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">preventDefault</span><span class="s1">();(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">shiftKey</span><span class="s1">?</span><span class="s2">re</span><span class="s1">:</span><span class="s2">ie</span><span class="s1">)(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">view</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">keyCode</span><span class="s1">==</span><span class="s3">13</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">target</span><span class="s1">==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">replaceField</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">preventDefault</span><span class="s1">();</span><span class="s2">oe</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">view</span><span class="s1">)}}</span><span class="s2">update</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">t of e</span><span class="s1">.</span><span class="s2">transactions</span><span class="s1">)</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e of t</span><span class="s1">.</span><span class="s2">effects</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">is</span><span class="s1">(</span><span class="s2">K</span><span class="s1">)&amp;&amp;!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">))</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setQuery</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">value</span><span class="s1">)}}</span><span class="s2">setQuery</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">query</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">searchField</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">search</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">replaceField</span><span class="s1">.</span><span class="s2">value</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">replace</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">caseField</span><span class="s1">.</span><span class="s2">checked</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">caseSensitive</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">reField</span><span class="s1">.</span><span class="s2">checked</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">regexp</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">wordField</span><span class="s1">.</span><span class="s2">checked</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">wholeWord</span><span class="s1">}</span><span class="s2">mount</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">searchField</span><span class="s1">.</span><span class="s2">select</span><span class="s1">()}</span><span class="s2">get pos</span><span class="s1">(){</span><span class="s4">return </span><span class="s3">80</span><span class="s1">}</span><span class="s2">get top</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">view</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">facet</span><span class="s1">(</span><span class="s2">R</span><span class="s1">).</span><span class="s2">top</span><span class="s1">}}</span><span class="s4">function </span><span class="s2">ge</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">phrase</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">const </span><span class="s2">ve</span><span class="s1">=</span><span class="s3">30</span><span class="s1">;</span><span class="s4">const </span><span class="s2">xe</span><span class="s1">=</span><span class="s5">/[\s\.,:;?!]/</span><span class="s1">;</span><span class="s4">function </span><span class="s2">ye</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">from</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">to</span><span class="s1">:</span><span class="s2">i</span><span class="s1">}){</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">lineAt</span><span class="s1">(</span><span class="s2">i</span><span class="s1">).</span><span class="s2">to</span><span class="s1">;</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">max</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">from</span><span class="s1">,</span><span class="s2">t</span><span class="s1">-</span><span class="s2">ve</span><span class="s1">),</span><span class="s2">l</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">min</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">i</span><span class="s1">+</span><span class="s2">ve</span><span class="s1">);</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">sliceDoc</span><span class="s1">(</span><span class="s2">o</span><span class="s1">,</span><span class="s2">l</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">!=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">from</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s2">ve</span><span class="s1">;</span><span class="s2">e</span><span class="s1">++)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">xe</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">a</span><span class="s1">[</span><span class="s2">e</span><span class="s1">+</span><span class="s3">1</span><span class="s1">])&amp;&amp;</span><span class="s2">xe</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">a</span><span class="s1">[</span><span class="s2">e</span><span class="s1">])){</span><span class="s2">a</span><span class="s1">=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">break</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">!=</span><span class="s2">s</span><span class="s1">){</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">;</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">ve</span><span class="s1">;</span><span class="s2">e</span><span class="s1">--)</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">xe</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">a</span><span class="s1">[</span><span class="s2">e</span><span class="s1">-</span><span class="s3">1</span><span class="s1">])&amp;&amp;</span><span class="s2">xe</span><span class="s1">.</span><span class="s2">test</span><span class="s1">(</span><span class="s2">a</span><span class="s1">[</span><span class="s2">e</span><span class="s1">])){</span><span class="s2">a</span><span class="s1">=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">break</span><span class="s1">}}</span><span class="s4">return </span><span class="s2">r</span><span class="s1">.</span><span class="s2">EditorView</span><span class="s1">.</span><span class="s2">announce</span><span class="s1">.</span><span class="s2">of</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">phrase</span><span class="s1">(</span><span class="s0">&quot;current match&quot;</span><span class="s1">)}</span><span class="s0">. </span><span class="s2">$</span><span class="s1">{</span><span class="s2">a</span><span class="s1">} </span><span class="s2">$</span><span class="s1">{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">state</span><span class="s1">.</span><span class="s2">phrase</span><span class="s1">(</span><span class="s0">&quot;on line&quot;</span><span class="s1">)} </span><span class="s2">$</span><span class="s1">{</span><span class="s2">n</span><span class="s1">.</span><span class="s2">number</span><span class="s1">}</span><span class="s0">.`</span><span class="s1">)}</span><span class="s4">const </span><span class="s2">we</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">EditorView</span><span class="s1">.</span><span class="s2">baseTheme</span><span class="s1">({</span><span class="s0">&quot;.cm-panel.cm-search&quot;</span><span class="s1">:{</span><span class="s2">padding</span><span class="s1">:</span><span class="s0">&quot;2px 6px 4px&quot;</span><span class="s1">,</span><span class="s2">position</span><span class="s1">:</span><span class="s0">&quot;relative&quot;</span><span class="s1">,</span><span class="s0">&quot;&amp; [name=close]&quot;</span><span class="s1">:{</span><span class="s2">position</span><span class="s1">:</span><span class="s0">&quot;absolute&quot;</span><span class="s1">,</span><span class="s2">top</span><span class="s1">:</span><span class="s0">&quot;0&quot;</span><span class="s1">,</span><span class="s2">right</span><span class="s1">:</span><span class="s0">&quot;4px&quot;</span><span class="s1">,</span><span class="s2">backgroundColor</span><span class="s1">:</span><span class="s0">&quot;inherit&quot;</span><span class="s1">,</span><span class="s2">border</span><span class="s1">:</span><span class="s0">&quot;none&quot;</span><span class="s1">,</span><span class="s2">font</span><span class="s1">:</span><span class="s0">&quot;inherit&quot;</span><span class="s1">,</span><span class="s2">padding</span><span class="s1">:</span><span class="s3">0</span><span class="s1">,</span><span class="s2">margin</span><span class="s1">:</span><span class="s3">0</span><span class="s1">},</span><span class="s0">&quot;&amp; input, &amp; button, &amp; label&quot;</span><span class="s1">:{</span><span class="s2">margin</span><span class="s1">:</span><span class="s0">&quot;.2em .6em .2em 0&quot;</span><span class="s1">},</span><span class="s0">&quot;&amp; input[type=checkbox]&quot;</span><span class="s1">:{</span><span class="s2">marginRight</span><span class="s1">:</span><span class="s0">&quot;.2em&quot;</span><span class="s1">},</span><span class="s0">&quot;&amp; label&quot;</span><span class="s1">:{</span><span class="s2">fontSize</span><span class="s1">:</span><span class="s0">&quot;80%&quot;</span><span class="s1">,</span><span class="s2">whiteSpace</span><span class="s1">:</span><span class="s0">&quot;pre&quot;</span><span class="s1">}},</span><span class="s0">&quot;&amp;light .cm-searchMatch&quot;</span><span class="s1">:{</span><span class="s2">backgroundColor</span><span class="s1">:</span><span class="s0">&quot;#ffff0054&quot;</span><span class="s1">},</span><span class="s0">&quot;&amp;dark .cm-searchMatch&quot;</span><span class="s1">:{</span><span class="s2">backgroundColor</span><span class="s1">:</span><span class="s0">&quot;#00ffff8a&quot;</span><span class="s1">},</span><span class="s0">&quot;&amp;light .cm-searchMatch-selected&quot;</span><span class="s1">:{</span><span class="s2">backgroundColor</span><span class="s1">:</span><span class="s0">&quot;#ff6a0054&quot;</span><span class="s1">},</span><span class="s0">&quot;&amp;dark .cm-searchMatch-selected&quot;</span><span class="s1">:{</span><span class="s2">backgroundColor</span><span class="s1">:</span><span class="s0">&quot;#ff00ff8a&quot;</span><span class="s1">}});</span><span class="s4">const </span><span class="s2">be</span><span class="s1">=[</span><span class="s2">H</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">Prec</span><span class="s1">.</span><span class="s2">low</span><span class="s1">(</span><span class="s2">ee</span><span class="s1">),</span><span class="s2">we</span><span class="s1">]}}]);</span></pre>
</body>
</html>