<html>
<head>
<title>5521.cc7da8760b98f2dd2c18.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #2aacb8;}
.s4 { color: #cf8e6d;}
.ln { color: #4b5059; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
5521.cc7da8760b98f2dd2c18.js</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">&quot;use strict&quot;</span><span class="s1">;(</span><span class="s2">self</span><span class="s1">[</span><span class="s0">&quot;webpackChunk_jupyterlab_application_top&quot;</span><span class="s1">]=</span><span class="s2">self</span><span class="s1">[</span><span class="s0">&quot;webpackChunk_jupyterlab_application_top&quot;</span><span class="s1">]||[]).</span><span class="s2">push</span><span class="s1">([[</span><span class="s3">5521</span><span class="s1">],{</span><span class="s3">65521</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">r</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">YBaseCell</span><span class="s1">:()=&gt;</span><span class="s2">k</span><span class="s1">,</span><span class="s2">YCodeCell</span><span class="s1">:()=&gt;</span><span class="s2">C</span><span class="s1">,</span><span class="s2">YDocument</span><span class="s1">:()=&gt;</span><span class="s2">b</span><span class="s1">,</span><span class="s2">YFile</span><span class="s1">:()=&gt;</span><span class="s2">v</span><span class="s1">,</span><span class="s2">YMarkdownCell</span><span class="s1">:()=&gt;</span><span class="s2">V</span><span class="s1">,</span><span class="s2">YNotebook</span><span class="s1">:()=&gt;</span><span class="s2">E</span><span class="s1">,</span><span class="s2">YRawCell</span><span class="s1">:()=&gt;</span><span class="s2">x</span><span class="s1">,</span><span class="s2">convertYMapEventToMapChange</span><span class="s1">:()=&gt;</span><span class="s2">n</span><span class="s1">,</span><span class="s2">createMutex</span><span class="s1">:()=&gt;</span><span class="s2">a</span><span class="s1">,</span><span class="s2">createStandaloneCell</span><span class="s1">:()=&gt;</span><span class="s2">w</span><span class="s1">});</span><span class="s4">function </span><span class="s2">n</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,{</span><span class="s2">action</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">action</span><span class="s1">,</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)})}));</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=()=&gt;{</span><span class="s4">let </span><span class="s2">t</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">return </span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s2">t</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">try</span><span class="s1">{</span><span class="s2">e</span><span class="s1">()}</span><span class="s4">finally</span><span class="s1">{</span><span class="s2">t</span><span class="s1">=</span><span class="s4">true</span><span class="s1">}}}};</span><span class="s4">var </span><span class="s2">o</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">5592</span><span class="s1">);</span><span class="s4">var </span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">2336</span><span class="s1">);</span><span class="s4">var </span><span class="s2">r</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">64191</span><span class="s1">);</span><span class="s4">var </span><span class="s2">d</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">63616</span><span class="s1">);</span><span class="s4">var </span><span class="s2">c</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">5739</span><span class="s1">);</span><span class="s4">var </span><span class="s2">l</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">53110</span><span class="s1">);</span><span class="s4">var </span><span class="s2">u</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">74356</span><span class="s1">);</span><span class="s4">const </span><span class="s2">h</span><span class="s1">=</span><span class="s3">3e4</span><span class="s1">;</span><span class="s4">class </span><span class="s2">g </span><span class="s4">extends </span><span class="s2">c</span><span class="s1">.</span><span class="s2">c</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">super</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">clientID</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">clientID</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_checkInterval</span><span class="s1">=</span><span class="s2">setInterval</span><span class="s1">((()=&gt;{</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">r</span><span class="s1">.</span><span class="s2">_g</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getLocalState</span><span class="s1">()!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">/</span><span class="s3">2</span><span class="s1">&lt;=</span><span class="s2">t</span><span class="s1">-</span><span class="s4">this</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">clientID</span><span class="s1">).</span><span class="s2">lastUpdated</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setLocalState</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getLocalState</span><span class="s1">())}</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=[];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(((</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">!==</span><span class="s4">this</span><span class="s1">.</span><span class="s2">clientID</span><span class="s1">&amp;&amp;</span><span class="s2">h</span><span class="s1">&lt;=</span><span class="s2">t</span><span class="s1">-</span><span class="s2">s</span><span class="s1">.</span><span class="s2">lastUpdated</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)}}));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">p</span><span class="s1">(</span><span class="s4">this</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s0">&quot;timeout&quot;</span><span class="s1">)}}),</span><span class="s2">d</span><span class="s1">.</span><span class="s2">RI</span><span class="s1">(</span><span class="s2">h</span><span class="s1">/</span><span class="s3">10</span><span class="s1">));</span><span class="s2">t</span><span class="s1">.</span><span class="s2">on</span><span class="s1">(</span><span class="s0">&quot;destroy&quot;</span><span class="s1">,(()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">destroy</span><span class="s1">()}));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setLocalState</span><span class="s1">({})}</span><span class="s2">destroy</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">(</span><span class="s0">&quot;destroy&quot;</span><span class="s1">,[</span><span class="s4">this</span><span class="s1">]);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setLocalState</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">super</span><span class="s1">.</span><span class="s2">destroy</span><span class="s1">();</span><span class="s2">clearInterval</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_checkInterval</span><span class="s1">)}</span><span class="s2">getLocalState</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">clientID</span><span class="s1">)||</span><span class="s4">null</span><span class="s1">}</span><span class="s2">setLocalState</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">clientID</span><span class="s1">;</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">clock</span><span class="s1">+</span><span class="s3">1</span><span class="s1">;</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">clock</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">lastUpdated</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">_g</span><span class="s1">()});</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=[];</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">const </span><span class="s2">d</span><span class="s1">=[];</span><span class="s4">const </span><span class="s2">c</span><span class="s1">=[];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">){</span><span class="s2">c</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">==</span><span class="s4">null</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">o</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">.</span><span class="s2">vo</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)){</span><span class="s2">d</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">d</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">c</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">(</span><span class="s0">&quot;change&quot;</span><span class="s1">,[{</span><span class="s2">added</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">updated</span><span class="s1">:</span><span class="s2">d</span><span class="s1">,</span><span class="s2">removed</span><span class="s1">:</span><span class="s2">c</span><span class="s1">},</span><span class="s0">&quot;local&quot;</span><span class="s1">])}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">(</span><span class="s0">&quot;update&quot;</span><span class="s1">,[{</span><span class="s2">added</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">updated</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">removed</span><span class="s1">:</span><span class="s2">c</span><span class="s1">},</span><span class="s0">&quot;local&quot;</span><span class="s1">])}</span><span class="s2">setLocalStateField</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getLocalState</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">!==</span><span class="s4">null</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setLocalState</span><span class="s1">({</span><span class="s2">...s</span><span class="s1">,[</span><span class="s2">t</span><span class="s1">]:</span><span class="s2">e</span><span class="s1">})}}</span><span class="s2">getStates</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">states</span><span class="s1">}}</span><span class="s4">const </span><span class="s2">p</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">a</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">a</span><span class="s1">++){</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">a</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">===</span><span class="s2">t</span><span class="s1">.</span><span class="s2">clientID</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,{</span><span class="s2">clock</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">clock</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">lastUpdated</span><span class="s1">:</span><span class="s2">r</span><span class="s1">.</span><span class="s2">_g</span><span class="s1">()})}</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">(</span><span class="s0">&quot;change&quot;</span><span class="s1">,[{</span><span class="s2">added</span><span class="s1">:[],</span><span class="s2">updated</span><span class="s1">:[],</span><span class="s2">removed</span><span class="s1">:</span><span class="s2">n</span><span class="s1">},</span><span class="s2">s</span><span class="s1">]);</span><span class="s2">t</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">(</span><span class="s0">&quot;update&quot;</span><span class="s1">,[{</span><span class="s2">added</span><span class="s1">:[],</span><span class="s2">updated</span><span class="s1">:[],</span><span class="s2">removed</span><span class="s1">:</span><span class="s2">n</span><span class="s1">},</span><span class="s2">s</span><span class="s1">])}};</span><span class="s4">const </span><span class="s2">m</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">states</span><span class="s1">)=&gt;{</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">createEncoder</span><span class="s1">();</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">writeVarUint</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">o</span><span class="s1">&lt;</span><span class="s2">n</span><span class="s1">;</span><span class="s2">o</span><span class="s1">++){</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s2">o</span><span class="s1">];</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)||</span><span class="s4">null</span><span class="s1">;</span><span class="s4">const </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">n</span><span class="s1">).</span><span class="s2">clock</span><span class="s1">;</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">writeVarUint</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">writeVarUint</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">writeVarString</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">i</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">toUint8Array</span><span class="s1">(</span><span class="s2">a</span><span class="s1">)};</span><span class="s4">const </span><span class="s2">y</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">createDecoder</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">createEncoder</span><span class="s1">();</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">readVarUint</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">writeVarUint</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">a</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">o</span><span class="s1">&lt;</span><span class="s2">a</span><span class="s1">;</span><span class="s2">o</span><span class="s1">++){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">readVarUint</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">readVarUint</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">parse</span><span class="s1">(</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">readVarString</span><span class="s1">(</span><span class="s2">s</span><span class="s1">));</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">(</span><span class="s2">o</span><span class="s1">);</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">writeVarUint</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">writeVarUint</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">a</span><span class="s1">);</span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">writeVarString</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s2">i</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">encoding</span><span class="s1">.</span><span class="s2">toUint8Array</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)};</span><span class="s4">const </span><span class="s2">_</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">createDecoder</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">time</span><span class="s1">.</span><span class="s2">getUnixTime</span><span class="s1">();</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=[];</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=[];</span><span class="s4">const </span><span class="s2">r</span><span class="s1">=[];</span><span class="s4">const </span><span class="s2">d</span><span class="s1">=[];</span><span class="s4">const </span><span class="s2">c</span><span class="s1">=</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">readVarUint</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">l</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">l</span><span class="s1">&lt;</span><span class="s2">c</span><span class="s1">;</span><span class="s2">l</span><span class="s1">++){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">readVarUint</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">readVarUint</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s4">const </span><span class="s2">c</span><span class="s1">=</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">parse</span><span class="s1">(</span><span class="s2">decoding</span><span class="s1">.</span><span class="s2">readVarString</span><span class="s1">(</span><span class="s2">n</span><span class="s1">));</span><span class="s4">const </span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">const </span><span class="s2">u</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">const </span><span class="s2">h</span><span class="s1">=</span><span class="s2">l</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">?</span><span class="s3">0</span><span class="s1">:</span><span class="s2">l</span><span class="s1">.</span><span class="s2">clock</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">h</span><span class="s1">&lt;</span><span class="s2">s</span><span class="s1">||</span><span class="s2">h</span><span class="s1">===</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">c</span><span class="s1">===</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">c</span><span class="s1">===</span><span class="s4">null</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">===</span><span class="s2">t</span><span class="s1">.</span><span class="s2">clientID</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">getLocalState</span><span class="s1">()!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">s</span><span class="s1">++}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">states</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">c</span><span class="s1">)}</span><span class="s2">t</span><span class="s1">.</span><span class="s2">meta</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">clock</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">lastUpdated</span><span class="s1">:</span><span class="s2">a</span><span class="s1">});</span><span class="s4">if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">&amp;&amp;</span><span class="s2">c</span><span class="s1">!==</span><span class="s4">null</span><span class="s1">){</span><span class="s2">o</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">l</span><span class="s1">!==</span><span class="s2">undefined</span><span class="s1">&amp;&amp;</span><span class="s2">c</span><span class="s1">===</span><span class="s4">null</span><span class="s1">){</span><span class="s2">d</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">c</span><span class="s1">!==</span><span class="s4">null</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">f</span><span class="s1">.</span><span class="s2">equalityDeep</span><span class="s1">(</span><span class="s2">c</span><span class="s1">,</span><span class="s2">u</span><span class="s1">)){</span><span class="s2">r</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">i</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">r</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">d</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">(</span><span class="s0">&quot;change&quot;</span><span class="s1">,[{</span><span class="s2">added</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">updated</span><span class="s1">:</span><span class="s2">r</span><span class="s1">,</span><span class="s2">removed</span><span class="s1">:</span><span class="s2">d</span><span class="s1">},</span><span class="s2">s</span><span class="s1">])}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">d</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">(</span><span class="s0">&quot;update&quot;</span><span class="s1">,[{</span><span class="s2">added</span><span class="s1">:</span><span class="s2">o</span><span class="s1">,</span><span class="s2">updated</span><span class="s1">:</span><span class="s2">i</span><span class="s1">,</span><span class="s2">removed</span><span class="s1">:</span><span class="s2">d</span><span class="s1">},</span><span class="s2">s</span><span class="s1">])}};</span><span class="s4">class </span><span class="s2">b</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">var </span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">onStateChanged</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Array</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">keysChanged</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">((</span><span class="s2">s</span><span class="s1">=&gt;{</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">name</span><span class="s1">:</span><span class="s2">s</span><span class="s1">,</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ystate</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)})}}));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">stateChange</span><span class="s1">:</span><span class="s2">e</span><span class="s1">})};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">=</span><span class="s4">new </span><span class="s2">i</span><span class="s1">.</span><span class="s2">Signal</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_isDisposed</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_disposed</span><span class="s1">=</span><span class="s4">new </span><span class="s2">i</span><span class="s1">.</span><span class="s2">Signal</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ydoc</span><span class="s1">=(</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ydoc</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">Doc</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ystate</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ydoc</span><span class="s1">.</span><span class="s2">getMap</span><span class="s1">(</span><span class="s0">&quot;state&quot;</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">UndoManager</span><span class="s1">([],{</span><span class="s2">trackedOrigins</span><span class="s1">:</span><span class="s4">new </span><span class="s2">Set</span><span class="s1">([</span><span class="s4">this</span><span class="s1">]),</span><span class="s2">doc</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ydoc</span><span class="s1">});</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_awareness</span><span class="s1">=</span><span class="s4">new </span><span class="s2">g</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ydoc</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ystate</span><span class="s1">.</span><span class="s2">observe</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">onStateChanged</span><span class="s1">)}</span><span class="s2">get ydoc</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_ydoc</span><span class="s1">}</span><span class="s2">get ystate</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_ystate</span><span class="s1">}</span><span class="s2">get undoManager</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">}</span><span class="s2">get awareness</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_awareness</span><span class="s1">}</span><span class="s2">get changed</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">}</span><span class="s2">get disposed</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_disposed</span><span class="s1">}</span><span class="s2">get isDisposed</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_isDisposed</span><span class="s1">}</span><span class="s2">get state</span><span class="s1">(){</span><span class="s4">return </span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ystate</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">())}</span><span class="s2">canUndo</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">undoStack</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">canRedo</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">redoStack</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">dispose</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_isDisposed</span><span class="s1">){</span><span class="s4">return</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_isDisposed</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ystate</span><span class="s1">.</span><span class="s2">unobserve</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">onStateChanged</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">awareness</span><span class="s1">.</span><span class="s2">destroy</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">destroy</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ydoc</span><span class="s1">.</span><span class="s2">destroy</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_disposed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">();</span><span class="s2">i</span><span class="s1">.</span><span class="s2">Signal</span><span class="s1">.</span><span class="s2">clearData</span><span class="s1">(</span><span class="s4">this</span><span class="s1">)}</span><span class="s2">getState</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ystate</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return typeof </span><span class="s2">e</span><span class="s1">===</span><span class="s0">&quot;undefined&quot;</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">setState</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ystate</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">),</span><span class="s2">e</span><span class="s1">)){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ystate</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}}</span><span class="s2">get source</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">getSource</span><span class="s1">()}</span><span class="s2">set source</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setSource</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">undo</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">undo</span><span class="s1">()}</span><span class="s2">redo</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">redo</span><span class="s1">()}</span><span class="s2">clearUndoHistory</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">clear</span><span class="s1">()}</span><span class="s2">transact</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">true</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ydoc</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s2">s</span><span class="s1">)}}</span><span class="s4">class </span><span class="s2">v </span><span class="s4">extends </span><span class="s2">b</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(){</span><span class="s4">super</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">version</span><span class="s1">=</span><span class="s0">&quot;1.0.0&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ydoc</span><span class="s1">.</span><span class="s2">getText</span><span class="s1">(</span><span class="s0">&quot;source&quot;</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_modelObserver</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">sourceChange</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">delta</span><span class="s1">})};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">addToScope</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">.</span><span class="s2">observe</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_modelObserver</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(){</span><span class="s4">return new </span><span class="s2">v</span><span class="s1">}</span><span class="s2">get source</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">getSource</span><span class="s1">()}</span><span class="s2">set source</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setSource</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">dispose</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isDisposed</span><span class="s1">){</span><span class="s4">return</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">.</span><span class="s2">unobserve</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_modelObserver</span><span class="s1">);</span><span class="s4">super</span><span class="s1">.</span><span class="s2">dispose</span><span class="s1">()}</span><span class="s2">getSource</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">.</span><span class="s2">toString</span><span class="s1">()}</span><span class="s2">setSource</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}))}</span><span class="s2">updateSource</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">t</span><span class="s1">+</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">)}))}}</span><span class="s4">const </span><span class="s2">M</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">={})=&gt;{</span><span class="s4">switch</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;cell_type&quot;</span><span class="s1">)){</span><span class="s4">case</span><span class="s0">&quot;code&quot;</span><span class="s1">:</span><span class="s4">return new </span><span class="s2">C</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;source&quot;</span><span class="s1">),</span><span class="s2">t</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;outputs&quot;</span><span class="s1">),</span><span class="s2">e</span><span class="s1">);</span><span class="s4">case</span><span class="s0">&quot;markdown&quot;</span><span class="s1">:</span><span class="s4">return new </span><span class="s2">V</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;source&quot;</span><span class="s1">),</span><span class="s2">e</span><span class="s1">);</span><span class="s4">case</span><span class="s0">&quot;raw&quot;</span><span class="s1">:</span><span class="s4">return new </span><span class="s2">x</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;source&quot;</span><span class="s1">),</span><span class="s2">e</span><span class="s1">);</span><span class="s4">default</span><span class="s1">:</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Found unknown cell type&quot;</span><span class="s1">)}};</span><span class="s4">const </span><span class="s2">S</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">var </span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">;</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">Map</span><span class="s1">;</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">Text</span><span class="s1">;</span><span class="s4">const </span><span class="s2">r</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">Map</span><span class="s1">;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;source&quot;</span><span class="s1">,</span><span class="s2">i</span><span class="s1">);</span><span class="s2">a</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">,</span><span class="s2">r</span><span class="s1">);</span><span class="s2">a</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;cell_type&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">cell_type</span><span class="s1">);</span><span class="s2">a</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">,(</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s2">o</span><span class="s1">.</span><span class="s2">UUID</span><span class="s1">.</span><span class="s2">uuid4</span><span class="s1">());</span><span class="s4">let </span><span class="s2">d</span><span class="s1">;</span><span class="s4">switch</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">cell_type</span><span class="s1">){</span><span class="s4">case</span><span class="s0">&quot;markdown&quot;</span><span class="s1">:{</span><span class="s2">d</span><span class="s1">=</span><span class="s4">new </span><span class="s2">V</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,{</span><span class="s2">notebook</span><span class="s1">:</span><span class="s2">e</span><span class="s1">},</span><span class="s2">r</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">attachments</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">d</span><span class="s1">.</span><span class="s2">setAttachments</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">attachments</span><span class="s1">)}</span><span class="s4">break</span><span class="s1">}</span><span class="s4">case</span><span class="s0">&quot;code&quot;</span><span class="s1">:{</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">Array</span><span class="s1">;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;outputs&quot;</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">d</span><span class="s1">=</span><span class="s4">new </span><span class="s2">C</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,{</span><span class="s2">notebook</span><span class="s1">:</span><span class="s2">e</span><span class="s1">},</span><span class="s2">r</span><span class="s1">);</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s2">d</span><span class="s1">.</span><span class="s2">execution_count</span><span class="s1">=(</span><span class="s2">n</span><span class="s1">=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">execution_count</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">n</span><span class="s1">:</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">outputs</span><span class="s1">){</span><span class="s2">d</span><span class="s1">.</span><span class="s2">setOutputs</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">outputs</span><span class="s1">)}</span><span class="s4">break</span><span class="s1">}</span><span class="s4">default</span><span class="s1">:{</span><span class="s2">d</span><span class="s1">=</span><span class="s4">new </span><span class="s2">x</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,{</span><span class="s2">notebook</span><span class="s1">:</span><span class="s2">e</span><span class="s1">},</span><span class="s2">r</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">attachments</span><span class="s1">){</span><span class="s2">d</span><span class="s1">.</span><span class="s2">setAttachments</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">attachments</span><span class="s1">)}</span><span class="s4">break</span><span class="s1">}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">d</span><span class="s1">.</span><span class="s2">setMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">source</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">d</span><span class="s1">.</span><span class="s2">setSource</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">.</span><span class="s2">source</span><span class="s1">===</span><span class="s0">&quot;string&quot;</span><span class="s1">?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">source</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">source</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">d</span><span class="s1">};</span><span class="s4">const </span><span class="s2">w</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">S</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">class </span><span class="s2">k</span><span class="s1">{</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return </span><span class="s2">S</span><span class="s1">({</span><span class="s2">id</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">cell_type</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">cell_type</span><span class="s1">})}</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">={},</span><span class="s2">n</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_modelObserver</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">origin</span><span class="s1">!==</span><span class="s0">&quot;silent-change&quot;</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getChanges</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))}};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">=</span><span class="s4">new </span><span class="s2">i</span><span class="s1">.</span><span class="s2">Signal</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_notebook</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">=</span><span class="s4">new </span><span class="s2">i</span><span class="s1">.</span><span class="s2">Signal</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_disposed</span><span class="s1">=</span><span class="s4">new </span><span class="s2">i</span><span class="s1">.</span><span class="s2">Signal</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_isDisposed</span><span class="s1">=</span><span class="s4">false</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ysource</span><span class="s1">=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">=</span><span class="s2">n</span><span class="s1">!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">n</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_prevSourceLength</span><span class="s1">=</span><span class="s2">e</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">:</span><span class="s3">0</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_notebook</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_awareness</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">=</span><span class="s4">null</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_notebook</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">Doc</span><span class="s1">;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">getArray</span><span class="s1">().</span><span class="s2">insert</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,[</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">]);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_awareness</span><span class="s1">=</span><span class="s4">new </span><span class="s2">g</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">UndoManager</span><span class="s1">([</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">],{</span><span class="s2">trackedOrigins</span><span class="s1">:</span><span class="s4">new </span><span class="s2">Set</span><span class="s1">([</span><span class="s4">this</span><span class="s1">])})}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">observeDeep</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_modelObserver</span><span class="s1">)}</span><span class="s2">get awareness</span><span class="s1">(){</span><span class="s4">var </span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">;</span><span class="s4">return</span><span class="s1">(</span><span class="s2">s</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_awareness</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">t</span><span class="s1">:(</span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">e</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">awareness</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s4">null</span><span class="s1">}</span><span class="s2">get cell_type</span><span class="s1">(){</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;A YBaseCell must not be constructed&quot;</span><span class="s1">)}</span><span class="s2">get changed</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">}</span><span class="s2">get disposed</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_disposed</span><span class="s1">}</span><span class="s2">get id</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">getId</span><span class="s1">()}</span><span class="s2">get isDisposed</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_isDisposed</span><span class="s1">}</span><span class="s2">get isStandalone</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_notebook</span><span class="s1">!==</span><span class="s4">null</span><span class="s1">}</span><span class="s2">get metadata</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">()}</span><span class="s2">set metadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">get metadataChanged</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">}</span><span class="s2">get notebook</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_notebook</span><span class="s1">}</span><span class="s2">get source</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">getSource</span><span class="s1">()}</span><span class="s2">set source</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setSource</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">get undoManager</span><span class="s1">(){</span><span class="s4">var </span><span class="s2">t</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">}</span><span class="s4">return</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">disableDocumentWideUndoRedo</span><span class="s1">)?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">}</span><span class="s2">setUndoManager</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">){</span><span class="s4">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;The cell undo manager is already set.&quot;</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_notebook</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_notebook</span><span class="s1">.</span><span class="s2">disableDocumentWideUndoRedo</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">UndoManager</span><span class="s1">([</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">],{</span><span class="s2">trackedOrigins</span><span class="s1">:</span><span class="s4">new </span><span class="s2">Set</span><span class="s1">([</span><span class="s4">this</span><span class="s1">])})}}</span><span class="s2">get ysource</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_ysource</span><span class="s1">}</span><span class="s2">canUndo</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">!!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">undoStack</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">canRedo</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">!!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">redoStack</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">}</span><span class="s2">clearUndoHistory</span><span class="s1">(){</span><span class="s4">var </span><span class="s2">t</span><span class="s1">;(</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">clear</span><span class="s1">()}</span><span class="s2">undo</span><span class="s1">(){</span><span class="s4">var </span><span class="s2">t</span><span class="s1">;(</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">undo</span><span class="s1">()}</span><span class="s2">redo</span><span class="s1">(){</span><span class="s4">var </span><span class="s2">t</span><span class="s1">;(</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">redo</span><span class="s1">()}</span><span class="s2">dispose</span><span class="s1">(){</span><span class="s4">var </span><span class="s2">t</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_isDisposed</span><span class="s1">)</span><span class="s4">return</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_isDisposed</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">unobserveDeep</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_modelObserver</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_awareness</span><span class="s1">){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_awareness</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_awareness</span><span class="s1">.</span><span class="s2">destroy</span><span class="s1">();</span><span class="s2">t</span><span class="s1">.</span><span class="s2">destroy</span><span class="s1">()}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">===((</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">)){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">=</span><span class="s4">null</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_undoManager</span><span class="s1">.</span><span class="s2">destroy</span><span class="s1">()}}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_disposed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">();</span><span class="s2">i</span><span class="s1">.</span><span class="s2">Signal</span><span class="s1">.</span><span class="s2">clearData</span><span class="s1">(</span><span class="s4">this</span><span class="s1">)}</span><span class="s2">getId</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;id&quot;</span><span class="s1">)}</span><span class="s2">getSource</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">.</span><span class="s2">toString</span><span class="s1">()}</span><span class="s2">setSource</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}))}</span><span class="s2">updateSource</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s0">&quot;&quot;</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ysource</span><span class="s1">;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">t</span><span class="s1">+</span><span class="s2">s</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">)}))}</span><span class="s2">deleteMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)===</span><span class="s0">&quot;undefined&quot;</span><span class="s1">){</span><span class="s4">return</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s0">&quot;jupyter&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">===</span><span class="s0">&quot;collapsed&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">){</span><span class="s4">const</span><span class="s1">{</span><span class="s2">outputs_hidden</span><span class="s1">:</span><span class="s2">t</span><span class="s1">,</span><span class="s2">...s</span><span class="s1">}=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">s</span><span class="s1">).</span><span class="s2">length</span><span class="s1">===</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s0">&quot;jupyter&quot;</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;jupyter&quot;</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">===</span><span class="s0">&quot;jupyter&quot;</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s0">&quot;collapsed&quot;</span><span class="s1">)}}),</span><span class="s4">false</span><span class="s1">)}</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">){</span><span class="s4">return </span><span class="s2">undefined</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">===</span><span class="s0">&quot;string&quot;</span><span class="s1">){</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return typeof </span><span class="s2">s</span><span class="s1">===</span><span class="s0">&quot;undefined&quot;</span><span class="s1">?</span><span class="s2">undefined</span><span class="s1">:</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">return </span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">())}}</span><span class="s2">setMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">var </span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">===</span><span class="s0">&quot;string&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">e</span><span class="s1">===</span><span class="s0">&quot;undefined&quot;</span><span class="s1">){</span><span class="s4">throw new </span><span class="s2">TypeError</span><span class="s1">(</span><span class="s0">`Metadata value for </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">} </span><span class="s0">cannot be 'undefined'; use deleteMetadata.`</span><span class="s1">)}</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">((</span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s2">n</span><span class="s1">))!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s4">null</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)){</span><span class="s4">return</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">var </span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">===</span><span class="s0">&quot;collapsed&quot;</span><span class="s1">){</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s0">&quot;jupyter&quot;</span><span class="s1">))!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">t</span><span class="s1">:{};</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">outputs_hidden</span><span class="s1">!==</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMetadata</span><span class="s1">(</span><span class="s0">&quot;jupyter&quot;</span><span class="s1">,{</span><span class="s2">...s</span><span class="s1">,</span><span class="s2">outputs_hidden</span><span class="s1">:</span><span class="s2">e</span><span class="s1">})}}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">===</span><span class="s0">&quot;jupyter&quot;</span><span class="s1">){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">[</span><span class="s0">&quot;outputs_hidden&quot;</span><span class="s1">];</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">!==</span><span class="s0">&quot;undefined&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s0">&quot;collapsed&quot;</span><span class="s1">)!==</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMetadata</span><span class="s1">(</span><span class="s0">&quot;collapsed&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">deleteMetadata</span><span class="s1">(</span><span class="s0">&quot;collapsed&quot;</span><span class="s1">)}}}),</span><span class="s4">false</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">collapsed</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">jupyter</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">jupyter</span><span class="s1">||{};</span><span class="s2">e</span><span class="s1">.</span><span class="s2">jupyter</span><span class="s1">.</span><span class="s2">outputs_hidden</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">collapsed</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(((</span><span class="s2">n</span><span class="s1">=</span><span class="s2">e</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">e</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">e</span><span class="s1">.</span><span class="s2">jupyter</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">n</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">n</span><span class="s1">.</span><span class="s2">outputs_hidden</span><span class="s1">)!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">collapsed</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">jupyter</span><span class="s1">.</span><span class="s2">outputs_hidden</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">())){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const</span><span class="s1">[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">]</span><span class="s2">of Object</span><span class="s1">.</span><span class="s2">entries</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}}),</span><span class="s4">false</span><span class="s1">)}}}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">{</span><span class="s2">id</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getId</span><span class="s1">(),</span><span class="s2">cell_type</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cell_type</span><span class="s1">,</span><span class="s2">source</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getSource</span><span class="s1">(),</span><span class="s2">metadata</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">()}}</span><span class="s2">transact</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">=</span><span class="s4">true</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">||</span><span class="s4">this</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">.</span><span class="s2">disableDocumentWideUndoRedo</span><span class="s1">?</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">==</span><span class="s4">null</span><span class="s1">?</span><span class="s2">t</span><span class="s1">():</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">doc</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">?</span><span class="s4">this</span><span class="s1">:</span><span class="s2">s</span><span class="s1">):</span><span class="s4">this</span><span class="s1">.</span><span class="s2">notebook</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">getChanges</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">={};</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">===</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;source&quot;</span><span class="s1">)));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sourceChange</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">delta</span><span class="s1">}</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">===</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">metadataChange</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">switch</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">action</span><span class="s1">){</span><span class="s4">case</span><span class="s0">&quot;add&quot;</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">key</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">),</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;add&quot;</span><span class="s1">});</span><span class="s4">break</span><span class="s1">;</span><span class="s4">case</span><span class="s0">&quot;delete&quot;</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">key</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;remove&quot;</span><span class="s1">});</span><span class="s4">break</span><span class="s1">;</span><span class="s4">case</span><span class="s0">&quot;update&quot;</span><span class="s1">:{</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ymetadata</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">n</span><span class="s1">==</span><span class="s0">&quot;object&quot;</span><span class="s1">&amp;&amp;</span><span class="s4">typeof </span><span class="s2">s</span><span class="s1">==</span><span class="s0">&quot;object&quot;</span><span class="s1">){</span><span class="s2">a</span><span class="s1">=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">a</span><span class="s1">=</span><span class="s2">n</span><span class="s1">===</span><span class="s2">s</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">a</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">key</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;change&quot;</span><span class="s1">,</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">n</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s2">s</span><span class="s1">})}}</span><span class="s4">break</span><span class="s1">}}))}</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">===</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">));</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;source&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&amp;&amp;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">keysChanged</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s0">&quot;source&quot;</span><span class="s1">)){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">sourceChange</span><span class="s1">=[{</span><span class="s4">delete</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_prevSourceLength</span><span class="s1">},{</span><span class="s2">insert</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">toString</span><span class="s1">()}]}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_prevSourceLength</span><span class="s1">=</span><span class="s2">i</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">C </span><span class="s4">extends </span><span class="s2">k</span><span class="s1">{</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return super</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">={},</span><span class="s2">a</span><span class="s1">){</span><span class="s4">super</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">a</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}</span><span class="s2">get cell_type</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">&quot;code&quot;</span><span class="s1">}</span><span class="s2">get execution_count</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;execution_count&quot;</span><span class="s1">)||</span><span class="s4">null</span><span class="s1">}</span><span class="s2">set execution_count</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;execution_count&quot;</span><span class="s1">)!==</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;execution_count&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}),</span><span class="s4">false</span><span class="s1">)}}</span><span class="s2">get executionState</span><span class="s1">(){</span><span class="s4">var </span><span class="s2">t</span><span class="s1">;</span><span class="s4">return</span><span class="s1">(</span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;execution_state&quot;</span><span class="s1">))!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">t</span><span class="s1">:</span><span class="s0">&quot;idle&quot;</span><span class="s1">}</span><span class="s2">set executionState</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;execution_state&quot;</span><span class="s1">)!==</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;execution_state&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}),</span><span class="s4">false</span><span class="s1">)}}</span><span class="s2">get outputs</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">getOutputs</span><span class="s1">()}</span><span class="s2">set outputs</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setOutputs</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">get youtputs</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">}</span><span class="s2">getOutputs</span><span class="s1">(){</span><span class="s4">return </span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">())}</span><span class="s2">createOutputs</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">s of o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">let </span><span class="s2">t</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">output_type</span><span class="s1">===</span><span class="s0">&quot;stream&quot;</span><span class="s1">){</span><span class="s4">const</span><span class="s1">{</span><span class="s2">text</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">...n</span><span class="s1">}=</span><span class="s2">s</span><span class="s1">;</span><span class="s2">t</span><span class="s1">=</span><span class="s2">n</span><span class="s1">;</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">Text</span><span class="s1">;</span><span class="s4">let </span><span class="s2">o</span><span class="s1">=</span><span class="s2">e </span><span class="s4">instanceof </span><span class="s2">Array</span><span class="s1">?</span><span class="s2">e</span><span class="s1">.</span><span class="s2">join</span><span class="s1">():</span><span class="s2">e</span><span class="s1">;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">o</span><span class="s1">);</span><span class="s2">t</span><span class="s1">[</span><span class="s0">&quot;text&quot;</span><span class="s1">]=</span><span class="s2">a</span><span class="s1">}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">t</span><span class="s1">=</span><span class="s2">s</span><span class="s1">}</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const</span><span class="s1">[</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">]</span><span class="s2">of Object</span><span class="s1">.</span><span class="s2">entries</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)){</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">([</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">])}</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">Map</span><span class="s1">(</span><span class="s2">n</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">a</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}</span><span class="s2">setOutputs</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">);</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">createOutputs</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}),</span><span class="s4">false</span><span class="s1">)}</span><span class="s2">removeStreamOutput</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;text&quot;</span><span class="s1">);</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">e</span><span class="s1">;</span><span class="s2">n</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">a</span><span class="s1">)}),</span><span class="s4">false</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">appendStreamOutput</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;text&quot;</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}),</span><span class="s4">false</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">updateOutputs</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=[],</span><span class="s2">n</span><span class="s1">=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">e</span><span class="s1">&lt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">?</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s2">t</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">a</span><span class="s1">);</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">createOutputs</span><span class="s1">(</span><span class="s2">s</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_youtputs</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}),</span><span class="s4">false</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">{</span><span class="s2">...</span><span class="s4">super</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">(),</span><span class="s2">outputs</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getOutputs</span><span class="s1">(),</span><span class="s2">execution_count</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">execution_count</span><span class="s1">}}</span><span class="s2">getChanges</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">super</span><span class="s1">.</span><span class="s2">getChanges</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">path</span><span class="s1">.</span><span class="s2">length</span><span class="s1">===</span><span class="s3">3</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">path</span><span class="s1">[</span><span class="s3">0</span><span class="s1">]===</span><span class="s0">&quot;outputs&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">path</span><span class="s1">[</span><span class="s3">2</span><span class="s1">]===</span><span class="s0">&quot;text&quot;</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">streamOutputChange</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">delta</span><span class="s1">}</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">===</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;outputs&quot;</span><span class="s1">)));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">){</span><span class="s2">e</span><span class="s1">.</span><span class="s2">outputsChange</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">delta</span><span class="s1">}</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">===</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&amp;&amp;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">keysChanged</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s0">&quot;execution_count&quot;</span><span class="s1">)){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;execution_count&quot;</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">executionCountChange</span><span class="s1">={</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;execution_count&quot;</span><span class="s1">)}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&amp;&amp;</span><span class="s2">a</span><span class="s1">.</span><span class="s2">keysChanged</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s0">&quot;execution_state&quot;</span><span class="s1">)){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">a</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;execution_state&quot;</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">executionStateChange</span><span class="s1">={</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;execution_state&quot;</span><span class="s1">)}}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">O </span><span class="s4">extends </span><span class="s2">k</span><span class="s1">{</span><span class="s2">get attachments</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">getAttachments</span><span class="s1">()}</span><span class="s2">set attachments</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setAttachments</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">getAttachments</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;attachments&quot;</span><span class="s1">)}</span><span class="s2">setAttachments</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">null</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s0">&quot;attachments&quot;</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;attachments&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}}),</span><span class="s4">false</span><span class="s1">)}</span><span class="s2">getChanges</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">super</span><span class="s1">.</span><span class="s2">getChanges</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">===</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">.</span><span class="s2">keysChanged</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s0">&quot;attachments&quot;</span><span class="s1">)){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;attachments&quot;</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">attachmentsChange</span><span class="s1">={</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;attachments&quot;</span><span class="s1">)}}</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}}</span><span class="s4">class </span><span class="s2">x </span><span class="s4">extends </span><span class="s2">O</span><span class="s1">{</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return super</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">get cell_type</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">&quot;raw&quot;</span><span class="s1">}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">{</span><span class="s2">id</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getId</span><span class="s1">(),</span><span class="s2">cell_type</span><span class="s1">:</span><span class="s0">&quot;raw&quot;</span><span class="s1">,</span><span class="s2">source</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getSource</span><span class="s1">(),</span><span class="s2">metadata</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(),</span><span class="s2">attachments</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getAttachments</span><span class="s1">()}}}</span><span class="s4">class </span><span class="s2">V </span><span class="s4">extends </span><span class="s2">O</span><span class="s1">{</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return super</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">get cell_type</span><span class="s1">(){</span><span class="s4">return</span><span class="s0">&quot;markdown&quot;</span><span class="s1">}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">return</span><span class="s1">{</span><span class="s2">id</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getId</span><span class="s1">(),</span><span class="s2">cell_type</span><span class="s1">:</span><span class="s0">&quot;markdown&quot;</span><span class="s1">,</span><span class="s2">source</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getSource</span><span class="s1">(),</span><span class="s2">metadata</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(),</span><span class="s2">attachments</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getAttachments</span><span class="s1">()}}}</span><span class="s4">class </span><span class="s2">E </span><span class="s4">extends </span><span class="s2">b</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">={}){</span><span class="s4">var </span><span class="s2">e</span><span class="s1">;</span><span class="s4">super</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">version</span><span class="s1">=</span><span class="s0">&quot;2.0.0&quot;</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ydoc</span><span class="s1">.</span><span class="s2">getMap</span><span class="s1">(</span><span class="s0">&quot;meta&quot;</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_onMetaChanged</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">===</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">)));</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">;</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">);</span><span class="s2">e</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">switch</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">action</span><span class="s1">){</span><span class="s4">case</span><span class="s0">&quot;add&quot;</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">key</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;add&quot;</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)});</span><span class="s4">break</span><span class="s1">;</span><span class="s4">case</span><span class="s0">&quot;delete&quot;</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">key</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;remove&quot;</span><span class="s1">,</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">});</span><span class="s4">break</span><span class="s1">;</span><span class="s4">case</span><span class="s0">&quot;update&quot;</span><span class="s1">:{</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">;</span><span class="s4">let </span><span class="s2">i</span><span class="s1">=</span><span class="s4">true</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">a</span><span class="s1">==</span><span class="s0">&quot;object&quot;</span><span class="s1">&amp;&amp;</span><span class="s4">typeof </span><span class="s2">n</span><span class="s1">==</span><span class="s0">&quot;object&quot;</span><span class="s1">){</span><span class="s2">i</span><span class="s1">=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s2">i</span><span class="s1">=</span><span class="s2">a</span><span class="s1">===</span><span class="s2">n</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">i</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">key</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;change&quot;</span><span class="s1">,</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">a</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s2">n</span><span class="s1">})}}</span><span class="s4">break</span><span class="s1">}}));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">metadataChange</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})}</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">find</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">target</span><span class="s1">===</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">));</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">){</span><span class="s4">return</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">keysChanged</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">)){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">((</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">action</span><span class="s1">)===</span><span class="s0">&quot;add&quot;</span><span class="s1">&amp;&amp;!</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">e of Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">)){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">action</span><span class="s1">:</span><span class="s0">&quot;add&quot;</span><span class="s1">,</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">undefined</span><span class="s1">});</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">key</span><span class="s1">:</span><span class="s2">e</span><span class="s1">,</span><span class="s2">type</span><span class="s1">:</span><span class="s0">&quot;add&quot;</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)})}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">metadataChange</span><span class="s1">:</span><span class="s2">t</span><span class="s1">})}}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">keysChanged</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s0">&quot;nbformat&quot;</span><span class="s1">)){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;nbformat&quot;</span><span class="s1">);</span><span class="s4">const </span><span class="s2">e</span><span class="s1">={</span><span class="s2">key</span><span class="s1">:</span><span class="s0">&quot;nbformat&quot;</span><span class="s1">,</span><span class="s2">oldValue</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">)?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">undefined</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nbformat</span><span class="s1">};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">nbformatChanged</span><span class="s1">:</span><span class="s2">e</span><span class="s1">})}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">keysChanged</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s0">&quot;nbformat_minor&quot;</span><span class="s1">)){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">s</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;nbformat_minor&quot;</span><span class="s1">);</span><span class="s4">const </span><span class="s2">e</span><span class="s1">={</span><span class="s2">key</span><span class="s1">:</span><span class="s0">&quot;nbformat_minor&quot;</span><span class="s1">,</span><span class="s2">oldValue</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">t</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">)?</span><span class="s2">t</span><span class="s1">.</span><span class="s2">oldValue</span><span class="s1">:</span><span class="s2">undefined</span><span class="s1">,</span><span class="s2">newValue</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nbformat_minor</span><span class="s1">};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">nbformatChanged</span><span class="s1">:</span><span class="s2">e</span><span class="s1">})}};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_onYCellsChanged</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">added</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">content</span><span class="s1">.</span><span class="s2">type</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s2">M</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">notebook</span><span class="s1">:</span><span class="s4">this</span><span class="s1">});</span><span class="s2">t</span><span class="s1">.</span><span class="s2">setUndoManager</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}}));</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">deleted</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">content</span><span class="s1">.</span><span class="s2">type</span><span class="s1">;</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">dispose</span><span class="s1">();</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}}));</span><span class="s4">let </span><span class="s2">e</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=[];</span><span class="s2">t</span><span class="s1">.</span><span class="s2">changes</span><span class="s1">.</span><span class="s2">delta</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)));</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">({</span><span class="s2">insert</span><span class="s1">:</span><span class="s2">n</span><span class="s1">});</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cells</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s3">0</span><span class="s1">,</span><span class="s2">...n</span><span class="s1">);</span><span class="s2">e</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">.</span><span class="s2">length</span><span class="s1">}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cells</span><span class="s1">.</span><span class="s2">splice</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">t</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">)}</span><span class="s4">else if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">retain</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">e</span><span class="s1">+=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">retain</span><span class="s1">}}));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_changed</span><span class="s1">.</span><span class="s2">emit</span><span class="s1">({</span><span class="s2">cellsChange</span><span class="s1">:</span><span class="s2">s</span><span class="s1">})};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">=</span><span class="s4">new </span><span class="s2">i</span><span class="s1">.</span><span class="s2">Signal</span><span class="s1">(</span><span class="s4">this</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ydoc</span><span class="s1">.</span><span class="s2">getArray</span><span class="s1">(</span><span class="s0">&quot;cells&quot;</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">=</span><span class="s4">new </span><span class="s2">WeakMap</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_disableDocumentWideUndoRedo</span><span class="s1">=(</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">disableDocumentWideUndoRedo</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s4">false</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cells</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">.</span><span class="s2">toArray</span><span class="s1">().</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">M</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,{</span><span class="s2">notebook</span><span class="s1">:</span><span class="s4">this</span><span class="s1">}))}</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">undoManager</span><span class="s1">.</span><span class="s2">addToScope</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">.</span><span class="s2">observe</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_onYCellsChanged</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">observeDeep</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_onMetaChanged</span><span class="s1">)}</span><span class="s4">static </span><span class="s2">create</span><span class="s1">(</span><span class="s2">t</span><span class="s1">={}){</span><span class="s4">var </span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">,</span><span class="s2">a</span><span class="s1">,</span><span class="s2">o</span><span class="s1">,</span><span class="s2">i</span><span class="s1">,</span><span class="s2">r</span><span class="s1">,</span><span class="s2">d</span><span class="s1">,</span><span class="s2">c</span><span class="s1">;</span><span class="s4">const </span><span class="s2">l</span><span class="s1">=</span><span class="s4">new </span><span class="s2">E</span><span class="s1">({</span><span class="s2">disableDocumentWideUndoRedo</span><span class="s1">:(</span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">disableDocumentWideUndoRedo</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s4">false</span><span class="s1">});</span><span class="s4">const </span><span class="s2">u</span><span class="s1">={</span><span class="s2">cells</span><span class="s1">:(</span><span class="s2">n</span><span class="s1">=(</span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">data</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">s</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">s</span><span class="s1">.</span><span class="s2">cells</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">n</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">n</span><span class="s1">:[],</span><span class="s2">nbformat</span><span class="s1">:(</span><span class="s2">o</span><span class="s1">=(</span><span class="s2">a</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">data</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">a</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">a</span><span class="s1">.</span><span class="s2">nbformat</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">o</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">o</span><span class="s1">:</span><span class="s3">4</span><span class="s1">,</span><span class="s2">nbformat_minor</span><span class="s1">:(</span><span class="s2">r</span><span class="s1">=(</span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">data</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">i</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">i</span><span class="s1">.</span><span class="s2">nbformat_minor</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">r</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">r</span><span class="s1">:</span><span class="s3">5</span><span class="s1">,</span><span class="s2">metadata</span><span class="s1">:(</span><span class="s2">c</span><span class="s1">=(</span><span class="s2">d</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">data</span><span class="s1">)===</span><span class="s4">null</span><span class="s1">||</span><span class="s2">d</span><span class="s1">===</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s4">void </span><span class="s3">0</span><span class="s1">:</span><span class="s2">d</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">)!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">c</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">c</span><span class="s1">:{}};</span><span class="s2">l</span><span class="s1">.</span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">u</span><span class="s1">);</span><span class="s4">return </span><span class="s2">l</span><span class="s1">}</span><span class="s2">get disableDocumentWideUndoRedo</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_disableDocumentWideUndoRedo</span><span class="s1">}</span><span class="s2">get metadata</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">()}</span><span class="s2">set metadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">get metadataChanged</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">_metadataChanged</span><span class="s1">}</span><span class="s2">get nbformat</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;nbformat&quot;</span><span class="s1">)}</span><span class="s2">set nbformat</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;nbformat&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}),</span><span class="s4">false</span><span class="s1">)}</span><span class="s2">get nbformat_minor</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;nbformat_minor&quot;</span><span class="s1">)}</span><span class="s2">set nbformat_minor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;nbformat_minor&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}),</span><span class="s4">false</span><span class="s1">)}</span><span class="s2">dispose</span><span class="s1">(){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">isDisposed</span><span class="s1">){</span><span class="s4">return</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">.</span><span class="s2">unobserve</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_onYCellsChanged</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">unobserveDeep</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_onMetaChanged</span><span class="s1">);</span><span class="s4">super</span><span class="s1">.</span><span class="s2">dispose</span><span class="s1">()}</span><span class="s2">getCell</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">cells</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]}</span><span class="s2">addCell</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">insertCell</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">insertCell</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">insertCells</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,[</span><span class="s2">e</span><span class="s1">])[</span><span class="s3">0</span><span class="s1">]}</span><span class="s2">insertCells</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">S</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycellMapping</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">return </span><span class="s2">e</span><span class="s1">}));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">ymodel</span><span class="s1">)))}));</span><span class="s2">s</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s2">t</span><span class="s1">.</span><span class="s2">setUndoManager</span><span class="s1">()}));</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}</span><span class="s2">moveCell</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">moveCells</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">moveCells</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">1</span><span class="s1">){</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Array</span><span class="s1">(</span><span class="s2">s</span><span class="s1">).</span><span class="s2">fill</span><span class="s1">(</span><span class="s4">true</span><span class="s1">).</span><span class="s2">map</span><span class="s1">(((</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getCell</span><span class="s1">(</span><span class="s2">t</span><span class="s1">+</span><span class="s2">s</span><span class="s1">).</span><span class="s2">toJSON</span><span class="s1">()));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">.</span><span class="s2">insert</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&gt;</span><span class="s2">e</span><span class="s1">?</span><span class="s2">e</span><span class="s1">:</span><span class="s2">e</span><span class="s1">-</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">,</span><span class="s2">n</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">S</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s4">this</span><span class="s1">).</span><span class="s2">ymodel</span><span class="s1">)))}))}</span><span class="s2">deleteCell</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">deleteCellRange</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">t</span><span class="s1">+</span><span class="s3">1</span><span class="s1">)}</span><span class="s2">deleteCellRange</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_ycells</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">-</span><span class="s2">t</span><span class="s1">)}))}</span><span class="s2">deleteMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)===</span><span class="s0">&quot;undefined&quot;</span><span class="s1">){</span><span class="s4">return</span><span class="s1">}</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">;</span><span class="s4">delete </span><span class="s2">e</span><span class="s1">[</span><span class="s2">t</span><span class="s1">];</span><span class="s4">this</span><span class="s1">.</span><span class="s2">setMetadata</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">){</span><span class="s4">return </span><span class="s2">undefined</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">===</span><span class="s0">&quot;string&quot;</span><span class="s1">){</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">return typeof </span><span class="s2">s</span><span class="s1">===</span><span class="s0">&quot;undefined&quot;</span><span class="s1">?</span><span class="s2">undefined</span><span class="s1">:</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">return </span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">())}}</span><span class="s2">setMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">var </span><span class="s2">s</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">===</span><span class="s0">&quot;string&quot;</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s4">typeof </span><span class="s2">e</span><span class="s1">===</span><span class="s0">&quot;undefined&quot;</span><span class="s1">){</span><span class="s4">throw new </span><span class="s2">TypeError</span><span class="s1">(</span><span class="s0">`Metadata value for </span><span class="s2">$</span><span class="s1">{</span><span class="s2">t</span><span class="s1">} </span><span class="s0">cannot be 'undefined'; use deleteMetadata.`</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">((</span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">getMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">))!==</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">s</span><span class="s1">!==</span><span class="s4">void </span><span class="s3">0</span><span class="s1">?</span><span class="s2">s</span><span class="s1">:</span><span class="s4">null</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)){</span><span class="s4">return</span><span class="s1">}</span><span class="s4">const </span><span class="s2">n</span><span class="s1">={};</span><span class="s2">n</span><span class="s1">[</span><span class="s2">t</span><span class="s1">]=</span><span class="s2">e</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">updateMetadata</span><span class="s1">(</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">||!</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepEqual</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">){</span><span class="s4">return </span><span class="s2">undefined</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">clear</span><span class="s1">();</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const</span><span class="s1">[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">]</span><span class="s2">of Object</span><span class="s1">.</span><span class="s2">entries</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}}))}}}</span><span class="s2">updateMetadata</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">o</span><span class="s1">.</span><span class="s2">JSONExt</span><span class="s1">.</span><span class="s2">deepCopy</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">){</span><span class="s4">return </span><span class="s2">undefined</span><span class="s1">}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const</span><span class="s1">[</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">]</span><span class="s2">of Object</span><span class="s1">.</span><span class="s2">entries</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}}))}</span><span class="s2">getSource</span><span class="s1">(){</span><span class="s4">return this</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">()}</span><span class="s2">setSource</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}</span><span class="s2">fromJSON</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">transact</span><span class="s1">((()=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nbformat</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nbformat</span><span class="s1">;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nbformat_minor</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nbformat_minor</span><span class="s1">;</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">;</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s0">&quot;orig_nbformat&quot;</span><span class="s1">]!==</span><span class="s2">undefined</span><span class="s1">){</span><span class="s4">delete </span><span class="s2">e</span><span class="s1">[</span><span class="s0">&quot;orig_nbformat&quot;</span><span class="s1">]}</span><span class="s4">if</span><span class="s1">(!</span><span class="s4">this</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s4">new </span><span class="s2">u</span><span class="s1">.</span><span class="s2">Map</span><span class="s1">;</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const</span><span class="s1">[</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">]</span><span class="s2">of Object</span><span class="s1">.</span><span class="s2">entries</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">)}</span><span class="s4">this</span><span class="s1">.</span><span class="s2">ymeta</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s0">&quot;metadata&quot;</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}</span><span class="s4">else</span><span class="s1">{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">=</span><span class="s2">e</span><span class="s1">}</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nbformat</span><span class="s1">===</span><span class="s3">4</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">nbformat_minor</span><span class="s1">&gt;=</span><span class="s3">5</span><span class="s1">;</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">cells</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">){</span><span class="s4">delete </span><span class="s2">t</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s4">return </span><span class="s2">t</span><span class="s1">}));</span><span class="s4">this</span><span class="s1">.</span><span class="s2">insertCells</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cells</span><span class="s1">.</span><span class="s2">length</span><span class="s1">,</span><span class="s2">n</span><span class="s1">);</span><span class="s4">this</span><span class="s1">.</span><span class="s2">deleteCellRange</span><span class="s1">(</span><span class="s3">0</span><span class="s1">,</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cells</span><span class="s1">.</span><span class="s2">length</span><span class="s1">)}))}</span><span class="s2">toJSON</span><span class="s1">(){</span><span class="s4">const </span><span class="s2">t</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nbformat</span><span class="s1">===</span><span class="s3">4</span><span class="s1">&amp;&amp;</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nbformat_minor</span><span class="s1">&lt;=</span><span class="s3">4</span><span class="s1">;</span><span class="s4">return</span><span class="s1">{</span><span class="s2">metadata</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">metadata</span><span class="s1">,</span><span class="s2">nbformat_minor</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nbformat_minor</span><span class="s1">,</span><span class="s2">nbformat</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">nbformat</span><span class="s1">,</span><span class="s2">cells</span><span class="s1">:</span><span class="s4">this</span><span class="s1">.</span><span class="s2">cells</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">e</span><span class="s1">=&gt;{</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">e</span><span class="s1">.</span><span class="s2">toJSON</span><span class="s1">();</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">){</span><span class="s4">delete </span><span class="s2">s</span><span class="s1">.</span><span class="s2">id</span><span class="s1">}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">}))}}}},</span><span class="s3">32421</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">HT</span><span class="s1">:()=&gt;</span><span class="s2">r</span><span class="s1">,</span><span class="s2">HV</span><span class="s1">:()=&gt;</span><span class="s2">n</span><span class="s1">,</span><span class="s2">S2</span><span class="s1">:()=&gt;</span><span class="s2">i</span><span class="s1">,</span><span class="s2">cy</span><span class="s1">:()=&gt;</span><span class="s2">h</span><span class="s1">});</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">[</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">-</span><span class="s3">1</span><span class="s1">];</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=()=&gt;[];</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">();</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])}};</span><span class="s4">const </span><span class="s2">r</span><span class="s1">=</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">from</span><span class="s1">;</span><span class="s4">const </span><span class="s2">d</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">const </span><span class="s2">c</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)){</span><span class="s4">return true</span><span class="s1">}}</span><span class="s4">return false</span><span class="s1">};</span><span class="s4">const </span><span class="s2">l</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">===</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">&amp;&amp;</span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">===</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]));</span><span class="s4">const </span><span class="s2">u</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">reduce</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)),[]);</span><span class="s4">const </span><span class="s2">h</span><span class="s1">=</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">isArray</span><span class="s1">;</span><span class="s4">const </span><span class="s2">g</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">r</span><span class="s1">(</span><span class="s2">set</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">t</span><span class="s1">));</span><span class="s4">const </span><span class="s2">f</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">set</span><span class="s1">.</span><span class="s2">create</span><span class="s1">();</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">a</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">a</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">a</span><span class="s1">++){</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">[</span><span class="s2">a</span><span class="s1">];</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=</span><span class="s2">e</span><span class="s1">(</span><span class="s2">o</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">s</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">i</span><span class="s1">)){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">add</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span><span class="s2">n</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">o</span><span class="s1">)}}</span><span class="s4">return </span><span class="s2">n</span><span class="s1">}},</span><span class="s3">53110</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">EK</span><span class="s1">:()=&gt;</span><span class="s2">u</span><span class="s1">,</span><span class="s2">OK</span><span class="s1">:()=&gt;</span><span class="s2">a</span><span class="s1">,</span><span class="s2">vo</span><span class="s1">:()=&gt;</span><span class="s2">l</span><span class="s1">});</span><span class="s4">var </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">70641</span><span class="s1">);</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">)=&gt;{</span><span class="s4">try</span><span class="s1">{</span><span class="s4">for</span><span class="s1">(;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">](</span><span class="s2">...e</span><span class="s1">)}}</span><span class="s4">finally</span><span class="s1">{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s2">a</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">)}}};</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=()=&gt;{};</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">();</span><span class="s4">const </span><span class="s2">r</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">;</span><span class="s4">const </span><span class="s2">d</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">===</span><span class="s2">e</span><span class="s1">;</span><span class="s4">const </span><span class="s2">c</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">===</span><span class="s2">e</span><span class="s1">||</span><span class="s2">t</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">e</span><span class="s1">!=</span><span class="s4">null</span><span class="s1">&amp;&amp;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">constructor</span><span class="s1">===</span><span class="s2">e</span><span class="s1">.</span><span class="s2">constructor</span><span class="s1">&amp;&amp;(</span><span class="s2">t </span><span class="s4">instanceof </span><span class="s2">Array</span><span class="s1">&amp;&amp;</span><span class="s2">array</span><span class="s1">.</span><span class="s2">equalFlat</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)||</span><span class="s4">typeof </span><span class="s2">t</span><span class="s1">===</span><span class="s0">&quot;object&quot;</span><span class="s1">&amp;&amp;</span><span class="s2">object</span><span class="s1">.</span><span class="s2">equalFlat</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">));</span><span class="s4">const </span><span class="s2">l</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">==</span><span class="s4">null</span><span class="s1">||</span><span class="s2">e</span><span class="s1">==</span><span class="s4">null</span><span class="s1">){</span><span class="s4">return </span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">constructor</span><span class="s1">!==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">constructor</span><span class="s1">){</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">===</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return true</span><span class="s1">}</span><span class="s4">switch</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">constructor</span><span class="s1">){</span><span class="s4">case </span><span class="s2">ArrayBuffer</span><span class="s1">:</span><span class="s2">t</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Uint8Array</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s2">e</span><span class="s1">=</span><span class="s4">new </span><span class="s2">Uint8Array</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">case </span><span class="s2">Uint8Array</span><span class="s1">:{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">byteLength</span><span class="s1">!==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">byteLength</span><span class="s1">){</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]!==</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">break</span><span class="s1">}</span><span class="s4">case </span><span class="s2">Set</span><span class="s1">:{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">size</span><span class="s1">!==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">size</span><span class="s1">){</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">s of t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">break</span><span class="s1">}</span><span class="s4">case </span><span class="s2">Map</span><span class="s1">:{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">size</span><span class="s1">!==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">size</span><span class="s1">){</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">s of t</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">()){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">s</span><span class="s1">)||!</span><span class="s2">l</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">s</span><span class="s1">),</span><span class="s2">e</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">s</span><span class="s1">))){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">break</span><span class="s1">}</span><span class="s4">case </span><span class="s2">Object</span><span class="s1">:</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">.</span><span class="s2">Bw</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)!==</span><span class="s2">n</span><span class="s1">.</span><span class="s2">Bw</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)){</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">s </span><span class="s4">in </span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">n</span><span class="s1">.</span><span class="s2">i5</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)||!</span><span class="s2">l</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">break</span><span class="s1">;</span><span class="s4">case </span><span class="s2">Array</span><span class="s1">:</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">!==</span><span class="s2">e</span><span class="s1">.</span><span class="s2">length</span><span class="s1">){</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">for</span><span class="s1">(</span><span class="s4">let </span><span class="s2">s</span><span class="s1">=</span><span class="s3">0</span><span class="s1">;</span><span class="s2">s</span><span class="s1">&lt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span><span class="s2">s</span><span class="s1">++){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">l</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">])){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">break</span><span class="s1">;</span><span class="s4">default</span><span class="s1">:</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">const </span><span class="s2">u</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">e</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)},</span><span class="s3">61662</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">C</span><span class="s1">:()=&gt;</span><span class="s2">a</span><span class="s1">,</span><span class="s2">Tj</span><span class="s1">:()=&gt;</span><span class="s2">i</span><span class="s1">,</span><span class="s2">_4</span><span class="s1">:()=&gt;</span><span class="s2">o</span><span class="s1">,</span><span class="s2">bz</span><span class="s1">:()=&gt;</span><span class="s2">r</span><span class="s1">,</span><span class="s2">vt</span><span class="s1">:()=&gt;</span><span class="s2">n</span><span class="s1">});</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=()=&gt;</span><span class="s4">new </span><span class="s2">Map</span><span class="s1">;</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">n</span><span class="s1">();</span><span class="s2">t</span><span class="s1">.</span><span class="s2">forEach</span><span class="s1">(((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">e</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">s</span><span class="s1">,</span><span class="s2">t</span><span class="s1">)}));</span><span class="s4">return </span><span class="s2">e</span><span class="s1">};</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s4">let </span><span class="s2">n</span><span class="s1">=</span><span class="s2">t</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">===</span><span class="s2">undefined</span><span class="s1">){</span><span class="s2">t</span><span class="s1">.</span><span class="s2">set</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">())}</span><span class="s4">return </span><span class="s2">n</span><span class="s1">};</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const</span><span class="s1">[</span><span class="s2">n</span><span class="s1">,</span><span class="s2">a</span><span class="s1">]</span><span class="s2">of t</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">(</span><span class="s2">a</span><span class="s1">,</span><span class="s2">n</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">};</span><span class="s4">const </span><span class="s2">r</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const</span><span class="s1">[</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">]</span><span class="s2">of t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)){</span><span class="s4">return true</span><span class="s1">}}</span><span class="s4">return false</span><span class="s1">};</span><span class="s4">const </span><span class="s2">d</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const</span><span class="s1">[</span><span class="s2">s</span><span class="s1">,</span><span class="s2">n</span><span class="s1">]</span><span class="s2">of t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">(</span><span class="s2">n</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">return true</span><span class="s1">}},</span><span class="s3">63616</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">RI</span><span class="s1">:()=&gt;</span><span class="s2">n</span><span class="s1">,</span><span class="s2">T9</span><span class="s1">:()=&gt;</span><span class="s2">f</span><span class="s1">,</span><span class="s2">jk</span><span class="s1">:()=&gt;</span><span class="s2">g</span><span class="s1">,</span><span class="s2">sj</span><span class="s1">:()=&gt;</span><span class="s2">b</span><span class="s1">,</span><span class="s2">tn</span><span class="s1">:()=&gt;</span><span class="s2">o</span><span class="s1">});</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">floor</span><span class="s1">;</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">ceil</span><span class="s1">;</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">abs</span><span class="s1">;</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">imul</span><span class="s1">;</span><span class="s4">const </span><span class="s2">r</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">round</span><span class="s1">;</span><span class="s4">const </span><span class="s2">d</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">log10</span><span class="s1">;</span><span class="s4">const </span><span class="s2">c</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">log2</span><span class="s1">;</span><span class="s4">const </span><span class="s2">l</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">log</span><span class="s1">;</span><span class="s4">const </span><span class="s2">u</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">sqrt</span><span class="s1">;</span><span class="s4">const </span><span class="s2">h</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">+</span><span class="s2">e</span><span class="s1">;</span><span class="s4">const </span><span class="s2">g</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s2">e</span><span class="s1">?</span><span class="s2">t</span><span class="s1">:</span><span class="s2">e</span><span class="s1">;</span><span class="s4">const </span><span class="s2">f</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">&gt;</span><span class="s2">e</span><span class="s1">?</span><span class="s2">t</span><span class="s1">:</span><span class="s2">e</span><span class="s1">;</span><span class="s4">const </span><span class="s2">p</span><span class="s1">=</span><span class="s2">Number</span><span class="s1">.</span><span class="s2">isNaN</span><span class="s1">;</span><span class="s4">const </span><span class="s2">m</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">pow</span><span class="s1">;</span><span class="s4">const </span><span class="s2">y</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">pow</span><span class="s1">(</span><span class="s3">10</span><span class="s1">,</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">_</span><span class="s1">=</span><span class="s2">Math</span><span class="s1">.</span><span class="s2">sign</span><span class="s1">;</span><span class="s4">const </span><span class="s2">b</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">!==</span><span class="s3">0</span><span class="s1">?</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">:</span><span class="s3">1</span><span class="s1">/</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">0</span><span class="s1">},</span><span class="s3">70641</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">Bw</span><span class="s1">:()=&gt;</span><span class="s2">d</span><span class="s1">,</span><span class="s2">SQ</span><span class="s1">:()=&gt;</span><span class="s2">g</span><span class="s1">,</span><span class="s2">i5</span><span class="s1">:()=&gt;</span><span class="s2">h</span><span class="s1">});</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=()=&gt;</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">create</span><span class="s1">(</span><span class="s4">null</span><span class="s1">);</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">assign</span><span class="s1">;</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">;</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">s </span><span class="s4">in </span><span class="s2">t</span><span class="s1">){</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">s</span><span class="s1">)}};</span><span class="s4">const </span><span class="s2">r</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=[];</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">n </span><span class="s4">in </span><span class="s2">t</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">n</span><span class="s1">],</span><span class="s2">n</span><span class="s1">))}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">};</span><span class="s4">const </span><span class="s2">d</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">o</span><span class="s1">(</span><span class="s2">t</span><span class="s1">).</span><span class="s2">length</span><span class="s1">;</span><span class="s4">const </span><span class="s2">c</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">s </span><span class="s4">in </span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">s</span><span class="s1">)){</span><span class="s4">return true</span><span class="s1">}}</span><span class="s4">return false</span><span class="s1">};</span><span class="s4">const </span><span class="s2">l</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">e </span><span class="s4">in </span><span class="s2">t</span><span class="s1">){</span><span class="s4">return false</span><span class="s1">}</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">const </span><span class="s2">u</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;{</span><span class="s4">for</span><span class="s1">(</span><span class="s4">const </span><span class="s2">s </span><span class="s4">in </span><span class="s2">t</span><span class="s1">){</span><span class="s4">if</span><span class="s1">(!</span><span class="s2">e</span><span class="s1">(</span><span class="s2">t</span><span class="s1">[</span><span class="s2">s</span><span class="s1">],</span><span class="s2">s</span><span class="s1">)){</span><span class="s4">return false</span><span class="s1">}}</span><span class="s4">return true</span><span class="s1">};</span><span class="s4">const </span><span class="s2">h</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">);</span><span class="s4">const </span><span class="s2">g</span><span class="s1">=(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">)=&gt;</span><span class="s2">t</span><span class="s1">===</span><span class="s2">e</span><span class="s1">||</span><span class="s2">d</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)===</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)&amp;&amp;</span><span class="s2">u</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,((</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;(</span><span class="s2">t</span><span class="s1">!==</span><span class="s2">undefined</span><span class="s1">||</span><span class="s2">h</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">))&amp;&amp;</span><span class="s2">e</span><span class="s1">[</span><span class="s2">s</span><span class="s1">]===</span><span class="s2">t</span><span class="s1">))},</span><span class="s3">5739</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">c</span><span class="s1">:()=&gt;</span><span class="s2">i</span><span class="s1">});</span><span class="s4">var </span><span class="s2">n</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">61662</span><span class="s1">);</span><span class="s4">var </span><span class="s2">a</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">25404</span><span class="s1">);</span><span class="s4">var </span><span class="s2">o</span><span class="s1">=</span><span class="s2">s</span><span class="s1">(</span><span class="s3">32421</span><span class="s1">);</span><span class="s4">class </span><span class="s2">i</span><span class="s1">{</span><span class="s2">constructor</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_observers</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">vt</span><span class="s1">()}</span><span class="s2">on</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s2">n</span><span class="s1">.</span><span class="s2">_4</span><span class="s1">(</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_observers</span><span class="s1">,</span><span class="s2">t</span><span class="s1">,</span><span class="s2">a</span><span class="s1">.</span><span class="s2">vt</span><span class="s1">).</span><span class="s2">add</span><span class="s1">(</span><span class="s2">e</span><span class="s1">)}</span><span class="s2">once</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=(</span><span class="s2">...n</span><span class="s1">)=&gt;{</span><span class="s4">this</span><span class="s1">.</span><span class="s2">off</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">);</span><span class="s2">e</span><span class="s1">(</span><span class="s2">...n</span><span class="s1">)};</span><span class="s4">this</span><span class="s1">.</span><span class="s2">on</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)}</span><span class="s2">off</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_observers</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">!==</span><span class="s2">undefined</span><span class="s1">){</span><span class="s2">s</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">e</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">s</span><span class="s1">.</span><span class="s2">size</span><span class="s1">===</span><span class="s3">0</span><span class="s1">){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_observers</span><span class="s1">.</span><span class="s2">delete</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)}}}</span><span class="s2">emit</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">){</span><span class="s4">return </span><span class="s2">o</span><span class="s1">.</span><span class="s2">HT</span><span class="s1">((</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_observers</span><span class="s1">.</span><span class="s2">get</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)||</span><span class="s2">n</span><span class="s1">.</span><span class="s2">vt</span><span class="s1">()).</span><span class="s2">values</span><span class="s1">()).</span><span class="s2">forEach</span><span class="s1">((</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">(</span><span class="s2">...e</span><span class="s1">)))}</span><span class="s2">destroy</span><span class="s1">(){</span><span class="s4">this</span><span class="s1">.</span><span class="s2">_observers</span><span class="s1">=</span><span class="s2">n</span><span class="s1">.</span><span class="s2">vt</span><span class="s1">()}}},</span><span class="s3">25404</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">vt</span><span class="s1">:()=&gt;</span><span class="s2">n</span><span class="s1">});</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=()=&gt;</span><span class="s4">new </span><span class="s2">Set</span><span class="s1">;</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">Array</span><span class="s1">.</span><span class="s2">from</span><span class="s1">(</span><span class="s2">t</span><span class="s1">);</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s2">t</span><span class="s1">.</span><span class="s2">values</span><span class="s1">().</span><span class="s2">next</span><span class="s1">().</span><span class="s2">value</span><span class="s1">||</span><span class="s2">undefined</span><span class="s1">;</span><span class="s4">const </span><span class="s2">i</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;</span><span class="s4">new </span><span class="s2">Set</span><span class="s1">(</span><span class="s2">t</span><span class="s1">)},</span><span class="s3">64191</span><span class="s1">:(</span><span class="s2">t</span><span class="s1">,</span><span class="s2">e</span><span class="s1">,</span><span class="s2">s</span><span class="s1">)=&gt;{</span><span class="s2">s</span><span class="s1">.</span><span class="s2">d</span><span class="s1">(</span><span class="s2">e</span><span class="s1">,{</span><span class="s2">_g</span><span class="s1">:()=&gt;</span><span class="s2">a</span><span class="s1">});</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=()=&gt;</span><span class="s4">new </span><span class="s2">Date</span><span class="s1">;</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">Date</span><span class="s1">.</span><span class="s2">now</span><span class="s1">;</span><span class="s4">const </span><span class="s2">o</span><span class="s1">=</span><span class="s2">t</span><span class="s1">=&gt;{</span><span class="s4">if</span><span class="s1">(</span><span class="s2">t</span><span class="s1">&lt;</span><span class="s3">6e4</span><span class="s1">){</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">metric</span><span class="s1">.</span><span class="s2">prefix</span><span class="s1">(</span><span class="s2">t</span><span class="s1">,-</span><span class="s3">1</span><span class="s1">);</span><span class="s4">return </span><span class="s2">math</span><span class="s1">.</span><span class="s2">round</span><span class="s1">(</span><span class="s2">e</span><span class="s1">.</span><span class="s2">n</span><span class="s1">*</span><span class="s3">100</span><span class="s1">)/</span><span class="s3">100</span><span class="s1">+</span><span class="s2">e</span><span class="s1">.</span><span class="s2">prefix</span><span class="s1">+</span><span class="s0">&quot;s&quot;</span><span class="s1">}</span><span class="s2">t</span><span class="s1">=</span><span class="s2">math</span><span class="s1">.</span><span class="s2">floor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">/</span><span class="s3">1e3</span><span class="s1">);</span><span class="s4">const </span><span class="s2">e</span><span class="s1">=</span><span class="s2">t</span><span class="s1">%</span><span class="s3">60</span><span class="s1">;</span><span class="s4">const </span><span class="s2">s</span><span class="s1">=</span><span class="s2">math</span><span class="s1">.</span><span class="s2">floor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">/</span><span class="s3">60</span><span class="s1">)%</span><span class="s3">60</span><span class="s1">;</span><span class="s4">const </span><span class="s2">n</span><span class="s1">=</span><span class="s2">math</span><span class="s1">.</span><span class="s2">floor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">/</span><span class="s3">3600</span><span class="s1">)%</span><span class="s3">24</span><span class="s1">;</span><span class="s4">const </span><span class="s2">a</span><span class="s1">=</span><span class="s2">math</span><span class="s1">.</span><span class="s2">floor</span><span class="s1">(</span><span class="s2">t</span><span class="s1">/</span><span class="s3">86400</span><span class="s1">);</span><span class="s4">if</span><span class="s1">(</span><span class="s2">a</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">return </span><span class="s2">a</span><span class="s1">+</span><span class="s0">&quot;d&quot;</span><span class="s1">+(</span><span class="s2">n</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">s</span><span class="s1">&gt;</span><span class="s3">30</span><span class="s1">?</span><span class="s0">&quot; &quot;</span><span class="s1">+(</span><span class="s2">s</span><span class="s1">&gt;</span><span class="s3">30</span><span class="s1">?</span><span class="s2">n</span><span class="s1">+</span><span class="s3">1</span><span class="s1">:</span><span class="s2">n</span><span class="s1">)+</span><span class="s0">&quot;h&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)}</span><span class="s4">if</span><span class="s1">(</span><span class="s2">n</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">){</span><span class="s4">return </span><span class="s2">n</span><span class="s1">+</span><span class="s0">&quot;h&quot;</span><span class="s1">+(</span><span class="s2">s</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">||</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">30</span><span class="s1">?</span><span class="s0">&quot; &quot;</span><span class="s1">+(</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">30</span><span class="s1">?</span><span class="s2">s</span><span class="s1">+</span><span class="s3">1</span><span class="s1">:</span><span class="s2">s</span><span class="s1">)+</span><span class="s0">&quot;min&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)}</span><span class="s4">return </span><span class="s2">s</span><span class="s1">+</span><span class="s0">&quot;min&quot;</span><span class="s1">+(</span><span class="s2">e</span><span class="s1">&gt;</span><span class="s3">0</span><span class="s1">?</span><span class="s0">&quot; &quot;</span><span class="s1">+</span><span class="s2">e</span><span class="s1">+</span><span class="s0">&quot;s&quot;</span><span class="s1">:</span><span class="s0">&quot;&quot;</span><span class="s1">)}}}]);</span></pre>
</body>
</html>